

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>NAS.NASUtils.nasclient &mdash; Commvault Automation 11.20 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>NAS.NASUtils.nasclient</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for NAS.NASUtils.nasclient</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;Main file for managing operations on nas filer</span>

<span class="sd">An object of NASClient will be returned for each nas filer.</span>

<span class="sd">NASClient, NetAPPClusterClient, NetAPPClient, Volume, IsilonClient, HuaweiClient,</span>
<span class="sd">UnityVnxCelerraClient,and HNASClient are 8 classes defined in this file</span>

<span class="sd">NASClient: Base class for any NAS Client</span>

<span class="sd">NetAPPClusterClient: Class to perform operations on NetAPP cluster filer</span>

<span class="sd">NetAPPClient: Class to perform operations on NetAPP filer</span>

<span class="sd">Volume: Class to perform operations on Volume</span>

<span class="sd">IsilonClient: Class to perform operations on Isilon Filer</span>

<span class="sd">HuaweiClient: Class to perform operations on Huawei filer</span>

<span class="sd">UnityVnxCelerraClient: Class to perform operations on Unity/ Celerra/ VNX Clients</span>

<span class="sd">HNASClient: Class to perform operation on HNAS filer</span>

<span class="sd">NASClient:</span>
<span class="sd">    __init__()      --  initialize nas filer object</span>

<span class="sd">    copy_folder()       --  copies the source folder to specified destination path</span>

<span class="sd">    compare_volumes()   --  compares the content on two volumes of same filer</span>

<span class="sd">    compare_folders()   --  compares the content on 2 different machines (Windows/Unix/Filer)</span>

<span class="sd">    get_content_size()  --  returns the storage size for the specified volume path</span>


<span class="sd">Volume:</span>
<span class="sd">    __init__()      --  initializes the volume object for specified filer</span>

<span class="sd">    restrict()      --  restricts this volume</span>

<span class="sd">    status()        --  returns the status of this volume</span>

<span class="sd">    online()        --  process the volume to make online</span>

<span class="sd">    snap_list()     --  returns the list of snaps associated with this volume</span>

<span class="sd">    has_snap()      --  checks if snap with specified name exists on this volume</span>

<span class="sd">    create_snap()   --  creates the snap with specified name</span>

<span class="sd">    delete_snap()   --  deletes the snap with specified name</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.pyping</span> <span class="kn">import</span> <span class="n">ping</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.machine</span> <span class="kn">import</span> <span class="n">Machine</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.unix_machine</span> <span class="kn">import</span> <span class="n">UnixMachine</span>


<div class="viewcode-block" id="NASClient"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NASClient">[docs]</a><span class="k">class</span> <span class="nc">NASClient</span><span class="p">(</span><span class="n">UnixMachine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class to connect to nas client&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filer_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">controlhost</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the instance of one of the Subclasses NASClient,</span>
<span class="sd">            based on the instance of the class.</span>

<span class="sd">            Pings the filer and make sure it is accessible</span>

<span class="sd">            If we get TTL value it means machine is pingable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">ping</span><span class="p">(</span><span class="n">filer_name</span><span class="p">)</span>

        <span class="c1"># Extract TTL value form the response.output string.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(.*)ttl=(\d*) .*&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Failed to connect to the machine.</span><span class="se">\n</span><span class="s1">Error: &quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filer_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the filer client object</span>

<span class="sd">            Args:</span>
<span class="sd">                filer_name          (str)           --  name of filer to be connected</span>

<span class="sd">                commcell_object     (object)    --    python sdk commcell object</span>

<span class="sd">                username            (str)           --  name of the user which should be used to</span>
<span class="sd">                                                        make a connection to client</span>

<span class="sd">                password            (str)           --  password of filer to be connected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">UnixMachine</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filer_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span> <span class="o">=</span> <span class="n">filer_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_access</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_login_with_credentials</span><span class="p">()</span>

        <span class="c1"># create logger object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>

        <span class="c1"># get local machine object</span>
        <span class="kn">import</span> <span class="nn">socket</span>
        <span class="n">local_machine</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="o">=</span> <span class="n">agent_obj</span><span class="o">.</span><span class="n">agent_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">local_machine</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_folder_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ignore_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;MD5&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the set of volume paths and its hash value</span>

<span class="sd">            Args:</span>
<span class="sd">                content     (str)   --  content for which the folder hash is to be calculated</span>

<span class="sd">                ignore_folder       (list)  --  list of folders to be ignored.</span>
<span class="sd">                Default: None.</span>

<span class="sd">              ignore_case         (bool)  --  ignores the case if set to True.</span>
<span class="sd">                Default: False.</span>

<span class="sd">              algorithm           (str)   --  Specifies the cryptographic hash function</span>
<span class="sd">                    to use for computing the hash value of the contents.</span>

<span class="sd">                Default: &quot;MD5&quot;</span>

<span class="sd">              The acceptable values for algorithm parameter are:</span>
<span class="sd">                 * SHA1</span>
<span class="sd">                 * SHA256</span>
<span class="sd">                 * SHA384</span>
<span class="sd">                 * SHA512</span>
<span class="sd">                 * MD5</span>

<span class="sd">            Returns:</span>
<span class="sd">                set of file paths and their hash value</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if CIFS share is not connected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_access</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;CIFS share is not connected. &quot;</span>
                <span class="s2">&quot;Please connect it by calling connect_to_cifs_share().&quot;</span><span class="p">)</span>
        <span class="n">volume_path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path_from_content</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="n">mount_drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span><span class="o">.</span><span class="n">mount_network_path</span><span class="p">(</span>
            <span class="n">volume_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_password</span>
        <span class="p">)</span>
        <span class="n">hash_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span><span class="o">.</span><span class="n">_get_folder_hash</span><span class="p">(</span><span class="n">mount_drive</span><span class="p">,</span> <span class="n">ignore_folder</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span><span class="o">.</span><span class="n">unmount_drive</span><span class="p">(</span><span class="n">mount_drive</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hash_value</span>

<div class="viewcode-block" id="NASClient.remove_folder"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NASClient.remove_folder">[docs]</a>    <span class="k">def</span> <span class="nf">remove_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_path</span><span class="p">):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">volume_path</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="NASClient.exec_command"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NASClient.exec_command">[docs]</a>    <span class="k">def</span> <span class="nf">exec_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executes commands on filer&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_login_with_credentials</span><span class="p">()</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running Command: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

            <span class="c1"># Wait for the command to terminate</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">stdout</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">exit_status_ready</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">stdout</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">recv_ready</span><span class="p">():</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">out</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to execute command with error: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="NASClient.get_volumes_by_pattern"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NASClient.get_volumes_by_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">get_volumes_by_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns list of all volumes which match certain pattern</span>

<span class="sd">            Args:</span>
<span class="sd">                content     (str)   --  pattern which can be mapped with volumes on filer</span>
<span class="sd">                    Ex: /vol/My_Volume_*</span>

<span class="sd">            Returns:</span>
<span class="sd">                list of volumes that matches the pattern</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Determine the volumes list for </span><span class="si">%s</span><span class="s2"> pattern&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="n">volumes_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path_from_content</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">vol</span><span class="p">:</span>
                <span class="n">volumes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Volumes list from pattern: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">volumes_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">volumes_list</span></div>

<div class="viewcode-block" id="NASClient.copy_folder"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NASClient.copy_folder">[docs]</a>    <span class="k">def</span> <span class="nf">copy_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">volume_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies the source folder content to the specified volume path</span>

<span class="sd">            Args:</span>
<span class="sd">                source_path     (str)   --  source folder path</span>

<span class="sd">                volume_path     (str)   --  destination volume path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_access</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;CIFS share is not connected. &quot;</span>
                <span class="s2">&quot;Please connect it by calling connect_to_cifs_share().&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span><span class="o">.</span><span class="n">copy_folder_to_network_share</span><span class="p">(</span>
            <span class="n">source_path</span><span class="p">,</span> <span class="n">volume_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_password</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="NASClient.get_restore_volume"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NASClient.get_restore_volume">[docs]</a>    <span class="k">def</span> <span class="nf">get_restore_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20480</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the volume name that can be used in restore job</span>

<span class="sd">            Args:</span>
<span class="sd">                size    (int)   --  min size in MB that should be available on volume to be</span>
<span class="sd">                                        selected for restore job</span>
<span class="sd">                    default: 20480</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;df -m&#39;</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to get available space on all volumes with error: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)))</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">vol_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vol</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="n">vol</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;/.snapshot&#39;</span> <span class="ow">in</span> <span class="n">vol</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="n">vol_dict</span><span class="p">[</span><span class="n">vol</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">vol</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="s2">&quot;/vol/</span><span class="si">{0}</span><span class="s2">/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vol</span> <span class="ow">in</span> <span class="n">vol_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">vol_dict</span><span class="p">[</span><span class="n">vol</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">vol</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">&quot;Failed to get restore volume. &quot;</span>
            <span class="s2">&quot;Please check if enough space is avaialble on any of your volume&quot;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="NASClient.connect_to_cifs_share"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NASClient.connect_to_cifs_share">[docs]</a>    <span class="k">def</span> <span class="nf">connect_to_cifs_share</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the connection parameters to connect to cifs share</span>

<span class="sd">            Args:</span>
<span class="sd">                username    (str)   --  name of the user which should be used to make a</span>
<span class="sd">                                            cifs share connection</span>

<span class="sd">                password    (str)   --  asscoiated authentication string for the specified user</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_access</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="NASClient.compare_volumes"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NASClient.compare_volumes">[docs]</a>    <span class="k">def</span> <span class="nf">compare_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_volume</span><span class="p">,</span> <span class="n">destination_volume</span><span class="p">,</span> <span class="n">ignore_files</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Compares the two volumes on this filer</span>

<span class="sd">            Args:</span>
<span class="sd">                source_volume           (str)    --  source volume on this filer</span>

<span class="sd">                destination_volume      (str)       --  destination volume on this filer</span>

<span class="sd">                ignore_files            (list)      --  list of files/patterns to be ignored</span>
<span class="sd">                    default: []</span>

<span class="sd">            Returns:</span>
<span class="sd">                list -  list of file paths if any are difference exists else []</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if cifs share credentials are not specified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_access</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;CIFS share is not connected.&quot;</span>
                            <span class="s2">&quot;Please connect it by calling connect_to_cifs_share().&quot;</span><span class="p">)</span>

        <span class="n">source_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span><span class="p">,</span> <span class="n">source_volume</span><span class="p">)</span>
        <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span><span class="p">,</span> <span class="n">destination_volume</span><span class="p">)</span>

        <span class="n">source_drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span><span class="o">.</span><span class="n">mount_network_path</span><span class="p">(</span>
            <span class="n">source_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_password</span>
        <span class="p">)</span>

        <span class="n">destination_drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span><span class="o">.</span><span class="n">mount_network_path</span><span class="p">(</span>
            <span class="n">destination_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_password</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span><span class="o">.</span><span class="n">compare_folders</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span><span class="p">,</span> <span class="n">source_drive</span><span class="p">,</span> <span class="n">destination_drive</span><span class="p">,</span> <span class="n">ignore_files</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="NASClient.compare_folders"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NASClient.compare_folders">[docs]</a>    <span class="k">def</span> <span class="nf">compare_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination_machine</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">,</span> <span class="n">ignore_files</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Compares the two directories on different machines</span>

<span class="sd">            Args:</span>
<span class="sd">                destination_machine     (object)    --  Machine class object for destination</span>
<span class="sd">                                                            machine</span>

<span class="sd">                content                 (str)       --  subclient content path</span>

<span class="sd">                destination_path        (str)       --  path on destination machine that is to be</span>
<span class="sd">                                                            compared</span>

<span class="sd">                ignore_files            (list)      --  list of files/patterns to be ignored</span>
<span class="sd">                    default: []</span>

<span class="sd">            Returns:</span>
<span class="sd">                list -  list of file paths if any are difference exists else []</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if source_path does not exist</span>

<span class="sd">                    if destination_path does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_folder_hash</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">ignore_files</span><span class="p">)</span>
        <span class="n">destination_hash</span> <span class="o">=</span> <span class="n">destination_machine</span><span class="o">.</span><span class="n">_get_folder_hash</span><span class="p">(</span><span class="n">destination_path</span><span class="p">,</span> <span class="n">ignore_files</span><span class="p">)</span>

        <span class="n">difference</span> <span class="o">=</span> <span class="n">source_hash</span> <span class="o">-</span> <span class="n">destination_hash</span>

        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">difference</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">destination_machine</span><span class="o">.</span><span class="n">_validate_ignore_files</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">ignore_files</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="NASClient.get_content_size"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NASClient.get_content_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_content_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the total size in MB for specified content</span>

<span class="sd">            Args:</span>
<span class="sd">                contents    (list)  -- subclient content list</span>

<span class="sd">            Returns:</span>
<span class="sd">                total size of specified contents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get subclient content size&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_access</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;CIFS share is not connected.&quot;</span>
                            <span class="s2">&quot;Please connect it by calling connect_to_cifs_share().&quot;</span><span class="p">)</span>

        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">volume_path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path_from_content</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">mount_drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span><span class="o">.</span><span class="n">mount_network_path</span><span class="p">(</span>
                <span class="n">volume_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_password</span>
            <span class="p">)</span>

            <span class="n">size</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span><span class="o">.</span><span class="n">get_folder_size</span><span class="p">(</span><span class="n">mount_drive</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span><span class="o">.</span><span class="n">unmount_drive</span><span class="p">(</span><span class="n">mount_drive</span><span class="p">)</span>

        <span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Obtained subclient size: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size</span></div>

<div class="viewcode-block" id="NASClient.get_fs_from_path_fsnas"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NASClient.get_fs_from_path_fsnas">[docs]</a>    <span class="k">def</span> <span class="nf">get_fs_from_path_fsnas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns fs name from subclient content path (applicable for FS under NAS)</span>

<span class="sd">            Args:</span>
<span class="sd">                content  (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fsname</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fsname</span></div></div>

<div class="viewcode-block" id="NetAPPClusterClient"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NetAPPClusterClient">[docs]</a><span class="k">class</span> <span class="nc">NetAPPClusterClient</span><span class="p">(</span><span class="n">NASClient</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent NetAPPClusterClient&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filer_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span>
                 <span class="n">controlhost</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the netapp cluster client object</span>

<span class="sd">            Args:</span>
<span class="sd">                filer_name          (str)           --  name of filer to be connected</span>

<span class="sd">                commcell_object     (object)    --    python sdk commcell object</span>

<span class="sd">                username            (str)           --  name of the user which should be used to</span>
<span class="sd">                                                        make a connection to client</span>

<span class="sd">                password            (str)           --  password of filer to be connected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">NASClient</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filer_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_cluster</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_get_used_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">vserver</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the available space on the volume</span>

<span class="sd">            Args:</span>
<span class="sd">                volume      (str)   --  name of the volume on specified vserver for which the</span>
<span class="sd">                                            used space is to be computed</span>

<span class="sd">                vserver     (str)   --  name of the vserver on which the specified volume</span>
<span class="sd">                                            is mounted</span>

<span class="sd">            Returns:</span>
<span class="sd">                int     -   total used space by contents on volume</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to get used space on specified volume</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;volume show -vserver </span><span class="si">{0}</span><span class="s2"> -volume </span><span class="si">{1}</span><span class="s2"> -fields used&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vserver</span><span class="p">,</span> <span class="n">volume</span><span class="p">)</span>

        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to get used space on volume </span><span class="si">{0}</span><span class="s2"> with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s2">&quot;MB&quot;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="s2">&quot;GB&quot;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;GB&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span>

<div class="viewcode-block" id="NetAPPClusterClient.get_content_size"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NetAPPClusterClient.get_content_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_content_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the total size in MB for specified content</span>

<span class="sd">            Args:</span>
<span class="sd">                contents    (list)  -- subclient content list</span>

<span class="sd">            Returns:</span>
<span class="sd">                int     -   total size of specified contents</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get subclient content size&quot;</span><span class="p">)</span>

        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">vserver</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">size</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_used_space</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">vserver</span><span class="p">)</span>

        <span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Obtained subclient size: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size</span></div>

<div class="viewcode-block" id="NetAPPClusterClient.get_vserver_ip"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NetAPPClusterClient.get_vserver_ip">[docs]</a>    <span class="k">def</span> <span class="nf">get_vserver_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vserver_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the vserver ip of specified vserver name</span>

<span class="sd">            Args:</span>
<span class="sd">                vserver_name    (str)   --  name of the vserver whose ip is to be determined</span>

<span class="sd">            Returns:</span>
<span class="sd">                str     -   ip of the specified vserver</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;network interface show -data-protocol cifs -vserver </span><span class="si">{0}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                    -status-admin up -fields Address&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vserver_name</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get vserver ip with error: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)))</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>

<div class="viewcode-block" id="NetAPPClusterClient.get_path_from_content"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NetAPPClusterClient.get_path_from_content">[docs]</a>    <span class="k">def</span> <span class="nf">get_path_from_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the CIFS Share path and volume name</span>

<span class="sd">            Args:</span>
<span class="sd">                content     (str)   --  volume path from the subclient content</span>

<span class="sd">            Returns:</span>
<span class="sd">                (str, str)  -   cifs share path and path of the volume</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">vserver_name</span><span class="p">,</span> <span class="n">volume_name</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">vserver_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vserver_ip</span><span class="p">(</span><span class="n">vserver_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="si">{0}</span><span class="s2">\</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vserver_ip</span><span class="p">,</span> <span class="n">volume_name</span><span class="p">),</span> <span class="n">volume_name</span></div></div>


<div class="viewcode-block" id="NetAPPClient"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NetAPPClient">[docs]</a><span class="k">class</span> <span class="nc">NetAPPClient</span><span class="p">(</span><span class="n">NASClient</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent NetAPPClient&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filer_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span>
                 <span class="n">controlhost</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the netapp client object</span>

<span class="sd">            Args:</span>
<span class="sd">                filer_name          (str)           --  name of filer to be connected</span>

<span class="sd">                commcell_object     (object)    --    python sdk commcell object</span>

<span class="sd">                username            (str)           --  name of the user which should be used to</span>
<span class="sd">                                                        make a connection to client</span>

<span class="sd">                password            (str)           --  password of filer to be connected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">NASClient</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filer_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_volumes</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns list of volumes on filer&quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;vol status&#39;</span>

        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get list of all volumes with error: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)))</span>

        <span class="n">volumes_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="n">vol</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">vol</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;online&quot;</span><span class="p">:</span>
                    <span class="n">volumes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">vol</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">volumes_list</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Treats volumes as a read-only property&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volumes</span>

<div class="viewcode-block" id="NetAPPClient.has_volume"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NetAPPClient.has_volume">[docs]</a>    <span class="k">def</span> <span class="nf">has_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if volume with specififed name exists on filer</span>

<span class="sd">            Args:</span>
<span class="sd">                volume_name     (str)   --  name of the volume which is to be checked</span>
<span class="sd">                                                if exists on this filer</span>

<span class="sd">            Returns:</span>
<span class="sd">                True    -   if volume exist on this filer</span>

<span class="sd">                False   -   if volume does not exist on this filer</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">volume_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="NetAPPClient.get_content_size"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NetAPPClient.get_content_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_content_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the total size in MB for specified content</span>

<span class="sd">            Args:</span>
<span class="sd">                contents    (list)  -- subclient content list</span>

<span class="sd">            Returns:</span>
<span class="sd">                total size of specified contents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get subclient content size&quot;</span><span class="p">)</span>

        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_volume</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">size</span> <span class="o">+=</span> <span class="n">volume</span><span class="o">.</span><span class="n">used_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Obtained subclient size: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="n">size</span></div>

<div class="viewcode-block" id="NetAPPClient.get_volume"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NetAPPClient.get_volume">[docs]</a>    <span class="k">def</span> <span class="nf">get_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns volume class object for specified volume name</span>

<span class="sd">            Args:</span>
<span class="sd">                volume_name     (str)   --  name of the volume for which the Volume object</span>
<span class="sd">                                                is to be created</span>

<span class="sd">            Returns:</span>
<span class="sd">                object  -   Volume class object for specified volume</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if specified volume doesn&#39;t exist on this filer</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;/vol/&quot;</span> <span class="ow">in</span> <span class="n">volume_name</span><span class="p">:</span>
            <span class="n">volume_name</span> <span class="o">=</span> <span class="n">volume_name</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/vol/&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_volume</span><span class="p">(</span><span class="n">volume_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Volume </span><span class="si">{0}</span><span class="s2"> doesn&#39;t exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volume_name</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetAPPClient.get_path_from_content"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.NetAPPClient.get_path_from_content">[docs]</a>    <span class="k">def</span> <span class="nf">get_path_from_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the CIFS Share path and volume name&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;NDMP&#39;</span><span class="p">:</span>
            <span class="n">volume_name</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">vol</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="si">{0}</span><span class="s2">\</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span><span class="p">,</span> <span class="n">volume_name</span><span class="p">),</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fsname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fs_from_path_fsnas</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">content</span><span class="p">,</span> <span class="n">fsname</span></div></div>

<div class="viewcode-block" id="Volume"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.Volume">[docs]</a><span class="k">class</span> <span class="nc">Volume</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to manage volume level operations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filer_obj</span><span class="p">,</span> <span class="n">volume_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes Volume object</span>

<span class="sd">            Args:</span>
<span class="sd">                filer_obj       (object)    --  instance of the filer client class on which</span>
<span class="sd">                                                    this volume is present</span>

<span class="sd">                volume_name     (str)       --  name of the volume for which this</span>
<span class="sd">                                                    class object is initialized</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filer_obj</span> <span class="o">=</span> <span class="n">filer_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span> <span class="o">=</span> <span class="n">volume_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_usage_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Populates the memory usage details for this volume&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get the memory usage details of </span><span class="si">%s</span><span class="s2"> volume&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;df -m </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>

        <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filer_obj</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to get </span><span class="si">{0}</span><span class="s2"> volume details with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; +&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;.snapshot&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">row</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get volume details&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">available_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the available space in MB on this volume&quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_usage_details</span><span class="p">()</span>
        <span class="n">available_space</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">available_space</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">used_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the used space in MB by this volume&quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_usage_details</span><span class="p">()</span>
        <span class="n">used_space</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">used_space</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the total space in MB on this volume&quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_usage_details</span><span class="p">()</span>
        <span class="n">total_space</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_space</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Treats the name as  a read-only property&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span>

<div class="viewcode-block" id="Volume.restrict"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.Volume.restrict">[docs]</a>    <span class="k">def</span> <span class="nf">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Restricts this volume&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restricting volume: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;vol restrict /vol/</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filer_obj</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="s2">&quot;is already restricted&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to restrict volume </span><span class="si">{0}</span><span class="s2"> with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully restricted volume&quot;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the status of his volume&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrieving status for volume: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;vol status /vol/</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filer_obj</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to get status of volume </span><span class="si">{0}</span><span class="s2"> with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)))</span>

        <span class="n">status</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">status</span>

<div class="viewcode-block" id="Volume.online"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.Volume.online">[docs]</a>    <span class="k">def</span> <span class="nf">online</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turns ON the volume&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Turning </span><span class="si">%s</span><span class="s2"> volume on&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;vol online /vol/</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filer_obj</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="c1"># Check if any error</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="s2">&quot;is already online&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to make volume : </span><span class="si">{0}</span><span class="s2"> online with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is now ONLINE&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">snaps_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns list of snaps for this volume&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrieving the snaps list for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;snap list </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filer_obj</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="c1"># check if snap is created</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to list snap for volume: </span><span class="si">{0}</span><span class="s2"> with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>

        <span class="n">snaps_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">snaps_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snaps on </span><span class="si">%s</span><span class="s2"> are </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">snaps_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">snaps_list</span>

<div class="viewcode-block" id="Volume.has_snap"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.Volume.has_snap">[docs]</a>    <span class="k">def</span> <span class="nf">has_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if a snap with given name exists on this volume</span>

<span class="sd">            Args:</span>
<span class="sd">                snap_name   (str)   --  name of the snap which has to be checked</span>
<span class="sd">                                            if is created for this volume</span>

<span class="sd">            Returns:</span>
<span class="sd">                True    -   if specified snap was created for this volume</span>

<span class="sd">                False   -   if specified snap was not created for this volume</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">snap_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snaps_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Volume.create_snap"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.Volume.create_snap">[docs]</a>    <span class="k">def</span> <span class="nf">create_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a snap with specified name</span>

<span class="sd">            Args:</span>
<span class="sd">                snap_name   (str)   --  name of the snap which is to be created on this volume</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if a snap with specified name is already exists</span>

<span class="sd">                    if failed to create snap with specified snap name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating snap </span><span class="si">%s</span><span class="s2"> on </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">snap_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_snap</span><span class="p">(</span><span class="n">snap_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> snap already exists on </span><span class="si">{1}</span><span class="s2"> volume&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snap_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;snap create </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">,</span> <span class="n">snap_name</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filer_obj</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="c1"># check if snap is created</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to create snap </span><span class="si">{0}</span><span class="s2"> with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">snap_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created </span><span class="si">%s</span><span class="s2"> snap&quot;</span><span class="p">,</span> <span class="n">snap_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Volume.delete_snap"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.Volume.delete_snap">[docs]</a>    <span class="k">def</span> <span class="nf">delete_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes a snap with specified name</span>

<span class="sd">            Args:</span>
<span class="sd">                snap_name   (str)   --  name of the snap which is to be deleted on this volume</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if a snap with specified name does not exist</span>

<span class="sd">                    if failed to delete snap with specified snap name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting snap </span><span class="si">%s</span><span class="s2"> on </span><span class="si">%s</span><span class="s2">}&quot;</span><span class="p">,</span> <span class="n">snap_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_snap</span><span class="p">(</span><span class="n">snap_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> snap doesn&#39;t exist on volume: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snap_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;snap delete </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_volume_name</span><span class="p">,</span> <span class="n">snap_name</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filer_obj</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="c1"># check if snap is created</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to create snap </span><span class="si">{0}</span><span class="s2"> with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snap_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully deleted </span><span class="si">%s</span><span class="s2"> snap&quot;</span><span class="p">,</span> <span class="n">snap_name</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="IsilonClient"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.IsilonClient">[docs]</a><span class="k">class</span> <span class="nc">IsilonClient</span><span class="p">(</span><span class="n">NASClient</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent IsilonClient&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filer_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">controlhost</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Initializes the Isilon client object</span>

<span class="sd">            Args:</span>
<span class="sd">                filer_name          (str)           --  name of filer to be connected</span>

<span class="sd">                commcell_object     (object)    --  python sdk commcell object</span>

<span class="sd">                username            (str)           --  name of the user which should be used to</span>
<span class="sd">                                                        make a connection to client</span>

<span class="sd">                password            (str)           --  password of filer to be connected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">NASClient</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controlhost</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span> <span class="o">=</span> <span class="n">filer_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_access</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># create logger object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>

        <span class="c1"># get local machine object</span>
        <span class="kn">import</span> <span class="nn">socket</span>
        <span class="n">local_machine</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">local_machine</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">)</span>

<div class="viewcode-block" id="IsilonClient.get_path_from_content"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.IsilonClient.get_path_from_content">[docs]</a>    <span class="k">def</span> <span class="nf">get_path_from_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the CIFS Share path and volume name&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;NDMP&#39;</span><span class="p">:</span>
            <span class="n">volume_name</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">ifs</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="si">{0}</span><span class="s2">\</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span><span class="p">,</span> <span class="n">volume_name</span><span class="p">),</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fsname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fs_from_path_fsnas</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">content</span><span class="p">,</span> <span class="n">fsname</span></div></div>

<div class="viewcode-block" id="HuaweiClient"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.HuaweiClient">[docs]</a><span class="k">class</span> <span class="nc">HuaweiClient</span><span class="p">(</span><span class="n">NASClient</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent Huawei Client&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filer_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">controlhost</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the Huawei client object</span>

<span class="sd">            Args:</span>
<span class="sd">                filer_name          (str)           --  name of filer to be connected</span>

<span class="sd">                commcell_object     (object)    --  python sdk commcell object</span>

<span class="sd">                username            (str)           --  name of the user which should be used to</span>
<span class="sd">                                                        make a connection to client</span>

<span class="sd">                password            (str)           --  password of filer to be connected</span>

<span class="sd">                controlhost         (str)           --  control host of the filer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">NASClient</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controlhost</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span> <span class="o">=</span> <span class="n">filer_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">()</span>

<div class="viewcode-block" id="HuaweiClient.get_fsid_from_path"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.HuaweiClient.get_fsid_from_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_fsid_from_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the FS ID from content path&quot;&quot;&quot;</span>
        <span class="n">fsid</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">fsid</span></div>

<div class="viewcode-block" id="HuaweiClient.get_fsname_from_fsid"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.HuaweiClient.get_fsname_from_fsid">[docs]</a>    <span class="k">def</span> <span class="nf">get_fsname_from_fsid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fsid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the CIFS Share name from fs id&quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;show share cifs|filterRow column=File\sSystem\sID predict=match value=</span><span class="si">{0}</span><span class="s2">|&quot;</span>
                   <span class="s2">&quot;filterColumn include columnList=Name&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fsid</span><span class="p">))</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to get fsname details with error: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                  <span class="p">)</span></div>

<div class="viewcode-block" id="HuaweiClient.get_path_from_content"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.HuaweiClient.get_path_from_content">[docs]</a>    <span class="k">def</span> <span class="nf">get_path_from_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the CIFS path to be mounted&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;NDMP&#39;</span><span class="p">:</span>
            <span class="n">fsid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fsid_from_path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
            <span class="n">fsname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fsname_from_fsid</span><span class="p">(</span><span class="n">fsid</span><span class="p">)</span>
            <span class="n">folderinfs</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">fs&#39;</span><span class="o">+</span><span class="n">fsid</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="si">{0}</span><span class="s2">\</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span><span class="p">,</span> <span class="n">fsname</span><span class="o">+</span><span class="n">folderinfs</span><span class="p">),</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fsname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fs_from_path_fsnas</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">content</span><span class="p">,</span> <span class="n">fsname</span></div></div>

<div class="viewcode-block" id="UnityVnxCelerraClient"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.UnityVnxCelerraClient">[docs]</a><span class="k">class</span> <span class="nc">UnityVnxCelerraClient</span><span class="p">(</span><span class="n">NASClient</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent DELL Unity/ VNX/ Celerra Client&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filer_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">controlhost</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the Unity/ VNX/ Celerra client object</span>

<span class="sd">            Args:</span>
<span class="sd">                filer_name          (str)           --  name of filer to be connected</span>

<span class="sd">                commcell_object     (object)    --  python sdk commcell object</span>

<span class="sd">                username            (str)           --  name of the user which should be used to</span>
<span class="sd">                                                        make a connection to client</span>

<span class="sd">                password            (str)           --  password of filer to be connected</span>

<span class="sd">                controlhost         (str)           --  control host of the file server</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span> <span class="o">=</span> <span class="n">filer_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_access</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># create logger object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="o">=</span> <span class="n">agent_obj</span><span class="o">.</span><span class="n">agent_name</span>
        <span class="c1"># get local machine object</span>
        <span class="kn">import</span> <span class="nn">socket</span>
        <span class="n">local_machine</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">local_machine</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">)</span>

<div class="viewcode-block" id="UnityVnxCelerraClient.get_path_from_content"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.UnityVnxCelerraClient.get_path_from_content">[docs]</a>    <span class="k">def</span> <span class="nf">get_path_from_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the CIFS Share path and volume name&quot;&quot;&quot;</span>
        <span class="n">vol_name</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">volume_name</span> <span class="o">=</span> <span class="n">vol_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="si">{0}</span><span class="s2">\</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span><span class="p">,</span> <span class="n">volume_name</span><span class="p">),</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span></div></div>

<div class="viewcode-block" id="HNASClient"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.HNASClient">[docs]</a><span class="k">class</span> <span class="nc">HNASClient</span><span class="p">(</span><span class="n">NASClient</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent BluearcClient&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filer_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">controlhost</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the HNAS client object</span>

<span class="sd">            Args:</span>
<span class="sd">                filer_name          (str)           --  name of filer to be connected</span>

<span class="sd">                commcell_object     (object)    --  python sdk commcell object</span>

<span class="sd">                username            (str)           --  name of the user which should be used to</span>
<span class="sd">                                                        make a connection to client</span>

<span class="sd">                password            (str)           --  password of filer to be connected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">NASClient</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controlhost</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span> <span class="o">=</span> <span class="n">filer_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cifs_access</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># create logger object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>

        <span class="c1"># get local machine object</span>
        <span class="kn">import</span> <span class="nn">socket</span>
        <span class="n">local_machine</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_local_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">local_machine</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">)</span>

<div class="viewcode-block" id="HNASClient.get_path_from_content"><a class="viewcode-back" href="../../../source/NAS.NASUtils.html#NAS.NASUtils.nasclient.HNASClient.get_path_from_content">[docs]</a>    <span class="k">def</span> <span class="nf">get_path_from_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the CIFS Share path and volume name&quot;&quot;&quot;</span>
        <span class="sd">&#39;&#39;&#39;volume_name = content.strip(\&quot;/vol&quot;).replace(&quot;/&quot;, &quot;\\&quot;)&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;NDMP&#39;</span><span class="p">:</span>
            <span class="n">volume_name</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">__VOLUME__</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="si">{0}</span><span class="s2">\</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filer_name</span><span class="p">,</span> <span class="n">volume_name</span><span class="p">),</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fsname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fs_from_path_fsnas</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">content</span><span class="p">,</span> <span class="n">fsname</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>