

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Laptop.laptophelper &mdash; Commvault Automation 11.19 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>Laptop.laptophelper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Laptop.laptophelper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;Main file for performing laptop operations on Commcell</span>

<span class="sd">LaptopHelper:</span>
<span class="sd">    __init__()             --  initialize instance of the LaptopHelper class</span>

<span class="sd">    __repr__()             --  Representation string for the instance of the LaptopHelper class.</span>

<span class="sd">    environment_info()     --  Logs the environment details</span>

<span class="sd">    initialize()           --  Initialize objects for laptop test cases</span>

<span class="sd">    install_laptop()       --  Module to install a laptop client.</span>
<span class="sd">                                This is the common module that multiple Laptop testcases will utilize for</span>
<span class="sd">                                a. Custom package creation and download from cloud</span>
<span class="sd">                                b. Custom package installation on Laptop client</span>
<span class="sd">                                c. Laptop client registration via authcode/user</span>
<span class="sd">                                d. Post registration, automatic laptop osc backups and restore validation</span>
<span class="sd">                                e. Laptop client validation</span>

<span class="sd">                                It can</span>
<span class="sd">                                    - Execute in MSP/Non MSP mode</span>
<span class="sd">                                    - Supports all options to create custom package</span>
<span class="sd">                                    - Can install via authcode/user</span>
<span class="sd">                                    - Can register via user/authcode</span>
<span class="sd">                                    - Can execute osc/regular backups.</span>

<span class="sd">                                This module will be called with various arguments for validation.</span>

<span class="sd">    install_and_register()  -- Laptop installation and registration</span>

<span class="sd">    uninstall_laptop()     --  Module to uninstall laptop client and hard delete from commcell</span>

<span class="sd">    generate_email_body()  --  generates email content with headers, data and returns html string.</span>

<span class="sd">    set_inputs()           --  Creates a dictionary for test case inputs needed for a given test case for Laptops.</span>

<span class="sd">    set_plan()             --  Sets default plan and organization client group name for the organization</span>

<span class="sd">    set_authcode()         --  Create an authcode for the Organization</span>

<span class="sd">    set_blacklisted_users()</span>
<span class="sd">                           --  Adds / Remove blacklisted users</span>

<span class="sd">    create_custom_package()</span>
<span class="sd">                           --  Module to create custom package</span>

<span class="sd">    copy_client_logs()     --  Copy client logs to a network path</span>

<span class="sd">    cleanup()              --  Module to perform cleanups for laptop testcases</span>

<span class="sd">    cleanup_clients()      --  Module to perform cleanups for laptop install testcases</span>

<span class="sd">    generate_email_body()  -- generates email content with headers, data and returns html string.</span>

<span class="sd">    verify_automatic_schedule_restore()</span>
<span class="sd">                           --  Waits until the next automatic job starts and validates with restore</span>

<span class="sd">    create_rdp_sessions()  -- Create RDP sessions for all activation users given in test case inputs</span>

<span class="sd">    set_laptop_backup()    -- Sets Laptop backup status to ON/OFF for a client.</span>

<span class="sd">    laptop_status()        -- Logs Laptop&#39;s db status and client registry values for the given clientobject of Commcell</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot;Main file for performing laptop operations on user centric clients on Commcell</span>

<span class="sd">LaptopHelperUserCentric:</span>
<span class="sd">    __init__()              -- Initialize instance of the LaptopHelperUserCentric class</span>

<span class="sd">    install_laptop()        -- Module to install a laptop client in USER CENTRIC MODE</span>

<span class="sd">    install_and_register()  -- Laptop installation and registration for user centric clients</span>

<span class="sd">    create_pseudo_map()     -- Create user to Pseudo client dictionary</span>

<span class="sd">    check_pseudo_clients()  -- Checks if pseudo clients are created on the Commcell for each user in the user map</span>

<span class="sd">    cleanup_user_centric()  -- Module to perform cleanups for laptop testcases</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">psutil</span><span class="o">,</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">cvpysdk.commcell</span> <span class="k">import</span> <span class="n">Commcell</span>

<span class="kn">from</span> <span class="nn">AutomationUtils.config</span> <span class="k">import</span> <span class="n">get_config</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="k">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="k">import</span> <span class="n">OptionsSelector</span><span class="p">,</span> <span class="n">CVEntities</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.idautils</span> <span class="k">import</span> <span class="n">CommonUtils</span>
<span class="kn">from</span> <span class="nn">Install.InstallUtils.custom_package</span> <span class="k">import</span> <span class="n">CustomPackage</span>
<span class="kn">from</span> <span class="nn">Install.InstallUtils.client_installation</span> <span class="k">import</span> <span class="n">Installation</span>
<span class="kn">from</span> <span class="nn">Install.InstallUtils.custom_package</span> <span class="k">import</span> <span class="n">CustomPackageCloudXML</span>
<span class="kn">from</span> <span class="nn">Install.InstallUtils</span> <span class="k">import</span> <span class="n">installer_constants</span>
<span class="kn">from</span> <span class="nn">Server.serverhelper</span> <span class="k">import</span> <span class="n">ServerTestCases</span>
<span class="kn">from</span> <span class="nn">Server.Security.securityhelper</span> <span class="k">import</span> <span class="n">OrganizationHelper</span>
<span class="kn">from</span> <span class="nn">Server.JobManager.jobmanager_helper</span> <span class="k">import</span> <span class="n">JobManager</span>
<span class="kn">from</span> <span class="nn">Server.Scheduler</span> <span class="k">import</span> <span class="n">schedulerhelper</span>
<span class="kn">from</span> <span class="nn">Laptop</span> <span class="k">import</span> <span class="n">laptopconstants</span>

<div class="viewcode-block" id="LaptopHelper"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper">[docs]</a><span class="k">class</span> <span class="nc">LaptopHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;LaptopHelper helper class to perform laptop related operations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize instance of the LaptopHelper class.</span>

<span class="sd">        Args:</span>
<span class="sd">            init_object: (object) --  TestCase OR Commcell object</span>

<span class="sd">            **kwargs: (dict) -- Key value pairs for supporting conditional initializations of</span>
<span class="sd">                                instance of various classes.</span>

<span class="sd">                                Supported :</span>
<span class="sd">                                    company:    (str)    -- Name of company with which to</span>
<span class="sd">                                                            initialize OrganizationHelper class</span>
<span class="sd">                                                            instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_object</span> <span class="o">=</span> <span class="n">init_object</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_object</span><span class="p">,</span> <span class="n">Commcell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">init_object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcaseid</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">get_custom_str</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="o">=</span> <span class="n">init_object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">commcell</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcaseid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_object</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">utils</span> <span class="o">=</span> <span class="n">CommonUtils</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">CommonUtils</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tc</span> <span class="o">=</span> <span class="n">ServerTestCases</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utility</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span> <span class="o">=</span> <span class="n">CVEntities</span><span class="p">(</span><span class="n">init_object</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobhelper</span> <span class="o">=</span> <span class="n">JobManager</span><span class="p">(</span><span class="n">commcell</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">installer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expected_owners</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdp_sessions_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s1">&#39;company&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">organization</span> <span class="o">=</span> <span class="n">OrganizationHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;company&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;company&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">company</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">organization</span> <span class="o">=</span> <span class="n">OrganizationHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">laptop_config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span><span class="o">.</span><span class="n">Laptop</span><span class="o">.</span><span class="n">Install</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_client_cleanup</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span> <span class="k">if</span> <span class="n">laptop_config</span><span class="o">.</span><span class="n">SkipClientCleanup</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span> <span class="k">else</span> <span class="s2">&quot;no&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_postosc_backup</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">laptop_config</span><span class="o">.</span><span class="n">SkipPostOscBackup</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span> <span class="k">else</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_osc_job_wait</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">laptop_config</span><span class="o">.</span><span class="n">SkipPostOscJobWait</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy_logs</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span> <span class="k">if</span> <span class="n">laptop_config</span><span class="o">.</span><span class="n">SkipCopyingLogs</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span> <span class="k">else</span> <span class="s2">&quot;yes&quot;</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Representation string for the instance of the LaptopHelper class.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;LaptopHelper class instance for company [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span>

<div class="viewcode-block" id="LaptopHelper.environment_info"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.environment_info">[docs]</a>    <span class="k">def</span> <span class="nf">environment_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Logs the environment details &quot;&quot;&quot;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">get_gxglobalparam_val</span><span class="p">(</span><span class="s1">&#39;Secure Agent Install&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">is_msp</span><span class="p">()</span></div>

<div class="viewcode-block" id="LaptopHelper.uninstall_laptop"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.uninstall_laptop">[docs]</a>    <span class="k">def</span> <span class="nf">uninstall_laptop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">laptop_details</span><span class="p">,</span> <span class="n">delete_client</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Module to uninstall a laptop client</span>

<span class="sd">         Args:</span>
<span class="sd">            laptop_details (dict)      : Laptop Details</span>
<span class="sd">                Supported Keys:</span>

<span class="sd">                        Machine_client_name (str): Laptop name</span>

<span class="sd">                        Machine_user_name   (str): Laptop user name</span>

<span class="sd">                        Machine_password    (str): Laptop password</span>

<span class="sd">                        Machine_host_name   (str): Laptop hostname</span>

<span class="sd">            delete_client (bool)       : Delete client from commcell? Default: True</span>

<span class="sd">        Exception:</span>
<span class="sd">            If failed to uninstall laptop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client_name</span> <span class="o">=</span> <span class="n">laptop_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Machine_client_name&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">client_name</span><span class="p">:</span>
                <span class="n">uninstall_args</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;client_user_name&#39;</span><span class="p">:</span> <span class="n">laptop_details</span><span class="p">[</span><span class="s1">&#39;Machine_user_name&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;client_password&#39;</span><span class="p">:</span> <span class="n">laptop_details</span><span class="p">[</span><span class="s1">&#39;Machine_password&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;client_host_name&#39;</span><span class="p">:</span> <span class="n">laptop_details</span><span class="p">[</span><span class="s1">&#39;Machine_host_name&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;client_name&#39;</span><span class="p">:</span> <span class="n">client_name</span>
                <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;Uninstalling client [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
                <span class="n">installer</span> <span class="o">=</span> <span class="n">Installation</span><span class="o">.</span><span class="n">create_installer_object</span><span class="p">(</span><span class="n">uninstall_args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
                <span class="n">installer</span><span class="o">.</span><span class="n">uninstall_existing_instance</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">delete_client</span><span class="p">:</span>
                    <span class="n">installer</span><span class="o">.</span><span class="n">delete_client_from_commcell</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to uninstall existing commvault instance on [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelper.install_laptop"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.install_laptop">[docs]</a>    <span class="k">def</span> <span class="nf">install_laptop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tcinputs</span><span class="p">,</span> <span class="n">config_kwargs</span><span class="p">,</span> <span class="n">install_kwargs</span><span class="p">,</span> <span class="n">custompackage_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Module to install a laptop client</span>

<span class="sd">        Args:</span>
<span class="sd">            tcinputs (dict)            : Testcase input answers</span>

<span class="sd">            config_kwargs (dict)       : Testcase configuration arguments</span>
<span class="sd">            -------------------------------------------------------------</span>

<span class="sd">                Supported:</span>
<span class="sd">                ----------</span>

<span class="sd">                os                    (str): Operating system for which to execute the module.</span>
<span class="sd">                (Mandatory)</span>

<span class="sd">                org_enable_auth_code (bool): If true will disable/enable authcode for the organization.</span>
<span class="sd">                (Optional)                    Default:False</span>

<span class="sd">                override_auth_code (bool):   If set to true, an existing authcode for the Tenant company shall be</span>
<span class="sd">                (Optional)                       ignored, and a new authcode will be created.</span>
<span class="sd">                                              Default: True [New authcode will be created whenever org_enable_auth_code</span>
<span class="sd">                                                              is set to True]</span>

<span class="sd">                org_set_default_plan (bool): If true will set default plan(provided in test inputs) for organization.</span>
<span class="sd">                (Optional)                    Default:False</span>

<span class="sd">            install_kwargs (dict)      : Client installation arguments</span>
<span class="sd">            ----------------------------------------------------------</span>

<span class="sd">                Supported:</span>
<span class="sd">                ----------</span>

<span class="sd">                expected_owners (list):         Client owner validation would be done using this list.</span>
<span class="sd">                (Optional)                       If not set then the activation user would be assumed as the client</span>
<span class="sd">                                                    owner.</span>

<span class="sd">                install_with_authcode (bool):   If True, silent installation will be done on the client using /authcode</span>
<span class="sd">                (Optional)                        option.</span>
<span class="sd">                                                  Default: None</span>

<span class="sd">                execute_simcallwrapper (bool):  If true, SimCallWrapper will register the client post install. Else not</span>
<span class="sd">                (Optional)                        Default: False</span>

<span class="sd">                authcode (str):                 This is authcode which will be used in silent install</span>
<span class="sd">                (Optional)</span>

<span class="sd">                check_num_of_devices (bool):    If true validation for clients joined in the organization shall</span>
<span class="sd">                (Optional)                          be validated, else not.</span>
<span class="sd">                                                    Default: True</span>

<span class="sd">                client_groups (list):           If provided the laptops shall be validated to be a part of only these</span>
<span class="sd">                (Optional)                          client groups. Else default client groups shall be assumed in the</span>
<span class="sd">                                                    underlying called module.</span>
<span class="sd">                                                    Default: None</span>

<span class="sd">                delete_client (bool):           If set, client would not be hard deleted from the commcell after</span>
<span class="sd">                (Optional)                          uninstall.</span>
<span class="sd">                                                    Default: True</span>

<span class="sd">                new_client_name (str):          Post client registration this new client name shall be</span>
<span class="sd">                (Optional)                        considered for further processing.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                register_with_new_name (bool):  If set to true the client shall be registered with a new name.</span>
<span class="sd">                (Optional)                          Default: False</span>

<span class="sd">                register_authcode (str):        If authcode is provided here, the client will be registered with this</span>
<span class="sd">                (Optional)                          authcode with SimcallWrapper</span>
<span class="sd">                                                    *Do not confuse it with authcode with install*</span>
<span class="sd">                                                    *This authcode is provided with SimCallWrapper*</span>
<span class="sd">                                                    *As per SP14 design, client should register for Server Plan*</span>
<span class="sd">                                                    Default: None</span>

<span class="sd">                client_hostname (str):          Client will be registered with this hostname</span>
<span class="sd">                (Optional)                      Default: None</span>


<span class="sd">                skip_osc    (bool):             If true:</span>
<span class="sd">                (Optional)                      Will not wait for the filtered automatic jobs to trigger</span>
<span class="sd">                                                    (Reinstall cases for laptop, where the owner does not change)</span>

<span class="sd">                blacklist_user (str):           Add this user to blacklist user group</span>
<span class="sd">                (Optional)                      Default: None</span>


<span class="sd">                remove_blacklisted_user (str):  Remove this user from blacklist user group</span>
<span class="sd">                (Optional)                      Default: None</span>

<span class="sd">                post_osc_backup (bool):         If set to False will skip sublicent content modification and auto</span>
<span class="sd">                (Optional)                          backup job execution from osc</span>
<span class="sd">                                                    Default: True</span>

<span class="sd">                nLaptopAgent (int):             Expected values (0/1)</span>
<span class="sd">                (Optional)                          Default: 1</span>

<span class="sd">                validate_user (bool):            If true:</span>
<span class="sd">                                                 Validates the username with which the job triggered from the Backunow</span>
<span class="sd">                                                 button.</span>

<span class="sd">                backupnow  (bool):                If true:</span>
<span class="sd">                                                 Validate the BackupNow button on the Edgemonitor app.</span>

<span class="sd">                wait_for_reinstalled_client (bool):</span>
<span class="sd">                (Optional)                      If set to true wait for the client to be activated post re-install.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                sleep_before_osc (bool):</span>
<span class="sd">                (Optional)                      If set to true wait for the client to restore active state post</span>
<span class="sd">                                                    re-install.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                activation_time_limit (int):    Activation time limit.</span>
<span class="sd">                                                    Default: 8</span>

<span class="sd">            custompackage_kwargs (dict) : Custom package creation arguments</span>
<span class="sd">            ---------------------------------------------------------------</span>

<span class="sd">                Supported:</span>
<span class="sd">                ----------</span>
<span class="sd">                servicePack  (str):               Service pack for which to create the custom package</span>
<span class="sd">                                                    e.g: SP14</span>

<span class="sd">                SP_revision  (str):               Service Pack Revision for the custom package to create</span>

<span class="sd">                skip_creation (bool):             Skip package creation if skip_creation is set to true</span>
<span class="sd">                (Optional)                          Default: False</span>

<span class="sd">                authcode_flag (bool):             If set, custom package shall be created with relevant authcode for</span>
<span class="sd">                (Optional)                          either the tenant or from commcell level.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                ClientGroups (str):               If provided custom package shall be created with this client group,</span>
<span class="sd">                                                    which means the laptop is supposed to be associated to this</span>
<span class="sd">                                                    client group post install</span>
<span class="sd">                                                    Default: None</span>

<span class="sd">                laptopClient (str):               &quot;true&quot;/&quot;false&quot;: Configure for laptop client?</span>
<span class="sd">                (Optional)                          Default: true</span>

<span class="sd">                Custom_pkg_username (str):        Username with which the custom package is created.</span>
<span class="sd">                (Optional)                          Default: None</span>

<span class="sd">                Custom_pkg_password (str):        Password for the user with which the custom package is created.</span>
<span class="sd">                (Optional)                          Default: None</span>

<span class="sd">                requireCredentials (str):         Require credentials</span>
<span class="sd">                (Optional)                          Default: &quot;true&quot;</span>

<span class="sd">                backupMonitor (str):              Enable Edge monitor app process</span>
<span class="sd">                (Optional)                          Default: &quot;true&quot;, Options: &quot;false&quot; / &quot;true&quot;</span>

<span class="sd">        Returns: None</span>

<span class="sd">        Exception:</span>
<span class="sd">            - If install is set to be done with auth_code but auth_code is not set.</span>
<span class="sd">            - Client not registered with commcell.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">custompackage_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">custompackage_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cp_authcode</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#-------------------------------------------------------------------------------------</span>
            <span class="c1"># Setup</span>
            <span class="c1">#-------------------------------------------------------------------------------------</span>

            <span class="c1"># Setup machine object</span>
            <span class="n">machine_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span>
                <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_host_name&#39;</span><span class="p">],</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_user_name&#39;</span><span class="p">],</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_password&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">machine_object</span>

            <span class="c1"># Log the environment info before proceeding with the Laptop installation.</span>
            <span class="c1"># Open RDP sessions to the client which is being installed.</span>
            <span class="c1"># To Do : Add SQL queries at plan/organization/commcell levels to get all existing details before install.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environment_info</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_rdp_sessions</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client platform: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;os_type&#39;</span><span class="p">]))</span>
            <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_client_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Machine_client_name&#39;</span><span class="p">,</span> <span class="n">machine_object</span><span class="o">.</span><span class="n">machine_name</span><span class="p">)</span>

            <span class="c1"># Add/remove blacklisted user groups before installation.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_blacklisted_users</span><span class="p">(</span>
                <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;blacklist_user&#39;</span><span class="p">),</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;remove_blacklisted_user&#39;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Set authcode for organization</span>
            <span class="k">if</span> <span class="n">config_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;org_enable_auth_code&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">install_authcode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_authcode</span><span class="p">(</span><span class="n">config_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;override_auth_code&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
                <span class="n">cp_authcode</span> <span class="o">=</span> <span class="n">install_authcode</span>

            <span class="c1"># Set default plan and client group name for organization</span>
            <span class="k">if</span> <span class="n">config_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;org_set_default_plan&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_plan</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Default_Plan&#39;</span><span class="p">])</span>

            <span class="c1"># If silent install has to be done through authcode.</span>
            <span class="c1"># Enabling authcode at org level does not mean user wants to install with authcode.</span>
            <span class="c1"># Covers negative scenarios where user provides wrong authcode to install and org authcode is different</span>
            <span class="k">if</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install_with_authcode&#39;</span><span class="p">):</span>
                <span class="c1"># User provided authcode in test case</span>
                <span class="k">if</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;authcode&#39;</span><span class="p">):</span>
                    <span class="n">install_authcode</span> <span class="o">=</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;authcode&#39;</span><span class="p">)</span>
                    <span class="n">cp_authcode</span> <span class="o">=</span> <span class="n">install_authcode</span>

                <span class="c1"># If user says install with authcode but by now authcode is not set or not provided, exception out.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">install_authcode</span> <span class="ow">or</span> <span class="n">install_authcode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please provide auth code to use during install.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">install_authcode</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1">#-------------------------------------------------------------------------------------</span>
            <span class="c1"># Create custom package</span>
            <span class="c1">#-------------------------------------------------------------------------------------</span>

            <span class="k">if</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;os_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">:</span>
                <span class="n">custompackage_kwargs</span><span class="p">[</span><span class="s1">&#39;include_mac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span>
            <span class="n">custompackage_kwargs</span><span class="p">[</span><span class="s1">&#39;authcode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cp_authcode</span>
            <span class="n">pkg_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_custom_package</span><span class="p">(</span><span class="n">custompackage_kwargs</span><span class="p">)</span>

            <span class="c1">#-------------------------------------------------------------------------------------</span>
            <span class="c1"># Install laptop</span>
            <span class="c1">#-------------------------------------------------------------------------------------</span>

            <span class="n">install_args</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;BackupNow&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;backupnow&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s1">&#39;client_user_name&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_user_name&#39;</span><span class="p">],</span>
                <span class="s1">&#39;client_password&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_password&#39;</span><span class="p">],</span>
                <span class="s1">&#39;client_host_name&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_host_name&#39;</span><span class="p">],</span>
                <span class="s1">&#39;client_hostname&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_hostname&#39;</span><span class="p">),</span>
                <span class="s1">&#39;client_name&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_client_name&#39;</span><span class="p">],</span>
                <span class="s1">&#39;delete_client&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_client&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s1">&#39;executable_name&#39;</span><span class="p">:</span> <span class="n">installer_constants</span><span class="o">.</span><span class="n">PACKAGE_EXE_MAP</span><span class="p">[</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;os_type&#39;</span><span class="p">]],</span>
                <span class="s1">&#39;install_authcode&#39;</span><span class="p">:</span> <span class="n">install_authcode</span><span class="p">,</span>
                <span class="s1">&#39;install_type&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interactive_install&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s1">&#39;install_with_authcode&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install_with_authcode&#39;</span><span class="p">),</span>
                <span class="s1">&#39;organization_object&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span><span class="p">,</span>
                <span class="s1">&#39;package_location&#39;</span><span class="p">:</span> <span class="n">pkg_path</span><span class="p">,</span>
                <span class="s1">&#39;registering_user&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Activation_User&#39;</span><span class="p">],</span>
                <span class="s1">&#39;registering_user_password&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Activation_Password&#39;</span><span class="p">),</span>
                <span class="s1">&#39;register_auth_code&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;register_authcode&#39;</span><span class="p">),</span>
                <span class="s1">&#39;register_with_SAML&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;register_with_SAML&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s1">&#39;saml_email&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;saml_email&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;register_with_SAML&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;takeover_client&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;takeover_client&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s1">&#39;Tenant_company&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">,</span>
                <span class="s1">&#39;LaunchEdgeMonitor&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LaunchEdgeMonitor&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="n">register_args</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;register_with_new_name&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;register_with_new_name&#39;</span><span class="p">),</span>
                <span class="s1">&#39;new_client_name&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_client_name&#39;</span><span class="p">),</span>
                <span class="s1">&#39;wait_for_reinstalled_client&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_for_reinstalled_client&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s1">&#39;Machine_object&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_object&#39;</span><span class="p">],</span>
                <span class="s1">&#39;Default_Plan&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Default_Plan&#39;</span><span class="p">),</span>
                <span class="s1">&#39;activation_time_limit&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;activation_time_limit&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                <span class="s1">&#39;org_set_default_plan&#39;</span><span class="p">:</span> <span class="n">config_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;org_set_default_plan&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="n">client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_and_register</span><span class="p">(</span>
                <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_client_name&#39;</span><span class="p">],</span>
                <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;execute_simcallwrapper&#39;</span><span class="p">),</span>
                <span class="n">install_args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">register_args</span>
            <span class="p">)</span>

            <span class="c1">#---------------------------------------------------------------------------------</span>
            <span class="c1"># OSC Backup and Restore</span>
            <span class="c1">#---------------------------------------------------------------------------------</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                -  [</span><span class="si">{0}</span><span class="s2">] Backup and restore phase&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_host_name&#39;</span><span class="p">]))</span>

            <span class="c1"># After reinstalls especially in cases of Multiple companies with same client name and different hostname</span>
            <span class="c1"># Even after activation the client takes some time to initialize. Subclient content if modified is</span>
            <span class="c1"># reverted back to original contents.</span>
            <span class="k">if</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sleep_before_osc&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="s2">&quot;Waiting before osc backup and restore&quot;</span><span class="p">)</span>

            <span class="c1"># Sometimes Sim registration is quick and before check client check readiness and edge monitor running or not</span>
            <span class="c1"># the backup job is completed. So for full backups check for all states, and for incrementals since there are</span>
            <span class="c1"># no checks after subclient content modification, capturing incremental backup job is immediate.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">osc_backup_and_restore</span><span class="p">(</span><span class="n">client_obj</span><span class="p">,</span>
                                              <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">postbackup</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                                  <span class="s1">&#39;post_osc_backup&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_postosc_backup</span>
                                                <span class="p">),</span>
                                              <span class="n">skip_osc</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;skip_osc&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_osc_job_wait</span><span class="p">),</span>
                                              <span class="n">options</span><span class="o">=</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;osc_options&#39;</span><span class="p">],</span>
                                              <span class="n">validate_user</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;validate_user&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                              <span class="n">registering_user</span><span class="o">=</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Activation_User&#39;</span><span class="p">],</span>
                                              <span class="n">current_state</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting&#39;</span><span class="p">],</span>
                                              <span class="n">incr_current_state</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting&#39;</span><span class="p">,</span> <span class="s1">&#39;pending&#39;</span><span class="p">])</span>

            <span class="c1">#---------------------------------------------------------------------------------</span>
            <span class="c1"># Install validation</span>
            <span class="c1">#---------------------------------------------------------------------------------</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                -  [</span><span class="si">{0}</span><span class="s2">] Validation phase&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_host_name&#39;</span><span class="p">]))</span>
            <span class="n">expected_owners</span> <span class="o">=</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expected_owners&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Activation_User&#39;</span><span class="p">]])</span>
            <span class="n">blacklist_user</span> <span class="o">=</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;blacklist_user&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blacklist_user</span> <span class="ow">and</span> <span class="n">blacklist_user</span> <span class="ow">in</span> <span class="n">expected_owners</span><span class="p">:</span>
                <span class="n">expected_owners</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">blacklist_user</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">validate_client</span><span class="p">(</span><span class="n">client_obj</span><span class="p">,</span>
                                              <span class="n">expected_owners</span><span class="o">=</span><span class="n">expected_owners</span><span class="p">,</span>
                                              <span class="n">client_groups</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_groups&#39;</span><span class="p">),</span>
                                              <span class="n">clients_joined</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;check_num_of_devices&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                                              <span class="n">nLaptopAgent</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nLaptopAgent&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelper.install_and_register"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.install_and_register">[docs]</a>    <span class="k">def</span> <span class="nf">install_and_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">register</span><span class="p">,</span> <span class="n">install_args</span><span class="p">,</span> <span class="o">**</span><span class="n">registration_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Laptop installation and registration</span>
<span class="sd">        Args:</span>

<span class="sd">            client (str):                    Client Name</span>

<span class="sd">            register (bool):                 Register client post install</span>

<span class="sd">            install_args (dict):             Installation arguments</span>
<span class="sd">            --------------------</span>

<span class="sd">                Supported</span>
<span class="sd">                ---------</span>

<span class="sd">                LaunchEdgeMonitor (str):         Enable Edge monitor app process</span>
<span class="sd">                (Optional)                          Default: &quot;true&quot;, Options: &quot;false&quot; / &quot;true&quot;</span>

<span class="sd">                backupnow  (bool):                If true:</span>
<span class="sd">                                                 Validate the BackupNow button on the Edgemonitor app.</span>

<span class="sd">                register_authcode (str):        If authcode is provided here, the client will be registered with this</span>
<span class="sd">                (Optional)                          authcode with SimcallWrapper</span>
<span class="sd">                                                    *Do not confuse it with authcode with install*</span>
<span class="sd">                                                    *This authcode is provided with SimCallWrapper*</span>
<span class="sd">                                                    *As per SP14 design, client should register for Server Plan*</span>
<span class="sd">                                                    Default: None</span>

<span class="sd">                client_host_name (str):          Client hostname</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                client_new_hostname (str):           Client will be registered with this hostname</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                client_user_name (str):          Client will be registered with this name</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                client_password (str):           Client password</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                client_name (str):               Client name</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                delete_client (bool):            Delete client from Commcell before install and in cleanup</span>
<span class="sd">                (Mandatory)                      Default: True</span>

<span class="sd">                executable_name (str):           Custom Package executable name</span>
<span class="sd">                (Mandatory)                      Default: Computed from constants</span>

<span class="sd">                install_authcode (str):          Installation will be done with this auth code</span>
<span class="sd">                (Optional)                       Default: None</span>

<span class="sd">                install_type (bool):             Installation Type (True/False)</span>
<span class="sd">                (Mandatory)                      Default: False</span>

<span class="sd">                organization_object (object):    Organization object</span>
<span class="sd">                (Mandatory)                      Default: Computed in __init__</span>

<span class="sd">                package_location (str):          Location where packages would be copied to the client</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                registering_user (str):          This user name would be used to register the client</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                registering_user_password (str): Registering user password</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                register_auth_code (str):        Registration would be done with this auth code</span>
<span class="sd">                (optional)                       Default: None</span>

<span class="sd">                register_with_SAML (bool):       SAML Registration (True/False)</span>
<span class="sd">                (Mandatory)                      Default: False</span>

<span class="sd">                saml_email (str):                SAML email</span>
<span class="sd">                (Optional)                       Default: None</span>

<span class="sd">                takeover_client (bool):          Takeover client</span>
<span class="sd">                (Mandatory)                      Default: False</span>

<span class="sd">                Tenant_company (str):            Tenant company name</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">            ----------------------------------------------------------------------------------------------------------</span>

<span class="sd">            registration_args (dict):        Registration Arguments</span>
<span class="sd">            -------------------------</span>

<span class="sd">                Supported</span>
<span class="sd">                ---------</span>

<span class="sd">                org_set_default_plan (bool): If true will set default plan(provided in test inputs) for organization.</span>
<span class="sd">                (Optional)                    Default:False</span>

<span class="sd">                activation_time_limit (int):    Activation time limit.</span>
<span class="sd">                                                    Default: 8</span>


<span class="sd">                new_client_name (str):          Post client registration this new client name shall be</span>
<span class="sd">                (Optional)                        considered for further processing.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                register_with_new_name (bool):  If set to true the client shall be registered with a new name.</span>
<span class="sd">                (Optional)                          Default: False</span>

<span class="sd">                wait_for_reinstalled_client (bool):</span>
<span class="sd">                (Optional)                      If set to true wait for the client to be activated post re-install.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                Machine_object (object):        Client Machine object for Machine class</span>
<span class="sd">                (Optional)</span>

<span class="sd">                Default_Plan  (str):            Default plan</span>
<span class="sd">                (Optional)</span>

<span class="sd">            ----------------------------------------------------------------------------------------------------------</span>

<span class="sd">        Returns</span>
<span class="sd">            client object (obj):    Machine class object for the client</span>

<span class="sd">        Raises</span>
<span class="sd">            Exception</span>
<span class="sd">                - if failed to install client</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;Custom package Installation for [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">install_args</span><span class="p">[</span><span class="s1">&#39;client_host_name&#39;</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                - [</span><span class="si">{1}</span><span class="s2">]     Install custom package with following parameters</span>
<span class="s2">                  [</span><span class="si">{0}</span><span class="s2">]</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">install_args</span><span class="p">,</span> <span class="n">install_args</span><span class="p">[</span><span class="s1">&#39;client_host_name&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">installer</span> <span class="o">=</span> <span class="n">Installation</span><span class="o">.</span><span class="n">create_installer_object</span><span class="p">(</span><span class="n">install_args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">installer</span><span class="o">.</span><span class="n">uninstall_existing_instance</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">installer</span><span class="o">.</span><span class="n">delete_client_from_commcell</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span><span class="p">:</span>
                <span class="n">pre_machine_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span><span class="o">.</span><span class="n">machine_count</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">installer</span><span class="o">.</span><span class="n">install_client</span><span class="p">()</span>
            <span class="n">registered_client</span> <span class="o">=</span> <span class="n">client</span>

            <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
                <span class="n">register_with_client</span> <span class="o">=</span> <span class="n">client</span>
                <span class="k">if</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;register_with_new_name&#39;</span><span class="p">):</span>
                    <span class="n">register_with_client</span> <span class="o">=</span> <span class="n">registration_args</span><span class="p">[</span><span class="s1">&#39;new_client_name&#39;</span><span class="p">]</span>

                <span class="n">registered_client</span> <span class="o">=</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_client_name&#39;</span><span class="p">,</span> <span class="n">registered_client</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">installer</span><span class="o">.</span><span class="n">execute_register_me_command</span><span class="p">(</span><span class="n">register_with_client</span><span class="o">=</span><span class="n">register_with_client</span><span class="p">,</span>
                                                           <span class="n">client_post_register</span><span class="o">=</span><span class="n">registered_client</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

            <span class="c1"># In reinstall of client (takeover) the client activation takes time even though the client is ready</span>
            <span class="c1"># and part of defaults Plans client group.(Because of old entry). The old client is also part of</span>
            <span class="c1"># company&#39;s devices. Observed if proceed without sleep, subclient content is overridden and removed</span>
            <span class="c1"># for reinstalled client, so osc backup triggered through manually updated content immediately after</span>
            <span class="c1"># registration fails.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_client_name&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_for_reinstalled_client&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="s2">&quot;Waiting for reinstalled client to be activated.&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">is_device_associated</span><span class="p">(</span><span class="n">pre_machine_count</span><span class="p">)</span>

            <span class="c1"># In case the client name is supposed to change post registration [ Reinstall scenarios ],</span>
            <span class="c1"># then set the client name.</span>
            <span class="c1"># Also, Wait until client ready, before creating client object.</span>
            <span class="c1"># Because when client object is created with commcell object, it checks for client readiness, and if</span>
            <span class="c1"># client is not ready exceptions out.</span>
            <span class="c1"># Also, post simwrapper execution or even without it, when cvd registers/activates clients, client</span>
            <span class="c1"># is not ready [ Client check readiness fails ] for certain interval of time.</span>
            <span class="n">new_client</span> <span class="o">=</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_client_name&#39;</span><span class="p">)</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">new_client</span> <span class="k">if</span> <span class="n">new_client</span> <span class="k">else</span> <span class="n">client</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">wait_until_client_ready</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="k">if</span> <span class="n">new_client</span> <span class="k">else</span> <span class="n">registration_args</span><span class="p">[</span><span class="s1">&#39;Machine_object&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">install_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LaunchEdgeMonitor&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_edge_monitor_running</span><span class="p">(</span><span class="n">client_obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;org_set_default_plan&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">is_client_activated</span><span class="p">(</span>
                    <span class="n">client</span><span class="p">,</span>
                    <span class="n">registration_args</span><span class="p">[</span><span class="s1">&#39;Default_Plan&#39;</span><span class="p">],</span>
                    <span class="n">time_limit</span><span class="o">=</span><span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;activation_time_limit&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">client_obj</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelper.create_rdp_sessions"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.create_rdp_sessions">[docs]</a>    <span class="k">def</span> <span class="nf">create_rdp_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tcinputs</span><span class="p">,</span> <span class="n">machine_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Create RDP sessions for all activation users given in test case inputs</span>

<span class="sd">        Args:</span>

<span class="sd">            machine_object   (obj):    Machine object for the machine for which the RDP session has to be opened</span>

<span class="sd">            tcinputs (dict):   TestCase dictionary containing Activation Users and Passwords</span>

<span class="sd">        Raises</span>
<span class="sd">            Exception:</span>
<span class="sd">                - If failed to create RDP Sessions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">machine_object</span><span class="p">:</span>
                <span class="n">machine_object</span> <span class="o">=</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_object&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tcinputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;Activation_User&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">user</span> <span class="o">=</span> <span class="n">tcinputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">passkey</span> <span class="o">=</span> <span class="s2">&quot;Activation_Password&quot;</span>
                <span class="n">user_index</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Activation_User&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">user_index</span><span class="p">:</span>
                    <span class="n">passkey</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_index</span><span class="p">)</span>
                <span class="n">password</span> <span class="o">=</span> <span class="n">tcinputs</span><span class="p">[</span><span class="n">passkey</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Skip_RDP_Users&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skip creating RDP session for user [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
                    <span class="k">continue</span>

                <span class="n">rdp_handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">start_rdp_session</span><span class="p">(</span><span class="n">machine_object</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rdp_handler</span><span class="p">,</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rdp_sessions_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rdp_handler</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelper.set_inputs"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.set_inputs">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">set_inputs</span><span class="p">(</span><span class="n">commcell</span><span class="p">,</span> <span class="n">platform</span><span class="p">,</span> <span class="n">organization</span><span class="p">,</span> <span class="n">common_inputs</span><span class="p">,</span> <span class="n">platform_inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Creates a dictionary for test case inputs needed for a given test case for Laptops.</span>
<span class="sd">            Reads the config defined constants and gets all the required inputs and creates key value pairs for</span>
<span class="sd">            these inputs and returns back the dictionary of inputs to caller.</span>

<span class="sd">        Args:</span>

<span class="sd">            commcell (obj):                            Commcell object</span>

<span class="sd">            platform (Windows/Mac):                    Platform for which the key values would be fetched from constants</span>

<span class="sd">            organization (str):                        Name of the organization for which to fetch inputs from constants</span>
<span class="sd">                                                        Defined as of writing are :</span>
<span class="sd">                                                        Company1, Company2, Commcell, CustomDomainCompany</span>

<span class="sd">            common_inputs (list):                      This is list of common inputs needed from Organization constants</span>

<span class="sd">            platform_inputs (list):                    This is list of platform specific inputs needed from</span>
<span class="sd">                                                        Organization.&#39;Windows/Mac&#39; constants</span>

<span class="sd">        Returns:</span>

<span class="sd">            inputs (dict):    Key value dictionary for the required inputs for testcase fetched from constants</span>

<span class="sd">        Raises</span>
<span class="sd">            Exception:</span>
<span class="sd">                - If failed to get the inputs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">laptop_config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span><span class="o">.</span><span class="n">Laptop</span><span class="o">.</span><span class="n">Install</span>
            <span class="n">org_data</span> <span class="o">=</span> <span class="n">laptop_config</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()[</span><span class="n">organization</span><span class="p">]</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
            <span class="n">platform_data</span> <span class="o">=</span> <span class="n">org_data</span><span class="p">[</span><span class="n">platform</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;windows&#39;</span><span class="p">:</span>
                <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;os_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Windows&#39;</span>
                <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;osc_options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;os_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Mac&#39;</span>
                <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;osc_options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-testuser root -testgroup admin&#39;</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">common_inputs</span><span class="p">:</span>
                <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">org_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">platform_inputs</span><span class="p">:</span>
                <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform_data</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()[</span><span class="n">key</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">inputs</span>

        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to fetch inputs from config.json for </span><span class="si">{0}</span><span class="s2"> and </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">organization</span><span class="p">,</span> <span class="n">platform</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelper.set_authcode"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.set_authcode">[docs]</a>    <span class="k">def</span> <span class="nf">set_authcode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create an authcode for the Organization</span>

<span class="sd">            Args:</span>

<span class="sd">                override (bool):    Recreate authcode for organization if it&#39;s already created</span>

<span class="sd">            Returns:</span>

<span class="sd">                authcode (str):     Auth code for the Organization</span>

<span class="sd">            Exception:</span>

<span class="sd">                - If failed to get the authcode for the oprganization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">authcode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span><span class="o">.</span><span class="n">auth_code</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">override</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">authcode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                - Enable and get new authcode for Organization</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">modify_auth_code</span><span class="p">(</span><span class="s1">&#39;disable&#39;</span><span class="p">)</span>
            <span class="n">authcode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">modify_auth_code</span><span class="p">(</span><span class="s1">&#39;enable&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using existing authcode [</span><span class="si">{0}</span><span class="s2">] for Organization&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">authcode</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">authcode</span></div>

<div class="viewcode-block" id="LaptopHelper.set_plan"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.set_plan">[docs]</a>    <span class="k">def</span> <span class="nf">set_plan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plan_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets default plan and organization client group name for the organization</span>

<span class="sd">            Args:</span>
<span class="sd">                Plan name (str)   :  Plan name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            - Set default plan for Tenant Company, and validate that the default plan can be set.</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">default_plan</span> <span class="o">=</span> <span class="n">plan_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">tenant_client_group</span> <span class="o">=</span> <span class="n">plan_name</span></div>

<div class="viewcode-block" id="LaptopHelper.set_blacklisted_users"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.set_blacklisted_users">[docs]</a>    <span class="k">def</span> <span class="nf">set_blacklisted_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_to_blacklist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">approve_user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds / Remove blacklisted users</span>

<span class="sd">            Args:</span>

<span class="sd">                user_to_blacklist (str):    User who needs to be blacklisted</span>

<span class="sd">                approve_user (str):         User who needs to be removed from blacklisted group</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">user_to_blacklist</span> <span class="ow">or</span> <span class="n">approve_user</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">create_blacklisted_group</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No user provided to blacklist or approve.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">user_to_blacklist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">add_user_to_blacklisted_group</span><span class="p">(</span><span class="n">user_to_blacklist</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">approve_user</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">remove_user_from_blacklisted_group</span><span class="p">(</span><span class="n">approve_user</span><span class="p">)</span></div>

<div class="viewcode-block" id="LaptopHelper.set_laptop_backup"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.set_laptop_backup">[docs]</a>    <span class="k">def</span> <span class="nf">set_laptop_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="p">,</span> <span class="n">toggle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets Laptop backup status to ON/OFF for a client.</span>

<span class="sd">            Args:</span>
<span class="sd">                client_name   (str):       Client name</span>

<span class="sd">                toggle       (str):        Enable laptop backup on client</span>
<span class="sd">                                            Accepted values:</span>
<span class="sd">                                                ON/OFF</span>

<span class="sd">                Returns:</span>
<span class="sd">                    None</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        - If module fail to execute at any step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">toggle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span> <span class="p">(</span><span class="s2">&quot;toggle option can only take in values ON/OFF&quot;</span><span class="p">)</span>

            <span class="c1"># Set laptop backup status on the client.</span>
            <span class="n">qscript</span> <span class="o">=</span> <span class="s2">&quot;-sn enableLaptopBackup -si &#39;</span><span class="si">{0}</span><span class="s2">&#39; -si &#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">toggle</span><span class="p">,</span> <span class="n">client_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting laptop backup status [</span><span class="si">{0}</span><span class="s2">] on client [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">toggle</span><span class="p">,</span> <span class="n">client_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executing qoperation execscript </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qscript</span><span class="p">))</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">_qoperation_execscript</span><span class="p">(</span><span class="n">qscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;qscript response: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;QS_enableLaptopBackup_completed&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;ExecScriptOutput&#39;</span><span class="p">][</span><span class="s1">&#39;FieldValue&#39;</span><span class="p">]))):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to set laptop backup status [</span><span class="si">{0}</span><span class="s2">] on client [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">toggle</span><span class="p">,</span> <span class="n">client_name</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelper.laptop_status"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.laptop_status">[docs]</a>    <span class="k">def</span> <span class="nf">laptop_status</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">machine_obj</span><span class="p">,</span> <span class="n">client_obj</span><span class="p">,</span> <span class="n">client_status</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">workstation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlaptopagent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activated_mode</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Logs Laptop&#39;s db status for the given clientobject of Commcell</span>
<span class="sd">            Registries on the client</span>

<span class="sd">            Args:</span>
<span class="sd">                machine_obj  (obj):       Machine class object of the client</span>

<span class="sd">                client_obj   (obj):       Client object for the given Commcell</span>

<span class="sd">                client_status (int):      DB status of the client in DB</span>

<span class="sd">                workstation (int):        Personal Workstation attrval in client prop</span>

<span class="sd">                nlaptopagent (int):       Clients FileSystemAgent&gt;nLaptopAgent in registry post install</span>

<span class="sd">                activated_mode (int):     Clients FileSystemAgent&gt;ActivateMode in registry post install</span>

<span class="sd">                Returns:</span>
<span class="sd">                    None</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        - If module fail to execute at any step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client_name</span> <span class="o">=</span> <span class="n">client_obj</span><span class="o">.</span><span class="n">client_name</span>
            <span class="n">client_id</span> <span class="o">=</span> <span class="n">client_obj</span><span class="o">.</span><span class="n">client_id</span>

            <span class="c1"># Check status in app_client</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select status from app_client where id = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_id</span><span class="p">)</span>
            <span class="n">resultset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">laptop_status</span> <span class="o">=</span> <span class="n">resultset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Laptop [</span><span class="si">{0}</span><span class="s2">] status in app_client [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">,</span> <span class="n">laptop_status</span><span class="p">))</span>
            <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">client_status</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">laptop_status</span><span class="p">),</span> <span class="s2">&quot;DB validation failed.&quot;</span>

            <span class="c1"># Check workstation status in app_clientprop</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select attrval from app_clientprop</span>
<span class="s2">                        where attrname = &#39;Personal Workstation&#39; and componentNameId = </span><span class="si">{0}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_id</span><span class="p">)</span>
            <span class="n">resultset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">workstation_status</span> <span class="o">=</span> <span class="n">resultset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Laptop [</span><span class="si">{0}</span><span class="s2">] workstation status in app_clientprop [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">,</span> <span class="n">workstation_status</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">workstation_status</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">workstation</span><span class="p">),</span> <span class="s2">&quot;DB validation failed.&quot;</span>

            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">check_reg_key</span><span class="p">(</span><span class="n">machine_obj</span><span class="p">,</span> <span class="s1">&#39;FileSystemAgent&#39;</span><span class="p">,</span> <span class="s1">&#39;nLaptopAgent&#39;</span><span class="p">,</span> <span class="n">nlaptopagent</span><span class="p">)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">check_reg_key</span><span class="p">(</span><span class="n">machine_obj</span><span class="p">,</span> <span class="s1">&#39;FileSystemAgent&#39;</span><span class="p">,</span> <span class="s1">&#39;ActivatedMode&#39;</span><span class="p">,</span> <span class="n">activated_mode</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelper.create_custom_package"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.create_custom_package">[docs]</a>    <span class="k">def</span> <span class="nf">create_custom_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">custompackage_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Module to create custom package</span>

<span class="sd">         Args:</span>

<span class="sd">            custompackage_kwargs (dict) : Custom package arguments and values clubbed in a dictionary</span>
<span class="sd">            ---------------------------------------------------------------</span>

<span class="sd">                Supported:</span>
<span class="sd">                ----------</span>
<span class="sd">                servicePack  (str):               Service pack for which to create the custom package</span>
<span class="sd">                                                    e.g: SP14</span>

<span class="sd">                SP_revision  (str):               Service Pack Revision for the custom package to create</span>

<span class="sd">                skip_creation (bool):             Skip package creation if skip_creation is set to true</span>
<span class="sd">                (Optional)                          Default: False</span>

<span class="sd">                authcode_flag (bool):             If set, custom package shall be created with relevant authcode for</span>
<span class="sd">                (Optional)                          either the tenant or from commcell level.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                ClientGroups (str):               If provided custom package shall be created with this client group,</span>
<span class="sd">                                                    which means the laptop is supposed to be associated to this</span>
<span class="sd">                                                    client group post install</span>
<span class="sd">                                                    Default: None</span>

<span class="sd">                laptopClient (str):               &quot;true&quot;/&quot;false&quot;: Configure for laptop client?</span>
<span class="sd">                (Optional)                          Default: true</span>

<span class="sd">                Custom_pkg_username (str):        Username with which the custom package is created.</span>
<span class="sd">                (Optional)                          Default: None</span>

<span class="sd">                Custom_pkg_password (str):        Password for the user with which the custom package is created.</span>
<span class="sd">                (Optional)                          Default: None</span>

<span class="sd">                requireCredentials (str):         Require credentials</span>
<span class="sd">                (Optional)                          Default: &quot;true&quot;</span>

<span class="sd">                backupMonitor (str):              Enable Edge monitor app process</span>
<span class="sd">                (Optional)                          Default: &quot;true&quot;, Options: &quot;false&quot; / &quot;true&quot;</span>

<span class="sd">                authcode (str):                   Authcode (If Applicable)</span>

<span class="sd">                include_mac (str):                Include Mac platform to create packages</span>

<span class="sd">        Returns:</span>
<span class="sd">            Package Path (str):     Location where Custom packages are downloaded</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">custom_package</span> <span class="o">=</span> <span class="n">CustomPackage</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;include_mac&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">platform_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;macOS&#39;</span><span class="p">,</span> <span class="s1">&#39;Windows-x64&#39;</span><span class="p">,</span> <span class="s1">&#39;Windows-x86&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">platform_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Windows-x64&#39;</span><span class="p">,</span> <span class="s1">&#39;Windows-x86&#39;</span><span class="p">]</span>

            <span class="n">authcode</span> <span class="o">=</span> <span class="n">custompackage_kwargs</span><span class="p">[</span><span class="s1">&#39;authcode&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;authcode_flag&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">cargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;commcell_object&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">,</span>
                <span class="s1">&#39;proxy_list&#39;</span><span class="p">:</span> <span class="n">custom_package</span><span class="o">.</span><span class="n">proxy_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">),</span>
                <span class="s1">&#39;servicePack&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;servicePack&#39;</span><span class="p">),</span>
                <span class="s1">&#39;SP_revision&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SP_revision&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_revision</span><span class="p">),</span>
                <span class="s1">&#39;authcode&#39;</span><span class="p">:</span> <span class="n">authcode</span><span class="p">,</span>
                <span class="s1">&#39;WindowsSubClientPolicy&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WindowsSubClientPolicy&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s1">&#39;MacSubClientPolicy&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MacSubClientPolicy&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s1">&#39;SubClientPlan&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SubClientPlan&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="s1">&#39;ClientGroups&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ClientGroups&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="s1">&#39;Custom_pkg_username&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Custom_pkg_username&#39;</span><span class="p">),</span>
                <span class="s1">&#39;Custom_pkg_password&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Custom_pkg_password&#39;</span><span class="p">),</span>
                <span class="s1">&#39;laptopClient&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;laptopClient&#39;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">),</span>
                <span class="s1">&#39;requireCredentials&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;requireCredentials&#39;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">),</span>
                <span class="s1">&#39;backupMonitor&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;backupMonitor&#39;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">),</span>
                <span class="s1">&#39;hideApps&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hideApps&#39;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">),</span>
                <span class="s1">&#39;includeMac&#39;</span><span class="p">:</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;include_mac&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">pkg_path</span> <span class="o">=</span> <span class="n">custom_package</span><span class="o">.</span><span class="n">get_pkg_path</span><span class="p">(</span><span class="n">cargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">custompackage_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;skip_creation&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;- [</span><span class="si">{0}</span><span class="s2">] Create custom package phase&quot;&quot;&quot;</span><span class="p">)</span>
                <span class="n">input_xml</span> <span class="o">=</span> <span class="n">CustomPackageCloudXML</span><span class="p">(</span><span class="n">cargs</span><span class="p">)</span><span class="o">.</span><span class="n">generate_xml</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">custom_package</span><span class="o">.</span><span class="n">check_packages</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">,</span> <span class="n">platform_list</span><span class="p">):</span>
                    <span class="c1"># Initialize cloud object only when we need to create custom package</span>
                    <span class="n">custom_package</span><span class="o">.</span><span class="n">cloud_commcell</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">custom_package</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">input_xml</span><span class="p">)</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">custom_package</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">download_dir</span><span class="o">=</span><span class="n">pkg_path</span><span class="p">,</span> <span class="n">platform_list</span><span class="o">=</span><span class="n">platform_list</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">pkg_path</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelper.is_edge_monitor_running"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.is_edge_monitor_running">[docs]</a>    <span class="k">def</span> <span class="nf">is_edge_monitor_running</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to check if CvEdgeMonitor process is running on the client</span>

<span class="sd">            machine (object)    : Machine object</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    If CvEdgeMonitor process is not running.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">machine</span><span class="o">.</span><span class="n">os_info</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">:</span>
            <span class="n">process_name</span> <span class="o">=</span> <span class="s2">&quot;CvEdgeMonitor&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">process_name</span> <span class="o">=</span> <span class="s2">&quot;EdgeMonitor&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">machine</span><span class="o">.</span><span class="n">is_process_running</span><span class="p">(</span><span class="n">process_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;EdgeMonitor validation failed.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Edge Monitor App was not launched on [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Edge Monitor App launched successfully on [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="LaptopHelper.copy_client_logs"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.copy_client_logs">[docs]</a>    <span class="k">def</span> <span class="nf">copy_client_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine_object</span><span class="p">,</span> <span class="n">source_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">network_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy client logs to a network path</span>

<span class="sd">         Args:</span>
<span class="sd">                machine_object  (object):                       Client object for Machine class</span>

<span class="sd">                network_path (str):                             Network path where logs would be copied over</span>

<span class="sd">                username (str):                                 Network path&#39;s user name</span>

<span class="sd">                password (str):                                 Network path password</span>

<span class="sd">        Returns: bool</span>
<span class="sd">            False: If failed to copy logs.</span>

<span class="sd">        Raises: Exception:</span>
<span class="sd">            - If exceptions out while performing any operation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os_sep</span> <span class="o">=</span> <span class="n">machine_object</span><span class="o">.</span><span class="n">os_sep</span>
            <span class="n">os_info</span> <span class="o">=</span> <span class="n">machine_object</span><span class="o">.</span><span class="n">os_info</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">machine_object</span><span class="o">.</span><span class="n">machine_name</span>

            <span class="k">if</span> <span class="n">network_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">laptop_config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span><span class="o">.</span><span class="n">Laptop</span><span class="o">.</span><span class="n">Install</span>
                <span class="n">network_path</span> <span class="o">=</span> <span class="n">laptop_config</span><span class="o">.</span><span class="n">NetworkPath</span>
                <span class="n">username</span> <span class="o">=</span> <span class="n">laptop_config</span><span class="o">.</span><span class="n">NetworkUser</span>
                <span class="n">password</span> <span class="o">=</span> <span class="n">laptop_config</span><span class="o">.</span><span class="n">NetworkPassword</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">network_path</span> <span class="ow">or</span> <span class="n">network_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;NetworkPath is not defined in the input template config. Skip copying client logs&quot;</span><span class="p">)</span>

            <span class="c1"># Create destination location first.</span>
            <span class="n">drive</span> <span class="o">=</span> <span class="n">machine_object</span><span class="o">.</span><span class="n">mount_network_path</span><span class="p">(</span><span class="n">network_path</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="n">os_sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">drive</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcaseid</span><span class="p">,</span> <span class="n">os_info</span><span class="p">,</span> <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">get_custom_str</span><span class="p">()])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">machine_object</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">source_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Get client install path</span>
                <span class="k">if</span> <span class="n">machine_object</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s1">&#39;WINDOWS&#39;</span><span class="p">:</span>
                    <span class="n">install_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">check_reg_key</span><span class="p">(</span><span class="n">machine_object</span><span class="p">,</span> <span class="s1">&#39;Base&#39;</span><span class="p">,</span> <span class="s1">&#39;dGALAXYHOME&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">install_dir</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to get installation directory for client [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to copy logs for client [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
                        <span class="k">return</span> <span class="kc">False</span>
                    <span class="n">source_dir</span> <span class="o">=</span> <span class="n">os_sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">install_dir</span><span class="p">,</span> <span class="s2">&quot;Log Files&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">source_dir</span> <span class="o">=</span> <span class="n">laptopconstants</span><span class="o">.</span><span class="n">UNIX_INSTALL_DIR</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying logs from client [</span><span class="si">{0}</span><span class="s2">]. From [</span><span class="si">{1}</span><span class="s2">] to [</span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">))</span>
            <span class="n">machine_object</span><span class="o">.</span><span class="n">copy_folder</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">machine_object</span><span class="o">.</span><span class="n">unmount_drive</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span></div>

<div class="viewcode-block" id="LaptopHelper.cleanup_rdp_sessions"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.cleanup_rdp_sessions">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup_rdp_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rdp_handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdp_sessions_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Closing RDP session with pid [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rdp_handler</span><span class="o">.</span><span class="n">pid</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">rdp_handler</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Killing RDP child pid [</span><span class="si">{0}</span><span class="s2">] for process [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="n">rdp_handler</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;No such process&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;NoSuchProcess no process found with pid&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;RDP session not found.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LaptopHelper.cleanup"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tcinputs</span><span class="p">,</span> <span class="n">delete_client</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Module to perform cleanups for laptop testcases</span>

<span class="sd">         Args:</span>
<span class="sd">            tcinputs (dict)            : Testcase input answers</span>

<span class="sd">            delete_client (bool)       : Hard delete client from commcell</span>
<span class="sd">                                            Default: True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;***Starting laptop cleanup***&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_rdp_sessions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_clients</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">,</span> <span class="n">delete_client</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span></div>

<div class="viewcode-block" id="LaptopHelper.cleanup_clients"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.cleanup_clients">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tcinputs</span><span class="p">,</span> <span class="n">delete_client</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Module to perform cleanups for laptop install testcases</span>

<span class="sd">         Args:</span>
<span class="sd">            tcinputs (dict)            : Testcase input answers</span>

<span class="sd">            delete_client (bool)       : Hard delete client from commcell</span>
<span class="sd">                                            Default: True</span>

<span class="sd">        Returns:</span>
<span class="sd">            True:     If client cleanup is set to be skipped</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: If failed to cleanup clients at any step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Copy client logs to network location.</span>
            <span class="k">if</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">os_info</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_logs</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">copy_client_logs</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_object&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skip copying client logs.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_client_cleanup</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client cleanup skipped as config parameter is set to skip client cleanup&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;***Cleaning up laptop devices***&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uninstall_laptop</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">,</span> <span class="n">delete_client</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">delete_client</span><span class="p">:</span>
                <span class="c1"># Hard delete clients from commcell</span>
                <span class="n">client_name</span> <span class="o">=</span> <span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Machine_client_name&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">client_name</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="p">[</span><span class="n">client_name</span> <span class="o">+</span> <span class="n">laptopconstants</span><span class="o">.</span><span class="n">REINSTALL_NAME</span><span class="p">,</span>
                                   <span class="n">client_name</span> <span class="o">+</span> <span class="n">laptopconstants</span><span class="o">.</span><span class="n">REINSTALLED_CLIENT_STR</span><span class="p">,</span>
                                   <span class="n">client_name</span> <span class="o">+</span> <span class="n">laptopconstants</span><span class="o">.</span><span class="n">REPURPOSED_CLIENT</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">has_client</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">delete_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

            <span class="c1">#This Key exists for only usercentric laptop automation. delete all the Pseudo clients if present.</span>
            <span class="k">for</span> <span class="n">each_user</span> <span class="ow">in</span> <span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_map&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;user_map&#39;</span><span class="p">][</span><span class="n">each_user</span><span class="p">][</span><span class="s1">&#39;pseudo_client&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">has_client</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">delete_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Cleanup failed for laptop test cases.&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelper.generate_email_body"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.generate_email_body">[docs]</a>    <span class="k">def</span> <span class="nf">generate_email_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        generates email content with headers, data and returns html string.</span>

<span class="sd">        @args:</span>

<span class="sd">        data (dictionary)     : body of the mail in dictionary format</span>

<span class="sd">        returns</span>

<span class="sd">        items(list)    : list of items as html in email body</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39; &lt;html&gt;</span>
<span class="s1">        &lt;style type=&quot;text/css&quot;&gt;</span>
<span class="s1">        table {</span>
<span class="s1">         border-collapse: collapse;</span>
<span class="s1">          width: 40%;</span>
<span class="s1">          text-align: middle;</span>
<span class="s1">          }</span>
<span class="s1">        table td, th {</span>
<span class="s1">          border: 1px solid blue;</span>
<span class="s1">          padding: 10px;</span>

<span class="s1">          }</span>

<span class="s1">        #summary{</span>
<span class="s1">            border-color: #348dd4;</span>
<span class="s1">        }</span>
<span class="s1">        #summary_head{</span>
<span class="s1">            color: #fff;</span>
<span class="s1">            text-transform: uppercase;</span>
<span class="s1">        }</span>
<span class="s1">        #summary th{</span>
<span class="s1">            background-color: #84E8F5;</span>

<span class="s1">        }</span>
<span class="s1">        #summary tr{</span>
<span class="s1">            background-color: #F7D0C6;</span>

<span class="s1">        }</span>
<span class="s1">        #summary tr:nth-child(even){</span>
<span class="s1">            background: #C3F5C4;</span>

<span class="s1">        }</span>
<span class="s1">        #summary tr:nth-child(odd){</span>
<span class="s1">            background: #D8E6FA;</span>

<span class="s1">        }</span>
<span class="s1">        header h2 {</span>
<span class="s1">            margin: 20px;</span>
<span class="s1">        }</span>

<span class="s1">        &lt;/style&gt;</span>

<span class="s1">        &lt;header&gt;</span>
<span class="s1">            &lt;h2&gt;Laptop CPU Performance&lt;/h2&gt;</span>
<span class="s1">        &lt;/header&gt;</span>
<span class="s1">        &lt;body&gt;</span>
<span class="s1">        &#39;&#39;&#39;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;OS&#39;</span><span class="p">,</span> <span class="s1">&#39;PROCESS&#39;</span><span class="p">,</span> <span class="s1">&#39;SERIVICEPACK&#39;</span><span class="p">,</span> <span class="s1">&#39;CPU&#39;</span><span class="p">]</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;The below Table gives us the average cpu performance for scancheck,FileScan,clBackup process.&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;table id=&quot;summary&quot;&gt;&#39;</span> <span class="o">%</span> <span class="n">style</span> <span class="o">+</span> <span class="s1">&#39;&lt;tr&gt;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;th&gt;&lt;b&gt;</span><span class="si">%s</span><span class="s1">&lt;/th&gt;&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">)</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/tr&gt;&#39;</span><span class="p">)</span>


        <span class="n">sp_list</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">SERVICEPACK</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">os_list</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">OS</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">process_list</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">PROCESS</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">os</span> <span class="ow">in</span> <span class="n">os_list</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;tr&gt;&#39;</span><span class="p">)</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;th rowspan=&quot;6&quot;&gt;&lt;strong&gt;&lt;font color=&quot;black&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/td&gt;&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">process_list</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;th rowspan=&quot;2&quot;&gt;&lt;strong&gt;&lt;font color=&quot;black&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/td&gt;&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">process</span><span class="p">))</span>
                <span class="n">val</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">sp_max</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">sp_list</span><span class="p">:</span>
                    <span class="n">val</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;PROCESS==&quot;&#39;</span><span class="o">+</span><span class="n">process</span><span class="o">+</span><span class="s1">&#39;&quot; and SERVICEPACK==&quot;&#39;</span><span class="o">+</span><span class="n">sp</span><span class="o">+</span><span class="s1">&#39;&quot; and OS==&quot;&#39;</span><span class="o">+</span><span class="n">os</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)[</span><span class="s1">&#39;CPU&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">sp_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([[</span><span class="n">val</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">val</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">sp_list</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;th&gt;&lt;b&gt;</span><span class="si">%s</span><span class="s1">&lt;/th&gt;&#39;</span> <span class="o">%</span> <span class="n">sp</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sp</span> <span class="o">==</span> <span class="n">sp_max</span><span class="p">:</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;td&gt;&lt;strong&gt;&lt;font color=&quot;red&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/td&gt;&#39;</span> <span class="o">%</span> <span class="n">val</span><span class="p">[</span><span class="n">sp</span><span class="p">])</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/tr&gt;&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;td&gt;&lt;strong&gt;&lt;font color=&quot;Green&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/td&gt;&#39;</span> <span class="o">%</span> <span class="n">val</span><span class="p">[</span><span class="n">sp</span><span class="p">])</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/tr&gt;&#39;</span><span class="p">)</span>

        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/table&gt;&#39;</span><span class="p">)</span>

        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;The below graphs gives us the cpu performance for scancheck,FileScan,clBackup process.&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;h2 style=&quot;color: #2e6c80;&quot;&gt;&lt;img src=&quot;c:\cpu_prescan.png&quot; alt=&quot;Graph for cpu performance&quot;&#39;</span>
                     <span class="s1">&#39;width=&quot;500&quot; height=&quot;500&quot; /&gt;&lt;/h2&gt;&#39;</span><span class="p">)</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;h2 style=&quot;color: #2e6c80;&quot;&gt;&lt;img src=&quot;c:\cpu_scan.png&quot; alt=&quot;Graph for cpu performance&quot;&#39;</span>
                     <span class="s1">&#39;width=&quot;500&quot; height=&quot;500&quot; /&gt;&lt;/h2&gt;&#39;</span><span class="p">)</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;h2 style=&quot;color: #2e6c80;&quot;&gt;&lt;img src=&quot;c:\cpu_clbackup.png&quot; alt=&quot;Graph for cpu performance&quot;&#39;</span>
                     <span class="s1">&#39;width=&quot;500&quot; height=&quot;500&quot; /&gt;&lt;/h2&gt;&#39;</span><span class="p">)</span>

        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="LaptopHelper.verify_automatic_schedule_restore"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelper.verify_automatic_schedule_restore">[docs]</a>    <span class="k">def</span> <span class="nf">verify_automatic_schedule_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">subclient_obj</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">client_name</span><span class="p">,</span> <span class="n">sch_obj</span><span class="p">,</span> <span class="n">validate</span><span class="p">,</span>
                                          <span class="n">cleanup</span><span class="p">,</span> <span class="n">previous_job</span><span class="p">,</span> <span class="n">newcontent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">add_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">subclient_content</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Waits until next automatic schedule job starts/completes  and validates by running restore</span>
<span class="sd">            Args:</span>
<span class="sd">                path (str)            : source path where data to be generated and validate</span>
<span class="sd">                tmp_path (str)        : tmp_path where restore to be done</span>
<span class="sd">                subclient_obj (obj)   : Sub client object</span>
<span class="sd">                machine (obj)         : machine object on which validation is done</span>
<span class="sd">                client_name           : client name</span>
<span class="sd">                sch_obj (obj)         : schedule object on which to be validate the job</span>
<span class="sd">                validate (boolean)    : restore to be validated or not</span>
<span class="sd">                cleanup (boolean)     : cleanup of restored folder to be done or not</span>
<span class="sd">                previous_job (int)    : previous job for the schedule</span>
<span class="sd">                add_data (Boolean)    : to generate test data or not</span>
<span class="sd">                subclient_content (list): list of sub client content to be updated</span>

<span class="sd">            Returns: the latest automatic schedule backup job ran</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">add_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">machine</span><span class="o">.</span><span class="n">os_info</span> <span class="ow">in</span> <span class="s1">&#39;Unix&#39;</span><span class="p">:</span>
                <span class="n">machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">hlinks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">slinks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                           <span class="n">options</span><span class="o">=</span><span class="s2">&quot;-testuser root -testgroup wheel&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">hlinks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">slinks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subclient_content</span><span class="p">:</span>
            <span class="n">subclient_obj</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">subclient_content</span>
        <span class="n">_sch_helper_obj</span> <span class="o">=</span> <span class="n">schedulerhelper</span><span class="o">.</span><span class="n">SchedulerHelper</span><span class="p">(</span><span class="n">sch_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Verify whether job triggered due to content change or not&#39;</span><span class="p">)</span>
        <span class="n">previous_job</span> <span class="o">=</span> <span class="n">_sch_helper_obj</span><span class="o">.</span><span class="n">automatic_schedule_wait</span><span class="p">(</span><span class="n">previous_job</span><span class="p">,</span> <span class="n">newcontent</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">previous_job</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot; automatic job didnt trigger in scheduled time&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Run a restore of the incremental backup data and verify correct data is restored.&quot;</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">CommonUtils</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">subclient_restore_from_job</span><span class="p">(</span>
            <span class="n">data_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">tmp_path</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">,</span>
            <span class="n">job</span><span class="o">=</span><span class="n">previous_job</span><span class="p">,</span>
            <span class="n">cleanup</span><span class="o">=</span><span class="n">cleanup</span><span class="p">,</span>
            <span class="n">subclient</span><span class="o">=</span><span class="n">subclient_obj</span><span class="p">,</span>
            <span class="n">client</span><span class="o">=</span><span class="n">client_name</span><span class="p">,</span>
            <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">previous_job</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">company</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Read only attribute for company object &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sp_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the revision installed on the CS &quot;&quot;&quot;</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        select MAX(S2.RevisionId) FROM PatchSPVersion S join simInstalledPackages P on S.id=P.SPVersionID</span>
<span class="s2">        JOIN PatchSPVersion S2 ON S.Release=S2.Release AND S.SPMajor=S2.SPMajor AND S.SPMinor=S2.SPMinor</span>
<span class="s2">        AND S.TransactionID=S2.TransactionID</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">resultset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resultset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">expected_owners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the list of laptop&#39;s expected owners &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expected_owners</span>

    <span class="nd">@expected_owners</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">expected_owners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set&#39;s the laptops expected owners &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expected_owners</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expected_owners</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="LaptopHelperUserCentric"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelperUserCentric">[docs]</a><span class="k">class</span> <span class="nc">LaptopHelperUserCentric</span><span class="p">(</span><span class="n">LaptopHelper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;LaptopHelper helper class to perform laptop related operations for user centric laptops&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize instance of the LaptopHelperUserCentric class.</span>

<span class="sd">        Args:</span>
<span class="sd">            init_object: (object) --  TestCase OR Commcell object</span>

<span class="sd">            **kwargs: (dict) -- Key value pairs for supporting conditional initializations of</span>
<span class="sd">                                instance of various classes.</span>

<span class="sd">                                Supported :</span>
<span class="sd">                                    company:    (str)    -- Name of company with which to</span>
<span class="sd">                                                            initialize OrganizationHelper class</span>
<span class="sd">                                                            instance.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LaptopHelperUserCentric</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">init_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Enable shared laptop usage for the organization.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">shared_laptop_usage</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">shared_laptop_usage</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="LaptopHelperUserCentric.install_laptop"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelperUserCentric.install_laptop">[docs]</a>    <span class="k">def</span> <span class="nf">install_laptop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tcinputs</span><span class="p">,</span> <span class="n">config_kwargs</span><span class="p">,</span> <span class="n">install_kwargs</span><span class="p">,</span> <span class="n">custompackage_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Module to install a laptop client in USER CENTRIC MODE</span>

<span class="sd">        Args:</span>
<span class="sd">            tcinputs (dict)            : Testcase input answers</span>

<span class="sd">            config_kwargs (dict)       : Testcase configuration arguments</span>
<span class="sd">            -------------------------------------------------------------</span>

<span class="sd">                Supported:</span>
<span class="sd">                ----------</span>

<span class="sd">                os                    (str): Operating system for which to execute the module.</span>
<span class="sd">                (Mandatory)</span>

<span class="sd">                org_enable_auth_code (bool): If true will disable/enable authcode for the organization.</span>
<span class="sd">                (Optional)                    Default:False</span>

<span class="sd">                override_auth_code (bool):   If set to true, an existing authcode for the Tenant company shall be</span>
<span class="sd">                (Optional)                       ignored, and a new authcode will be created.</span>
<span class="sd">                                              Default: True [New authcode will be created whenever org_enable_auth_code</span>
<span class="sd">                                                              is set to True]</span>

<span class="sd">                org_set_default_plan (bool): If true will set default plan(provided in test inputs) for organization.</span>
<span class="sd">                (Optional)                    Default:False</span>

<span class="sd">            install_kwargs (dict)      : Client installation arguments</span>
<span class="sd">            ----------------------------------------------------------</span>

<span class="sd">                Supported:</span>
<span class="sd">                ----------</span>

<span class="sd">                expected_owners (list):         Client owner validation would be done using this list.</span>
<span class="sd">                (Optional)                       If not set then the activation user would be assumed as the client</span>
<span class="sd">                                                    owner.</span>

<span class="sd">                install_with_authcode (bool):   If True, silent installation will be done on the client using /authcode</span>
<span class="sd">                (Optional)                        option.</span>
<span class="sd">                                                  Default: None</span>

<span class="sd">                execute_simcallwrapper (bool):  If true, SimCallWrapper will register the client post install. Else not</span>
<span class="sd">                (Optional)                        Default: False</span>

<span class="sd">                authcode (str):                 This is authcode which will be used in silent install</span>
<span class="sd">                (Optional)</span>

<span class="sd">                check_num_of_devices (bool):    If true validation for clients joined in the organization shall</span>
<span class="sd">                (Optional)                          be validated, else not.</span>
<span class="sd">                                                    Default: True</span>

<span class="sd">                client_groups (list):           If provided the laptops shall be validated to be a part of only these</span>
<span class="sd">                (Optional)                          client groups. Else default client groups shall be assumed in the</span>
<span class="sd">                                                    underlying called module.</span>
<span class="sd">                                                    Default: None</span>

<span class="sd">                delete_client (bool):           If set, client would not be hard deleted from the commcell after</span>
<span class="sd">                (Optional)                          uninstall.</span>
<span class="sd">                                                    Default: True</span>

<span class="sd">                new_client_name (str):          Post client registration this new client name shall be</span>
<span class="sd">                (Optional)                        considered for further processing.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                register_with_new_name (bool):  If set to true the client shall be registered with a new name.</span>
<span class="sd">                (Optional)                          Default: False</span>

<span class="sd">                register_authcode (str):        If authcode is provided here, the client will be registered with this</span>
<span class="sd">                (Optional)                          authcode with SimcallWrapper</span>
<span class="sd">                                                    *Do not confuse it with authcode with install*</span>
<span class="sd">                                                    *This authcode is provided with SimCallWrapper*</span>
<span class="sd">                                                    *As per SP14 design, client should register for Server Plan*</span>
<span class="sd">                                                    Default: None</span>

<span class="sd">                client_hostname (str):          Client will be registered with this hostname</span>
<span class="sd">                (Optional)                      Default: None</span>


<span class="sd">                skip_osc    (bool):             If true:</span>
<span class="sd">                (Optional)                      Will not wait for the filtered automatic jobs to trigger</span>
<span class="sd">                                                    (Reinstall cases for laptop, where the owner does not change)</span>

<span class="sd">                blacklist_user (str):           Add this user to blacklist user group</span>
<span class="sd">                (Optional)                      Default: None</span>


<span class="sd">                remove_blacklisted_user (str):  Remove this user from blacklist user group</span>
<span class="sd">                (Optional)                      Default: None</span>

<span class="sd">                post_osc_backup (bool):         If set to False will skip sublicent content modification and auto</span>
<span class="sd">                (Optional)                          backup job execution from osc</span>
<span class="sd">                                                    Default: True</span>

<span class="sd">                nLaptopAgent (int):             Expected values (0/1)</span>
<span class="sd">                (Optional)                          Default: 1</span>

<span class="sd">                validate_user (bool):            If true:</span>
<span class="sd">                                                 Validates the username with which the job triggered from the Backunow</span>
<span class="sd">                                                 button.</span>

<span class="sd">                backupnow  (bool):                If true:</span>
<span class="sd">                                                 Validate the BackupNow button on the Edgemonitor app.</span>

<span class="sd">                wait_for_reinstalled_client (bool):</span>
<span class="sd">                (Optional)                      If set to true wait for the client to be activated post re-install.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                sleep_before_osc (bool):</span>
<span class="sd">                (Optional)                      If set to true wait for the client to restore active state post</span>
<span class="sd">                                                    re-install.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                activation_time_limit (int):    Activation time limit.</span>
<span class="sd">                                                    Default: 8</span>

<span class="sd">            custompackage_kwargs (dict) : Custom package creation arguments</span>
<span class="sd">            ---------------------------------------------------------------</span>

<span class="sd">                Supported:</span>
<span class="sd">                ----------</span>
<span class="sd">                servicePack  (str):               Service pack for which to create the custom package</span>
<span class="sd">                                                    e.g: SP14</span>

<span class="sd">                SP_revision  (str):               Service Pack Revision for the custom package to create</span>

<span class="sd">                skip_creation (bool):             Skip package creation if skip_creation is set to true</span>
<span class="sd">                (Optional)                          Default: False</span>

<span class="sd">                authcode_flag (bool):             If set, custom package shall be created with relevant authcode for</span>
<span class="sd">                (Optional)                          either the tenant or from commcell level.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                ClientGroups (str):               If provided custom package shall be created with this client group,</span>
<span class="sd">                                                    which means the laptop is supposed to be associated to this</span>
<span class="sd">                                                    client group post install</span>
<span class="sd">                                                    Default: None</span>

<span class="sd">                laptopClient (str):               &quot;true&quot;/&quot;false&quot;: Configure for laptop client?</span>
<span class="sd">                (Optional)                          Default: true</span>

<span class="sd">                Custom_pkg_username (str):        Username with which the custom package is created.</span>
<span class="sd">                (Optional)                          Default: None</span>

<span class="sd">                Custom_pkg_password (str):        Password for the user with which the custom package is created.</span>
<span class="sd">                (Optional)                          Default: None</span>

<span class="sd">                requireCredentials (str):         Require credentials</span>
<span class="sd">                (Optional)                          Default: &quot;true&quot;</span>

<span class="sd">                backupMonitor (str):              Enable Edge monitor app process</span>
<span class="sd">                (Optional)                          Default: &quot;true&quot;, Options: &quot;false&quot; / &quot;true&quot;</span>

<span class="sd">        Returns: None</span>

<span class="sd">        Exception:</span>
<span class="sd">            - If install is set to be done with auth_code but auth_code is not set.</span>
<span class="sd">            - Client not registered with commcell.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">custompackage_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">custompackage_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cp_authcode</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#-------------------------------------------------------------------------------------</span>
            <span class="c1"># Setup</span>
            <span class="c1">#-------------------------------------------------------------------------------------</span>

            <span class="c1"># Setup machine object</span>
            <span class="n">machine_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span>
                <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_host_name&#39;</span><span class="p">],</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_user_name&#39;</span><span class="p">],</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_password&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">machine_object</span>

            <span class="c1"># Log the environment info before proceeding with the Laptop installation.</span>
            <span class="c1"># To Do : Add SQL queries at plan/organization/commcell levels to get all existing details before install.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environment_info</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_rdp_sessions</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client platform: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;os_type&#39;</span><span class="p">]))</span>
            <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_client_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Machine_client_name&#39;</span><span class="p">,</span> <span class="n">machine_object</span><span class="o">.</span><span class="n">machine_name</span><span class="p">)</span>

            <span class="c1"># Add/remove blacklisted user groups before installation.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_blacklisted_users</span><span class="p">(</span>
                <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;blacklist_user&#39;</span><span class="p">),</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;remove_blacklisted_user&#39;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Set authcode for organization</span>
            <span class="k">if</span> <span class="n">config_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;org_enable_auth_code&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">install_authcode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_authcode</span><span class="p">(</span><span class="n">config_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;override_auth_code&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
                <span class="n">cp_authcode</span> <span class="o">=</span> <span class="n">install_authcode</span>

            <span class="c1"># Set default plan and client group name for organization</span>
            <span class="k">if</span> <span class="n">config_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;org_set_default_plan&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_plan</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Default_Plan&#39;</span><span class="p">])</span>

            <span class="c1"># If silent install has to be done through authcode.</span>
            <span class="c1"># Enabling authcode at org level does not mean user wants to install with authcode.</span>
            <span class="c1"># Covers negative scenarios where user provides wrong authcode to install and org authcode is different</span>
            <span class="k">if</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install_with_authcode&#39;</span><span class="p">):</span>
                <span class="c1"># User provided authcode in test case</span>
                <span class="k">if</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;authcode&#39;</span><span class="p">):</span>
                    <span class="n">install_authcode</span> <span class="o">=</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;authcode&#39;</span><span class="p">)</span>
                    <span class="n">cp_authcode</span> <span class="o">=</span> <span class="n">install_authcode</span>

                <span class="c1"># If user says install with authcode but by now authcode is not set or not provided, exception out.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">install_authcode</span> <span class="ow">or</span> <span class="n">install_authcode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please provide auth code to use during install.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">install_authcode</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1">#-------------------------------------------------------------------------------------</span>
            <span class="c1"># Create custom package</span>
            <span class="c1">#-------------------------------------------------------------------------------------</span>

            <span class="n">custompackage_kwargs</span><span class="p">[</span><span class="s1">&#39;authcode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cp_authcode</span>
            <span class="k">if</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;os_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">:</span>
                <span class="n">custompackage_kwargs</span><span class="p">[</span><span class="s1">&#39;include_mac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span>
            <span class="n">pkg_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_custom_package</span><span class="p">(</span><span class="n">custompackage_kwargs</span><span class="p">)</span>

            <span class="c1">#-------------------------------------------------------------------------------------</span>
            <span class="c1"># Install laptop</span>
            <span class="c1">#-------------------------------------------------------------------------------------</span>

            <span class="n">install_args</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;BackupNow&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;backupnow&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s1">&#39;client_user_name&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_user_name&#39;</span><span class="p">],</span>
                <span class="s1">&#39;client_password&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_password&#39;</span><span class="p">],</span>
                <span class="s1">&#39;client_host_name&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_host_name&#39;</span><span class="p">],</span>
                <span class="s1">&#39;client_hostname&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_hostname&#39;</span><span class="p">),</span>
                <span class="s1">&#39;client_name&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_client_name&#39;</span><span class="p">],</span>
                <span class="s1">&#39;delete_client&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delete_client&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s1">&#39;executable_name&#39;</span><span class="p">:</span> <span class="n">installer_constants</span><span class="o">.</span><span class="n">PACKAGE_EXE_MAP</span><span class="p">[</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;os_type&#39;</span><span class="p">]],</span>
                <span class="s1">&#39;install_authcode&#39;</span><span class="p">:</span> <span class="n">install_authcode</span><span class="p">,</span>
                <span class="s1">&#39;install_type&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interactive_install&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s1">&#39;install_with_authcode&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install_with_authcode&#39;</span><span class="p">),</span>
                <span class="s1">&#39;organization_object&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span><span class="p">,</span>
                <span class="s1">&#39;package_location&#39;</span><span class="p">:</span> <span class="n">pkg_path</span><span class="p">,</span>
                <span class="s1">&#39;registering_user&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Activation_User&#39;</span><span class="p">],</span>
                <span class="s1">&#39;registering_user_password&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Activation_Password&#39;</span><span class="p">),</span>
                <span class="s1">&#39;register_auth_code&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;register_authcode&#39;</span><span class="p">),</span>
                <span class="s1">&#39;register_with_SAML&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;register_with_SAML&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s1">&#39;saml_email&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;saml_email&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;register_with_SAML&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;takeover_client&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;takeover_client&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s1">&#39;Tenant_company&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">,</span>
                <span class="s1">&#39;user_map&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;user_map&#39;</span><span class="p">],</span>
                <span class="s1">&#39;LaunchEdgeMonitor&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LaunchEdgeMonitor&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="n">register_args</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;register_with_new_name&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;register_with_new_name&#39;</span><span class="p">),</span>
                <span class="s1">&#39;new_client_name&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_client_name&#39;</span><span class="p">),</span>
                <span class="s1">&#39;wait_for_reinstalled_client&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_for_reinstalled_client&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s1">&#39;Machine_object&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_object&#39;</span><span class="p">],</span>
                <span class="s1">&#39;Default_Plan&#39;</span><span class="p">:</span> <span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Default_Plan&#39;</span><span class="p">),</span>
                <span class="s1">&#39;activation_time_limit&#39;</span><span class="p">:</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;activation_time_limit&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                <span class="s1">&#39;org_set_default_plan&#39;</span><span class="p">:</span> <span class="n">config_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;org_set_default_plan&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="n">client_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_and_register</span><span class="p">(</span>
                <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_client_name&#39;</span><span class="p">],</span>
                <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;execute_simcallwrapper&#39;</span><span class="p">),</span>
                <span class="n">install_args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">register_args</span>
            <span class="p">)</span>
            <span class="n">client_obj</span> <span class="o">=</span> <span class="n">client_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">client_name</span> <span class="o">=</span> <span class="n">client_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1">#---------------------------------------------------------------------------------</span>
            <span class="c1"># Validate if Pseudo Clients are created for every user in  UserCentric Mode</span>
            <span class="c1">#---------------------------------------------------------------------------------</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_pseudo_clients</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;user_map&#39;</span><span class="p">])</span>

            <span class="c1">#---------------------------------------------------------------------------------</span>
            <span class="c1"># OSC Backup and Restore</span>
            <span class="c1"># 1: OSC Backup Job shouldn&#39;t run for the Physical clients</span>
            <span class="c1"># 2: Backup job runs only for the Pseudo client.</span>
            <span class="c1">#       -if OSC job is running wait for the job to finish.</span>
            <span class="c1">#       -else check if a FULL job is already ran for the client and validate the job</span>
            <span class="c1">#---------------------------------------------------------------------------------</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                -  [</span><span class="si">{0}</span><span class="s2">] Backup and restore phase&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_host_name&#39;</span><span class="p">]))</span>

            <span class="c1"># After reinstalls especially in cases of Multiple companies with same client name and different hostname</span>
            <span class="c1"># Even after activation the client takes some time to initialize. Subclient content if modified is</span>
            <span class="c1"># reverted back to original contents.</span>
            <span class="k">if</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sleep_before_osc&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="s2">&quot;Waiting before osc backup and restore&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;user_map&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">osc_backup_and_restore</span><span class="p">(</span>
                    <span class="n">client_name</span><span class="p">,</span>
                    <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">postbackup</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;post_osc_backup&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_postosc_backup</span><span class="p">),</span>
                    <span class="n">skip_osc</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;skip_osc&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_osc_job_wait</span><span class="p">),</span>
                    <span class="n">options</span><span class="o">=</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;osc_options&#39;</span><span class="p">],</span>
                    <span class="n">validate_user</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;validate_user&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                    <span class="n">registering_user</span><span class="o">=</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Activation_User&#39;</span><span class="p">],</span>
                    <span class="n">client_name</span><span class="o">=</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;user_map&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;pseudo_client&#39;</span><span class="p">],</span>
                    <span class="n">current_state</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting&#39;</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="c1">#---------------------------------------------------------------------------------</span>
            <span class="c1"># Install validation</span>
            <span class="c1"># 1: For Physical clients no Owner should be set</span>
            <span class="c1"># 2: For Pseudo clients</span>
            <span class="c1">#       - For each pseudo client and make sure it&#39;s owner is set</span>
            <span class="c1">#       - Validate the pseudo client count after installation.</span>
            <span class="c1">#---------------------------------------------------------------------------------</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;set_inputs</span>
<span class="s2">                -  [</span><span class="si">{0}</span><span class="s2">] Validation phase&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Machine_host_name&#39;</span><span class="p">]))</span>

            <span class="c1"># Physical client does not get associated to Plan client groups.</span>
            <span class="n">client_groups</span> <span class="o">=</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_groups&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Laptop Clients&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">company_name</span><span class="p">])</span>
            <span class="n">expected_owners</span> <span class="o">=</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expected_owners&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">blacklist_user</span> <span class="o">=</span> <span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;blacklist_user&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blacklist_user</span> <span class="ow">and</span> <span class="n">blacklist_user</span> <span class="ow">in</span> <span class="n">expected_owners</span><span class="p">:</span>
                <span class="n">expected_owners</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">blacklist_user</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">validate_client</span><span class="p">(</span><span class="n">client_obj</span><span class="p">,</span>
                                              <span class="n">expected_owners</span><span class="o">=</span><span class="n">expected_owners</span><span class="p">,</span>
                                              <span class="n">client_groups</span><span class="o">=</span><span class="n">client_groups</span><span class="p">,</span>
                                              <span class="n">clients_joined</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;check_num_of_devices&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                                              <span class="n">increment_client_count_by</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;user_map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                              <span class="n">nLaptopAgent</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nLaptopAgent&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                              <span class="n">client_name</span><span class="o">=</span><span class="n">client_name</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">each_user</span> <span class="ow">in</span> <span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_map&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">validate_usercentric_client</span><span class="p">(</span>
                    <span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;user_map&#39;</span><span class="p">][</span><span class="n">each_user</span><span class="p">][</span><span class="s1">&#39;pseudo_client&#39;</span><span class="p">],</span>
                    <span class="n">expected_owners</span><span class="o">=</span><span class="p">[</span><span class="n">each_user</span><span class="p">],</span>
                    <span class="n">client_groups</span><span class="o">=</span><span class="n">install_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_groups&#39;</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelperUserCentric.install_and_register"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelperUserCentric.install_and_register">[docs]</a>    <span class="k">def</span> <span class="nf">install_and_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">register</span><span class="p">,</span> <span class="n">install_args</span><span class="p">,</span> <span class="o">**</span><span class="n">registration_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Laptop installation and registration for user centric clients</span>
<span class="sd">        Args:</span>

<span class="sd">            client (str):                    Client Name</span>

<span class="sd">            register (bool):                 Register client post install</span>

<span class="sd">            install_args (dict):             Installation arguments</span>
<span class="sd">            --------------------</span>

<span class="sd">                Supported</span>
<span class="sd">                ---------</span>

<span class="sd">                LaunchEdgeMonitor (str):         Enable Edge monitor app process</span>
<span class="sd">                (Optional)                          Default: &quot;true&quot;, Options: &quot;false&quot; / &quot;true&quot;</span>

<span class="sd">                user_map    (dict):            User map dictionary for the User Centric clients</span>
<span class="sd">                    e.g</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;testlab\testuser_01&#39;:</span>
<span class="sd">                            {</span>
<span class="sd">                                &#39;domain&#39;: &#39;testlab&#39;,</span>
<span class="sd">                                &#39;domain_user&#39;: &#39;testuser_01&#39;,</span>
<span class="sd">                                &#39;password&#39;: &#39;_password&#39;,</span>
<span class="sd">                                &#39;pseudo_client&#39;: clientname_testlab_testuser_01</span>
<span class="sd">                            },</span>
<span class="sd">                        &#39;testlab\testuser_02&#39;:</span>
<span class="sd">                            {</span>
<span class="sd">                                &#39;domain&#39;: &#39;testlab&#39;,</span>
<span class="sd">                                &#39;domain_user&#39;: &#39;testuser_02&#39;,</span>
<span class="sd">                                &#39;password&#39;: &#39;_password&#39;,</span>
<span class="sd">                                &#39;pseudo_client&#39;: clientname_testlab_testuser_02</span>
<span class="sd">                            }</span>
<span class="sd">                    }</span>

<span class="sd">                backupnow  (bool):                If true:</span>
<span class="sd">                                                 Validate the BackupNow button on the Edgemonitor app.</span>

<span class="sd">                register_authcode (str):        If authcode is provided here, the client will be registered with this</span>
<span class="sd">                (Optional)                          authcode with SimcallWrapper</span>
<span class="sd">                                                    *Do not confuse it with authcode with install*</span>
<span class="sd">                                                    *This authcode is provided with SimCallWrapper*</span>
<span class="sd">                                                    *As per SP14 design, client should register for Server Plan*</span>
<span class="sd">                                                    Default: None</span>

<span class="sd">                client_host_name (str):          Client hostname</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                client_hostname (str):           Client will be registered with this hostname</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                client_user_name (str):          Client will be registered with this name</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                client_password (str):           Client password</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                client_name (str):               Client name</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                delete_client (bool):            Delete client from Commcell before install and in cleanup</span>
<span class="sd">                (Mandatory)                      Default: True</span>

<span class="sd">                executable_name (str):           Custom Package executable name</span>
<span class="sd">                (Mandatory)                      Default: Computed from constants</span>

<span class="sd">                install_authcode (str):          Installation will be done with this auth code</span>
<span class="sd">                (Optional)                       Default: None</span>

<span class="sd">                install_type (bool):             Installation Type (True/False)</span>
<span class="sd">                (Mandatory)                      Default: False</span>

<span class="sd">                organization_object (object):    Organization object</span>
<span class="sd">                (Mandatory)                      Default: Computed in __init__</span>

<span class="sd">                package_location (str):          Location where packages would be copied to the client</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                registering_user (str):          This user name would be used to register the client</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                registering_user_password (str): Registering user password</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">                register_auth_code (str):        Registration would be done with this auth code</span>
<span class="sd">                (optional)                       Default: None</span>

<span class="sd">                register_with_SAML (bool):       SAML Registration (True/False)</span>
<span class="sd">                (Mandatory)                      Default: False</span>

<span class="sd">                saml_email (str):                SAML email</span>
<span class="sd">                (Optional)                       Default: None</span>

<span class="sd">                takeover_client (bool):          Takeover client</span>
<span class="sd">                (Mandatory)                      Default: False</span>

<span class="sd">                Tenant_company (str):            Tenant company name</span>
<span class="sd">                (Mandatory)                      Default: None</span>

<span class="sd">            ----------------------------------------------------------------------------------------------------------</span>

<span class="sd">            registration_args (dict):        Registration Arguments</span>
<span class="sd">            -------------------------</span>

<span class="sd">                Supported</span>
<span class="sd">                ---------</span>

<span class="sd">                org_set_default_plan (bool): If true will set default plan(provided in test inputs) for organization.</span>
<span class="sd">                (Optional)                    Default:False</span>

<span class="sd">                activation_time_limit (int):    Activation time limit.</span>
<span class="sd">                                                    Default: 8</span>


<span class="sd">                new_client_name (str):          Post client registration this new client name shall be</span>
<span class="sd">                (Optional)                        considered for further processing.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                register_with_new_name (bool):  If set to true the client shall be registered with a new name.</span>
<span class="sd">                (Optional)                          Default: False</span>

<span class="sd">                wait_for_reinstalled_client (bool):</span>
<span class="sd">                (Optional)                      If set to true wait for the client to be activated post re-install.</span>
<span class="sd">                                                    Default: False</span>

<span class="sd">                Machine_object (object):        Client Machine object for Machine class</span>
<span class="sd">                (Optional)</span>

<span class="sd">                Default_Plan  (str):            Default plan</span>
<span class="sd">                (Optional)</span>

<span class="sd">            ----------------------------------------------------------------------------------------------------------</span>

<span class="sd">        Returns: Tuple</span>
<span class="sd">            (Client name (str):    Client name,</span>
<span class="sd">             client object (obj):    Machine class object for the client)</span>

<span class="sd">        Raises</span>
<span class="sd">            Exception</span>
<span class="sd">                - if failed to install client</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;Custom package Installation for [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">install_args</span><span class="p">[</span><span class="s1">&#39;client_host_name&#39;</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">log_step</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                - [</span><span class="si">{1}</span><span class="s2">]     Install custom package with following parameters</span>
<span class="s2">                  [</span><span class="si">{0}</span><span class="s2">]</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">install_args</span><span class="p">,</span> <span class="n">install_args</span><span class="p">[</span><span class="s1">&#39;client_host_name&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">installer</span> <span class="o">=</span> <span class="n">Installation</span><span class="o">.</span><span class="n">create_installer_object</span><span class="p">(</span><span class="n">install_args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">installer</span><span class="o">.</span><span class="n">uninstall_existing_instance</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">installer</span><span class="o">.</span><span class="n">delete_client_from_commcell</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span><span class="p">:</span>
                <span class="n">pre_machine_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span><span class="o">.</span><span class="n">machine_count</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">installer</span><span class="o">.</span><span class="n">install_client</span><span class="p">()</span>
            <span class="n">registered_client</span> <span class="o">=</span> <span class="n">client</span>

            <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
                <span class="n">register_with_client</span> <span class="o">=</span> <span class="n">client</span>
                <span class="k">if</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;register_with_new_name&#39;</span><span class="p">):</span>
                    <span class="n">register_with_client</span> <span class="o">=</span> <span class="n">registration_args</span><span class="p">[</span><span class="s1">&#39;new_client_name&#39;</span><span class="p">]</span>
                <span class="n">registered_client</span> <span class="o">=</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_client_name&#39;</span><span class="p">,</span> <span class="n">registered_client</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">each_user</span> <span class="ow">in</span> <span class="n">install_args</span><span class="p">[</span><span class="s1">&#39;user_map&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">installer</span><span class="o">.</span><span class="n">execute_register_me_command</span><span class="p">(</span>
                        <span class="n">username</span><span class="o">=</span><span class="n">each_user</span><span class="p">,</span>
                        <span class="n">password</span><span class="o">=</span><span class="n">install_args</span><span class="p">[</span><span class="s1">&#39;user_map&#39;</span><span class="p">][</span><span class="n">each_user</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">],</span>
                        <span class="n">register_with_client</span><span class="o">=</span><span class="n">register_with_client</span><span class="p">,</span>
                        <span class="n">client_post_register</span><span class="o">=</span><span class="n">registered_client</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

            <span class="c1"># In reinstall of client (takeover) the client activation takes time even though the client is ready</span>
            <span class="c1"># and part of defaults Plans client group.(Because of old entry). The old client is also part of</span>
            <span class="c1"># company&#39;s devices. Observed if proceed without sleep, subclient content is overridden and removed</span>
            <span class="c1"># for reinstalled client, so osc backup triggered through manually updated content immediately after</span>
            <span class="c1"># registration fails.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_client_name&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_for_reinstalled_client&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="s2">&quot;Waiting for reinstalled client to be activated.&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_object</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">is_device_associated</span><span class="p">(</span><span class="n">pre_machine_count</span><span class="p">)</span>

            <span class="c1"># In case the client name is supposed to change post registration [ Reinstall scenarios ],</span>
            <span class="c1"># then set the client name.</span>
            <span class="c1"># Also, Wait until client ready, before creating client object.</span>
            <span class="c1"># Because when client object is created with commcell object, it checks for client readiness, and if</span>
            <span class="c1"># client is not ready exceptions out.</span>
            <span class="c1"># Also, post simwrapper execution or even without it, when cvd registers/activates clients, client</span>
            <span class="c1"># is not ready [ Client check readiness fails ] for certain interval of time.</span>
            <span class="n">new_client</span> <span class="o">=</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_client_name&#39;</span><span class="p">)</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">new_client</span> <span class="k">if</span> <span class="n">new_client</span> <span class="k">else</span> <span class="n">client</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">wait_until_client_ready</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="k">if</span> <span class="n">new_client</span> <span class="k">else</span> <span class="n">registration_args</span><span class="p">[</span><span class="s1">&#39;Machine_object&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">install_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LaunchEdgeMonitor&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_edge_monitor_running</span><span class="p">(</span><span class="n">client_obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;org_set_default_plan&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">each_user</span> <span class="ow">in</span> <span class="n">install_args</span><span class="p">[</span><span class="s1">&#39;user_map&#39;</span><span class="p">]:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">is_client_activated</span><span class="p">(</span>
                        <span class="n">install_args</span><span class="p">[</span><span class="s1">&#39;user_map&#39;</span><span class="p">][</span><span class="n">each_user</span><span class="p">][</span><span class="s1">&#39;pseudo_client&#39;</span><span class="p">],</span>
                        <span class="n">registration_args</span><span class="p">[</span><span class="s1">&#39;Default_Plan&#39;</span><span class="p">],</span>
                        <span class="n">time_limit</span><span class="o">=</span><span class="n">registration_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;activation_time_limit&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                    <span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">client_obj</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelperUserCentric.create_pseudo_map"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelperUserCentric.create_pseudo_map">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_pseudo_map</span><span class="p">(</span><span class="n">test_inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create user map for User Centric clients</span>

<span class="sd">         Args:</span>

<span class="sd">            test_inputs (dict)          : test case inputs</span>

<span class="sd">        Returns:</span>

<span class="sd">            Dictionary containing details for each user</span>
<span class="sd">            e.g</span>
<span class="sd">            {</span>
<span class="sd">                &#39;testlab\testuser_01&#39;:</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;domain&#39;: &#39;testlab&#39;,</span>
<span class="sd">                        &#39;domain_user&#39;: &#39;testuser_01&#39;,</span>
<span class="sd">                        &#39;password&#39;: &#39;######&#39;,</span>
<span class="sd">                        &#39;pseudo_client&#39;: clientname_testlab_testuser_01</span>
<span class="sd">                    },</span>
<span class="sd">                &#39;testlab\testuser_02&#39;:</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;domain&#39;: &#39;testlab&#39;,</span>
<span class="sd">                        &#39;domain_user&#39;: &#39;testuser_02&#39;,</span>
<span class="sd">                        &#39;password&#39;: &#39;######&#39;,</span>
<span class="sd">                        &#39;pseudo_client&#39;: clientname_testlab_testuser_02</span>
<span class="sd">                    }</span>
<span class="sd">            }</span>

<span class="sd">        Raises</span>
<span class="sd">            Exception</span>
<span class="sd">                - If failed to create mapping</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">usermap</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">test_inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;Activation_User&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">user</span> <span class="o">=</span> <span class="n">test_inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">domain_username</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">usermap</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">usermap</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain</span>
                <span class="n">usermap</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;domain_user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain_username</span>
                <span class="n">usermap</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;pseudo_client&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">test_inputs</span><span class="p">[</span><span class="s1">&#39;Machine_client_name&#39;</span><span class="p">],</span> <span class="n">domain</span><span class="p">,</span> <span class="n">domain_username</span><span class="p">])</span>
                <span class="n">passkey</span> <span class="o">=</span> <span class="s2">&quot;Activation_Password&quot;</span>
                <span class="n">user_index</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Activation_User&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">user_index</span><span class="p">:</span>
                    <span class="n">passkey</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_index</span><span class="p">)</span>
                <span class="n">usermap</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">passkey</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">usermap</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelperUserCentric.check_pseudo_clients"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelperUserCentric.check_pseudo_clients">[docs]</a>    <span class="k">def</span> <span class="nf">check_pseudo_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_map</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks if pseudo clients are created on the Commcell for each user in the user map</span>

<span class="sd">         Args:</span>

<span class="sd">            user_map (dict)             : user map for Pseudo clients</span>

<span class="sd">        Example:</span>

<span class="sd">            Dictionary containing details for each user</span>
<span class="sd">            e.g</span>
<span class="sd">            {</span>
<span class="sd">                &#39;testlab\testuser_01&#39;:</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;domain&#39;: &#39;testlab&#39;,</span>
<span class="sd">                        &#39;domain_user&#39;: &#39;testuser_01&#39;,</span>
<span class="sd">                        &#39;pseudo_client&#39;: clientname_testlab_testuser_01</span>
<span class="sd">                    },</span>
<span class="sd">                &#39;testlab\testuser_02&#39;:</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;domain&#39;: &#39;testlab&#39;,</span>
<span class="sd">                        &#39;domain_user&#39;: &#39;testuser_02&#39;,</span>
<span class="sd">                        &#39;pseudo_client&#39;: clientname_testlab_testuser_02</span>
<span class="sd">                    }</span>
<span class="sd">            }</span>

<span class="sd">        Raises</span>
<span class="sd">            Exception</span>
<span class="sd">                - If pseudo client does not exist on Commcell</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">each_user</span> <span class="ow">in</span> <span class="n">user_map</span><span class="p">:</span>
                <span class="n">client_name</span> <span class="o">=</span> <span class="n">user_map</span><span class="p">[</span><span class="n">each_user</span><span class="p">][</span><span class="s1">&#39;pseudo_client&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">has_client</span><span class="p">(</span><span class="n">client_name</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Pseudo client [</span><span class="si">{0}</span><span class="s2">] is not created&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Pseudo client [</span><span class="si">{0}</span><span class="s2">] is not created in UserCentric Mode&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pseudo client is [</span><span class="si">{0}</span><span class="s2">] created on Commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LaptopHelperUserCentric.cleanup_user_centric"><a class="viewcode-back" href="../../source/Laptop.html#Laptop.laptophelper.LaptopHelperUserCentric.cleanup_user_centric">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup_user_centric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tcinputs</span><span class="p">,</span> <span class="n">delete_client</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Module to perform cleanups for laptop testcases</span>

<span class="sd">         Args:</span>
<span class="sd">            tcinputs (dict)            : Testcase input answers</span>

<span class="sd">            delete_client (bool)       : Hard delete client from commcell</span>
<span class="sd">                                            Default: True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Disable shared laptop usage on the organization.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">shared_laptop_usage</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">(</span><span class="n">tcinputs</span><span class="p">,</span> <span class="n">delete_client</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>