

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>FileSystem.FSUtils.fshelper &mdash; Commvault Automation 11.19 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>FileSystem.FSUtils.fshelper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for FileSystem.FSUtils.fshelper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;Helper file for performing File System operations</span>

<span class="sd">ScanType , IndexEnabled, CommitCondition and FSHelper are 4 classes defined in this file.</span>

<span class="sd">ScanType: Enum constants for all the scan types currently supported for file system subclients</span>

<span class="sd">IndexEnabled: With Blocklevel we check Meta Data Collection on or not.</span>

<span class="sd">CommitCondition: Enum constants for all supported commit conditions.</span>

<span class="sd">FSHelper: Helper class to perform file system operations</span>

<span class="sd">FSHelper:</span>
<span class="sd">    __init__()                        --  initializes file system helper object</span>

<span class="sd">    create_backupset()                --  creates new backupset</span>

<span class="sd">    create_instance()                 --  creates new instance for filesystem big data apps</span>

<span class="sd">    create_subclient()                --  creates new subclient</span>

<span class="sd">    update_subclient()                --  updates properties of existing subclient</span>

<span class="sd">    run_backup()                      --  Run backup on the testcase subclient</span>

<span class="sd">    find_items_subclient()            --  Find items by browse</span>
<span class="sd">    on the testcase subclient</span>

<span class="sd">    compare_lists()                   --  Compare source and destination</span>
<span class="sd">    list and find differennces</span>

<span class="sd">    restore_in_place()                --  Run in place restore</span>

<span class="sd">    restore_out_of_place()            --  Run out of place restore</span>

<span class="sd">    run_backup_verify()               --  Initiates backup and</span>
<span class="sd">    performs the applicable verifications</span>

<span class="sd">    run_restore_verify()              --  Initiates restore for data</span>
<span class="sd">    backed up in the given job and performs the applicable verifications</span>

<span class="sd">    run_find_verify()                 --  Finds items backed up in the given job</span>
<span class="sd">    and compares it with items from machine</span>

<span class="sd">    add_new_data_incr()               --  Adds new data for incremental</span>
<span class="sd">    with provisions for modification after this function execution,</span>
<span class="sd">    call mod_data_incr for modifications</span>

<span class="sd">    mod_data_incr()                   --  Modifies the data added by add_new_data_incr</span>
<span class="sd">    call add_new_data_incr before calling this.</span>

<span class="sd">    check_pseudo_client()             --  Checks for the existence of pseudo-client on CS</span>
<span class="sd">    for Usercentric laptop clients</span>

<span class="sd">    check_scheduled_backup()          --  Checks for the status of the scheduled backup job of</span>
<span class="sd">    pseudo-client for Usercentric laptop clients</span>

<span class="sd">    pseudo_client_cleanup()           --  Removes pseudo-client from CS for Usercentric</span>
<span class="sd">    laptop clients</span>

<span class="sd">    get_subclient_content()           --  Generates the subclient content list</span>

<span class="sd">    volume_level_restore()            --  To perform blocklevel volume level restore on client</span>

<span class="sd">    backup_copy()                     --  Run backup copy from Subclient level</span>

<span class="sd">    get_backup_stream_count()         --  Returns the number of streams used by a backup job</span>

<span class="sd">    get_restore_stream_count()        --  Returns the number of streams used by a restore job</span>

<span class="sd">    verify_dc()                       --  Verifies whether the job used Scan optimization</span>

<span class="sd">    validate_trueup()                 --  Checks if trueup ran or not;</span>
<span class="sd">    based on conditional variable it also checks</span>
<span class="sd">    if trueup picked up files for backup.</span>

<span class="sd">    run_systemstate_backup()          --  Checks for the system state property and runs a backup</span>

<span class="sd">    run_onetouch_backup()             --  Checking if onetouch option is enabled and running a backup</span>

<span class="sd">    commit_job()                      --  Commits the backup job if the threshold condition is met or exceeded.</span>

<span class="sd">    parse_restart_string()            --  Parses a backup job restart string and</span>
<span class="sd">    prepares a dictionary of collect file ID to offset value.</span>

<span class="sd">    create_expected_commit_files()    --  Prepares the expected committed files for the committed backup job.</span>

<span class="sd">    get_actual_commit_files()         --  Retrieves the actual commit files that were generated by scan.</span>

<span class="sd">    validate_commit_files()           --  Function checks whether the commit collect file and</span>
<span class="sd">    commit dirchange file were created correctly.</span>

<span class="sd">    _update_ref_time_dict()           --  Updates the reference time dictionary self.job_ref_time_dict.</span>

<span class="sd">    extent_level_validation()         --  Function attempts to check whether large files were backed up as extents.</span>
<span class="sd">    It also, optionally, validates the extent eligible collect file.</span>

<span class="sd">    generate_testdata()                -- To generate the test data</span>

<span class="sd">    validate_filters()                 -- To validate the filters set at client group level</span>

<span class="sd">    validate_failed_files()             -- To validate the failed files from collects</span>

<span class="sd">    is_snapshot_deleted()               -- To check if snapshot has been deleted</span>

<span class="sd">    get_snapshot_id()                   -- To get the snapshot ID created for that job</span>



<span class="sd">FSHelper Instance Attributes:</span>
<span class="sd">=============================</span>

<span class="sd">    **subclient_job_results_directory**            --  Returns the subclient job  results directory path.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">floor</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">difflib</span> <span class="k">import</span> <span class="n">Differ</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">past.builtins</span> <span class="k">import</span> <span class="n">basestring</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="k">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.cvtestcase</span> <span class="k">import</span> <span class="n">CVTestCase</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.machine</span> <span class="k">import</span> <span class="n">Machine</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.windows_machine</span> <span class="k">import</span> <span class="n">WindowsMachine</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.database_helper</span> <span class="k">import</span> <span class="n">get_csdb</span>


<div class="viewcode-block" id="ScanType"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.ScanType">[docs]</a><span class="k">class</span> <span class="nc">ScanType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constants for all the scan types</span>
<span class="sd">        currently supported for file system subclients&quot;&quot;&quot;</span>
    <span class="n">RECURSIVE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">OPTIMIZED</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">CHANGEJOURNAL</span> <span class="o">=</span> <span class="mi">3</span></div>


<div class="viewcode-block" id="IndexEnabled"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.IndexEnabled">[docs]</a><span class="k">class</span> <span class="nc">IndexEnabled</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;With Blocklevel we check Meta Data Collection on or not&quot;&quot;&quot;</span>

    <span class="n">NOINDEX</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">INDEX</span> <span class="o">=</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="CommitCondition"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.CommitCondition">[docs]</a><span class="k">class</span> <span class="nc">CommitCondition</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constants for all supported commit conditions&quot;&quot;&quot;</span>
    <span class="n">FILES</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SECONDS</span> <span class="o">=</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="SoftwareCompression"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.SoftwareCompression">[docs]</a><span class="k">class</span> <span class="nc">SoftwareCompression</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constants for all the supported software compression values.&quot;&quot;&quot;</span>

    <span class="n">ON_CLIENT</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ON_MEDIA_AGENT</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">USE_STORAGE_POLICY_SETTINGS</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">OFF</span> <span class="o">=</span> <span class="mi">4</span></div>


<div class="viewcode-block" id="FSHelper"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper">[docs]</a><span class="k">class</span> <span class="nc">FSHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class to perform file system operations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testcase</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize instance of the FSHelper class.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span> <span class="o">=</span> <span class="n">testcase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span> <span class="o">=</span> <span class="n">get_csdb</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_client_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_job_ref_time_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">job_ref_time_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary of jobs and their reference times.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_ref_time_dict</span>

    <span class="nd">@job_ref_time_dict</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">job_ref_time_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the job to reference time dictionary.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_job_ref_time_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="FSHelper.populate_tc_inputs"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.populate_tc_inputs">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">populate_tc_inputs</span><span class="p">(</span><span class="n">cv_testcase</span><span class="p">,</span> <span class="n">mandatory</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes all the test case inputs after validation</span>

<span class="sd">        Args:</span>
<span class="sd">            cv_testcase    (obj)    --    Object of CVTestCase</span>
<span class="sd">            mandatory      (bool)   --    whether to check for mandatory inputs</span>
<span class="sd">            and raise exception if not found</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if a valid CVTestCase object is not passed.</span>
<span class="sd">                if CVTestCase object doesn&#39;t have agent initialized</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cv_testcase</span><span class="p">,</span> <span class="n">CVTestCase</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Valid test case object must be passed as argument&quot;</span>
            <span class="p">)</span>

        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_name</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ClientName&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">test_path</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TestPath&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">test_path2</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TestPath2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">test_path3</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TestPath3&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">test_path_list</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;TestPathList&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">restore_path</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RestorePath&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">storage_policy</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StoragePolicyName&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">snap_engine</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;snapengine&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">storage_policy</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StoragePolicyName&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">unicode</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Unicode&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">acls</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ACLS&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">xattr</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XATTR&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">hlinks</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hlinks&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">slinks</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;slinks&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">sparse</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sparse&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">long_path</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LongPath&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">verify_dc</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VerifyDC&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">problematic</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Problematic&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">dirtime</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FolderTimeStamp&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">skiplink</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SkipLink&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">skip_classic</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SkipClassic&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HostName&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UserName&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Password&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">proxy_client</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ProxyClient&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">iscsi_server</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IscsiServer&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">runid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">())</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">is_client_big_data_apps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">is_client_network_share</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">master_node</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MasterNode&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">data_access_nodes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">no_of_streams</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">instance_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">cleanup_run</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CleanupRun&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># wait time after populating the data for journals to catch up</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">WAIT_TIME</span> <span class="o">=</span> <span class="mi">30</span>

        <span class="c1"># no of days to retain test data on the machine.</span>
        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">RETAIN_DAYS</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">should_wait</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span><span class="p">(</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">test_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">test_path_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mandatory</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;TestPath is a mandatory string input for the test case.&quot;</span>
                <span class="s2">&quot;TestPathList is a mandatory list input for the test case.&quot;</span>
                <span class="s2">&quot;At least one of these MUST be provided.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">storage_policy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mandatory</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;StoragePolicyName is a&quot;</span>
                <span class="s2">&quot; mandatory string input for the test case&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DataAccessNodes&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">data_access_nodes</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;DataAccessNodes&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NoOfStreams&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">no_of_streams</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;NoOfStreams&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Agent Name == File system</span>
            <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">agent_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;file system&quot;</span><span class="p">,</span> <span class="s2">&quot;windows file System&quot;</span><span class="p">,</span> <span class="s2">&quot;linux file system&quot;</span><span class="p">]:</span>
                <span class="n">cv_testcase</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;DefaultInstanceName&quot;</span>
                <span class="p">)</span>

                <span class="c1"># For Network share client, the data access nodes will be set in input JSON</span>
                <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">data_access_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cv_testcase</span><span class="o">.</span><span class="n">is_client_network_share</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">cv_testcase</span><span class="o">.</span><span class="n">skiplink</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># select the first node in data access nodes as master node</span>
                    <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">data_access_nodes</span><span class="p">:</span>
                        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_node</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">data_access_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The data access node list cannot be empty&quot;</span><span class="p">)</span>

                    <span class="c1"># use cvd for connecting with the master node</span>
                    <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span>
                            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_node</span><span class="p">,</span>
                            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">commcell</span>
                        <span class="p">)</span>

                    <span class="c1"># for network share clients, set number of streams to be 2* number of data</span>
                    <span class="c1"># access nodes</span>
                    <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">no_of_streams</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">no_of_streams</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">data_access_nodes</span><span class="p">)</span>

                <span class="c1"># for filesystem clients set number of streams to be 1</span>
                <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">no_of_streams</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cv_testcase</span><span class="o">.</span><span class="n">no_of_streams</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Agent Name = Big Data Apps</span>
            <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">agent_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;big data apps&quot;</span><span class="p">:</span>
                <span class="n">cv_testcase</span><span class="o">.</span><span class="n">is_client_big_data_apps</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">cv_testcase</span><span class="o">.</span><span class="n">skiplink</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_node</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">master_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">master_node</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_node</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">master_node</span>
                <span class="k">elif</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">data_access_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">data_access_nodes</span><span class="p">:</span>
                    <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_node</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">data_access_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;The Master node and the data access nodes both cannot be empty&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">master_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cv_testcase</span><span class="o">.</span><span class="n">master_node</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="c1"># use cvd for all communications with the master node</span>
                <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span>
                        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_node</span><span class="p">,</span>
                        <span class="n">cv_testcase</span><span class="o">.</span><span class="n">commcell</span>
                    <span class="p">)</span>

                <span class="c1"># If no of streams is not given in input. Configure 2 * no of data access</span>
                <span class="c1"># nodes for big data apps</span>
                <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">no_of_streams</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cv_testcase</span><span class="o">.</span><span class="n">no_of_streams</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">data_access_nodes</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Agent object is not initialized for test case. &quot;</span>
                <span class="s2">&quot;Valid ClientName and AgentName must be provided &quot;</span>
                <span class="s2">&quot;in the inputs.&quot;</span><span class="p">)</span>

        <span class="c1"># If credentials are given, directly login using credentials</span>
        <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">hostname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span><span class="p">((</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">username</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">password</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span>
                    <span class="n">cv_testcase</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span>
                    <span class="n">cv_testcase</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span>
                    <span class="n">username</span><span class="o">=</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                    <span class="n">password</span><span class="o">=</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">password</span>
                <span class="p">)</span>

        <span class="c1"># If no credentials are given, use cvd for all communications</span>
        <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span>
                <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span>
                <span class="n">cv_testcase</span><span class="o">.</span><span class="n">commcell</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="n">WindowsMachine</span><span class="p">):</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">applicable_os</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">os_list</span><span class="o">.</span><span class="n">WINDOWS</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">slash_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
            <span class="kn">from</span> <span class="nn">FileSystem.FSUtils.winfshelper</span> <span class="k">import</span> <span class="n">WinFSHelper</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">helper</span> <span class="o">=</span> <span class="n">WinFSHelper</span><span class="p">(</span><span class="n">cv_testcase</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">slash_format</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">applicable_os</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">os_list</span><span class="o">.</span><span class="n">UNIX</span>
            <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_flavour</span> <span class="o">!=</span> <span class="s1">&#39;OS400&#39;</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">FileSystem.FSUtils.unixfshelper</span> <span class="k">import</span> <span class="n">UnixFSHelper</span>
                <span class="n">cv_testcase</span><span class="o">.</span><span class="n">helper</span> <span class="o">=</span> <span class="n">UnixFSHelper</span><span class="p">(</span><span class="n">cv_testcase</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">FileSystem.FSUtils.ibmihelper</span> <span class="k">import</span> <span class="n">IBMiHelper</span>
                <span class="n">cv_testcase</span><span class="o">.</span><span class="n">helper</span> <span class="o">=</span> <span class="n">IBMiHelper</span><span class="p">(</span><span class="n">cv_testcase</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_flavour</span> <span class="o">==</span> <span class="s1">&#39;OpenVMS&#39;</span><span class="p">:</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">mount_openvms_testpath</span><span class="p">(</span><span class="n">cv_testcase</span><span class="o">.</span><span class="n">test_path</span><span class="p">)</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">test_path</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">test_path</span>

        <span class="c1"># Hard links and Symbolic links are disabled by default for windows</span>
        <span class="k">if</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span><span class="p">:</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">hlinks</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hlinks&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">cv_testcase</span><span class="o">.</span><span class="n">slinks</span> <span class="o">=</span> <span class="n">cv_testcase</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;slinks&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

    <span class="c1"># The subclient_job_results_directory is less of an input to the test case</span>
    <span class="c1"># and more of a constant for the test case, hence it has been defined as a property.</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subclient_job_results_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the subclient job  results directory path.&quot;&quot;&quot;</span>
        <span class="n">path_items</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">client_object</span><span class="o">.</span><span class="n">job_results_directory</span><span class="p">,</span>
                      <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">commcell_id</span><span class="p">),</span>
                      <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span><span class="p">:</span>
            <span class="n">sc_jr_items</span> <span class="o">=</span> <span class="n">path_items</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;CV_JobResults&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;iDataAgent&quot;</span><span class="p">,</span> <span class="s2">&quot;FileSystemAgent&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">path_items</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;UNIX&quot;</span><span class="p">:</span>
            <span class="n">sc_jr_items</span> <span class="o">=</span> <span class="n">path_items</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="o">*</span><span class="n">sc_jr_items</span><span class="p">)</span>

<div class="viewcode-block" id="FSHelper.verify_dc"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.verify_dc">[docs]</a>    <span class="k">def</span> <span class="nf">verify_dc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">log_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verifies whether the job used Scan optimization</span>

<span class="sd">             Args:</span>
<span class="sd">                jobid    (int)  -- jobid to be checked</span>

<span class="sd">                log_dir  (str)  -- path of the log directory</span>
<span class="sd">                    default:None</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool   -   Returns True if dc scan was successful or else false</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while verifying the scan status</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Arguments </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">log_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Has to be implemented in child class before calling&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="c1"># Below code is unreachable, but adding it to avoid pylint error</span>
        <span class="c1"># as we are calling this function in parent code using child object and using the return value from child</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FSHelper.get_restore_stream_count"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.get_restore_stream_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_restore_stream_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">log_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the number of streams used by a restore job</span>

<span class="sd">             Args:</span>
<span class="sd">                job    (object)  -- job object of the restore job to be checked</span>

<span class="sd">                log_dir  (str)  -- path of the log directory</span>
<span class="sd">                    default:None</span>

<span class="sd">            Returns:</span>
<span class="sd">                int   -   the number of streams used by a restore job</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while getting the restore stream count</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Arguments </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">log_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Has to be implemented in child class before calling&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="c1"># Below code is unreachable, but adding it to avoid pylint error</span>
        <span class="c1"># as we are calling this function in parent code using child object and using the return value from child</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="FSHelper.create_backupset"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.create_backupset">[docs]</a>    <span class="k">def</span> <span class="nf">create_backupset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates new backupset with specified parameters</span>
<span class="sd">             under the current testcase Instance.</span>

<span class="sd">            Checks if the backupset exists or not.</span>
<span class="sd">            If the backupset exists, deletes the existing backupset</span>
<span class="sd">            and creates new one with the testcase id.</span>

<span class="sd">            Args:</span>
<span class="sd">                name   (str)  -- name of the backupset</span>

<span class="sd">                delete (bool) -- indicates whether existing backupset should be deleted</span>
<span class="sd">                    default: False</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occured during backupset creation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking if backupset </span><span class="si">%s</span><span class="s2"> exists.&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">backupsets_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">backupsets</span>
            <span class="k">if</span> <span class="n">backupsets_object</span><span class="o">.</span><span class="n">has_backupset</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backupset exists, deleting backupset </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="n">backupsets_object</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating backupset </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backupset exists, using existing backupset </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">backupset</span> <span class="o">=</span> <span class="n">backupsets_object</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backupset doesn&#39;t exist, creating backupset </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">backupset</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">backupsets_object</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Backupset Creation Failed with error: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">excp</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Backupset Creation Failed with error: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FSHelper.create_instance"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.create_instance">[docs]</a>    <span class="k">def</span> <span class="nf">create_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates new Instance with specified parameters</span>
<span class="sd">             under the current Client.</span>

<span class="sd">            Checks if the Instance exists or not.</span>
<span class="sd">            If the Instance exists, deletes the existing Instance</span>
<span class="sd">            and creates new one with the testcase id.</span>

<span class="sd">            Args:</span>
<span class="sd">                name   (str)  -- name of the Instance</span>

<span class="sd">                delete (bool) -- indicates whether existing Instance should be deleted</span>
<span class="sd">                    default: False</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occured during Instance creation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking if Instance </span><span class="si">%s</span><span class="s2"> exists.&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">instances_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">instances</span>
            <span class="k">if</span> <span class="n">instances_object</span><span class="o">.</span><span class="n">has_instance</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Instance exists, deleting Instance </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="n">instances_object</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating Instance </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Instance exists, using existing Instance </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">instances_object</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">backupset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">backupsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s2">&quot;DefaultBackupSet&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Instance doesn&#39;t exist, creating Instance </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

            <span class="n">data_access_nodes_json</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">access_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">data_access_nodes</span><span class="p">:</span>
                <span class="n">data_access_nodes_json</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;clientName&quot;</span><span class="p">:</span> <span class="n">access_node</span><span class="p">})</span>

            <span class="n">json</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;instanceName&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;MasterNode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">master_node</span><span class="p">,</span>
                <span class="s2">&quot;dataAccessNodes&quot;</span><span class="p">:</span> <span class="n">data_access_nodes_json</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">instances_object</span><span class="o">.</span><span class="n">add_big_data_apps_instance</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">backupset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">backupsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DefaultBackupSet&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Instance Creation Failed with error: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Instance Creation Failed with error: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FSHelper.create_subclient"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.create_subclient">[docs]</a>    <span class="k">def</span> <span class="nf">create_subclient</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">storage_policy</span><span class="p">,</span>
            <span class="n">content</span><span class="p">,</span>
            <span class="n">filter_content</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">exception_content</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">trueup_option</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">trueup_days</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
            <span class="n">scan_type</span><span class="o">=</span><span class="n">ScanType</span><span class="o">.</span><span class="n">RECURSIVE</span><span class="p">,</span>
            <span class="n">data_readers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">allow_multiple_readers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">read_buffer_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
            <span class="n">block_level_backup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">data_access_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates subclient under current testcase backupset</span>
<span class="sd">            with specified parameters</span>

<span class="sd">            Args:</span>
<span class="sd">                name (str)                       -- subclient name</span>

<span class="sd">                storage_policy (str)             -- storage policy to assign to subclient</span>

<span class="sd">                content (list)                   -- content list</span>

<span class="sd">                filter_content (list)            -- filter list</span>
<span class="sd">                    default: None</span>

<span class="sd">                exception_conent (list)          -- exception list</span>
<span class="sd">                    default: None</span>

<span class="sd">                trueup_option (bool)             -- enable / disable true up</span>
<span class="sd">                    default: True</span>

<span class="sd">                trueup_days (int)                -- trueup after n days value of the subclient</span>
<span class="sd">                    default: 30</span>

<span class="sd">                data_readers (int)               -- number of data readers</span>
<span class="sd">                    default: 2</span>

<span class="sd">                allow_multiple_readers (bool)    -- enable / disable allow multiple readers</span>
<span class="sd">                    default: False</span>

<span class="sd">                read_buffer_size (int)           -- read buffer size in KB</span>
<span class="sd">                    default: 512</span>

<span class="sd">                delete (bool)                    -- indicates whether existing subclient should be deleted</span>
<span class="sd">                    default: False</span>

<span class="sd">                scan_type(ScanType(Enum))        --  scan type (RECURSIVE/OPTIMIZED/CHANGEJOURNAL)</span>
<span class="sd">                    default: ScanType.RECURSIVE</span>

<span class="sd">                data_access_nodes(list)          -- Data Access nodes for NFS share or big data apps</span>
<span class="sd">                    default : None</span>

<span class="sd">                block_level_backup (str)         -- blocklevel backup data switch</span>
<span class="sd">                    default: None</span>

<span class="sd">                \*\*kwargs  (dict)              --  Optional arguments.</span>

<span class="sd">                Available kwargs Options:</span>

<span class="sd">                    software_compression(SoftwareCompression(Enum)) :   Software compression property for a subclient.</span>
<span class="sd">                    (ON_CLIENT/ON_MEDIA_AGENT/USE_STORAGE_POLICY_SETTINGS/OFF)</span>

<span class="sd">                    use_vss (dict)  --  Enable or Disable Use VSS, Applicable to Windows FS only.</span>
<span class="sd">                    Dictionary contains the keys &#39;useVSS&#39;, &#39;vssOptions&#39; and &#39;useVssForAllFilesOptions&#39;.</span>

<span class="sd">                    useVSS:</span>
<span class="sd">                        True    -   ENABLED</span>
<span class="sd">                        False   -   DISABLED</span>

<span class="sd">                    vssOptions:</span>
<span class="sd">                        1   -   For all files</span>
<span class="sd">                        2   -   For locked files only</span>

<span class="sd">                    useVssForAllFilesOptions:</span>
<span class="sd">                        1   -   Fail the job</span>
<span class="sd">                        2   -   Continue and reset access time</span>
<span class="sd">                        3   -   Continue and do not reset access time</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred during Subclient creation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking if subclient </span><span class="si">%s</span><span class="s2"> exists.&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">subclients_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span>

            <span class="k">if</span> <span class="n">subclients_object</span><span class="o">.</span><span class="n">has_subclient</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Subclient exists, deleting subclient </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="n">subclients_object</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating subclient </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Subclient exists, use existing subclient </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="n">subclients_object</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Subclient doesn&#39;t exist, creating subclient </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">subclients_object</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">storage_policy</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_subclient</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                <span class="n">filter_content</span><span class="o">=</span><span class="n">filter_content</span><span class="p">,</span>
                <span class="n">exception_content</span><span class="o">=</span><span class="n">exception_content</span><span class="p">,</span>
                <span class="n">trueup_option</span><span class="o">=</span><span class="n">trueup_option</span><span class="p">,</span>
                <span class="n">trueup_days</span><span class="o">=</span><span class="n">trueup_days</span><span class="p">,</span>
                <span class="n">scan_type</span><span class="o">=</span><span class="n">scan_type</span><span class="p">,</span>
                <span class="n">data_readers</span><span class="o">=</span><span class="n">data_readers</span><span class="p">,</span>
                <span class="n">allow_multiple_readers</span><span class="o">=</span><span class="n">allow_multiple_readers</span><span class="p">,</span>
                <span class="n">block_level_backup</span><span class="o">=</span><span class="n">block_level_backup</span><span class="p">,</span>
                <span class="n">read_buffer_size</span><span class="o">=</span><span class="n">read_buffer_size</span><span class="p">,</span>
                <span class="n">data_access_nodes</span><span class="o">=</span><span class="n">data_access_nodes</span><span class="p">,</span>
                <span class="n">software_compression</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;software_compression&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">backup_onetouch</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;backup_onetouch&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">onetouch_server</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;onetouch_server&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">onetouch_server_directory</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;onetouch_server_directory&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">description</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">applicable_os</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_subclient</span><span class="p">(</span><span class="n">use_vss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;useVSS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;useVssForAllFilesOptions&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vssOptions&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Subclient Creation Failed with error: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Subclient Creation Failed with error: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FSHelper.update_subclient"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.update_subclient">[docs]</a>    <span class="k">def</span> <span class="nf">update_subclient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">storage_policy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">content</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">filter_content</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">exception_content</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">trueup_option</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">trueup_days</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">scan_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">data_readers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">allow_multiple_readers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">read_buffer_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">block_level_backup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">createFileLevelIndex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">data_access_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">backup_system_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates subclient property of current</span>
<span class="sd">            testcase subclient with specified parameters</span>

<span class="sd">            Args:</span>
<span class="sd">                storage_policy (str)            -- storage policy to assign to subclient</span>
<span class="sd">                    default: None</span>

<span class="sd">                content (list)                  -- content list</span>
<span class="sd">                    default: None</span>

<span class="sd">                filter_content (list)           -- filter list</span>
<span class="sd">                    default: None</span>

<span class="sd">                exception_conent (list)         -- exception list</span>
<span class="sd">                    default: None</span>

<span class="sd">                trueup_option (bool)            -- enable / disable true up</span>
<span class="sd">                    default: None</span>

<span class="sd">                trueup_days (int)               -- trueup after n days value of the subclient</span>
<span class="sd">                    default: None</span>

<span class="sd">                scan_type(ScanType(Enum))       -- scan type(RECURSIVE/OPTIMIZED/CHANGEJOURNAL)</span>
<span class="sd">                    default: None</span>

<span class="sd">                data_readers (int)              -- number of data readers</span>
<span class="sd">                    default: None</span>

<span class="sd">                allow_multiple_readers (bool)   -- enable / disable allow multiple readers</span>
<span class="sd">                    default: None</span>

<span class="sd">                read_buffer_size (int)          -- read buffer size in KB</span>
<span class="sd">                    default: None</span>

<span class="sd">                data_access_nodes (list)        -- sets the list passed as data access nodes</span>
<span class="sd">                or backup nodes for this subclient</span>

<span class="sd">                blockLevelBackup                -- enable/Disable Blocklevel Option</span>
<span class="sd">                    default:None</span>

<span class="sd">                createFileLevelIndex            -- Enable/Diable Metadata option</span>
<span class="sd">                     default:False</span>

<span class="sd">                backup_system_state             --  Enable/Disable system state option</span>
<span class="sd">                     default:None</span>

<span class="sd">                backup_onetouch                 --  Enable/Disable 1-Touch Recovery option</span>
<span class="sd">                    default:None</span>

<span class="sd">                onetouch_server                 -- provides onetouch server name</span>
<span class="sd">                    default:None</span>

<span class="sd">                onetouch_server_directory       -- Provides onetouch server directory</span>
<span class="sd">                    default:None</span>

<span class="sd">                \*\*kwargs  (dict)              --  Optional arguments.</span>

<span class="sd">                Available kwargs Options:</span>

<span class="sd">                    software_compression(SoftwareCompression(Enum)) :   Software compression property for a subclient.</span>
<span class="sd">                    (ON_CLIENT/ON_MEDIA_AGENT/USE_STORAGE_POLICY_SETTINGS/OFF)</span>

<span class="sd">                    catalog_acl                     --  Enable/Disable catalog acl option</span>

<span class="sd">                    use_vss (dict)  --  Enable or Disable Use VSS, Applicable to Windows FS only.</span>
<span class="sd">                    Dictionary contains the keys &#39;useVSS&#39;, &#39;vssOptions&#39; and &#39;useVssForAllFilesOptions&#39;.</span>

<span class="sd">                    useVSS:</span>
<span class="sd">                        True    -   ENABLED</span>
<span class="sd">                        False   -   DISABLED</span>

<span class="sd">                    vssOptions:</span>
<span class="sd">                        1   -   For all files</span>
<span class="sd">                        2   -   For locked files only</span>

<span class="sd">                    useVssForAllFilesOptions:</span>
<span class="sd">                        1   -   Fail the job</span>
<span class="sd">                        2   -   Continue and reset access time</span>
<span class="sd">                        3   -   Continue and do not reset access time</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred during Subclient Property update</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">storage_policy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">storage_policy</span> <span class="o">=</span> <span class="n">storage_policy</span>
            <span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
            <span class="k">if</span> <span class="n">filter_content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">filter_content</span> <span class="o">=</span> <span class="n">filter_content</span>
            <span class="k">if</span> <span class="n">exception_content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">exception_content</span> <span class="o">=</span> <span class="n">exception_content</span>
            <span class="k">if</span> <span class="n">scan_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">scan_type</span> <span class="o">=</span> <span class="n">scan_type</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="n">trueup_option</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">trueup_option</span> <span class="o">=</span> <span class="n">trueup_option</span>
            <span class="k">if</span> <span class="n">trueup_days</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">trueup_days</span> <span class="o">=</span> <span class="n">trueup_days</span>
            <span class="k">if</span> <span class="n">data_readers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data_access_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">data_readers</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_access_nodes</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">data_readers</span> <span class="o">=</span> <span class="n">data_readers</span>
            <span class="k">if</span> <span class="n">allow_multiple_readers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data_access_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">allow_multiple_readers</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">allow_multiple_readers</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">allow_multiple_readers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">read_buffer_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">read_buffer_size</span> <span class="o">=</span> <span class="n">read_buffer_size</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">is_client_big_data_apps</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">set_data_access_nodes</span><span class="p">(</span><span class="n">data_access_nodes</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">is_client_network_share</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">set_backup_nodes</span><span class="p">(</span><span class="n">data_access_nodes</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">block_level_backup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">block_level_backup_option</span> <span class="o">=</span> <span class="n">block_level_backup</span>
            <span class="k">if</span> <span class="n">createFileLevelIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">create_file_level_index_option</span> <span class="o">=</span> <span class="n">createFileLevelIndex</span>

            <span class="k">if</span> <span class="n">backup_system_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">system_state_option</span> <span class="o">=</span> <span class="n">backup_system_state</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;backup_onetouch&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">onetouch_option</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;backup_onetouch&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;onetouch_server&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">onetouch_server</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;onetouch_server&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;onetouch_server_directory&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">onetouch_server_directory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s1">&#39;onetouch_server_directory&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;software_compression&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">software_compression</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;software_compression&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;catalog_acl&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">catalog_acl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;catalog_acl&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_vss&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">use_vss</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_vss&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Subclient Update Failed with error: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Subclient Update Failed with error: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FSHelper.run_backup"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.run_backup">[docs]</a>    <span class="k">def</span> <span class="nf">run_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">backup_level</span><span class="o">=</span><span class="s2">&quot;Incremental&quot;</span><span class="p">,</span>
                   <span class="n">incremental_backup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">incremental_level</span><span class="o">=</span><span class="s1">&#39;BEFORE_SYNTH&#39;</span><span class="p">,</span>
                   <span class="n">wait_to_complete</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initiates backup job with specified options</span>
<span class="sd">            on the current testcase subclient object</span>
<span class="sd">            and waits for completion.</span>

<span class="sd">            Args:</span>
<span class="sd">                backup_level            (str)   --  level of backup</span>
<span class="sd">                (Full/Incremental/Differential/Synthetic_full)</span>

<span class="sd">                    default: Incremental</span>

<span class="sd">                incremental_backup      (bool)  --  run incremental backup</span>
<span class="sd">                only applicable in case of Synthetic_full backup</span>

<span class="sd">                    default: False</span>

<span class="sd">                incremental_level       (str)   --  run incremental backup</span>
<span class="sd">                before/after synthetic full (BEFORE_SYNTH / AFTER_SYNTH)</span>
<span class="sd">                only applicable in case of Synthetic_full backup</span>

<span class="sd">                    default: BEFORE_SYNTH</span>

<span class="sd">                wait_to_complete        (bool)  --  Specifies whether to wait until job finishes.</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    - list of instances of the Job class for the backup jobs ran</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while running backup or</span>
<span class="sd">                backup didn&#39;t complete successfully.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">backup_level</span> <span class="o">==</span> <span class="s2">&quot;Synthetic_full&quot;</span> <span class="ow">and</span> <span class="n">incremental_backup</span><span class="p">):</span>
                <span class="n">backup_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">backup_level</span> <span class="o">+</span> <span class="s2">&quot; with incremental &quot;</span> <span class="o">+</span> <span class="n">incremental_level</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">backup_type</span> <span class="o">=</span> <span class="n">backup_level</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting </span><span class="si">%s</span><span class="s2"> Backup &quot;</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span>
                <span class="n">backup_level</span><span class="p">,</span> <span class="n">incremental_backup</span><span class="p">,</span> <span class="n">incremental_level</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">job_type</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">job_type</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">job_type</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span>

            <span class="k">if</span> <span class="n">wait_to_complete</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Waiting for completion of </span><span class="si">%s</span><span class="s2"> backup with Job ID: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to run </span><span class="si">{0}</span><span class="s2"> backup </span><span class="si">{1}</span><span class="s2"> with error: </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">job_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> job </span><span class="si">{1}</span><span class="s2">status is not Completed, job has status: </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">job_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished </span><span class="si">%s</span><span class="s2"> job </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

                <span class="c1"># Wait for second job to complete correctly if applicable</span>
                <span class="c1"># and return both of them</span>
                <span class="k">if</span><span class="p">(</span><span class="n">backup_level</span> <span class="o">==</span> <span class="s2">&quot;Synthetic_full&quot;</span> <span class="ow">and</span> <span class="n">incremental_backup</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">incremental_level</span> <span class="o">==</span> <span class="s1">&#39;BEFORE_SYNTH&#39;</span><span class="p">:</span>
                        <span class="n">expected_job2_type</span> <span class="o">=</span> <span class="s1">&#39;synthetic full&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">expected_job2_type</span> <span class="o">=</span> <span class="s1">&#39;incremental&#39;</span>
                    <span class="n">attempts</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">job2</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">while</span> <span class="n">attempts</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">latest_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">find_latest_job</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">latest_job</span><span class="o">.</span><span class="n">backup_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">latest_job_type</span> <span class="o">=</span> <span class="n">latest_job</span><span class="o">.</span><span class="n">job_type</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">latest_job_type</span> <span class="o">=</span> <span class="n">latest_job</span><span class="o">.</span><span class="n">backup_level</span>
                        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">latest_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">latest_job_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">expected_job2_type</span><span class="p">:</span>
                                <span class="n">job2</span> <span class="o">=</span> <span class="n">latest_job</span>
                                <span class="k">break</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                                    <span class="s1">&#39;Expected </span><span class="si">{0}</span><span class="s1"> but job </span><span class="si">{1}</span><span class="s1"> is </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">expected_job2_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">latest_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span> <span class="n">latest_job_type</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                        <span class="n">attempts</span> <span class="o">=</span> <span class="n">attempts</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">job2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Expected </span><span class="si">{0}</span><span class="s1"> job not started within timeout&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">expected_job2_type</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">job2</span><span class="o">.</span><span class="n">backup_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">job2_type</span> <span class="o">=</span> <span class="n">job2</span><span class="o">.</span><span class="n">job_type</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">job2_type</span> <span class="o">=</span> <span class="n">job2</span><span class="o">.</span><span class="n">backup_level</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Waiting for completion of </span><span class="si">%s</span><span class="s2"> backup with Job ID: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">job2_type</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">job2</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">job2</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="s2">&quot;Failed to run </span><span class="si">{0}</span><span class="s2"> backup </span><span class="si">{1}</span><span class="s2"> with error: </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">job2_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job2</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span> <span class="n">job2</span><span class="o">.</span><span class="n">delay_reason</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">job2</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> job </span><span class="si">{1}</span><span class="s2"> status is not Completed, job has status: </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">job2_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job2</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span> <span class="n">job2</span><span class="o">.</span><span class="n">status</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished </span><span class="si">%s</span><span class="s2"> job </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job2_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job2</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">job</span><span class="p">,</span> <span class="n">job2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_ref_time_dict</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">job</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started </span><span class="si">%s</span><span class="s2"> backup with Job ID: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">job</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Job error : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">excp</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Job error : </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FSHelper.find_items_subclient"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.find_items_subclient">[docs]</a>    <span class="k">def</span> <span class="nf">find_items_subclient</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">**</span><span class="se">\\</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy_precedence</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">media_agent</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">sorted_output</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Searches a file/folder in the subclient backup content,</span>
<span class="sd">            and returns all the files matching the filters given.</span>

<span class="sd">             Args:</span>
<span class="sd">                path   (str)          --  directory path to get the items list</span>
<span class="sd">                    default: &#39;\\**\\*&#39;</span>

<span class="sd">                filters (list)        -- list of filters</span>
<span class="sd">                                            to exclude from the given path</span>

<span class="sd">                from_time (int)       --  time to find the contents after</span>
<span class="sd">                    format: timestamp</span>
<span class="sd">                    default: None</span>

<span class="sd">                to_time (int)         --  time to find the contents before</span>
<span class="sd">                    format: timestamp</span>
<span class="sd">                    default: None</span>

<span class="sd">                copy_precedence (int) -- copy precedence for the find operation</span>
<span class="sd">                    default: 0</span>

<span class="sd">                media_agent (str)     -- mediaagent to be used for the find operation</span>
<span class="sd">                    default: &#39;&#39;</span>

<span class="sd">                page_size (int)       -- page size for the find</span>
<span class="sd">                    default: 100000</span>

<span class="sd">                sorted_output (bool)  -- to specify whether the list should be sorted.</span>
<span class="sd">                    default : True</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    -   list of the items</span>
<span class="sd">                             from the find operation on the subclient</span>

<span class="sd">                dict    -   Dictionary of all the paths</span>
<span class="sd">                             with additional metadata retrieved from browse</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while doing the find operation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">find_options</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">find_options</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
            <span class="k">if</span> <span class="n">from_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">find_options</span><span class="p">[</span><span class="s1">&#39;from_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_time</span>
            <span class="k">if</span> <span class="n">to_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">find_options</span><span class="p">[</span><span class="s1">&#39;to_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_time</span>
            <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">find_options</span><span class="p">[</span><span class="s1">&#39;copy_precedence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy_precedence</span>
            <span class="n">find_options</span><span class="p">[</span><span class="s1">&#39;media_agent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">media_agent</span>
            <span class="n">find_options</span><span class="p">[</span><span class="s1">&#39;page_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_size</span>
            <span class="n">find_options</span><span class="p">[</span><span class="s1">&#39;filters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filters</span>

            <span class="n">find_items</span><span class="p">,</span> <span class="n">meta_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">find_options</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sorted_output</span><span class="p">:</span>
                <span class="n">find_items</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">find_items</span><span class="p">,</span> <span class="n">meta_data</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error occurred while doing the find operation: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Error occurred while doing the find operation: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FSHelper.compare_lists"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.compare_lists">[docs]</a>    <span class="k">def</span> <span class="nf">compare_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_list</span><span class="p">,</span> <span class="n">destination_list</span><span class="p">,</span> <span class="n">sort_list</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compares the source list with destination list</span>
<span class="sd">            and checks if they are same.</span>

<span class="sd">             Args:</span>
<span class="sd">                source_list      (list)</span>

<span class="sd">                destination_list (list)</span>

<span class="sd">                sort_list        (bool)    -- Indicates whether the list</span>
<span class="sd">                should be sorted before comparison</span>

<span class="sd">                    default: False</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool   -   Returns True if lists are same or returns False</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while comparing the lists.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sort_list</span><span class="p">:</span>
                <span class="n">source_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">destination_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">source_list</span> <span class="o">==</span> <span class="n">destination_list</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="n">diff</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">source_list</span><span class="p">,</span> <span class="n">destination_list</span><span class="p">)</span>
            <span class="n">diff_output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Source and destination lists differ&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Diff Output : </span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">diff_output</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error occurred while comparing the lists </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Error occurred while comparing the lists </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FSHelper.restore_in_place"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.restore_in_place">[docs]</a>    <span class="k">def</span> <span class="nf">restore_in_place</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">paths</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Restores the files/folders specified</span>
<span class="sd">            in the input paths list to the same location.</span>

<span class="sd">            Args:</span>
<span class="sd">                paths     (list)  --  list of full paths of files/folders to restore</span>

<span class="sd">                Kwargs:</span>
<span class="sd">                Keyword argument of restore options:</span>

<span class="sd">                    Example:</span>
<span class="sd">                        {</span>

<span class="sd">                        overwrite                (bool)  -- unconditional overwrite files</span>
<span class="sd">                            default: True</span>

<span class="sd">                        restore_data_and_acl     (bool)  -- restore data and ACL files</span>

<span class="sd">                            default: True</span>

<span class="sd">                        copy_precedence          (int)   -- copy precedence value</span>
<span class="sd">                            default: None</span>

<span class="sd">                        from_time                (str)   -- time from(restore the contents after)</span>
<span class="sd">                            format: YYYY-MM-DD HH:MM:SS</span>

<span class="sd">                            default: None</span>

<span class="sd">                        to_time                  (str)   -- time to(restore the contents before)</span>
<span class="sd">                            format: YYYY-MM-DD HH:MM:SS</span>

<span class="sd">                            default: None</span>

<span class="sd">                        restoreDataInsteadOfStub (bool)  -- to restore data instead of stub</span>
<span class="sd">                            default: True</span>

<span class="sd">                        restoreOnlyStubExists    (bool)  -- to restore data only if stub exists</span>
<span class="sd">                            default: False</span>

<span class="sd">                        overwriteFiles           (bool)  -- to overwrite if data on media is newer</span>
<span class="sd">                            default: True</span>

<span class="sd">                        doNotOverwriteFileOnDisk (bool)  -- to not overwrite files on disk</span>
<span class="sd">                            default: False</span>

<span class="sd">                        disableStubRestore       (bool)  -- will not allow stub restore</span>
<span class="sd">                        in case dangle stub existed</span>

<span class="sd">                            default True</span>

<span class="sd">                        _schedule_pattern        (dict)  -- schedule create job option</span>

<span class="sd">                            default :None</span>

<span class="sd">                        }</span>

<span class="sd">            Returns:</span>
<span class="sd">                object - instance of the Job class for this restore job</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while running restore</span>
<span class="sd">                or restore didn&#39;t complete successfully.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Run Restore in place &quot;</span><span class="p">)</span>
            <span class="n">_fs_options</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_overwrite</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">_restore_data_and_acl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;restore_data_and_acl&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">_copy_precedence</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;copy_precedence&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">_from_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;from_time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">_to_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;to_time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">_fs_options</span><span class="p">[</span><span class="s1">&#39;restoreDataInsteadOfStub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;restoreDataInsteadOfStub&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">_fs_options</span><span class="p">[</span><span class="s1">&#39;restoreOnlyStubExists&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;restoreOnlyStubExists&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">_fs_options</span><span class="p">[</span><span class="s1">&#39;overwriteFiles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;overwriteFiles&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">_fs_options</span><span class="p">[</span><span class="s1">&#39;doNotOverwriteFileOnDisk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;doNotOverwriteFileOnDisk&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">_fs_options</span><span class="p">[</span><span class="s1">&#39;disableStubRestore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;disableStubRestore&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">_schedule_pattern</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;schedule_pattern&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">restore_in_place</span><span class="p">(</span>
                <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
                <span class="n">overwrite</span><span class="o">=</span><span class="n">_overwrite</span><span class="p">,</span>
                <span class="n">restore_data_and_acl</span><span class="o">=</span><span class="n">_restore_data_and_acl</span><span class="p">,</span>
                <span class="n">copy_precedence</span><span class="o">=</span><span class="n">_copy_precedence</span><span class="p">,</span>
                <span class="n">from_time</span><span class="o">=</span><span class="n">_from_time</span><span class="p">,</span>
                <span class="n">to_time</span><span class="o">=</span><span class="n">_to_time</span><span class="p">,</span>
                <span class="n">fs_options</span><span class="o">=</span><span class="n">_fs_options</span><span class="p">,</span>
                <span class="n">schedule_pattern</span><span class="o">=</span><span class="n">_schedule_pattern</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started restore in place job with job id: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_to_complete&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to run restore in place job with error: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Job status is not Completed, job has status: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished restore in place job&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">job</span>
            <span class="k">return</span> <span class="n">job</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Job error : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Job error : </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FSHelper.restore_out_of_place"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.restore_out_of_place">[docs]</a>    <span class="k">def</span> <span class="nf">restore_out_of_place</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">destination_path</span><span class="p">,</span>
            <span class="n">paths</span><span class="p">,</span>
            <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">restore_data_and_acl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">restore_ACL</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">copy_precedence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">preserve_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">proxy_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">impersonate_user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">impersonate_password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">is_vlr_restore</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">is_client_big_data_apps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">destination_instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">no_of_streams</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">restore_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">iscsi_server</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Restores the files/folders specified</span>
<span class="sd">            in the input paths list to the input client,</span>
<span class="sd">            at the specified destionation location.</span>

<span class="sd">            Args:</span>
<span class="sd">                client                (str/object) --  either the name or the instance of Client</span>
<span class="sd">                    default: None</span>

<span class="sd">                destination_path      (str)        --  full path of the restore location on client</span>

<span class="sd">                paths                 (list)       --  list of full paths of</span>
<span class="sd">                files/folders to restore</span>

<span class="sd">                overwrite             (bool)       --  unconditional overwrite files during restore</span>
<span class="sd">                    default: True</span>

<span class="sd">                restore_data_and_acl  (bool)       --  restore data and ACL of files</span>
<span class="sd">                    default: True</span>

<span class="sd">                restore_ACL           (bool)       --  restore ACLs for Unix</span>
<span class="sd">                    default: True</span>

<span class="sd">                copy_precedence       (int)        --  copy precedence value</span>
<span class="sd">                    default: None</span>

<span class="sd">                from_time             (str)        --  time to restore the contents after</span>
<span class="sd">                    format: YYYY-MM-DD HH:MM:SS</span>

<span class="sd">                    default: None</span>

<span class="sd">                to_time               (str)        --  time to retore the contents before</span>
<span class="sd">                    format: YYYY-MM-DD HH:MM:SS</span>

<span class="sd">                    default: None</span>

<span class="sd">                preserve_level        (int)        --  preserve level option to set in restore</span>
<span class="sd">                    default: 0</span>

<span class="sd">                proxy_client          (str)        --  proxy that needed to be used for restore</span>
<span class="sd">                    default: None</span>

<span class="sd">                impersonate_user      (str)        --  Impersonate user options for restore</span>
<span class="sd">                    default: None</span>

<span class="sd">                impersonate_password  (str)        --  Impersonate password option for restore</span>
<span class="sd">                in base64 encoded form</span>

<span class="sd">                    default: None</span>

<span class="sd">                is_vlr_restore        (bool)       --  Blocklevel Switch to run restore of Volume</span>
<span class="sd">                    default: False</span>


<span class="sd">                is_client_big_data_apps(bool)      --  to indicate if the destintation client</span>
<span class="sd">                is of type DISTRIBUTED_IDA</span>

<span class="sd">                    default : None</span>

<span class="sd">                destination_instance  (str)        --  destination instance if the destination</span>
<span class="sd">                client is of type DISTRIBUTED_IDA</span>

<span class="sd">                    default : None</span>

<span class="sd">                no_of_streams         (int)        --  number of streams used for restore</span>
<span class="sd">                    default : 1</span>

<span class="sd">                restore_nodes         (list)       --  the data access nodes used for restore</span>
<span class="sd">                in case of multi-node restore.</span>

<span class="sd">                    default : None</span>

<span class="sd">            Returns:</span>
<span class="sd">                object - instance of the Job class for this restore job</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while running restore</span>
<span class="sd">                            or restore didn&#39;t complete successfully.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Run Restore out of place &quot;</span><span class="p">)</span>
            <span class="n">multinode_restore</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># set fs_options</span>
            <span class="n">fs_options</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;preserve_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preserve_level</span>
            <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;restore_ACL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">restore_ACL</span>
            <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;no_of_streams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">no_of_streams</span>

            <span class="k">if</span> <span class="n">proxy_client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;proxy_client&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxy_client</span>

            <span class="k">if</span> <span class="n">iscsi_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;iscsi_server&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iscsi_server</span>

            <span class="k">if</span> <span class="n">is_vlr_restore</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;is_vlr_restore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_vlr_restore</span>

            <span class="k">if</span> <span class="n">impersonate_user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;impersonate_user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">impersonate_user</span>

            <span class="k">if</span> <span class="n">impersonate_password</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;impersonate_password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">impersonate_password</span>

            <span class="c1"># Multi-node restores if restore_nodes is set</span>
            <span class="k">if</span> <span class="n">restore_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;multinode_restore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">multinode_restore</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">multinode_restore</span><span class="p">:</span>

                <span class="n">restore_nodes_json</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">access_node</span> <span class="ow">in</span> <span class="n">restore_nodes</span><span class="p">:</span>
                    <span class="n">restore_nodes_json</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;clientName&quot;</span><span class="p">:</span> <span class="n">access_node</span><span class="p">})</span>

                <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;data_access_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">restore_nodes_json</span>

                <span class="k">if</span> <span class="n">is_client_big_data_apps</span><span class="p">:</span>
                    <span class="c1"># use the current test case client as default</span>
                    <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client</span>
                    <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;destination_instance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination_instance</span>
                    <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;destination_appTypeId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">64</span>
                    <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;client_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">29</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># use the client_node as default for multi-node</span>
                    <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_node</span><span class="p">)</span>
                    <span class="k">elif</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
                    <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;destination_appTypeId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span> <span class="k">if</span> <span class="s2">&quot;windows&quot;</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">os_info</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">else</span> <span class="mi">29</span>

            <span class="k">elif</span> <span class="n">no_of_streams</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># use the current test case client as default</span>
                <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
                <span class="n">fs_options</span><span class="p">[</span><span class="s1">&#39;destination_appTypeId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span> <span class="k">if</span> <span class="s2">&quot;windows&quot;</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">os_info</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">else</span> <span class="mi">29</span>

            <span class="c1"># use the current test case client as default</span>
            <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client</span>

            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">restore_out_of_place</span><span class="p">(</span>
                <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
                <span class="n">destination_path</span><span class="o">=</span><span class="n">destination_path</span><span class="p">,</span>
                <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
                <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
                <span class="n">restore_data_and_acl</span><span class="o">=</span><span class="n">restore_data_and_acl</span><span class="p">,</span>
                <span class="n">copy_precedence</span><span class="o">=</span><span class="n">copy_precedence</span><span class="p">,</span>
                <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span>
                <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span>
                <span class="n">fs_options</span><span class="o">=</span><span class="n">fs_options</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started restore out of place job with job id: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_to_complete&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to run restore out of place job with error: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Job status is not Completed, job has status: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished restore out of place job&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">job</span>
            <span class="k">return</span> <span class="n">job</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Job error : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Job error : </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

    <span class="k">def</span> <span class="nf">_verify_job_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">no_of_streams</span><span class="p">,</span> <span class="n">streams_used</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Verifies if the job used expected number of streams</span>

<span class="sd">            Args:</span>
<span class="sd">                job (obj)                --  instance of the job class</span>

<span class="sd">                no_of_streams (int)      --  expected number of streams to be used</span>

<span class="sd">                streams_used (int)       --  actual number of streams used</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - if the job didn&#39;t use expected streams</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">streams_used</span> <span class="o">==</span> <span class="n">no_of_streams</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">%s</span><span class="s2"> used </span><span class="si">%s</span><span class="s2"> streams as expected&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">streams_used</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Job:</span><span class="si">%s</span><span class="s2"> used incorrect streams ExpectedStreams:</span><span class="si">%s</span><span class="s2"> ActualStreams:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                           <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">no_of_streams</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">streams_used</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job:</span><span class="si">{0}</span><span class="s2"> used incorrect streams ExpectedStreams:</span><span class="si">{1}</span><span class="s2"> ActualStreams:</span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">no_of_streams</span><span class="p">,</span> <span class="n">streams_used</span><span class="p">))</span>

<div class="viewcode-block" id="FSHelper.run_backup_verify"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.run_backup_verify">[docs]</a>    <span class="k">def</span> <span class="nf">run_backup_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">scan_type</span><span class="o">=</span><span class="n">ScanType</span><span class="o">.</span><span class="n">RECURSIVE</span><span class="p">,</span>
                          <span class="n">backup_level</span><span class="o">=</span><span class="s2">&quot;Incremental&quot;</span><span class="p">,</span>
                          <span class="n">incremental_backup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">incremental_level</span><span class="o">=</span><span class="s1">&#39;BEFORE_SYNTH&#39;</span><span class="p">,</span>
                          <span class="n">scan_marking</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initiates backup and performs the applicable verifications</span>
<span class="sd">             on current test case subclient</span>

<span class="sd">            Args:</span>
<span class="sd">                scan_type         (ScanType(Enum)) -- scan type(RECURSIVE/OPTIMIZED/CHANGEJOURNAL)</span>
<span class="sd">                    default: ScanType.RECURSIVE</span>

<span class="sd">                backup_level      (str)            -- level of backup</span>
<span class="sd">                (Full/Incremental/Differential/Synthetic_full)</span>

<span class="sd">                    default: Incremental</span>

<span class="sd">                incremental_backup(bool)           -- run incremental backup</span>
<span class="sd">                only applicable in case of Synthetic_full backup</span>

<span class="sd">                    default: False</span>

<span class="sd">                incremental_level (str)            -- run incremental backup</span>
<span class="sd">                before/after synthetic full(BEFORE_SYNTH / AFTER_SYNTH)</span>
<span class="sd">                only applicable in case of Synthetic_full backup</span>

<span class="sd">                    default: BEFORE_SYNTH</span>

<span class="sd">                scan_marking      (bool)           --  to check whether</span>
<span class="sd">                the job ran as Scan Marking Job</span>

<span class="sd">                    default: False</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    - instances of the Job class for the backup job ran</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while</span>
<span class="sd">                running backup or during verification.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="n">testcase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span>
            <span class="n">backup_level</span><span class="o">=</span><span class="n">backup_level</span><span class="p">,</span>
            <span class="n">incremental_backup</span><span class="o">=</span><span class="n">incremental_backup</span><span class="p">,</span>
            <span class="n">incremental_level</span><span class="o">=</span><span class="n">incremental_level</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;totalFailedFiles&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;totalFailedFolders&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">%s</span><span class="s2"> has failed items&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">{0}</span><span class="s2"> has failed items&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)))</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">testcase</span><span class="o">.</span><span class="n">applicable_os</span> <span class="o">==</span> <span class="s1">&#39;UNIX&#39;</span> <span class="ow">and</span> <span class="n">testcase</span><span class="o">.</span><span class="n">verify_dc</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">backup_level</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;synthetic_full&#39;</span><span class="p">):</span>
                <span class="n">is_dc_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_dc</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">scan_type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">ScanType</span><span class="o">.</span><span class="n">OPTIMIZED</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_dc_used</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">%s</span><span class="s2"> did not use scan optimization&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">{0}</span><span class="s2"> did not use scan optimization&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)))</span>
                <span class="k">elif</span> <span class="n">scan_type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">ScanType</span><span class="o">.</span><span class="n">RECURSIVE</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="n">is_dc_used</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">%s</span><span class="s2"> incorrectly used scan optimization&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">{0}</span><span class="s2"> incorrectly used scan optimization&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">scan_marking</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_scan_marking</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">{0}</span><span class="s2"> didn&#39;t complete in scan phase as expected.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="n">backup_level</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;synthetic_full&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">no_of_streams</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">is_client_big_data_apps</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">is_client_network_share</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_verify_job_streams</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">no_of_streams</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_backup_stream_count</span><span class="p">(</span><span class="n">job</span><span class="p">))</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job completed successfully without any failures&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jobs</span></div>

<div class="viewcode-block" id="FSHelper.run_restore_verify"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.run_restore_verify">[docs]</a>    <span class="k">def</span> <span class="nf">run_restore_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">slash_format</span><span class="p">,</span>
                           <span class="n">data_path</span><span class="p">,</span>
                           <span class="n">tmp_path</span><span class="p">,</span>
                           <span class="n">data_path_leaf</span><span class="p">,</span>
                           <span class="n">job</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">is_client_big_data_apps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">destination_instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">no_of_streams</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">proxy_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">restore_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">iscsi_server</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initiates restore for data backed up in the given job</span>
<span class="sd">            and performs the applicable verifications</span>

<span class="sd">            Args:</span>
<span class="sd">                slash_format    (str)       -- OS path separator format</span>

<span class="sd">                data_path       (str/list)  -- Source data path, a single source path can be provided as a string or</span>
<span class="sd">                multiple source paths can be provided as a list of strings.</span>

<span class="sd">                tmp_path        (str)       -- temporary path for restoring the data</span>

<span class="sd">                data_path_leaf  (str)       -- leaf level of the data_path</span>

<span class="sd">                job             (obj)       -- instance of the job class</span>
<span class="sd">                whose data needs to be restored</span>

<span class="sd">                    default : None</span>

<span class="sd">                cleanup (bool)           -- to indicate if restored data should be cleaned up</span>
<span class="sd">                    default : True</span>

<span class="sd">                is_client_big_data_apps(bool) -- to indicate if the destintation client</span>
<span class="sd">                is of type DISTRIBUTED_IDA</span>

<span class="sd">                    default : None</span>

<span class="sd">                destination_instance (str) -- destination instance if the destination</span>
<span class="sd">                client is of type DISTRIBUTED_IDA</span>

<span class="sd">                    default : None</span>

<span class="sd">                no_of_streams (int)      -- number of streams used for restore</span>

<span class="sd">                    default : 1</span>

<span class="sd">                proxy_client(str)        -- Proxy for restore</span>

<span class="sd">                    default : None</span>

<span class="sd">                restore_nodes (list)     -- the data access nodes used for restore in case of</span>
<span class="sd">                multi-node restore.</span>

<span class="sd">                    default : None</span>

<span class="sd">                iSCSIServer (str)         -- iscsi server option for restore</span>

<span class="sd">                    defaults: None</span>

<span class="sd">            Returns:</span>
<span class="sd">               object - instance of the Job class for this restore job</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while</span>
<span class="sd">                            running restore or during verification.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">testcase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="n">client_machine</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">path</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">data_path</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">+</span> <span class="n">slash_format</span> <span class="o">+</span> <span class="n">data_path_leaf</span> <span class="o">+</span> <span class="s2">&quot;_restore&quot;</span>

        <span class="n">restore_from_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">restore_to_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">job</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restore_from_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;jobStartTime&#39;</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="n">restore_to_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;jobEndTime&#39;</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="c1"># clean up destination directory before starting restore</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting restore with source:</span><span class="si">%s</span><span class="s1"> destination:</span><span class="si">%s</span><span class="s1"> from_time:</span><span class="si">%s</span><span class="s1"> to_time:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                 <span class="nb">str</span><span class="p">(</span><span class="n">paths</span><span class="p">),</span> <span class="n">dest_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">restore_from_time</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">restore_to_time</span><span class="p">))</span>

        <span class="n">jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_out_of_place</span><span class="p">(</span>
            <span class="n">destination_path</span><span class="o">=</span><span class="n">dest_path</span><span class="p">,</span>
            <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
            <span class="n">from_time</span><span class="o">=</span><span class="n">restore_from_time</span><span class="p">,</span>
            <span class="n">to_time</span><span class="o">=</span><span class="n">restore_to_time</span><span class="p">,</span>
            <span class="n">is_client_big_data_apps</span><span class="o">=</span><span class="n">is_client_big_data_apps</span><span class="p">,</span>
            <span class="n">destination_instance</span><span class="o">=</span><span class="n">destination_instance</span><span class="p">,</span>
            <span class="n">no_of_streams</span><span class="o">=</span><span class="n">no_of_streams</span><span class="p">,</span>
            <span class="n">proxy_client</span><span class="o">=</span><span class="n">proxy_client</span><span class="p">,</span>
            <span class="n">restore_nodes</span><span class="o">=</span><span class="n">restore_nodes</span><span class="p">,</span>
            <span class="n">iscsi_server</span><span class="o">=</span><span class="n">iscsi_server</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">restore_nodes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">no_of_streams</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verify_job_streams</span><span class="p">(</span><span class="n">jobs</span><span class="p">,</span> <span class="n">no_of_streams</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_restore_stream_count</span><span class="p">(</span><span class="n">jobs</span><span class="p">))</span>

        <span class="n">compare_source</span> <span class="o">=</span> <span class="n">data_path</span>
        <span class="n">compare_destination</span> <span class="o">=</span> <span class="n">dest_path</span> <span class="o">+</span> <span class="n">slash_format</span> <span class="o">+</span> <span class="n">data_path_leaf</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Comparing source:</span><span class="si">%s</span><span class="s2"> destination:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">compare_source</span><span class="p">,</span> <span class="n">compare_destination</span><span class="p">)</span>

        <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">client_machine</span><span class="o">.</span><span class="n">compare_meta_data</span><span class="p">(</span>
            <span class="n">compare_source</span><span class="p">,</span>
            <span class="n">compare_destination</span><span class="p">,</span>
            <span class="n">dirtime</span><span class="o">=</span><span class="n">testcase</span><span class="o">.</span><span class="n">dirtime</span><span class="p">,</span>
            <span class="n">skiplink</span><span class="o">=</span><span class="n">testcase</span><span class="o">.</span><span class="n">skiplink</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Meta data comparison successful&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Meta data comparison failed&quot;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">diff_output</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Meta data comparison failed&quot;</span><span class="p">)</span>

        <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">client_machine</span><span class="o">.</span><span class="n">compare_checksum</span><span class="p">(</span>
            <span class="n">compare_source</span><span class="p">,</span> <span class="n">compare_destination</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checksum comparison successful&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Checksum comparison failed&quot;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">diff_output</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Checksum comparison failed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">applicable_os</span> <span class="o">==</span> <span class="s1">&#39;UNIX&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">acls</span><span class="p">:</span>
                <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">client_machine</span><span class="o">.</span><span class="n">compare_acl</span><span class="p">(</span>
                    <span class="n">compare_source</span><span class="p">,</span>
                    <span class="n">compare_destination</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ACL comparison successful&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ACL comparison failed&quot;</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">diff_output</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ACL comparison failed&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">xattr</span><span class="p">:</span>
                <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">client_machine</span><span class="o">.</span><span class="n">compare_xattr</span><span class="p">(</span>
                    <span class="n">compare_source</span><span class="p">,</span>
                    <span class="n">compare_destination</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;XATTR comparison successful&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;XATTR comparison failed&quot;</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">diff_output</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;XATTR comparison failed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cleanup</span><span class="p">:</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jobs</span></div>

<div class="viewcode-block" id="FSHelper.run_find_verify"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.run_find_verify">[docs]</a>    <span class="k">def</span> <span class="nf">run_find_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine_path</span><span class="p">,</span> <span class="n">job</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Finds items backed up in the given job</span>
<span class="sd">            and compares it with items from machine</span>

<span class="sd">            Args:</span>
<span class="sd">                machine_path (str)       -- Source data path on the machine</span>

<span class="sd">                job (obj)                -- instance of the job class whose data needs to be found</span>
<span class="sd">                    default : None</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while finding items or during verification.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="n">testcase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span>

        <span class="n">from_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">to_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">job</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">from_time</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;jobStartTime&#39;</span><span class="p">]</span>
            <span class="n">to_time</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;jobEndTime&#39;</span><span class="p">]</span>

        <span class="n">index_items</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_items_subclient</span><span class="p">(</span>
            <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_flavour</span> <span class="o">==</span> <span class="s1">&#39;OpenVMS&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">index_item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">index_items</span><span class="p">):</span>
                <span class="n">index_item</span> <span class="o">=</span> <span class="n">index_item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.;&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">index_item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">index_item</span> <span class="o">=</span> <span class="n">index_item</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span>
                <span class="n">index_items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">index_item</span>

        <span class="n">machine_items</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">get_items_list</span><span class="p">(</span>
            <span class="n">machine_path</span><span class="p">,</span>
            <span class="n">include_parents</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_lists</span><span class="p">(</span><span class="n">index_items</span><span class="p">,</span> <span class="n">machine_items</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Items from find operation matches with items on the machine&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Items from find operation doesn&#39;t match&quot;</span>
                <span class="s2">&quot; with items on the machine&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.add_new_data_incr"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.add_new_data_incr">[docs]</a>    <span class="k">def</span> <span class="nf">add_new_data_incr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">incr_path</span><span class="p">,</span>
                          <span class="n">slash_format</span><span class="p">,</span>
                          <span class="n">scan_type</span><span class="o">=</span><span class="n">ScanType</span><span class="o">.</span><span class="n">RECURSIVE</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds new data for incremental with provisions for modification</span>
<span class="sd">            after this function execution call mod_data_incr for modifications</span>

<span class="sd">            Args:</span>

<span class="sd">                incr_path       (str)              -- path for adding data</span>

<span class="sd">                slash_format    (str)              -- OS path separator format</span>

<span class="sd">                scan_type       (ScanType(Enum))   -- scan type(RECURSIVE/OPTIMIZED/CHANGEJOURNAL)</span>
<span class="sd">                    default: ScanType.RECURSIVE</span>

<span class="sd">                kwargs (dict)                    -- dictionary of optional arguments</span>
<span class="sd">                Available kwargs Options:</span>

<span class="sd">                    dirs                (int)   --  number of directories in each level</span>
<span class="sd">                        default: 3</span>

<span class="sd">                    files               (int)   --  number of files in each directory</span>
<span class="sd">                        default: 5</span>

<span class="sd">                    file_size           (int)   --  Size of the files in KB</span>
<span class="sd">                        default: 20</span>

<span class="sd">                    levels              (int)   --  number of levels to be created</span>
<span class="sd">                        default: 1</span>

<span class="sd">                    hlinks              (bool)  --  whether to create hardlink files</span>
<span class="sd">                        default: True</span>

<span class="sd">                    slinks              (bool)  --  whether to create symbolic link files</span>
<span class="sd">                        default: True</span>

<span class="sd">                    sparse              (bool)  --  whether to create sparse files</span>
<span class="sd">                        default: True</span>

<span class="sd">                    sparse_hole_size    (int)   --  Size of the holes in sparse files in KB</span>
<span class="sd">                        default: 1024</span>

<span class="sd">                    options             (str)   --  to specify any other additional parameters</span>
<span class="sd">                        default: &quot;&quot;</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while</span>
<span class="sd">                            populating the data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="n">testcase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span>

        <span class="n">dirs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dirs&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file_size&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;levels&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">hlinks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hlinks&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">slinks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;slinks&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sparse&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">sparse_hole_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sparse_hole_size&#39;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">data_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;acls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">acls</span>
        <span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;unicode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">unicode</span>
        <span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;xattr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">xattr</span>
        <span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;long_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">long_path</span>
        <span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;problematic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">problematic</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">incr_modify</span> <span class="o">=</span> <span class="n">incr_path</span> <span class="o">+</span> <span class="n">slash_format</span> <span class="o">+</span> <span class="s2">&quot;modify&quot;</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">incr_file_rename</span> <span class="o">=</span> <span class="n">incr_path</span> <span class="o">+</span> <span class="n">slash_format</span> <span class="o">+</span> <span class="s2">&quot;filerename&quot;</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">incr_dir_rename</span> <span class="o">=</span> <span class="n">incr_path</span> <span class="o">+</span> <span class="n">slash_format</span> <span class="o">+</span> <span class="s2">&quot;dirrename&quot;</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">incr_permissions_change</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">incr_path</span> <span class="o">+</span> <span class="n">slash_format</span> <span class="o">+</span> <span class="s2">&quot;permissionschange&quot;</span><span class="p">)</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">incr_delete_data</span> <span class="o">=</span> <span class="n">incr_path</span> <span class="o">+</span> <span class="n">slash_format</span> <span class="o">+</span> <span class="s2">&quot;deleted&quot;</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">incr_hlinks_change</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">incr_acl_change</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">incr_xattr_change</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># IBMi and OpenVMS do not support unix style user permissions</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_flavour</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;OS400&#39;</span><span class="p">,</span> <span class="s1">&#39;OpenVMS&#39;</span><span class="p">]:</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">incr_permissions_change</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># OS400 and OpenVMS do not support ACL, XATTR and doesn&#39;t preserve hardlink counts</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">applicable_os</span> <span class="o">==</span> <span class="s1">&#39;UNIX&#39;</span> <span class="ow">and</span> <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_flavour</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s1">&#39;OS400&#39;</span><span class="p">,</span> <span class="s1">&#39;OpenVMS&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">testcase</span><span class="o">.</span><span class="n">is_client_big_data_apps</span><span class="p">:</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_hlinks_change</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}{1}</span><span class="s2">hlinkschange&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">incr_path</span><span class="p">,</span> <span class="n">slash_format</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">acls</span><span class="p">:</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_acl_change</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}{1}</span><span class="s2">aclchange&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">incr_path</span><span class="p">,</span> <span class="n">slash_format</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">xattr</span><span class="p">:</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_xattr_change</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}{1}</span><span class="s2">xattrchange&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">incr_path</span><span class="p">,</span> <span class="n">slash_format</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Recursive Scan on Windows cannot identify changes to ACLs</span>
            <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">acls</span> <span class="ow">and</span> <span class="n">scan_type</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">ScanType</span><span class="o">.</span><span class="n">RECURSIVE</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_acl_change</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}{1}</span><span class="s2">aclchange&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">incr_path</span><span class="p">,</span> <span class="n">slash_format</span><span class="p">)</span>

            <span class="n">hlinks</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">hlinks</span> <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">hlinks</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">else</span> <span class="n">hlinks</span>
            <span class="n">slinks</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">slinks</span> <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">slinks</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">else</span> <span class="n">slinks</span>
            <span class="n">sparse</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">sparse</span> <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">sparse</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">else</span> <span class="n">sparse</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding data under path: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">incr_path</span><span class="p">)</span>
        <span class="c1"># SKIP FILE RENAMES IF OS IS WINDOWS AND SCAN TYPE IS RECURSIVE</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">testcase</span><span class="o">.</span><span class="n">applicable_os</span> <span class="o">==</span> <span class="s1">&#39;WINDOWS&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">scan_type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">ScanType</span><span class="o">.</span><span class="n">RECURSIVE</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_file_rename</span><span class="p">,</span>
                <span class="n">dirs</span><span class="o">=</span><span class="n">dirs</span><span class="p">,</span>
                <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                <span class="n">hlinks</span><span class="o">=</span><span class="n">hlinks</span><span class="p">,</span>
                <span class="n">slinks</span><span class="o">=</span><span class="n">slinks</span><span class="p">,</span>
                <span class="n">sparse</span><span class="o">=</span><span class="n">sparse</span><span class="p">,</span>
                <span class="n">sparse_hole_size</span><span class="o">=</span><span class="n">sparse_hole_size</span><span class="p">,</span>
                <span class="n">acls</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;acls&#39;</span><span class="p">],</span>
                <span class="n">unicode</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;unicode&#39;</span><span class="p">],</span>
                <span class="n">xattr</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;xattr&#39;</span><span class="p">],</span>
                <span class="n">long_path</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;long_path&#39;</span><span class="p">],</span>
                <span class="n">problematic</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;problematic&#39;</span><span class="p">],</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">incr_dir_rename</span><span class="p">,</span>
            <span class="n">dirs</span><span class="o">=</span><span class="n">dirs</span><span class="p">,</span>
            <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
            <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
            <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
            <span class="n">hlinks</span><span class="o">=</span><span class="n">hlinks</span><span class="p">,</span>
            <span class="n">slinks</span><span class="o">=</span><span class="n">slinks</span><span class="p">,</span>
            <span class="n">sparse</span><span class="o">=</span><span class="n">sparse</span><span class="p">,</span>
            <span class="n">sparse_hole_size</span><span class="o">=</span><span class="n">sparse_hole_size</span><span class="p">,</span>
            <span class="n">acls</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;acls&#39;</span><span class="p">],</span>
            <span class="n">unicode</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;unicode&#39;</span><span class="p">],</span>
            <span class="n">xattr</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;xattr&#39;</span><span class="p">],</span>
            <span class="n">long_path</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;long_path&#39;</span><span class="p">],</span>
            <span class="n">problematic</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;problematic&#39;</span><span class="p">],</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">incr_delete_data</span><span class="p">,</span>
            <span class="n">dirs</span><span class="o">=</span><span class="n">dirs</span><span class="p">,</span>
            <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
            <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
            <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
            <span class="n">hlinks</span><span class="o">=</span><span class="n">hlinks</span><span class="p">,</span>
            <span class="n">slinks</span><span class="o">=</span><span class="n">slinks</span><span class="p">,</span>
            <span class="n">sparse</span><span class="o">=</span><span class="n">sparse</span><span class="p">,</span>
            <span class="n">sparse_hole_size</span><span class="o">=</span><span class="n">sparse_hole_size</span><span class="p">,</span>
            <span class="n">acls</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;acls&#39;</span><span class="p">],</span>
            <span class="n">unicode</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;unicode&#39;</span><span class="p">],</span>
            <span class="n">xattr</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;xattr&#39;</span><span class="p">],</span>
            <span class="n">long_path</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;long_path&#39;</span><span class="p">],</span>
            <span class="n">problematic</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;problematic&#39;</span><span class="p">],</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

        <span class="c1"># We shouldn&#39;t add soft links for below modifications</span>
        <span class="c1"># as the soft links won&#39;t change</span>
        <span class="n">change_data_options</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data_options</span><span class="p">)</span>
        <span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;slinks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slinks</span>
        <span class="c1"># ADDING WINDOWS AS WELL</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">applicable_os</span> <span class="o">==</span> <span class="s1">&#39;UNIX&#39;</span> <span class="ow">or</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">applicable_os</span> <span class="o">==</span> <span class="s1">&#39;WINDOWS&#39;</span> <span class="ow">or</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_flavour</span> <span class="o">==</span> <span class="s1">&#39;OS400&#39;</span> <span class="ow">or</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_flavour</span> <span class="o">==</span> <span class="s1">&#39;OpenVMS&#39;</span><span class="p">):</span>
            <span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;slinks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">incr_modify</span><span class="p">,</span>
            <span class="n">dirs</span><span class="o">=</span><span class="n">dirs</span><span class="p">,</span>
            <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
            <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
            <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
            <span class="n">hlinks</span><span class="o">=</span><span class="n">hlinks</span><span class="p">,</span>
            <span class="n">sparse</span><span class="o">=</span><span class="n">sparse</span><span class="p">,</span>
            <span class="n">sparse_hole_size</span><span class="o">=</span><span class="n">sparse_hole_size</span><span class="p">,</span>
            <span class="n">slinks</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;slinks&#39;</span><span class="p">],</span>
            <span class="n">acls</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;acls&#39;</span><span class="p">],</span>
            <span class="n">unicode</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;unicode&#39;</span><span class="p">],</span>
            <span class="n">xattr</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;xattr&#39;</span><span class="p">],</span>
            <span class="n">long_path</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;long_path&#39;</span><span class="p">],</span>
            <span class="n">problematic</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;problematic&#39;</span><span class="p">],</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_permissions_change</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_permissions_change</span><span class="p">,</span>
                <span class="n">dirs</span><span class="o">=</span><span class="n">dirs</span><span class="p">,</span>
                <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                <span class="n">hlinks</span><span class="o">=</span><span class="n">hlinks</span><span class="p">,</span>
                <span class="n">sparse</span><span class="o">=</span><span class="n">sparse</span><span class="p">,</span>
                <span class="n">sparse_hole_size</span><span class="o">=</span><span class="n">sparse_hole_size</span><span class="p">,</span>
                <span class="n">slinks</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;slinks&#39;</span><span class="p">],</span>
                <span class="n">acls</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;acls&#39;</span><span class="p">],</span>
                <span class="n">unicode</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;unicode&#39;</span><span class="p">],</span>
                <span class="n">xattr</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;xattr&#39;</span><span class="p">],</span>
                <span class="n">long_path</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;long_path&#39;</span><span class="p">],</span>
                <span class="n">problematic</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;problematic&#39;</span><span class="p">],</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_hlinks_change</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_hlinks_change</span><span class="p">,</span>
                <span class="n">dirs</span><span class="o">=</span><span class="n">dirs</span><span class="p">,</span>
                <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                <span class="n">hlinks</span><span class="o">=</span><span class="n">hlinks</span><span class="p">,</span>
                <span class="n">sparse</span><span class="o">=</span><span class="n">sparse</span><span class="p">,</span>
                <span class="n">sparse_hole_size</span><span class="o">=</span><span class="n">sparse_hole_size</span><span class="p">,</span>
                <span class="n">slinks</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;slinks&#39;</span><span class="p">],</span>
                <span class="n">acls</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;acls&#39;</span><span class="p">],</span>
                <span class="n">unicode</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;unicode&#39;</span><span class="p">],</span>
                <span class="n">xattr</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;xattr&#39;</span><span class="p">],</span>
                <span class="n">long_path</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;long_path&#39;</span><span class="p">],</span>
                <span class="n">problematic</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;problematic&#39;</span><span class="p">],</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_acl_change</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_acl_change</span><span class="p">,</span>
                <span class="n">dirs</span><span class="o">=</span><span class="n">dirs</span><span class="p">,</span>
                <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                <span class="n">hlinks</span><span class="o">=</span><span class="n">hlinks</span><span class="p">,</span>
                <span class="n">sparse</span><span class="o">=</span><span class="n">sparse</span><span class="p">,</span>
                <span class="n">sparse_hole_size</span><span class="o">=</span><span class="n">sparse_hole_size</span><span class="p">,</span>
                <span class="n">slinks</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;slinks&#39;</span><span class="p">],</span>
                <span class="n">acls</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;acls&#39;</span><span class="p">],</span>
                <span class="n">unicode</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;unicode&#39;</span><span class="p">],</span>
                <span class="n">xattr</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;xattr&#39;</span><span class="p">],</span>
                <span class="n">long_path</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;long_path&#39;</span><span class="p">],</span>
                <span class="n">problematic</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;problematic&#39;</span><span class="p">],</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_xattr_change</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_xattr_change</span><span class="p">,</span>
                <span class="n">dirs</span><span class="o">=</span><span class="n">dirs</span><span class="p">,</span>
                <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                <span class="n">hlinks</span><span class="o">=</span><span class="n">hlinks</span><span class="p">,</span>
                <span class="n">sparse</span><span class="o">=</span><span class="n">sparse</span><span class="p">,</span>
                <span class="n">sparse_hole_size</span><span class="o">=</span><span class="n">sparse_hole_size</span><span class="p">,</span>
                <span class="n">slinks</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;slinks&#39;</span><span class="p">],</span>
                <span class="n">acls</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;acls&#39;</span><span class="p">],</span>
                <span class="n">unicode</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;unicode&#39;</span><span class="p">],</span>
                <span class="n">xattr</span><span class="o">=</span><span class="n">change_data_options</span><span class="p">[</span><span class="s1">&#39;xattr&#39;</span><span class="p">],</span>
                <span class="n">long_path</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;long_path&#39;</span><span class="p">],</span>
                <span class="n">problematic</span><span class="o">=</span><span class="n">data_options</span><span class="p">[</span><span class="s1">&#39;problematic&#39;</span><span class="p">],</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

        <span class="c1"># wait for for journals to get flushed</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">should_wait</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for journals to get flushed&quot;</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="n">testcase</span><span class="o">.</span><span class="n">WAIT_TIME</span><span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.mod_data_incr"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.mod_data_incr">[docs]</a>    <span class="k">def</span> <span class="nf">mod_data_incr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_type</span><span class="o">=</span><span class="n">ScanType</span><span class="o">.</span><span class="n">RECURSIVE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Modifies the data added by add_new_data_incr</span>
<span class="sd">            call add_new_data_incr before calling this.</span>

<span class="sd">            Args:</span>
<span class="sd">                scan_type(ScanType(Enum))   -- scan type(RECURSIVE/OPTIMIZED/CHANGEJOURNAL)</span>
<span class="sd">                    default: ScanType.RECURSIVE</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while modifying the data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="n">testcase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting path: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_delete_data</span><span class="p">)</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">testcase</span><span class="o">.</span><span class="n">incr_delete_data</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Renaming directory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_dir_rename</span><span class="p">)</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">rename_file_or_folder</span><span class="p">(</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">incr_dir_rename</span><span class="p">,</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_dir_rename</span> <span class="o">+</span> <span class="s2">&quot;_renamed&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Modifying files on path: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_modify</span><span class="p">)</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">modify_test_data</span><span class="p">(</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">incr_modify</span><span class="p">,</span> <span class="n">modify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Renaming files on path:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_file_rename</span><span class="p">)</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">modify_test_data</span><span class="p">(</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">incr_file_rename</span><span class="p">,</span> <span class="n">rename</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_permissions_change</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Changing permissions of files on path: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="n">testcase</span><span class="o">.</span><span class="n">incr_permissions_change</span><span class="p">)</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">modify_test_data</span><span class="p">(</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_permissions_change</span><span class="p">,</span> <span class="n">permissions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_hlinks_change</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding hardlinks to files on path: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="n">testcase</span><span class="o">.</span><span class="n">incr_hlinks_change</span><span class="p">)</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">modify_test_data</span><span class="p">(</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_hlinks_change</span><span class="p">,</span> <span class="n">hlinks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_acl_change</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Changing acls of files on path: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="n">testcase</span><span class="o">.</span><span class="n">incr_acl_change</span><span class="p">)</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">modify_test_data</span><span class="p">(</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_acl_change</span><span class="p">,</span> <span class="n">acls</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">incr_xattr_change</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Changing xattrs of files on path: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="n">testcase</span><span class="o">.</span><span class="n">incr_xattr_change</span><span class="p">)</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">modify_test_data</span><span class="p">(</span>
                <span class="n">testcase</span><span class="o">.</span><span class="n">incr_xattr_change</span><span class="p">,</span> <span class="n">xattr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># wait for for journals to get flushed</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">should_wait</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for journals to get flushed&quot;</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="n">testcase</span><span class="o">.</span><span class="n">WAIT_TIME</span><span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.check_pseudo_client"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.check_pseudo_client">[docs]</a>    <span class="k">def</span> <span class="nf">check_pseudo_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pseudo_client_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if pseudo-client is created on CS for a usercentric</span>
<span class="sd">            laptop client and check if it belongs to</span>
<span class="sd">            &#39;Usercentric clients&#39; client group.</span>

<span class="sd">            Args:</span>
<span class="sd">                pseudo_client_name  (str) - Name of the pseudo-client</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - If pseudo-client doesn&#39;t exist</span>
<span class="sd">                            If pseudo-client does not belong to &quot;Usercentric clients&quot; client group</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">commcell_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_client_name</span> <span class="o">=</span> <span class="n">pseudo_client_name</span>
        <span class="n">commcell_obj</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>  <span class="c1"># refreshing the clients associated with the commcell</span>
        <span class="k">if</span> <span class="n">commcell_obj</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">has_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudo_client_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pseudo-client with name </span><span class="si">%s</span><span class="s2"> exists on CS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_client_name</span><span class="p">)</span>
            <span class="n">client_group_obj</span> <span class="o">=</span> <span class="n">commcell_obj</span><span class="o">.</span><span class="n">client_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Usercentric clients&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">client_group_obj</span><span class="p">:</span>
                <span class="n">associated_clients_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">associated_client</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">associated_client</span> <span class="ow">in</span>
                                           <span class="n">client_group_obj</span><span class="o">.</span><span class="n">associated_clients</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_client_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">associated_clients_list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pseudo-client is part of &#39;Usercentric clients&#39; group&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Pseudo-client is not a part of &#39;Usercentric clients&#39; client group&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to create client group object&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Pseudo-client with name </span><span class="si">{0}</span><span class="s2"> does not exist on CS&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudo_client_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="FSHelper.check_scheduled_backup"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.check_scheduled_backup">[docs]</a>    <span class="k">def</span> <span class="nf">check_scheduled_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; To check if, for a user-centric laptop client, scheduled</span>
<span class="sd">            backup was launched on the pseudo-client and</span>
<span class="sd">            whether it was successful</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - If retreiving Job ID fails</span>
<span class="sd">                            If first backup job was not scheduled</span>
<span class="sd">                            If the scheduled job did not complete successfully</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">commcell_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">commcell</span>
        <span class="n">job_controller_obj</span> <span class="o">=</span> <span class="n">commcell_obj</span><span class="o">.</span><span class="n">job_controller</span>
        <span class="k">if</span> <span class="n">job_controller_obj</span><span class="p">:</span>
            <span class="n">first_job</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">all_jobs_dict</span> <span class="o">=</span> <span class="n">job_controller_obj</span><span class="o">.</span><span class="n">all_jobs</span><span class="p">(</span>
                <span class="n">client_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudo_client_name</span><span class="p">,</span> <span class="n">lookup_time</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">job_filter</span><span class="o">=</span><span class="s1">&#39;Backup&#39;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">all_jobs_dict</span><span class="p">:</span>
                <span class="n">first_job</span> <span class="o">=</span> <span class="n">job_controller_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">all_jobs_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">first_job</span> <span class="o">=</span> <span class="n">first_job</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Job ID of first job on client </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_client_name</span><span class="p">,</span>
                    <span class="n">first_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">first_job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backup job finished successfully&quot;</span><span class="p">)</span>
                    <span class="n">job_details</span> <span class="o">=</span> <span class="n">first_job</span><span class="o">.</span><span class="n">details</span>
                    <span class="n">details</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;jobDetail&#39;</span><span class="p">][</span><span class="s1">&#39;generalInfo&#39;</span><span class="p">][</span><span class="s1">&#39;jobStartedFrom&#39;</span><span class="p">])</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">details</span> <span class="o">==</span> <span class="s1">&#39;scheduled&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backup job was scheduled&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Backup job was not scheduled&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Backup job failed to finish successfully&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to  retreive jobs&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to create job controller object&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.pseudo_client_cleanup"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.pseudo_client_cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">pseudo_client_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pseudo_client_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; To clean up pseudo-client from CS for</span>
<span class="sd">            usercentric laptop client.</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - if pseudo-client could not be removed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">commcell_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">commcell</span>
        <span class="n">commcell_obj</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">commcell_obj</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">has_client</span><span class="p">(</span><span class="n">pseudo_client_name</span><span class="p">):</span>
            <span class="n">job_controller_obj</span> <span class="o">=</span> <span class="n">commcell_obj</span><span class="o">.</span><span class="n">job_controller</span>
            <span class="k">if</span> <span class="n">job_controller_obj</span><span class="p">:</span>
                <span class="n">active_jobs_dict</span> <span class="o">=</span> <span class="n">job_controller_obj</span><span class="o">.</span><span class="n">active_jobs</span><span class="p">(</span>
                    <span class="n">client_name</span><span class="o">=</span><span class="n">pseudo_client_name</span><span class="p">,</span> <span class="n">lookup_time</span><span class="o">=</span><span class="mi">6</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">active_jobs_dict</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">active_jobs_dict</span><span class="p">:</span>
                        <span class="n">job_obj</span> <span class="o">=</span> <span class="n">job_controller_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">job_obj</span><span class="p">:</span>
                            <span class="n">job_obj</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">wait_for_job_to_kill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Jobs running on pseudo-client killed&quot;</span><span class="p">)</span>
            <span class="n">commcell_obj</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">pseudo_client_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pseudo-client cleaned up&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.get_subclient_content"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.get_subclient_content">[docs]</a>    <span class="k">def</span> <span class="nf">get_subclient_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_path</span><span class="p">,</span> <span class="n">slash_format</span><span class="p">,</span> <span class="n">subclient_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates the subclient content list.</span>

<span class="sd">        Args:</span>
<span class="sd">            test_path (str) : The testpath provided for the test case</span>

<span class="sd">            slash_format (str) : The slash format for the platform</span>

<span class="sd">            subclient_name (str) : The name of the subcllient for which data is generated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list : list of subclient contents for this test case</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">test_path</span><span class="p">,</span> <span class="n">subclient_name</span><span class="p">)</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp</span></div>

<div class="viewcode-block" id="FSHelper.verify_scan_marking"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.verify_scan_marking">[docs]</a>    <span class="k">def</span> <span class="nf">verify_scan_marking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies whether the job ran onle Scan phase i.e., Scan Marking Job</span>
<span class="sd">        Args :</span>
<span class="sd">            jobId   -- to verify the given job ran only Scan phase</span>

<span class="sd">        Return:</span>
<span class="sd">            True        -- if ran only Scan phases and the job is in Compeleted State</span>

<span class="sd">            False       -- if didn&#39;t ran Scan Marking Job</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># query to get the number of phases ran</span>
        <span class="n">str_query</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; select count(distinct(phase)) from JMBkpAtmptStats&quot;</span>
                     <span class="s2">&quot; with (NOLOCK) where status=1 and jobID=</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">str_query</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="c1"># if count is one it means only one phase was ran else multiple phases were ran</span>
        <span class="k">if</span> <span class="n">cur</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="c1"># query to get which phase was ran</span>
            <span class="n">str_query</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; select distinct(phase) from JMBkpAtmptStats&quot;</span>
                         <span class="s2">&quot; with (NOLOCK) where status=1 and jobID=</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">str_query</span><span class="p">)</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cur</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span>  <span class="c1"># 4 is number for Scan phase</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FSHelper.backup_copy"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.backup_copy">[docs]</a>    <span class="k">def</span> <span class="nf">backup_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs Offline backup copy for the given subclient</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">run_backup_copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backup copy workflow job id is : </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run  Workflow job </span><span class="si">{0}</span><span class="s2"> for backup copy with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished backup copy workflow Job :</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;job: </span><span class="si">{0}</span><span class="s2"> for Backup copy operation is completed with errors, Reason: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.volume_level_restore"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.volume_level_restore">[docs]</a>    <span class="k">def</span> <span class="nf">volume_level_restore</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">source_path</span><span class="p">,</span>
            <span class="n">destination_path</span><span class="p">,</span>
            <span class="n">client_name</span><span class="p">,</span>
            <span class="n">job</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Function to perform volume level restore</span>

<span class="sd">            Args:</span>
<span class="sd">                source_path(str)       -- Source Path for the restore</span>

<span class="sd">                destination_path(str)  -- Destination Path you want to restore</span>

<span class="sd">                client_name(str)       -- On client which you want to perform Volume level Restore</span>


<span class="sd">                from_time (str)        -- From time for Restore</span>

<span class="sd">                    default : None</span>

<span class="sd">                to_time (str)          -- to time for Restore</span>

<span class="sd">                    default : None</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while doing volume level restore.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">testcase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="n">client_machine</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span>

        <span class="n">paths</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">browse_view_name</span><span class="o">=</span><span class="s1">&#39;VOLUMEVIEW&#39;</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;browse paths Recieved  </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;browse paths Recieved  </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>
        <span class="p">(</span><span class="n">vlrdrive</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Drive used to restore volume level </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">vlrdrive</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">restore_out_of_place</span><span class="p">(</span>
            <span class="n">client</span><span class="o">=</span><span class="n">client_name</span><span class="p">,</span>
            <span class="n">destination_path</span><span class="o">=</span><span class="n">vlrdrive</span><span class="p">,</span>
            <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
            <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span>
            <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span>
            <span class="n">is_vlr_restore</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; Volume level Restore Done&quot;</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Comparing source:</span><span class="si">%s</span><span class="s2"> destination:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">)</span>

        <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">client_machine</span><span class="o">.</span><span class="n">compare_meta_data</span><span class="p">(</span>
            <span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Meta data comparison successful&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Meta data comparison failed&quot;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">diff_output</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Meta data comparison failed&quot;</span><span class="p">)</span>

        <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">client_machine</span><span class="o">.</span><span class="n">compare_checksum</span><span class="p">(</span>
            <span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checksum comparison successful&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Checksum comparison failed&quot;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">diff_output</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Checksum comparison failed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">applicable_os</span> <span class="o">==</span> <span class="s1">&#39;UNIX&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">acls</span><span class="p">:</span>
                <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">client_machine</span><span class="o">.</span><span class="n">compare_acl</span><span class="p">(</span>
                    <span class="n">source_path</span><span class="p">,</span>
                    <span class="n">destination_path</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ACL comparison successful&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ACL comparison failed&quot;</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">diff_output</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ACL comparison failed&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">xattr</span><span class="p">:</span>
                <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">client_machine</span><span class="o">.</span><span class="n">compare_xattr</span><span class="p">(</span>
                    <span class="n">source_path</span><span class="p">,</span>
                    <span class="n">destination_path</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;XATTR comparison successful&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;XATTR comparison failed&quot;</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">diff_output</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;XATTR comparison failed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cleanup</span><span class="p">:</span>
            <span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.get_backup_stream_count"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.get_backup_stream_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_backup_stream_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the number of streams used by a backup job</span>

<span class="sd">            Args:</span>
<span class="sd">                job    (object)  -- job object of the backup job to be checked</span>

<span class="sd">            Returns:</span>
<span class="sd">                int   -   the number of streams used by a backup job</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting the number of streams from job details&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;jobDetail&#39;</span><span class="p">][</span><span class="s1">&#39;detailInfo&#39;</span><span class="p">][</span><span class="s1">&#39;numOfStreams&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="FSHelper.validate_trueup"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.validate_trueup">[docs]</a>    <span class="k">def</span> <span class="nf">validate_trueup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">check_for_trueupfiles</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given job object, it runs a query in JMMisc table and</span>
<span class="sd">            checks if itemtype 38 and 44 are present in query result.</span>
<span class="sd">            ItemType - 38 - Confirms if true up ran or not.</span>
<span class="sd">            ItemType - 44 - Confirms if true up picked up files or not.</span>

<span class="sd">        Args:</span>
<span class="sd">            job (object)                -- instance of the Job class</span>
<span class="sd">                                for the backup job to query.</span>
<span class="sd">            check_for_trueupfiles (bool)  -- conditional variable to check</span>
<span class="sd">                        if trueup ran and picked up files.</span>
<span class="sd">                            default: False</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool     - If checkForTrueupFiles is False</span>
<span class="sd">                        Returns True if trueup Ran</span>
<span class="sd">                        If checkForTrueupFiles is True</span>
<span class="sd">                        Returns True if trueup Ran and picked up files.</span>
<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if any error occurred during SQL query execution.</span>

<span class="sd">            &quot;&quot;&quot;</span>
        <span class="n">trueup_ran_query</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;select count(*) from JMMisc WITH (NOLOCK) where jobid&quot;</span>
                            <span class="s2">&quot; = </span><span class="si">{0}</span><span class="s2"> and itemType = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="s2">&quot;38&quot;</span><span class="p">))</span>
        <span class="n">trueup_files_query</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;select count(*) from JMMisc WITH (NOLOCK) where jobid =&quot;</span>
                              <span class="s2">&quot; </span><span class="si">{0}</span><span class="s2"> and itemType = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="s2">&quot;44&quot;</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">check_for_trueupfiles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">trueup_ran_query</span><span class="p">)</span>
                <span class="n">trueup_ran</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span>
                <span class="k">if</span> <span class="n">trueup_ran</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">trueup_files_query</span><span class="p">)</span>
                    <span class="n">trueup_pickedup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span>
                    <span class="k">if</span> <span class="n">trueup_pickedup</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">trueup_ran_query</span><span class="p">)</span>
            <span class="n">trueup_ran</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span>
            <span class="k">if</span> <span class="n">trueup_ran</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to execute Trueup SQL Query for &quot;</span>
                <span class="s2">&quot;validating trueup </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.run_systemstate_backup"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.run_systemstate_backup">[docs]</a>    <span class="k">def</span> <span class="nf">run_systemstate_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">,</span> <span class="n">wait_to_complete</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checking if system state is enabled and running a backup</span>
<span class="sd">        Args:</span>

<span class="sd">            backup_type		     (str)				-- The type of backup job to be run.</span>

<span class="sd">            wait_to_complete     (bool)  			-- Specifies whether to wait until job finishes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list    - list of instances of the Job class for the backup jobs ran</span>

<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_subclient</span><span class="p">(</span><span class="n">backup_system_state</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">backup_type</span><span class="p">,</span> <span class="n">wait_to_complete</span><span class="o">=</span><span class="n">wait_to_complete</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job</span></div>

<div class="viewcode-block" id="FSHelper.run_onetouch_backup"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.run_onetouch_backup">[docs]</a>    <span class="k">def</span> <span class="nf">run_onetouch_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checking if onetouch option is enabled and running a backup&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_subclient</span><span class="p">(</span><span class="n">backup_onetouch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">backup_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.commit_job"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.commit_job">[docs]</a>    <span class="k">def</span> <span class="nf">commit_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">commit_condition</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Commits the backup job if the threshold condition is met or exceeded.</span>

<span class="sd">        Args:</span>
<span class="sd">            job                 (object)                --  Instance of Job object, the job that has to be committed.</span>

<span class="sd">            threshold           (int)                   --  Threshold value for the condition</span>
<span class="sd">            based on which job will be committed.</span>

<span class="sd">            commit_condition    (CommitCondition(Enum)) --  Commit condition can take one of the following values.</span>
<span class="sd">                -   FILES</span>
<span class="sd">                -   SECONDS</span>

<span class="sd">            timeout             (int)                   --  Specifies how long we must wait (in seconds)</span>
<span class="sd">            for the job to be committed before we give up.</span>

<span class="sd">                default:    300</span>

<span class="sd">        Example:</span>
<span class="sd">            job_1 = self.helper.run_backup(backup_level=&quot;Full&quot;, wait_to_complete=False)</span>
<span class="sd">            self.helper.commit_job(job_1[0], 3, CommitCondition.FILES)</span>

<span class="sd">        Returns:</span>
<span class="sd">           None</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">            Any error occurred while trying to commit the job.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># STEP 1 - WAIT UNTIL JOB REACHES BACKUP PHASE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for backup phase of job </span><span class="si">%s</span><span class="s2"> to begin.&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;BACKUP&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;RUNNING&quot;</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="c1"># STEP 2 - WAIT UNTIL COMMIT CONDITION IS MET</span>
            <span class="k">if</span> <span class="n">commit_condition</span> <span class="o">==</span> <span class="n">CommitCondition</span><span class="o">.</span><span class="n">FILES</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Job will be committed after </span><span class="si">%s</span><span class="s2"> files have been transferred.&quot;</span><span class="p">,</span>
                    <span class="n">threshold</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">job</span><span class="o">.</span><span class="n">num_of_files_transferred</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">num_of_files_transferred</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> files transferred so far.&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">num_of_files_transferred</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">commit_condition</span> <span class="o">==</span> <span class="n">CommitCondition</span><span class="o">.</span><span class="n">SECONDS</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job will be committed in </span><span class="si">%s</span><span class="s2"> seconds.&quot;</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
                <span class="n">sleep</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>

            <span class="c1"># STEP 3 - TRY TO COMMIT THE JOB</span>
            <span class="n">job</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">wait_for_job_to_kill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">state</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;COMMITTED&quot;</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">state</span>
                <span class="k">if</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="c1"># STEP 4 - LOG THAT WE&#39;VE COMMITTED THE JOB</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;COMMITTED&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">%s</span><span class="s2"> was committed&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">excp</span> <span class="o">=</span> <span class="s2">&quot; Error occurred, job </span><span class="si">{}</span><span class="s2"> couldn&#39;t be committed, it&#39;s state is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Error occurred when attempting to commit the job : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.verify_collect_extent_acl"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.verify_collect_extent_acl">[docs]</a>    <span class="k">def</span> <span class="nf">verify_collect_extent_acl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_list</span><span class="p">,</span> <span class="n">job_type</span><span class="p">,</span> <span class="n">acl</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To verify the extent/acls only files</span>
<span class="sd">            Args:</span>
<span class="sd">                source_list (list): List of files from source data</span>
<span class="sd">                job_type  (str): Full/incremental</span>
<span class="sd">                acl (int): 1- extent/container check</span>
<span class="sd">                           2 - only acl check</span>
<span class="sd">                           3 - extent/container/acl check</span>
<span class="sd">                :return(boolean): True - Successful</span>
<span class="sd">                                  False - Failed</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">file_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Get the job results directory</span>
        <span class="n">collect_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">/</span><span class="si">{1}</span><span class="s2">/</span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">job_results_directory</span><span class="p">,</span>
                                            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">commcell_id</span><span class="p">),</span>
                                            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">collect_path</span><span class="p">)</span>

        <span class="c1"># Check the collect files based on job type</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">job_type</span> <span class="o">==</span> <span class="s2">&quot;FULL&quot;</span> <span class="ow">and</span> <span class="n">acl</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Check for Extents and Container flag in CollectTot</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;cat  </span><span class="si">{0}</span><span class="s2">/CollectTot* | grep </span><span class="si">%E</span><span class="s2">XTENT%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">collect_path</span><span class="p">)</span>
            <span class="n">extent_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="n">cmd_container</span> <span class="o">=</span> <span class="s2">&quot;cat </span><span class="si">{0}</span><span class="s2">/CollectTot* | grep %CONTAINER%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">collect_path</span><span class="p">)</span>
            <span class="n">container_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd_container</span><span class="p">)</span>
            <span class="n">extent_output_loop</span> <span class="o">=</span> <span class="n">extent_output</span><span class="o">.</span><span class="n">formatted_output</span>
            <span class="n">container_loop</span> <span class="o">=</span> <span class="n">container_output</span><span class="o">.</span><span class="n">formatted_output</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Container output:&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">container_loop</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">job_type</span> <span class="o">==</span> <span class="s2">&quot;INCREMENTAL&quot;</span> <span class="ow">and</span> <span class="n">acl</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="c1"># Check for Extents, Container flag and ContainerACL flag in CollectInc</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;cat  </span><span class="si">{0}</span><span class="s2">/CollectInc* | grep </span><span class="si">%E</span><span class="s2">XTENT%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">collect_path</span><span class="p">)</span>
            <span class="n">cmd_container</span> <span class="o">=</span> <span class="s2">&quot;cat </span><span class="si">{0}</span><span class="s2">/CollectInc* | grep %CONTAINER%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">collect_path</span><span class="p">)</span>
            <span class="n">cmd_container_acl</span> <span class="o">=</span> <span class="s2">&quot;cat </span><span class="si">{0}</span><span class="s2">/CollectInc* | grep %CONTAINERACL%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">collect_path</span><span class="p">)</span>

            <span class="n">extent_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="n">container_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd_container</span><span class="p">)</span>
            <span class="n">container_acl_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd_container_acl</span><span class="p">)</span>
            <span class="n">extent_output_loop</span> <span class="o">=</span> <span class="n">extent_output</span><span class="o">.</span><span class="n">formatted_output</span>
            <span class="n">container_acl_output_loop</span> <span class="o">=</span> <span class="n">container_acl_output</span><span class="o">.</span><span class="n">formatted_output</span>
            <span class="n">container_loop</span> <span class="o">=</span> <span class="n">container_output</span><span class="o">.</span><span class="n">formatted_output</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">job_type</span> <span class="o">==</span> <span class="s2">&quot;INCREMENTAL&quot;</span> <span class="ow">and</span> <span class="n">acl</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;cat  </span><span class="si">{0}</span><span class="s2">/CollectInc* | grep </span><span class="si">%E</span><span class="s2">XTENT%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">collect_path</span><span class="p">)</span>
            <span class="n">cmd_container</span> <span class="o">=</span> <span class="s2">&quot;cat </span><span class="si">{0}</span><span class="s2">/CollectInc* | grep %CONTAINER%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">collect_path</span><span class="p">)</span>
            <span class="n">extent_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="n">container_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd_container</span><span class="p">)</span>
            <span class="n">extent_output_loop</span> <span class="o">=</span> <span class="n">extent_output</span><span class="o">.</span><span class="n">formatted_output</span>
            <span class="n">container_loop</span> <span class="o">=</span> <span class="n">container_output</span><span class="o">.</span><span class="n">formatted_output</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Container output:&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">container_loop</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Check for ContainerACL flag in CollectInc</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;cat </span><span class="si">{0}</span><span class="s2">/CollectInc* | grep %CONTAINERACL%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">collect_path</span><span class="p">)</span>
            <span class="n">container_acl_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="n">container_acl_output_loop</span> <span class="o">=</span> <span class="n">container_acl_output</span><span class="o">.</span><span class="n">formatted_output</span>

        <span class="k">if</span> <span class="n">acl</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">container_acl_output_loop</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">elif</span> <span class="n">acl</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">container_loop</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">extent_output_loop</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Maintain container only list and extent only list to compare flags are sent correctly</span>
        <span class="n">container_file_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">extent_file_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Splitting the collect file items to get the path list for extents or ACLs</span>
        <span class="k">for</span> <span class="n">list1</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="n">extent_output_loop</span><span class="p">,</span>
                <span class="n">container_acl_output_loop</span><span class="p">,</span>
                <span class="n">container_loop</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">innerlist</span> <span class="ow">in</span> <span class="n">list1</span><span class="p">:</span>
                <span class="n">subpaths</span> <span class="o">=</span> <span class="n">innerlist</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">subpaths</span><span class="p">)</span>
                <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subpaths</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">subpaths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;%CONTAINERACL%&quot;</span><span class="p">:</span>
                    <span class="n">lastword</span> <span class="o">=</span> <span class="n">subpaths</span><span class="p">[</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">container_acl_file_split</span> <span class="o">=</span> <span class="n">lastword</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="n">file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subpaths</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">subpaths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                                     <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">container_acl_file_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">subpaths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;%CONTAINER%&quot;</span><span class="p">:</span>
                    <span class="n">lastword</span> <span class="o">=</span> <span class="n">subpaths</span><span class="p">[</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">container_file_split</span> <span class="o">=</span> <span class="n">lastword</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="n">container_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subpaths</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">subpaths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                                               <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">container_file_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">container_file_list</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subpaths</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">subpaths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
                    <span class="n">extent_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subpaths</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">subpaths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">extent_file_list</span><span class="p">)</span>

        <span class="n">collect_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">file_list</span><span class="p">))</span>
        <span class="n">container_cmp_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">container_file_list</span><span class="p">))</span>
        <span class="n">extent_cmp_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">extent_file_list</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">container_cmp_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Comparing extent files against container list:&quot;</span><span class="p">)</span>
            <span class="n">compare_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_lists</span><span class="p">(</span><span class="n">extent_cmp_list</span><span class="p">,</span> <span class="n">container_cmp_list</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">compare_result</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extent back up file may not have associated container&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Containers are sent correctly for extent backed up files!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;collect list:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">collect_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;source list:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">source_list</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_lists</span><span class="p">(</span><span class="n">source_list</span><span class="p">,</span> <span class="n">collect_list</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collect file comparison is successful&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed to compare the collect files&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FSHelper.parse_backup_restart_string"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.parse_backup_restart_string">[docs]</a>    <span class="k">def</span> <span class="nf">parse_backup_restart_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parses the restart map file and fetches the restart string from JM</span>
<span class="sd">        to prepare a dictionary of collect file ID to offset value.</span>

<span class="sd">        Args:</span>
<span class="sd">            job  (object)   --  Instance of Job object, the job for which a restart string has to be parsed.</span>

<span class="sd">        Returns:</span>
<span class="sd">           dict -   Returns a dictionary of collect file ID to offset value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># STEP 1 - FETCH THE RESTART STRING FOR THE JOB</span>
        <span class="n">rst_string_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT restartString FROM JMBkpAtmptStats WITH (NOLOCK) WHERE jobId=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">rst_string_query</span><span class="p">)</span>
        <span class="n">restart_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># STEP 2 - PARSE THE RESTART STRING</span>
        <span class="n">cvf_offset_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">stream_restart_strings</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">restart_string</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-o&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">restart_string</span> <span class="o">==</span> <span class="s2">&quot;-1&quot;</span><span class="p">:</span>
            <span class="n">cvf_offset_dict</span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span>  <span class="c1"># NOTICED THIS TO BE THE RESTART STRING IN A CORNER CASE</span>
            <span class="k">return</span> <span class="n">cvf_offset_dict</span>
        <span class="k">for</span> <span class="n">stream_restart_string</span> <span class="ow">in</span> <span class="n">stream_restart_strings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stream_restart_string</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">cvf_offsets</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_restart_string</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                    <span class="s2">&quot;@&quot;</span><span class="p">)</span>  <span class="c1"># GET RESTART STRING PER STREAM</span>
                <span class="k">for</span> <span class="n">cvf_offset</span> <span class="ow">in</span> <span class="n">cvf_offsets</span><span class="p">:</span>
                    <span class="n">cvf_offset</span> <span class="o">=</span> <span class="n">cvf_offset</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">match_ptn</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                        <span class="sa">r</span><span class="s2">&quot;(?P&lt;cvf_id&gt;[0-9]*)\|(?P&lt;offset&gt;[0-9-]*)&quot;</span><span class="p">,</span>
                        <span class="n">cvf_offset</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">match_ptn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">cvf_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match_ptn</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;cvf_id&#39;</span><span class="p">))</span>
                        <span class="c1"># IF OFFSET IN RESTART STRING IS -1, IT MEANS CVF IS COMPLETELY PROCESSED</span>
                        <span class="c1"># IF CVF IS COMPLETELY PROCESSED, CORRESPONDING CLIENT SIDE OFFSET IS -999</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">match_ptn</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span> \
                            <span class="mi">1</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">match_ptn</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">))</span>
                        <span class="n">cvf_offset_dict</span><span class="p">[</span><span class="n">cvf_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="k">return</span> <span class="n">cvf_offset_dict</span></div>

<div class="viewcode-block" id="FSHelper.create_expected_commit_files"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.create_expected_commit_files">[docs]</a>    <span class="k">def</span> <span class="nf">create_expected_commit_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">committed_job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepares the expected committed files for the committed backup job.</span>
<span class="sd">        These files will be compared with the actual collect files that are prepared by scan.</span>

<span class="sd">        Args:</span>
<span class="sd">            committed_job   (object)    --  Instance of Job, of the committed job.</span>

<span class="sd">        Returns:</span>
<span class="sd">           dict -   Returns a dictionary of lists containing entries in the commit collect and commit dirchange.</span>

<span class="sd">        Raises:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">machine_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span>

        <span class="c1"># STEP 1 - PREPARE EXPECTED COMMIT COLLECT</span>
        <span class="c1"># STEP 1.1 - INITIALIZE BACKUP TYPE DEPENDENT CONSTANTS</span>
        <span class="k">if</span> <span class="n">committed_job</span><span class="o">.</span><span class="n">backup_level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FULL&quot;</span><span class="p">:</span>
            <span class="n">cvf_name</span> <span class="o">=</span> <span class="s2">&quot;NumColTot</span><span class="si">{}</span><span class="s2">.cvf&quot;</span> <span class="k">if</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span> <span class="k">else</span> <span class="s2">&quot;CollectTot</span><span class="si">{}</span><span class="s2">.cvf&quot;</span>
            <span class="n">restart_map</span> <span class="o">=</span> <span class="s2">&quot;CollectMap_Tot.cvf&quot;</span> <span class="k">if</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span> <span class="k">else</span> <span class="s2">&quot;restartMapTot&quot;</span>
            <span class="n">dc_name</span> <span class="o">=</span> <span class="s2">&quot;DCTot.cvf&quot;</span>

            <span class="c1"># RESTART STRING PATTERN IS DIFFERENT ON UNIX COMPARED TO WINDOWS</span>
            <span class="k">if</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(.*)NumColTot(?P&lt;cvf_id&gt;[0-9]*)\.cvf</span><span class="se">\\</span><span class="s2">\/</span><span class="se">\\</span><span class="s2">\/(?P&lt;offset&gt;.*)&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;UNIX&quot;</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?P&lt;cvf_id&gt;[0-9]+)\s*(?P&lt;offset&gt;[0-9]+)&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">committed_job</span><span class="o">.</span><span class="n">backup_level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;INCREMENTAL&quot;</span><span class="p">,</span> <span class="s2">&quot;DIFFERENTIAL&quot;</span><span class="p">):</span>
            <span class="n">cvf_name</span> <span class="o">=</span> <span class="s2">&quot;NumColInc</span><span class="si">{}</span><span class="s2">.cvf&quot;</span> <span class="k">if</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span> <span class="k">else</span> <span class="s2">&quot;CollectInc</span><span class="si">{}</span><span class="s2">.cvf&quot;</span>
            <span class="n">restart_map</span> <span class="o">=</span> <span class="s2">&quot;CollectMap_lnc.cvf&quot;</span> <span class="k">if</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span> <span class="k">else</span> <span class="s2">&quot;restartMapInc&quot;</span>
            <span class="n">dc_name</span> <span class="o">=</span> <span class="s2">&quot;DCInc.cvf&quot;</span>

            <span class="k">if</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(.*)NumColInc(?P&lt;cvf_id&gt;[0-9]*)\.cvf</span><span class="se">\\</span><span class="s2">\/</span><span class="se">\\</span><span class="s2">\/(?P&lt;offset&gt;.*)&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;UNIX&quot;</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?P&lt;cvf_id&gt;[0-9]+)\s*(?P&lt;offset&gt;[0-9]+)&quot;</span><span class="p">)</span>

        <span class="n">split_char</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># FETCHING AND STORING VALUE OF self.subclient_job_results_directory  IN</span>
        <span class="c1"># sc_jr FOR FURTHER USAGE</span>
        <span class="n">sc_jr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient_job_results_directory</span>

        <span class="n">dc_path</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">sc_jr</span><span class="p">,</span> <span class="n">dc_name</span><span class="p">)</span>
        <span class="n">cvf_path</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">sc_jr</span><span class="p">,</span> <span class="n">cvf_name</span><span class="p">)</span>
        <span class="n">restart_map_file_path</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">sc_jr</span><span class="p">,</span> <span class="n">restart_map</span><span class="p">)</span>

        <span class="c1"># STEP 1.2 - PARSE THE RESTART MAP FILE AND GET THE COLLECT FILE TO OFFSET VALUES</span>
        <span class="n">cvf_offset_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">restart_map_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_char</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">match_ptn</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">match_ptn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cvf_offset_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">match_ptn</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;cvf_id&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match_ptn</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">))</span>

        <span class="c1"># STEP 1.3 - PARSE RESTART STRING AND UPDATE DICTIONARY WITH OFFSET VALUES</span>
        <span class="n">cvf_offset_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_backup_restart_string</span><span class="p">(</span><span class="n">committed_job</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; cvf_offset_dict = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cvf_offset_dict</span><span class="p">)</span>

        <span class="c1"># STEP 1.4 - PREPARE THE COMMIT COLLECT FILE LIST</span>
        <span class="n">commit_cvf</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">cvf_id</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">cvf_offset_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">==</span> <span class="o">-</span><span class="mi">999</span><span class="p">:</span>  <span class="c1"># CVF IS COMPLETELY PROCESSED</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">offset</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># CVF IS YET TO BE PROCESSED</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span>
                <span class="n">cvf_path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cvf_id</span><span class="p">),</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_char</span><span class="p">)</span>
            <span class="n">commit_cvf</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

        <span class="c1"># STEP 2 - PREPARE EXPECTED COMMIT DIRCHANGE</span>
        <span class="n">commit_dc</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">dc_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_char</span><span class="p">)</span>

        <span class="n">expected_commit_files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cvf&#39;</span><span class="p">:</span> <span class="n">commit_cvf</span><span class="p">,</span> <span class="s1">&#39;dc&#39;</span><span class="p">:</span> <span class="n">commit_dc</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">expected_commit_files</span></div>

<div class="viewcode-block" id="FSHelper.get_actual_commit_files"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.get_actual_commit_files">[docs]</a>    <span class="k">def</span> <span class="nf">get_actual_commit_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">committed_job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves the actual commit files generated by scan.</span>
<span class="sd">        These files will be compared with the expected collect files that we created based on the restart string.</span>

<span class="sd">        Args:</span>
<span class="sd">            committed_job   (object)    --  Instance of Job, of the committed job.</span>

<span class="sd">        Returns:</span>
<span class="sd">           dict -   Returns a dictionary of lists containing entries in the commit collect and commit dirchange.</span>

<span class="sd">        Raises:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">machine_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span>

        <span class="n">commit_cvf_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s2">&quot;Commit_J&quot;</span><span class="p">,</span> <span class="n">committed_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="s2">&quot;_Collect.cvf&quot;</span><span class="p">))</span>
        <span class="n">commit_dc_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s2">&quot;Commit_J&quot;</span><span class="p">,</span> <span class="n">committed_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="s2">&quot;_DirChange.cvf&quot;</span><span class="p">))</span>

        <span class="n">split_char</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># FETCHING AND STORING VALUE OF self.subclient_job_results_directory  IN</span>
        <span class="c1"># sc_jr FOR FURTHER USAGE</span>
        <span class="n">sc_jr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient_job_results_directory</span>

        <span class="c1"># STEP 1 - GET ACTUAL COMMIT COLLECT FILE</span>
        <span class="n">commit_cvf_file_path</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">sc_jr</span><span class="p">,</span> <span class="n">commit_cvf_name</span><span class="p">)</span>
        <span class="n">commit_cvf</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">commit_cvf_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_char</span><span class="p">)</span>

        <span class="c1"># STEP 2 - GET ACTUAL COMMIT DIR CHANGE</span>
        <span class="n">commit_dc_file_path</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">sc_jr</span><span class="p">,</span> <span class="n">commit_dc_name</span><span class="p">)</span>
        <span class="n">commit_dc</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">commit_dc_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_char</span><span class="p">)</span>

        <span class="n">actual_commit_files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cvf&#39;</span><span class="p">:</span> <span class="n">commit_cvf</span><span class="p">,</span> <span class="s1">&#39;dc&#39;</span><span class="p">:</span> <span class="n">commit_dc</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">actual_commit_files</span></div>

<div class="viewcode-block" id="FSHelper.validate_commit_files"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.validate_commit_files">[docs]</a>    <span class="k">def</span> <span class="nf">validate_commit_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected_commit_files</span><span class="p">,</span> <span class="n">actual_commit_files</span><span class="p">,</span> <span class="n">only_cvf</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function checks whether the commit collect file and commit dirchange file were created correctly.</span>

<span class="sd">        Args:</span>
<span class="sd">            expected_commit_files   (dict)  --  Dictionary of commit files created by create_expected_commit_files.</span>

<span class="sd">            actual_commit_files     (dict)  --  Dictionary of commit files created by get_actual_commit_files.</span>

<span class="sd">            only_cvf                (bool)  --  If true, skips validation of the commit dirchange.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool    -   Returns True if the lists are identical.</span>
<span class="sd">            Returns False if the contents of the lists are different.</span>

<span class="sd">        Raises:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># REMOVING ALL EMPTY ELEMENTS FROM LIST PRIOR TO COMPARISON</span>
        <span class="n">ignore_items</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">expected_cvf_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">expected_commit_files</span><span class="p">[</span><span class="s1">&#39;cvf&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_items</span><span class="p">]</span>
        <span class="n">actual_cvf_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">actual_commit_files</span><span class="p">[</span><span class="s1">&#39;cvf&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_items</span><span class="p">]</span>

        <span class="n">expected_dc_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">expected_commit_files</span><span class="p">[</span><span class="s1">&#39;dc&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_items</span><span class="p">]</span>
        <span class="n">actual_dc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">actual_commit_files</span><span class="p">[</span><span class="s1">&#39;dc&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_items</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_lists</span><span class="p">(</span><span class="n">expected_cvf_list</span><span class="p">,</span> <span class="n">actual_cvf_list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Commit collect file passed validation.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Commit collect file failed validation.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_cvf</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_lists</span><span class="p">(</span><span class="n">expected_dc_list</span><span class="p">,</span> <span class="n">actual_dc_list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Commit dirchange passed validation.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Commit dirchange failed validation.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping commit dirchange validation.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_update_ref_time_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the reference time dictionary self.job_ref_time_dict.</span>

<span class="sd">        Args:</span>
<span class="sd">            job             (object)    --  Instance of backup Job.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT attrVal FROM APP_SubclientProp WITH (NOLOCK) WHERE attrName = &#39;</span><span class="si">{}</span><span class="s2">&#39; AND componentNameId=</span><span class="si">{}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;sys:last full&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_id</span><span class="p">))</span>
        <span class="n">last_full</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;sys:last incr&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_id</span><span class="p">))</span>
        <span class="n">last_incr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;INCREMENTAL&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_ref_time_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_ref_time_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s1">&#39;next_incr_ref_time&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_ref_time_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;next_incr_ref_time&#39;</span><span class="p">:</span> <span class="n">last_incr</span><span class="p">}</span>

        <span class="k">elif</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FULL&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_ref_time_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_ref_time_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;next_incr_ref_time&#39;</span><span class="p">:</span> <span class="n">last_full</span><span class="p">}</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_ref_time_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">:</span> <span class="n">last_full</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_ref_time_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;next_incr_ref_time&#39;</span><span class="p">:</span> <span class="n">last_incr</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">last_full</span> <span class="o">&gt;</span> <span class="n">last_incr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_ref_time_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;next_incr_ref_time&#39;</span><span class="p">:</span> <span class="n">last_full</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_ref_time_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;next_incr_ref_time&#39;</span><span class="p">:</span> <span class="n">last_incr</span><span class="p">}</span>

<div class="viewcode-block" id="FSHelper.extent_level_validation"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.extent_level_validation">[docs]</a>    <span class="k">def</span> <span class="nf">extent_level_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">cvf_validation</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Attempts to check whether large files were backed up as extents.</span>
<span class="sd">        It also, optionally, validates the extent eligible collect file.</span>

<span class="sd">        Args:</span>
<span class="sd">            job             (object)    --  Instance of backup Job.</span>

<span class="sd">            cvf_validation  (bool)      --  If true, validates entries in the extent eligible collect file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool    -   Returns True if the lists are identical.</span>
<span class="sd">            Returns False if the contents of the lists are different.</span>

<span class="sd">        Raises:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">get_query_op</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cond</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">{}</span><span class="s2"> FROM </span><span class="si">{}</span><span class="s2"> WITH (NOLOCK) WHERE </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cond</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># 0 FILES HAVE BEEN TRANSFERRED SO FAR</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># STEP 1 - GET NUMBER OF FILES TRANSFERRED AND NUMBER OF STREAMS USED BY THE JOB.</span>
        <span class="n">num_files</span> <span class="o">=</span> <span class="n">get_query_op</span><span class="p">(</span><span class="s2">&quot;totalNumOfFiles&quot;</span><span class="p">,</span> <span class="s2">&quot;JMBkpStats&quot;</span><span class="p">,</span> <span class="s2">&quot;jobId =</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="n">num_streams</span> <span class="o">=</span> <span class="n">get_query_op</span><span class="p">(</span>
            <span class="s2">&quot;COUNT(*)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;JMJobResourceHistory&quot;</span><span class="p">,</span>
            <span class="s2">&quot;jobId=</span><span class="si">{}</span><span class="s2"> AND phaseNum=7&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">num_files</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">num_streams</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> streams used to transfer one file, it was backed up as extents&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_streams</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Unable to perform validation for this job based merely on the number of streams used.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cvf_validation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collect file validation will be performed.&quot;</span><span class="p">)</span>
            <span class="n">machine_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span>
            <span class="n">items_on_setup</span><span class="p">,</span> <span class="n">items_in_collect</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">split_char</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FULL&quot;</span><span class="p">:</span>
                <span class="n">ptrn</span> <span class="o">=</span> <span class="s2">&quot;*ExtentEligibleNumColTot*&quot;</span>
                <span class="n">ref_time</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ptrn</span> <span class="o">=</span> <span class="s2">&quot;*ExtentEligibleNumColInc*&quot;</span>
                <span class="n">ref_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_ref_time_dict</span><span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">])</span>

            <span class="c1"># STEP 1 - GET LIST OF ALL FILES ON SETUP THAT SHOULD QUALIFY FOR EXTENT LEVEL BACKUP</span>
            <span class="n">meta_list</span> <span class="o">=</span> <span class="s2">&quot;&#39;FilesOnly&#39;,&#39;Hidden&#39;,&#39;FullName&#39;,&#39;LastWriteTimeUtc&#39;,&#39;Size&#39;&quot;</span>
            <span class="n">list_of_items</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">get_test_data_info</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">custom_meta_list</span><span class="o">=</span><span class="n">meta_list</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_char</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_of_items</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="n">item_prop</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">path</span><span class="p">,</span> <span class="n">lwt</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">item_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">floor</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">item_prop</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="nb">int</span><span class="p">(</span><span class="n">item_prop</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">threshold</span> <span class="ow">and</span> <span class="n">lwt</span> <span class="o">&gt;</span> <span class="n">ref_time</span><span class="p">:</span>
                        <span class="n">items_on_setup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="c1"># STEP 2 - GET LIST OF ALL ENTRIES FROM ALL FileExtentEligibleNumCol*.cvf</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;(Get-ChildItem </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> -Filter </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">).FullName&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient_job_results_directory</span><span class="p">,</span> <span class="n">ptrn</span><span class="p">)</span>
            <span class="n">cvf_entry_ptrn</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[*?][*?][*?](?P&lt;file_path&gt;.*?)(?P&lt;flags&gt;\|.*)&quot;</span><span class="p">)</span>
            <span class="n">extent_eligible_cvfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">machine_obj</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_char</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">extent_eligible_cvf</span> <span class="ow">in</span> <span class="n">extent_eligible_cvfs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="p">(</span><span class="n">machine_obj</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">extent_eligible_cvf</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_char</span><span class="p">):</span>
                    <span class="n">match_ptrn</span> <span class="o">=</span> <span class="n">cvf_entry_ptrn</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">match_ptrn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">items_in_collect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match_ptrn</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;file_path&#39;</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_lists</span><span class="p">(</span><span class="n">items_on_setup</span><span class="p">,</span> <span class="n">items_in_collect</span><span class="p">,</span> <span class="n">sort_list</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collect file validation was successful&quot;</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping extent collect file validation by default&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="FSHelper.generate_testdata"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.generate_testdata">[docs]</a>    <span class="k">def</span> <span class="nf">generate_testdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_extensions</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">no_of_files</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates files with the specified extensions</span>

<span class="sd">        Args:</span>
<span class="sd">            file_extensions   (list)    --  List of all the extensions</span>
<span class="sd">            path               (str)    --  Source path to create files on</span>
<span class="sd">            no.of files        (int)    --  File count to create in destination</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Populating test data&quot;</span><span class="p">)</span>
            <span class="n">install_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">install_directory</span>
            <span class="n">content_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content_path</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">content_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting the existing folder&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">content_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">content_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">each_extension</span> <span class="ow">in</span> <span class="n">file_extensions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">no_of_files</span><span class="p">):</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}{1}{2}{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">content_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">slash_format</span><span class="p">,</span>
                                                  <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">each_extension</span><span class="p">)</span>
                <span class="n">data_to_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;My File Data </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">data_to_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.validate_filters"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.validate_filters">[docs]</a>    <span class="k">def</span> <span class="nf">validate_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">win_filters</span><span class="p">,</span> <span class="n">unix_filters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to validate whether the filters set are being honoured or not</span>

<span class="sd">        Args:</span>
<span class="sd">            win_filters         (list)  --  windows filters list.</span>

<span class="sd">            unix_filters        (list)  --  unix filters list.</span>


<span class="sd">        Returns:</span>
<span class="sd">            bool    -   Returns True if the filters are being honoured correctly</span>
<span class="sd">                        Returns False if the filters are not being honoured</span>

<span class="sd">        Raises:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span><span class="p">:</span>

                <span class="n">collect_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">job_results_directory</span><span class="p">,</span>
                    <span class="sa">r</span><span class="s2">&quot;CV_JobResults\iDataAgent\FileSystemAgent&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_id</span><span class="p">,</span>
                    <span class="s2">&quot;NumColTot1.cvf&quot;</span><span class="p">)</span>

                <span class="n">filters</span> <span class="o">=</span> <span class="n">win_filters</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;UNIX&quot;</span><span class="p">:</span>

                <span class="n">collect_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">job_results_directory</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_id</span><span class="p">,</span>
                    <span class="s2">&quot;CollectTot1.cvf&quot;</span><span class="p">)</span>

                <span class="n">filters</span> <span class="o">=</span> <span class="n">unix_filters</span>

            <span class="k">for</span> <span class="nb">filter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">filter</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">collect_file_path</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;The filter </span><span class="si">%s</span><span class="s2"> is not being honoured &quot;</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The filter </span><span class="si">%s</span><span class="s2"> is not being honoured&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The filters </span><span class="si">%s</span><span class="s2"> is  honoured &quot;</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span></div>

<div class="viewcode-block" id="FSHelper.validate_failed_files"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.validate_failed_files">[docs]</a>    <span class="k">def</span> <span class="nf">validate_failed_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">job</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to validate failed files</span>

<span class="sd">        Args:</span>
<span class="sd">            source_list         (list)  --  list of source paths to be locked.</span>

<span class="sd">            Job                 (str)  --  Job type Failed or not .</span>


<span class="sd">        Raises:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">machine_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; Failures Collect file validation will be performed.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s2">&quot;WINDOWS&quot;</span><span class="p">:</span>
            <span class="n">failures_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">job_results_directory</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;CV_JobResults\iDataAgent\FileSystemAgent&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_id</span><span class="p">,</span>
                <span class="s2">&quot;Failures.cvf&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">failed_item</span> <span class="ow">in</span> <span class="n">source_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">failed_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">failures_file_path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">job</span> <span class="o">==</span> <span class="s2">&quot;Failed&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;The Failed item  </span><span class="si">%s</span><span class="s2"> is failures.cvf &quot;</span><span class="p">,</span> <span class="n">failed_item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The Failed item  </span><span class="si">%s</span><span class="s2"> is failures.cvf&quot;</span><span class="p">,</span> <span class="n">failed_item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">%s</span><span class="s2"> is not in Failures collect &quot;</span><span class="p">,</span> <span class="n">failed_item</span><span class="p">)</span></div>

<div class="viewcode-block" id="FSHelper.get_snapshot_id"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.get_snapshot_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_snapshot_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to get eh snapshotID created for that job</span>

<span class="sd">        Args:</span>
<span class="sd">            Job         (obj)  --  Job object</span>



<span class="sd">        Returns:</span>
<span class="sd">            String    -   Returns the snapshot ID</span>


<span class="sd">        Raises:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;BACKUP&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;RUNNING&quot;</span><span class="p">:</span>
                <span class="n">job</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;Select shadowCopyId from JMBkpJobInfo where jobId = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="n">snapshot_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span>
        <span class="n">job</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">snapshot_id</span></div>

<div class="viewcode-block" id="FSHelper.is_snapshot_deleted"><a class="viewcode-back" href="../../../source/FileSystem.FSUtils.html#FileSystem.FSUtils.fshelper.FSHelper.is_snapshot_deleted">[docs]</a>    <span class="k">def</span> <span class="nf">is_snapshot_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snapshot_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to check if snapshot has been deleted post backup</span>

<span class="sd">        Args:</span>
<span class="sd">            snapshot_id         (String)  --  snapshot ID</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception if snapshot has not been deleted</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;vssadmin list shadows&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;List shadows command failed to get executed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Got the shadow list succesfully&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">snapshot_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The Snapshot </span><span class="si">%s</span><span class="s2"> has been deleted successfully &quot;</span><span class="p">,</span> <span class="n">snapshot_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The Snapshot </span><span class="si">%s</span><span class="s2"> has not been deleted &quot;</span><span class="p">,</span> <span class="n">snapshot_id</span><span class="p">)</span></div></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>