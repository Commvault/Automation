

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CVTrials.trial_helper &mdash; Commvault Automation 11.22 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>CVTrials.trial_helper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for CVTrials.trial_helper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provides the function or operations related to Commvault trial</span>
<span class="sd">TrialHelper : This class provides methods for trial related operations</span>

<span class="sd">TrialHelper</span>
<span class="sd">===========</span>

<span class="sd">    register_for_free_trial()       -- To register for commvault free trial</span>

<span class="sd">    get_registration_mail()         -- To find and select the registration mail</span>

<span class="sd">    get_mail_contents()             -- To get the Commvault ID, Password and Activation code</span>
<span class="sd">    from the mail send from the sender</span>

<span class="sd">    _get_application_name()         -- To get the Commvault Express file name</span>

<span class="sd">    _validate_trial_video()         -- To validate the commvault trial install video</span>

<span class="sd">    login_to_cloud()                -- To login into Commvault&#39;s cloud</span>

<span class="sd">    execute_workflow()              -- To execute a workflow</span>

<span class="sd">    delete_commvaultone_trial_user() -- To execute workflow on the forevercell</span>

<span class="sd">    wait_for_download()             -- To wait for the file to be downloaded from the browser</span>

<span class="sd">    execute_command()               -- To execute a command on the remote machine using PsExec</span>

<span class="sd">    download_trial_package_from_cloud() -- To download the commvault software trial package</span>

<span class="sd">    silent_install_trial_package()  -- To install the commvault software trial package in background</span>

<span class="sd">    interactive_install_trial_package() -- To install the commvault software trial package in background</span>

<span class="sd">    register_trial_package()        -- To register the commvault software trial package</span>

<span class="sd">    configure_core_setup()          -- To configure Adminconsole core setup</span>

<span class="sd">    configure_virtualization()      -- To configure Virtualization on the getting started</span>
<span class="sd">    page of the admin console</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="kn">from</span> <span class="nn">cvpysdk.commcell</span> <span class="kn">import</span> <span class="n">Commcell</span>
<span class="kn">from</span> <span class="nn">cvpysdk.exception</span> <span class="kn">import</span> <span class="n">SDKException</span>

<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>

<span class="kn">from</span> <span class="nn">AutomationUtils.machine</span> <span class="kn">import</span> <span class="n">Machine</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.constants</span> <span class="kn">import</span> <span class="n">CVTRIALS_DIRECTORY</span><span class="p">,</span> <span class="n">AUTOMATION_DIRECTORY</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="kn">import</span> <span class="n">OptionsSelector</span>
<span class="kn">from</span> <span class="nn">Web.MarketPlace.commvault_trial</span> <span class="kn">import</span> <span class="n">CommvaultTrial</span>
<span class="kn">from</span> <span class="nn">Web.Gmail.gmail</span> <span class="kn">import</span> <span class="n">Gmail</span>
<span class="kn">from</span> <span class="nn">Web.AdminConsole.Setup.registration</span> <span class="kn">import</span> <span class="n">Registration</span>
<span class="kn">from</span> <span class="nn">Web.AdminConsole.Setup.login</span> <span class="kn">import</span> <span class="n">LoginPage</span>
<span class="kn">from</span> <span class="nn">Web.AdminConsole.Setup.core_setup</span> <span class="kn">import</span> <span class="n">Setup</span>
<span class="kn">from</span> <span class="nn">Web.AdminConsole.Setup.getting_started</span> <span class="kn">import</span> <span class="n">GettingStarted</span>
<span class="kn">from</span> <span class="nn">Web.AdminConsole.Setup.vsa_getting_started</span> <span class="kn">import</span> <span class="n">Virtualization</span>
<span class="kn">from</span> <span class="nn">Web.AdminConsole.AdminConsolePages.Jobs</span> <span class="kn">import</span> <span class="n">Jobs</span>
<span class="kn">from</span> <span class="nn">Install.installer_constants</span> <span class="kn">import</span> <span class="n">QINSTALLER_RETURNCODES</span>


<div class="viewcode-block" id="TrialHelper"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper">[docs]</a><span class="k">class</span> <span class="nc">TrialHelper</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Helper file for performing commvault trial related operations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testcase</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TrialHelper class initialization</span>

<span class="sd">        Args:</span>
<span class="sd">            testcase    (object)    -- object of TestCase class</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">tcinputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span> <span class="o">=</span> <span class="n">testcase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trial_details</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmail</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtualization</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getting_started</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="s1">&#39;driver&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">driver</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trial</span> <span class="o">=</span> <span class="n">CommvaultTrial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gmail</span> <span class="o">=</span> <span class="n">Gmail</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trial_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the details for trial related operations&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trial_details</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mail_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GmailUsername&#39;</span><span class="p">))</span>

<div class="viewcode-block" id="TrialHelper.register_for_free_trial"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.register_for_free_trial">[docs]</a>    <span class="k">def</span> <span class="nf">register_for_free_trial</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">first_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">last_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">phone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">postal_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">company</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">email</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">country</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To register for commvault free trial</span>

<span class="sd">        Args:</span>
<span class="sd">            username        (str)   -- Cloud username to perform trial related operations</span>

<span class="sd">            password        (str)   -- Password for the Trial account</span>

<span class="sd">            first_name      (str)   -- First name of the new user</span>

<span class="sd">            last_name       (str)   -- Last name of the new user</span>

<span class="sd">            phone           (str)   -- Phone number of the new user</span>

<span class="sd">            postal_code     (str)   -- postal code of the new user</span>

<span class="sd">            company         (str)   -- Company the user belongs</span>

<span class="sd">            email           (str)   -- Email ID of the new user</span>

<span class="sd">            country         (str)   -- Country of the new user</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://cloud.commvault.com/webconsole/RestServlet/Login&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
            <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span>
        <span class="p">}</span>
        <span class="n">cvpysdk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">_cvpysdk_object</span>
        <span class="n">flag</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">cvpysdk</span><span class="o">.</span><span class="n">make_request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;token&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">():</span>
                <span class="n">authtoken</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">,</span> <span class="s1">&#39;102&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">,</span> <span class="s1">&#39;101&#39;</span><span class="p">,</span> <span class="n">cvpysdk</span><span class="o">.</span><span class="n">_update_response_</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Content-type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Authtoken&#39;</span><span class="p">:</span> <span class="n">authtoken</span>
        <span class="p">}</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://cloud.commvault.com/webconsole/RestServlet/wapi/Generate%20Trial%20Activation%20Code&quot;</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;FirstName&quot;</span><span class="p">:</span> <span class="n">first_name</span><span class="p">,</span>
            <span class="s2">&quot;LastName&quot;</span><span class="p">:</span> <span class="n">last_name</span><span class="p">,</span>
            <span class="s2">&quot;Phone&quot;</span><span class="p">:</span> <span class="n">phone</span><span class="p">,</span>
            <span class="s2">&quot;Company&quot;</span><span class="p">:</span> <span class="n">company</span><span class="p">,</span>
            <span class="s2">&quot;Country&quot;</span><span class="p">:</span> <span class="n">country</span><span class="p">,</span>
            <span class="s2">&quot;TrialId&quot;</span><span class="p">:</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PartnerId&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span>
        <span class="p">}</span>

        <span class="n">flag</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">cvpysdk</span><span class="o">.</span><span class="n">make_request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;jobId&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">():</span>
                <span class="n">job_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;jobId&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s1"> started successfully&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">,</span> <span class="s1">&#39;102&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">,</span> <span class="s1">&#39;101&#39;</span><span class="p">,</span> <span class="n">cvpysdk</span><span class="o">.</span><span class="n">_update_response_</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully registered commvault free trial&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrialHelper.get_registration_mail"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.get_registration_mail">[docs]</a>    <span class="k">def</span> <span class="nf">get_registration_mail</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To find and select the latest commvault registration mail</span>

<span class="sd">        Args:</span>
<span class="sd">            sender      (str)   -- Full Email ID of the sender</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># To login to the Gmail page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmail</span><span class="o">.</span><span class="n">navigate_to_gmail</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmail</span><span class="o">.</span><span class="n">login</span><span class="p">(</span>
            <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GmailUsername&#39;</span><span class="p">),</span>
            <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GmailPassword&#39;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gmail</span><span class="o">.</span><span class="n">select_latest_mail_from_sender</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Registration mail received successfully in : </span><span class="si">%s</span><span class="s1"> seconds&#39;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">10</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Commvault registration mail not received within 5 minutes&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrialHelper.get_mail_contents"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.get_mail_contents">[docs]</a>    <span class="k">def</span> <span class="nf">get_mail_contents</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To get the Commvault ID, Password and Activation code from the mail send from the sender</span>

<span class="sd">        Args:</span>
<span class="sd">            sender      (str)   -- Full Email ID of the sender</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict)      -- dict of the mail contents</span>

<span class="sd">                 sample:</span>

<span class="sd">                    {</span>
<span class="sd">                    &quot;Commvault ID&quot;: &quot;value&quot;,</span>
<span class="sd">                    &quot;Password&quot;: &quot;value&quot;,</span>
<span class="sd">                    &quot;Activation code&quot;: &quot;value&quot;</span>
<span class="sd">                    }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># To select the latest mail from the sender</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_registration_mail</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>

        <span class="c1"># To get the username and password from mail</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//b[text()=&#39;Password&#39;]/..&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unable to locate the Password in the mail&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_trial_details</span><span class="p">[</span><span class="s1">&#39;Commvault ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Commvault ID: (.*)&quot;</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trial_details</span><span class="p">[</span><span class="s1">&#39;Password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Password: (.*)&quot;</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># To get the activation code</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//p/b[contains(text(), &#39;Trial Activation Code&#39;)]/..&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trial_details</span><span class="p">[</span><span class="s1">&#39;Activation Code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                <span class="s1">&#39;Trial Activation Code: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unable to locate the Activation code in the mail&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Mail contents are successfully retrieved&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_details</span></div>

    <span class="k">def</span> <span class="nf">_get_application_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To get the Commvault Express file name&quot;&quot;&quot;</span>
        <span class="n">element</span> <span class="o">=</span> <span class="s2">&quot;//td[contains(text(),&#39;CommvaultExpress&#39;)]&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">check_if_entity_exists</span><span class="p">(</span><span class="s1">&#39;xpath&#39;</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="n">element</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Trial software file name: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">file_name</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Commvault Express not found in trial download page&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_trial_video</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To validate the commvault Trial video&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># To pause the video to get the time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//button[@class=&quot;ytp-play-button ytp-button&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s2">&quot;ytp-time-duration&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;2:49&#39;</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">check_if_entity_exists</span><span class="p">(</span><span class="s1">&#39;xpath&#39;</span><span class="p">,</span> <span class="s1">&#39;//a[contains(text(),&quot;Commvault&quot;)]&#39;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Commvault trial video validation successful&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Commvault trial install video changed&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Commvault Trial video validation failed, please check the logs&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="TrialHelper.login_to_cloud"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.login_to_cloud">[docs]</a>    <span class="k">def</span> <span class="nf">login_to_cloud</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">stay_logged_in</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To login into Commvault&#39;s cloud</span>

<span class="sd">        Args:</span>
<span class="sd">            username        (str)   -- Cloud username to login</span>

<span class="sd">            password        (str)   -- Cloud password to login</span>

<span class="sd">            stay_logged_in  (bool)  -- set to true will keep user logged in</span>
<span class="sd">                                        default: True</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">fill_form_by_id</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s2">&quot;continuebtn&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">fill_form_by_id</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">stay_logged_in</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;stayactivebox&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">checkbox_deselect</span><span class="p">(</span><span class="s2">&quot;stayactivebox&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">select_hyperlink</span><span class="p">(</span><span class="s1">&#39;Login&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrialHelper.execute_workflow"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.execute_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">execute_workflow</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">workflow_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To execute the workflow on the given commcell machine</span>

<span class="sd">        Args:</span>
<span class="sd">            commcell        (obj)   -- Commcell class object</span>

<span class="sd">            workflow_name   (str)   -- Name of the workflow to be executed on the commcell machine</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Executing &quot;</span><span class="si">%s</span><span class="s1">&quot; workflow&#39;</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">)</span>
        <span class="n">workflow</span> <span class="o">=</span> <span class="n">commcell</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">job</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">execute_workflow</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to execute the workflow with error: &quot;</span> <span class="o">+</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully Executed &quot;</span><span class="si">%s</span><span class="s1">&quot; Workflow&#39;</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrialHelper.delete_commvaultone_trial_user"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.delete_commvaultone_trial_user">[docs]</a>    <span class="k">def</span> <span class="nf">delete_commvaultone_trial_user</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">cloud_username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">cloud_password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To execute workflow on the forevercell machine</span>

<span class="sd">        Args:</span>
<span class="sd">            cloud_username  (str)   -- Cloud username to login to the cloud machine</span>

<span class="sd">            cloud_password  (str)   -- Cloud password to login</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">commcell</span> <span class="o">=</span> <span class="n">Commcell</span><span class="p">(</span>
            <span class="s1">&#39;cloud.commvault.com&#39;</span><span class="p">,</span>
            <span class="n">cloud_username</span><span class="p">,</span>
            <span class="n">cloud_password</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">execute_workflow</span><span class="p">(</span><span class="n">commcell</span><span class="p">,</span> <span class="s1">&#39;delete commvault one trial user&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrialHelper.wait_for_download"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.wait_for_download">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To wait for the file to be downloaded from the browser</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path   (str)   -- Full path of the file to be downloaded</span>

<span class="sd">            wait_time   (int)   -- Time to wait for the download to complete in seconds</span>
<span class="sd">                                    default: 300</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_taken</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">time_taken</span> <span class="o">&lt;=</span> <span class="n">wait_time</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">check_file_exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;File downloaded successfully at the location &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">time_taken</span> <span class="o">+=</span> <span class="mi">10</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;File not downloaded within the time limit given&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrialHelper.execute_command"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.execute_command">[docs]</a>    <span class="k">def</span> <span class="nf">execute_command</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">hostname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To execute the command on the remote machine using PsExec.exe</span>

<span class="sd">        Args:</span>
<span class="sd">            hostname    (str)   -- Full hostname of the machine to execute command on</span>

<span class="sd">            username    (str)   -- Username to connect to the machine</span>

<span class="sd">            password    (str)   -- Password to connect to the machine</span>

<span class="sd">            command     (str)   -- Command to execute on the remote machine</span>

<span class="sd">        Returns:</span>
<span class="sd">            (int)       -- Return code of the command executed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exe_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">AUTOMATION_DIRECTORY</span><span class="p">,</span> <span class="s1">&#39;CompiledBins&#39;</span><span class="p">,</span> <span class="s1">&#39;PsExec.exe&#39;</span><span class="p">)</span>

        <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">exe_path</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                   <span class="s1">&#39; -i 1&#39;</span>
                   <span class="sa">f</span><span class="s1">&#39; &quot;</span><span class="se">\\\\</span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                   <span class="sa">f</span><span class="s1">&#39; -u &quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                   <span class="sa">f</span><span class="s1">&#39; -p &quot;</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                   <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrialHelper.download_trial_package_from_cloud"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.download_trial_package_from_cloud">[docs]</a>    <span class="k">def</span> <span class="nf">download_trial_package_from_cloud</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To download the commvault software trial package</span>

<span class="sd">        Args:</span>

<span class="sd">            sender      (str)   -- Sender of the registration mail</span>

<span class="sd">            path        (str)   -- FUll path to download the file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># To open the registration mail and get the contents</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mail_contents</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>

        <span class="c1"># To open new tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">()</span>

        <span class="c1"># To switch to the new tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">switch_to_latest_tab</span><span class="p">()</span>

        <span class="c1"># Disable SSO to overcome popup login</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">navigate</span><span class="p">(</span><span class="s1">&#39;https://cloud.commvault.com/webconsole/login/index.jsp?disableSSO&#39;</span><span class="p">)</span>

        <span class="c1"># To login to cloud</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">login_to_cloud</span><span class="p">(</span><span class="n">contents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Commvault ID&#39;</span><span class="p">),</span> <span class="n">contents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Password&#39;</span><span class="p">))</span>

        <span class="c1"># To close the new tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">close_current_tab</span><span class="p">()</span>

        <span class="c1"># To switch to the open tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">switch_to_latest_tab</span><span class="p">()</span>

        <span class="c1"># # To click on install video link from the mail received</span>
        <span class="c1"># self.gmail.select_hyperlink(&#39;installation video&#39;)</span>
        <span class="c1">#</span>
        <span class="c1"># # To switch to the open tab</span>
        <span class="c1"># self.trial.switch_to_latest_tab()</span>
        <span class="c1">#</span>
        <span class="c1"># # To validate install video</span>
        <span class="c1"># self._validate_trial_video()</span>
        <span class="c1">#</span>
        <span class="c1"># # To close the new tab</span>
        <span class="c1"># self.trial.close_current_tab()</span>
        <span class="c1">#</span>
        <span class="c1"># # To switch to the open tab</span>
        <span class="c1"># self.trial.switch_to_latest_tab()</span>

        <span class="c1"># To click on install video link from the mail received</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmail</span><span class="o">.</span><span class="n">select_hyperlink</span><span class="p">(</span><span class="s1">&#39;Quick Start Guide&#39;</span><span class="p">)</span>

        <span class="c1"># To sleep for 30s for the PDF page to load</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

        <span class="c1"># To switch to the open tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">switch_to_latest_tab</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># To validate quick start guide</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span>
                <span class="s1">&#39;//embed[@src=&quot;http://documentation.commvault.com/commvault/v11_sp16/others/pdf/&#39;</span>
                <span class="s1">&#39;Quick_Start_for_the_Commvault_Trial_Package.pdf&quot;]&#39;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Quick start guide validation successful&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Commvault quick start guide changed&#39;</span><span class="p">)</span>

        <span class="c1"># To close the new tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">close_current_tab</span><span class="p">()</span>

        <span class="c1"># To switch to the open tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">switch_to_latest_tab</span><span class="p">()</span>

        <span class="c1"># To click on telephone support link</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//a[contains(text(),&quot;Support&quot;)]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">()</span>

        <span class="c1"># To switch to the open tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">switch_to_latest_tab</span><span class="p">()</span>

        <span class="c1"># To validate support document</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">check_if_entity_exists</span><span class="p">(</span><span class="s1">&#39;xpath&#39;</span><span class="p">,</span> <span class="s1">&#39;//h1[contains(text(),&quot;Telephone-Based Support&quot;)]&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Telephone support document validation successfull&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Telephone support document validation failed&#39;</span><span class="p">)</span>

        <span class="c1"># To close the new tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">close_current_tab</span><span class="p">()</span>

        <span class="c1"># To switch to the open tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">switch_to_latest_tab</span><span class="p">()</span>

        <span class="c1"># To click on the privacy document link</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//a[text()=&quot;privacy policy&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">()</span>

        <span class="c1"># To switch to the open tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">switch_to_latest_tab</span><span class="p">()</span>

        <span class="c1"># To validate privacy document</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">check_if_entity_exists</span><span class="p">(</span><span class="s1">&#39;xpath&#39;</span><span class="p">,</span> <span class="s1">&#39;//h2[contains(text(),&quot;Commvault Privacy Policy&quot;)]&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Privacy document validation successfull&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Privacy document validation failed&#39;</span><span class="p">)</span>

        <span class="c1"># To close the new tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">close_current_tab</span><span class="p">()</span>

        <span class="c1"># To switch to the open tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">switch_to_latest_tab</span><span class="p">()</span>

        <span class="c1"># To open the download link from the mail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmail</span><span class="o">.</span><span class="n">select_hyperlink</span><span class="p">(</span><span class="s1">&#39;here&#39;</span><span class="p">)</span>

        <span class="c1"># To switch to the open tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">switch_to_latest_tab</span><span class="p">()</span>

        <span class="c1"># To start download</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//button/span[contains(text(),&quot;Download&quot;)]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Selected download button&#39;</span><span class="p">)</span>

        <span class="c1"># To go to the new tab if download asks for confirmation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">switch_to_latest_tab</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">check_if_entity_exists</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;proceed&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;proceed&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Proceeding further with download&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Download started&quot;</span><span class="p">)</span>

        <span class="c1"># sleep for 5 minutes for download to complete</span>
        <span class="n">wait</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="k">if</span> <span class="n">wait</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">get_files_in_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">wait</span> <span class="o">-=</span> <span class="mi">10</span>

        <span class="c1"># To check if the file is successfully downloaded</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">get_files_in_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span> <span class="ow">or</span> <span class="s1">&#39;CommvaultExpress&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;File not downloaded within the 5 minutes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;File downloaded successfully at the location &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># To include file path in the contents</span>
        <span class="n">contents</span><span class="p">[</span><span class="s1">&#39;SoftwarePath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">contents</span><span class="p">[</span><span class="s1">&#39;FileName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">file_path</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># To set all the trial related contents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trial_details</span> <span class="o">=</span> <span class="n">contents</span></div>

<div class="viewcode-block" id="TrialHelper.silent_install_trial_package"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.silent_install_trial_package">[docs]</a>    <span class="k">def</span> <span class="nf">silent_install_trial_package</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">hostname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">software_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To install the commvault trial package in the background</span>

<span class="sd">        Args:</span>
<span class="sd">            hostname        (str)   -- Full hostname of the machine to install package on</span>

<span class="sd">            username        (str)   -- Username of the machine</span>

<span class="sd">            password        (str)   -- Password of the machine</span>

<span class="sd">            software_path   (str)   -- Full path of the commvault trial software package</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># To create machine class object for the machine to install trial package on</span>
        <span class="n">machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Successfully created machine class object for machine </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span>
        <span class="p">)</span>

        <span class="c1"># To initialize options selector class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>

        <span class="c1"># To select drive with enough space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Selecting drive on the machine based on space available&#39;</span><span class="p">)</span>
        <span class="n">drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span><span class="o">.</span><span class="n">get_drive</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">drive</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Installation cancelled, Insufficient space on machine </span><span class="si">{</span><span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;selected drive: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">drive</span><span class="p">)</span>

        <span class="c1"># Directory to copy the batch file and the trial application</span>
        <span class="n">install_directory</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="s1">&#39;commvault_trial&#39;</span><span class="p">)</span>

        <span class="c1"># To remove install directory if exists</span>
        <span class="k">if</span> <span class="n">machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">install_directory</span><span class="p">):</span>
            <span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">install_directory</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully removed directory </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">install_directory</span><span class="p">)</span>

        <span class="c1"># To create install directory on the machine</span>
        <span class="n">machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">install_directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Successfully created Commvault trial directory in path &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="n">install_directory</span><span class="p">)</span>

        <span class="c1"># Batch file to trigger commvault trial installation</span>
        <span class="n">batch_file</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">CVTRIALS_DIRECTORY</span><span class="p">,</span> <span class="s1">&#39;silent_install.bat&#39;</span><span class="p">)</span>

        <span class="c1"># To copy the batch file</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">copy_from_local</span><span class="p">(</span><span class="n">batch_file</span><span class="p">,</span> <span class="n">install_directory</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># To validate if copy succeeded</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Failed to copy silent install batch file to the machine </span><span class="si">{</span><span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully copied the silent install batch file to machine </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="p">)</span>

        <span class="c1"># To copy the commvault trial software</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">copy_from_local</span><span class="p">(</span><span class="n">software_path</span><span class="p">,</span> <span class="n">install_directory</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># To validate if copy succeeded</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Failed to copy the Trial software to the machine </span><span class="si">{</span><span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Successfully copied the Trial software to machine </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="p">)</span>

        <span class="n">batch_file</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">install_directory</span><span class="p">,</span> <span class="s1">&#39;silent_install.bat&#39;</span><span class="p">)</span>
        <span class="n">exe_path</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">install_directory</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">software_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Waiting for Commvault Package installation to complete&#39;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span>
                                      <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
                                      <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
                                      <span class="n">command</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">batch_file</span><span class="si">}</span><span class="s1">&quot; &quot;</span><span class="si">{</span><span class="n">exe_path</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Installation Completed successfully&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">QINSTALLER_RETURNCODES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Installation Status: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Installation failed with error code: </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1"> status: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># To sleep for 5 minutes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sleeping for 5 minutes, for the services to come up&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

        <span class="c1"># To remove install directory on the machine</span>
        <span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">install_directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Successfully deleted Commvault trial directory in path &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="n">install_directory</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrialHelper.interactive_install_trial_package"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.interactive_install_trial_package">[docs]</a>    <span class="k">def</span> <span class="nf">interactive_install_trial_package</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">hostname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">software_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">input_json</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To install the commvault trial package interactively</span>

<span class="sd">        Args:</span>
<span class="sd">            hostname        (str)   -- Full hostname of the machine to install package on</span>

<span class="sd">            username        (str)   -- Username of the machine</span>

<span class="sd">            password        (str)   -- Password of the machine</span>

<span class="sd">            software_path   (str)   -- Full path of the commvault trial software package</span>

<span class="sd">            input_json      (dict)  -- Input for interactive install exe</span>
<span class="sd">                                Refer: Automation/Install/InteractiveInstall/UserInput.cs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># To create machine class object for the machine to install trial package on</span>
        <span class="n">machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Successfully created machine class object for machine </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span>
        <span class="p">)</span>

        <span class="c1"># To initialize options selector class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>

        <span class="c1"># To select drive with enough space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Selecting drive on the machine based on space available&#39;</span><span class="p">)</span>
        <span class="n">drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span><span class="o">.</span><span class="n">get_drive</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">drive</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Installation cancelled, Insufficient space on machine </span><span class="si">{</span><span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;selected drive: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">drive</span><span class="p">)</span>

        <span class="c1"># Directory to copy the batch file, trial application and interactive install exe</span>
        <span class="n">install_directory</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="s1">&#39;commvault_trial&#39;</span><span class="p">)</span>
        <span class="n">log_directory</span> <span class="o">=</span> <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">AUTOMATION_LOC&#39;</span>

        <span class="c1"># To remove install directory if exists</span>
        <span class="k">if</span> <span class="n">machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">install_directory</span><span class="p">):</span>
            <span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">install_directory</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully removed directory </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">install_directory</span><span class="p">)</span>

        <span class="c1"># To remove log directory if exists</span>
        <span class="k">if</span> <span class="n">machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">log_directory</span><span class="p">):</span>
            <span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">log_directory</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully removed directory </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">log_directory</span><span class="p">)</span>

        <span class="c1"># To create install directory on the machine</span>
        <span class="n">machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">install_directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Successfully created Commvault trial directory in path &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="n">install_directory</span><span class="p">)</span>

        <span class="c1"># To create log directory on the machine</span>
        <span class="n">machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">log_directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Successfully created Commvault trial log directory in path &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="n">log_directory</span><span class="p">)</span>

        <span class="c1"># Interactive install exe to perform install interactively</span>
        <span class="n">exe_file</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">AUTOMATION_DIRECTORY</span><span class="p">,</span> <span class="s1">&#39;CompiledBins&#39;</span><span class="p">,</span> <span class="s1">&#39;InteractiveInstall.exe&#39;</span><span class="p">)</span>

        <span class="c1"># To copy the exe file</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">copy_from_local</span><span class="p">(</span><span class="n">exe_file</span><span class="p">,</span> <span class="n">install_directory</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># To validate if copy succeeded</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Failed to copy interactive install exe to the machine </span><span class="si">{</span><span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully copied the interactive install exe to machine </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="p">)</span>

        <span class="c1"># To copy the commvault trial software</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">copy_from_local</span><span class="p">(</span><span class="n">software_path</span><span class="p">,</span> <span class="n">install_directory</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># To validate if copy succeeded</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Failed to copy the Trial software to the machine </span><span class="si">{</span><span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Successfully copied the Trial software to machine </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="p">)</span>

        <span class="c1"># To generate the user input json</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">CVTRIALS_DIRECTORY</span><span class="p">,</span> <span class="s1">&#39;UserInput.json&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">user_input</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">input_json</span><span class="p">))</span>

        <span class="c1"># To copy the user input json</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">copy_from_local</span><span class="p">(</span><span class="n">user_input</span><span class="p">,</span> <span class="n">install_directory</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># To validate if copy succeeded</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Failed to copy the user input json to the machine </span><span class="si">{</span><span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Successfully copied the User input json to machine </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="p">)</span>

        <span class="n">batch_file</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">install_directory</span><span class="p">,</span> <span class="s1">&#39;install.bat&#39;</span><span class="p">)</span>
        <span class="n">bootstrapper_path</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">install_directory</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">software_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">install_exe</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">install_directory</span><span class="p">,</span> <span class="s1">&#39;InteractiveInstall.exe&#39;</span><span class="p">)</span>
        <span class="n">installer_path</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">install_directory</span><span class="p">,</span> <span class="s1">&#39;installer&#39;</span><span class="p">)</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">install_directory</span><span class="p">,</span> <span class="s1">&#39;UserInput.json&#39;</span><span class="p">)</span>

        <span class="c1"># To generate the install.bat file</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">rf</span><span class="s1">&#39;&#39;&#39;&quot;&quot;</span><span class="si">{</span><span class="n">bootstrapper_path</span><span class="si">}</span><span class="s1">&quot;&quot; /d &quot;&quot;</span><span class="si">{</span><span class="n">installer_path</span><span class="si">}</span><span class="s1">&quot;&quot; /silent /noinstall</span>
<span class="s1">        &quot;&quot;</span><span class="si">{</span><span class="n">install_exe</span><span class="si">}</span><span class="s1">&quot;&quot; -PATH &quot;&quot;</span><span class="si">{</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">installer_path</span><span class="p">,</span> <span class="s1">&#39;Setup.exe&#39;</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;&quot; -PLAY &quot;&quot;</span><span class="si">{</span><span class="n">user_input</span><span class="si">}</span><span class="s1">&quot;&quot; /wait</span>
<span class="s1">        set errorCode = %ERRORLEVEL%</span>
<span class="s1">        EXIT %errorCode%</span>
<span class="s1">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">machine</span><span class="o">.</span><span class="n">create_file</span><span class="p">(</span><span class="n">batch_file</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Batch file creation failed&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Waiting for Commvault Package installation to complete&#39;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span>
                                      <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
                                      <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
                                      <span class="n">command</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">batch_file</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Interactive Installer exe Completed successfully&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">QINSTALLER_RETURNCODES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Installer Status: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Installer failed with error code: </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1"> status: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">input_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IsToDownload&#39;</span><span class="p">):</span>
            <span class="c1"># To sleep for 5 minutes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sleeping for 3 minutes, for the services to come up&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>

            <span class="c1"># To validate if Adminconsole is opened in the browser</span>
            <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Write-Host (Get-WmiObject Win32_Process &#39;</span>
                       <span class="s1">&#39;| select CommandLine &#39;</span>
                       <span class="s1">&#39;| Select-String -Pattern &quot;adminconsole&quot;)&#39;</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;adminconsole&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Admin console not opened in browser&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Admin console URL validation successful&#39;</span><span class="p">)</span>

        <span class="c1"># To remove install directory on the machine</span>
        <span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">install_directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Successfully deleted Commvault trial directory in path &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="n">install_directory</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrialHelper.register_trial_package"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.register_trial_package">[docs]</a>    <span class="k">def</span> <span class="nf">register_trial_package</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">commcell_username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">commcell_password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">activation_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">new_user</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">first_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">last_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">company_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">phone_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">address1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">address2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">city</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">postal_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">country</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To register commvault trial package</span>

<span class="sd">        Args:</span>
<span class="sd">            url                 (str)   -- Admin console URL</span>

<span class="sd">            commcell_username   (str)   -- username to login to admin console</span>

<span class="sd">            commcell_password   (str)   -- password to login to admin console</span>

<span class="sd">            activation_code     (str)   -- Activation code for the commcell</span>

<span class="sd">            new_user            (bool)  -- Set to True, to register a new user</span>
<span class="sd">                                            default: False</span>

<span class="sd">            first_name          (str)   -- First name of the user</span>

<span class="sd">            last_name           (str)   -- Last name of the user</span>

<span class="sd">            company_name        (str)   -- Company name</span>

<span class="sd">            phone_number        (str)   -- The complete phone no with country and area code</span>
<span class="sd">                                            Example:    001-002-1234567890</span>

<span class="sd">            address1            (str)   -- Line 1 of the address</span>

<span class="sd">            address2            (str)   -- Line 2 of the address</span>

<span class="sd">            city                (str)   -- Name of the city</span>

<span class="sd">            state               (str)   -- Name of the state</span>

<span class="sd">            postal_code         (str)   -- Postal code of the place</span>

<span class="sd">            country             (str)   -- Name of the country</span>

<span class="sd">        **Note** First 4 inputs are required for registering a existing user, for a new user all inputs are required</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># To initialize the registration page</span>
        <span class="n">registration</span> <span class="o">=</span> <span class="n">Registration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="c1"># To navigate to the admin console page</span>
        <span class="n">registration</span><span class="o">.</span><span class="n">navigate</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="c1"># To wait for a maximum of 5 minutes for the page to load</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">element_present</span> <span class="o">=</span> <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">))</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">element_present</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Waited for 5 minutes, Admin Console page is not reachable&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Waited for 5 minutes, Admin Console page is not reachable&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_user</span><span class="p">:</span>
            <span class="c1"># To register a new user</span>
            <span class="n">registration</span><span class="o">.</span><span class="n">fill_user_details</span><span class="p">(</span>
                <span class="n">commcell_username</span><span class="p">,</span>
                <span class="n">commcell_password</span><span class="p">,</span>
                <span class="n">activation_code</span>
            <span class="p">)</span>

            <span class="n">registration</span><span class="o">.</span><span class="n">fill_contact_details</span><span class="p">(</span>
                <span class="n">first_name</span><span class="p">,</span>
                <span class="n">last_name</span><span class="p">,</span>
                <span class="n">company_name</span><span class="p">,</span>
                <span class="n">phone_number</span>
            <span class="p">)</span>

            <span class="n">registration</span><span class="o">.</span><span class="n">fill_mailing_address</span><span class="p">(</span>
                <span class="n">address1</span><span class="p">,</span>
                <span class="n">address2</span><span class="p">,</span>
                <span class="n">city</span><span class="p">,</span>
                <span class="n">state</span><span class="p">,</span>
                <span class="n">postal_code</span><span class="p">,</span>
                <span class="n">country</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># To register the account in adminconsole</span>
            <span class="n">registration</span><span class="o">.</span><span class="n">register_existing_account</span><span class="p">(</span>
                <span class="n">email</span><span class="o">=</span><span class="n">commcell_username</span><span class="p">,</span>
                <span class="n">password</span><span class="o">=</span><span class="n">commcell_password</span><span class="p">,</span>
                <span class="n">activation_code</span><span class="o">=</span><span class="n">activation_code</span>
            <span class="p">)</span>

        <span class="c1"># To login to admin console</span>
        <span class="n">login</span> <span class="o">=</span> <span class="n">LoginPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>
        <span class="n">login</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">commcell_username</span><span class="p">,</span> <span class="n">commcell_password</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Registration and Login Successful&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrialHelper.configure_core_setup"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.configure_core_setup">[docs]</a>    <span class="k">def</span> <span class="nf">configure_core_setup</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">pool_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">media_agent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">partition_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To configure core setup page of Admin console</span>

<span class="sd">        Args:</span>
<span class="sd">            pool_name       (str)   -- Name of the storage pool to be created</span>

<span class="sd">            media_agent     (str)   -- media agent to be selected, by default it is selected</span>

<span class="sd">            username        (str)   -- Username for the network path</span>

<span class="sd">            password        (str)   -- Password for the network path</span>

<span class="sd">            path            (str)   -- Path to be selected as storage</span>

<span class="sd">            partition_path  (str)   -- DDB partition path</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># To configure core setup</span>
        <span class="n">setup</span> <span class="o">=</span> <span class="n">Setup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="c1"># To get started with the configuration</span>
        <span class="n">setup</span><span class="o">.</span><span class="n">select_get_started</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully selected &quot;Getting Started button&quot;&#39;</span><span class="p">)</span>

        <span class="c1"># To add storage pool</span>
        <span class="n">setup</span><span class="o">.</span><span class="n">add_storage_pool</span><span class="p">(</span>
            <span class="n">pool_name</span><span class="o">=</span><span class="n">pool_name</span><span class="p">,</span>
            <span class="n">media_agent</span><span class="o">=</span><span class="n">media_agent</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">partition_path</span><span class="o">=</span><span class="n">partition_path</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully added storage pool&#39;</span><span class="p">)</span>

        <span class="c1"># To create server backup plan</span>
        <span class="c1"># Using default Admin console values for backup</span>
        <span class="n">setup</span><span class="o">.</span><span class="n">create_server_backup_plan</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully created server backup plan&#39;</span><span class="p">)</span>

        <span class="c1"># To validate if core setup configuration is completed or not</span>
        <span class="k">if</span> <span class="n">setup</span><span class="o">.</span><span class="n">check_if_entity_exists</span><span class="p">(</span><span class="s1">&#39;xpath&#39;</span><span class="p">,</span> <span class="s1">&#39;//div[@data-ng-if=&quot;coreSetupCompleted&quot;]&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully configured core setup&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Core setup configuration failed please check the logs&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrialHelper.configure_virtualization"><a class="viewcode-back" href="../../source/CVTrials.html#CVTrials.trial_helper.TrialHelper.configure_virtualization">[docs]</a>    <span class="k">def</span> <span class="nf">configure_virtualization</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">commcell_username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">commcell_password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">hostname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">machine_username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">machine_password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">virtual_machines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To configure Virtualization on the getting started page of the admin console</span>
<span class="sd">        and to run VSA backup job</span>

<span class="sd">        Args:</span>
<span class="sd">            url                 (str)   -- Admin console URL</span>

<span class="sd">            commcell_username   (str)   -- username to login to admin console</span>

<span class="sd">            commcell_password   (str)   -- password to login to admin console</span>

<span class="sd">            hostname            (str)   -- Full hostname of the machine</span>

<span class="sd">            machine_username    (str)   -- username to access the machine</span>

<span class="sd">            machine_password    (str)   -- Password for accessing the machine</span>

<span class="sd">            group_name          (str)   -- Name for the VM group</span>

<span class="sd">            virtual_machines    (list)  -- List of vms to select</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># To login to admin console</span>
        <span class="n">login</span> <span class="o">=</span> <span class="n">LoginPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="c1"># To navigate to admin console URL</span>
        <span class="n">login</span><span class="o">.</span><span class="n">navigate</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="n">login</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">commcell_username</span><span class="p">,</span> <span class="n">commcell_password</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">virtualization</span> <span class="o">=</span> <span class="n">Virtualization</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getting_started</span> <span class="o">=</span> <span class="n">GettingStarted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="c1"># To track backup job</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">Jobs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="c1"># To navigate to the virtualization page of the admin console</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getting_started</span><span class="o">.</span><span class="n">navigate_to_getting_started</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getting_started</span><span class="o">.</span><span class="n">click_complete_setup_for_solution</span><span class="p">(</span><span class="s1">&#39;Virtualization&#39;</span><span class="p">)</span>

        <span class="c1"># To add a new hypervisor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtualization</span><span class="o">.</span><span class="n">add_hypervisor</span><span class="p">(</span>
            <span class="n">hostname</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span>
            <span class="n">hypervisor_name</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="n">machine_username</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">machine_password</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully added new hypervisor </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">hostname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtualization</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">()</span>

        <span class="c1"># To add a new VM group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtualization</span><span class="o">.</span><span class="n">add_vm_group</span><span class="p">(</span>
            <span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span><span class="p">,</span>
            <span class="n">virtual_machines</span><span class="o">=</span><span class="n">virtual_machines</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully added new VM group </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">group_name</span><span class="p">)</span>

        <span class="c1"># To run first backup job</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtualization</span><span class="o">.</span><span class="n">run_backup</span><span class="p">()</span>

        <span class="c1"># To refresh the page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtualization</span><span class="o">.</span><span class="n">refresh_page</span><span class="p">()</span>

        <span class="c1"># To get the Job ID from the page</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//h1[@class=&quot;page-title ng-binding&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="n">Jobs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">jobs</span><span class="o">.</span><span class="n">job_completion</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;Completed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Status&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;virtualization Backup failed&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;virtualization Backup failed&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Virtualization backup successful&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Virtualization configuration successful&#39;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>