

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MediaAgents.MAUtils.hyperscale_helper &mdash; Commvault Automation 11.23 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>MediaAgents.MAUtils.hyperscale_helper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for MediaAgents.MAUtils.hyperscale_helper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.machine</span> <span class="kn">import</span> <span class="n">Machine</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.database_helper</span> <span class="kn">import</span> <span class="n">MSSQL</span>
<span class="kn">from</span> <span class="nn">MediaAgents.mediaagentconstants</span> <span class="kn">import</span> <span class="n">HYPERSCALE_CONSTANTS</span>
<span class="kn">from</span> <span class="nn">VirtualServer.VSAUtils</span> <span class="kn">import</span> <span class="n">HypervisorHelper</span>


<div class="viewcode-block" id="HyperScaleHelper"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper">[docs]</a><span class="k">class</span> <span class="nc">HyperScaleHelper</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       Hyperscale helper library for DB based and REST based functionalities</span>

<span class="sd">       This file contains a class named hyperscale_helper that can be used to carry out</span>
<span class="sd">       all hyperscale related operations.</span>

<span class="sd">       The instance of this class can be used to perform various operations on a</span>
<span class="sd">       Hyperscale Storage Pool like:</span>

<span class="sd">       hyperscale_helper</span>
<span class="sd">       =================</span>

<span class="sd">       __init__                -- initialize object of the class</span>

<span class="sd">       execute_update_query    -- Executes update query on CSDB</span>

<span class="sd">       get_storage_pool_details -- Gets StoragePool Details from the MMSDSStoragePool table</span>

<span class="sd">       get_all_bricks          -- Gets flags, BrickHealth, BlockDeviceHealth and DeviceOsPath</span>
<span class="sd">           for all bricks associated with a storage pool for a particular MA</span>

<span class="sd">       get_all_bricks_for_hostid -- Gets flags, BrickHealth, BlockDeviceHealth and DeviceOsPath</span>
<span class="sd">           for all bricks associated with a particular MA</span>

<span class="sd">       get_brick_daemon_for_brick -- Check if brick daemon is present for the hyperscale brick</span>

<span class="sd">       get_all_nodes           -- Gets a list of MAs associated with a particular Storage Pool</span>

<span class="sd">       check_brick_health_status -- Checks the flag, blockdevicehealth and brickhealth</span>
<span class="sd">       values for all bricks for a given MA</span>

<span class="sd">       wait_for_completion     -- Check if hyperscale storage pool creation</span>
<span class="sd">       or expansion operation has completed or failed</span>

<span class="sd">       add_nodes               -- Add 3 more nodes to horizontally expand a setup by 1 block</span>

<span class="sd">       create_storage_pool     -- Create a hyperscale storage pool containing 3 nodes</span>

<span class="sd">       delete_storage_pool     -- Deletes a hyperscale storage pool</span>

<span class="sd">       get_associated_storage_policies -- Get a list of Storage Policies associated</span>
<span class="sd">       to a hyperscale Storage pool&#39;s GDSP</span>

<span class="sd">       check_if_storage_pool_is_present -- Check if s hyperscale storage pool is present or not</span>

<span class="sd">       get_associated_mas      -- Get all MAs associated with a hyperscale storage pool</span>

<span class="sd">       create_and_associate_plan -- Creates a plan that associates itself with a</span>
<span class="sd">       hyperscale storage pool&#39;s GDSP</span>

<span class="sd">       delete_plan             -- Deletes a hyperscale plan</span>

<span class="sd">       clean_up_ma             -- Cleans up all data disks and peer files from an MA</span>

<span class="sd">       reassociate_all_associated_subclients -- Reassociates all subclients associated</span>
<span class="sd">       with a storage policy to none assigned</span>

<span class="sd">       clean_up_storage_pool   -- Cleans up all entries left by a pre-existing storage pool</span>

<span class="sd">       check_brick_flag_status -- Check if the health status is proper for a particular</span>
<span class="sd">       MA&#39;s bricks or not</span>
<span class="sd">   &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commcell_obj</span><span class="p">,</span> <span class="n">csdb_obj</span><span class="p">,</span> <span class="n">log_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Initializes instance of the Machine class.</span>
<span class="sd">            Args:</span>

<span class="sd">            commcell_obj    (object)    --  instance of the Commcell</span>
<span class="sd">            csdb_obj        (object)    --  instance of the CSDB</span>
<span class="sd">            log_obj         (object)    --  instance of the Logger</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span> <span class="o">=</span> <span class="n">commcell_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span> <span class="o">=</span> <span class="n">csdb_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_pool_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_pools</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbobject</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commserve_instance</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">commvault&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">is_linux_commserv</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commserve_instance</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<div class="viewcode-block" id="HyperScaleHelper.connect"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_user</span><span class="p">,</span> <span class="n">db_password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connection to db</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbobject</span> <span class="o">=</span> <span class="n">MSSQL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">commserv_hostname</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">commserve_instance</span><span class="p">,</span>
                                  <span class="n">db_user</span><span class="p">,</span> <span class="n">db_password</span><span class="p">,</span> <span class="s2">&quot;CommServ&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception raised </span><span class="si">{}</span><span class="s2">, failed to connect to the Database with username </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">err</span><span class="p">,</span> <span class="n">db_user</span><span class="p">))</span></div>

<div class="viewcode-block" id="HyperScaleHelper.execute_update_query"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.execute_update_query">[docs]</a>    <span class="k">def</span> <span class="nf">execute_update_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">sql_login</span><span class="p">,</span> <span class="n">db_password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes update query on CSDB</span>
<span class="sd">        Args:</span>
<span class="sd">            query (str) -- update query that needs to be run on CSDB</span>
<span class="sd">            sql_login (str) --  Sql login user name</span>
<span class="sd">            db_password (str)   -- sa password for CSDB login</span>
<span class="sd">        Return:</span>
<span class="sd">            Response / exception</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbobject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">sql_login</span><span class="p">,</span> <span class="n">db_password</span><span class="p">)</span>

            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbobject</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;failed to execute query </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_storage_pool_details"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_storage_pool_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_storage_pool_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns Storage Pool details as a list</span>
<span class="sd">            Args:</span>
<span class="sd">                name (str) -- Storage Pool Name</span>
<span class="sd">            Return:</span>
<span class="sd">                storage_pool_details / Exception</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_pools</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_pools</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storage Pool Details </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">storage_pool_details</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">storage_pool_details</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_all_bricks"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_all_bricks">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_bricks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">host_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets flags, BrickHealth, BlockDeviceHealth and DeviceOsPath</span>
<span class="sd">            for all bricks associated with a storage pool for a particular MA</span>
<span class="sd">            Args:</span>
<span class="sd">               name(name) -- Storage Pool name</span>
<span class="sd">               host_id(name) -- Media agent id</span>
<span class="sd">            Return:</span>
<span class="sd">                rows -- List of bricks and their details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">storage_pool_properties</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">_storage_pool_properties</span>
        <span class="n">storage_pool_node_detail_list</span> <span class="o">=</span> <span class="n">storage_pool_properties</span><span class="p">[</span><span class="s2">&quot;storagePoolDetails&quot;</span><span class="p">][</span><span class="s2">&quot;storagePoolNodeDetailsList&quot;</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">brick_details</span> <span class="ow">in</span> <span class="n">storage_pool_node_detail_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">brick_details</span><span class="p">[</span><span class="s2">&quot;mediaAgent&quot;</span><span class="p">][</span><span class="s2">&quot;mediaAgentId&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">host_id</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brick_details</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Bricks for host_id </span><span class="si">%s</span><span class="s2"> are </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">host_id</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_all_bricks_for_hostid"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_all_bricks_for_hostid">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_bricks_for_hostid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets flags, BrickHealth, BlockDeviceHealth and DeviceOsPath for all bricks associated with a particular MA</span>
<span class="sd">            Args:</span>
<span class="sd">                hostid (int/str) -- Host ID of the MA</span>

<span class="sd">            Return:</span>
<span class="sd">                rows -- List of bricks and their details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;select flags,BrickHealth, BlockDeviceHealth, deviceospath, deviceId from mmdiskhwinfo where &quot;</span>
            <span class="s2">&quot;mountpathusagetype = 2 and hostid = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">hostid</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">rows</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_brick_daemon_for_brick"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_brick_daemon_for_brick">[docs]</a>    <span class="k">def</span> <span class="nf">get_brick_daemon_for_brick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">disk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Check if brick daemon is present for the hyperscale brick</span>
<span class="sd">           Args:</span>
<span class="sd">               media_agent (str) -- Name of the MA where the daemon is to be checked</span>
<span class="sd">               disk (string) -- Name of the hyperscale brick</span>

<span class="sd">           Return:</span>
<span class="sd">                String -- Console output</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># SSH to MA</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;ps -ef | grep </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">disk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_all_nodes"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_all_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets a list of MAs associated with a particular Storage Pool</span>
<span class="sd">            Args:</span>
<span class="sd">                storage_pool_name (str) -- Name of the Storage Pool</span>
<span class="sd">            Return:</span>
<span class="sd">                rows -- List of all MAs associated with the given Storage Pool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">storage_pool_properties</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">_storage_pool_properties</span>
        <span class="n">storage_pool_node_detail_list</span> <span class="o">=</span> <span class="n">storage_pool_properties</span><span class="p">[</span><span class="s1">&#39;storagePoolDetails&#39;</span><span class="p">][</span><span class="s1">&#39;storagePoolNodeDetailsList&#39;</span><span class="p">]</span>
        <span class="n">node_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">details</span> <span class="ow">in</span> <span class="n">storage_pool_node_detail_list</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;mediaAgent&#39;</span><span class="p">][</span><span class="s1">&#39;mediaAgentId&#39;</span><span class="p">],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;mediaAgent&#39;</span><span class="p">][</span><span class="s1">&#39;mediaAgentName&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">:</span>
                <span class="n">node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Node detils </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">node_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node_list</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_brick_health_status"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_brick_health_status">[docs]</a>    <span class="k">def</span> <span class="nf">check_brick_health_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Checks the flag, blockdevicehealth and brickhealth values for all bricks for a given MA</span>
<span class="sd">            Args:</span>
<span class="sd">                hostid (int) -- host id for the given MA</span>
<span class="sd">            Return:</span>
<span class="sd">                True / Exception</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bricks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_bricks_for_hostid</span><span class="p">(</span><span class="n">hostid</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">brick</span> <span class="ow">in</span> <span class="n">bricks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> Brick does not have the flag set to 1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">23</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> Brick does not have the BrickHealth set to 23&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">15</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> Brick does not have the BlockDeviceHealth set to 15&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flags, brickHealth and BlockDeviceHealth correctly set for </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_host_id"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_host_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_host_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ma_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns the hostid of the MA</span>
<span class="sd">            Args:</span>
<span class="sd">                ma_name (str) -- Name of the MA whose hostid is to be returned</span>
<span class="sd">            Return:</span>
<span class="sd">                hostid (int) -- host id for the given MA / Exception</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ma_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ma_name</span><span class="p">)</span>
        <span class="n">ma_id</span> <span class="o">=</span> <span class="n">ma_client</span><span class="o">.</span><span class="n">client_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Host id for ma: </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ma_name</span><span class="p">,</span> <span class="n">ma_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ma_id</span></div>

<div class="viewcode-block" id="HyperScaleHelper.wait_for_completion"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.wait_for_completion">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Check if hyperscale storage pool creation or expansion operation has completed or failed</span>

<span class="sd">            Args:</span>
<span class="sd">                storage_pool_name (str) -- Name of the storage pool</span>

<span class="sd">            Return:</span>
<span class="sd">                 Boolean -- True or False based on whether the storage pool creation succeeded or failed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">storage_pool_properties</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">_storage_pool_properties</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">storage_pool_properties</span><span class="p">[</span><span class="s2">&quot;storagePoolDetails&quot;</span><span class="p">][</span><span class="s1">&#39;statusCode&#39;</span><span class="p">]</span>

        <span class="k">while</span> <span class="nb">int</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
            <span class="n">storage_pool_properties</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">_storage_pool_properties</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">storage_pool_properties</span><span class="p">[</span><span class="s2">&quot;storagePoolDetails&quot;</span><span class="p">][</span><span class="s1">&#39;statusCode&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;status for pool </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">storage_pool_properties</span><span class="p">[</span><span class="s2">&quot;storagePoolDetails&quot;</span><span class="p">][</span><span class="s1">&#39;statusCode&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="o">==</span> <span class="mi">300</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storage Pool status </span><span class="si">%s</span><span class="s2"> not 300&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.add_nodes"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.add_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">add_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add 3 more nodes to horizontally expand a setup by 1 block</span>

<span class="sd">        Args:</span>
<span class="sd">            storage_pool_name (str) -- Name of the storage pool</span>
<span class="sd">            *args: Media agent names</span>
<span class="sd">                    ma1_name (str) -- Name of the first MA</span>
<span class="sd">                    ma2_name (str) -- Name of the second MA</span>
<span class="sd">                    ma3_name (str) -- Name of the third MA</span>

<span class="sd">        Return:</span>
<span class="sd">            flag (int) -- Response code received from the Rest API call</span>
<span class="sd">            response (str) -- Response received from the Rest API</span>
<span class="sd">            status (boolean) -- True or False based on the success or failure of the operation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;insufficient number of inputs </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;insufficient number of inputs </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">ma_values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">media_agents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>

        <span class="n">ma_ids</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_host_id</span><span class="p">(</span><span class="n">ma_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">ma_name</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Check if hosts present and flags = 0 not configured&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ma_id</span> <span class="ow">in</span> <span class="n">ma_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_brick_available_status</span><span class="p">(</span><span class="n">ma_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Brick status not available for creation&quot;</span><span class="p">)</span>
        <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">hyperscale_add_nodes</span><span class="p">(</span><span class="n">ma_values</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting CSDB to populate&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">900</span><span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">response</span></div>

<div class="viewcode-block" id="HyperScaleHelper.create_storage_pool"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.create_storage_pool">[docs]</a>    <span class="k">def</span> <span class="nf">create_storage_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Create a hyperscale storage pool containing 3 nodes</span>

<span class="sd">            Args:</span>
<span class="sd">                storage_pool_name (str) -- Name of the storage pool</span>
<span class="sd">               *args: Media agent names</span>
<span class="sd">                    ma1_name (str) -- Name of the first MA</span>
<span class="sd">                    ma2_name (str) -- Name of the second MA</span>
<span class="sd">                    ma3_name (str) -- Name of the third MA</span>

<span class="sd">            Return:</span>
<span class="sd">                flag (int) -- Response code received from the Rest API call</span>
<span class="sd">                response (str) -- Response received from the Rest API</span>
<span class="sd">                status (boolean) -- True or False based on the success or failure of the operation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">setup</span> <span class="o">=</span> <span class="s2">&quot;Standard&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;insufficient number of inputs </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;insufficient number of inputs </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="n">ma_values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">media_agents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="n">ma_ids</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_host_id</span><span class="p">(</span><span class="n">ma_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">ma_name</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Check if hosts present and flags = 0 not configured&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ma_id</span> <span class="ow">in</span> <span class="n">ma_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_brick_available_status</span><span class="p">(</span><span class="n">ma_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Brick status not available for creation&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">resiliency</span><span class="p">(</span><span class="n">ma_ids</span><span class="p">,</span> <span class="n">setup</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Resiliency not Correct&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Resiliency factor not correct or brick status not available&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_pools</span><span class="o">.</span><span class="n">hyperscale_create_storage_pool</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">,</span> <span class="n">ma_values</span><span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storage Pool status </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">response</span></div>

<div class="viewcode-block" id="HyperScaleHelper.delete_storage_pool"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.delete_storage_pool">[docs]</a>    <span class="k">def</span> <span class="nf">delete_storage_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes a hyperscale storage pool</span>
<span class="sd">        Args:</span>
<span class="sd">           storage_pool_name (str) -- name of the storage pool</span>

<span class="sd">        Return:</span>
<span class="sd">            flag (int) -- Response code received from the Rest API call</span>
<span class="sd">            response (str) -- Response received from the Rest API call</span>
<span class="sd">       &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_pools</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_associated_storage_policies"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_associated_storage_policies">[docs]</a>    <span class="k">def</span> <span class="nf">get_associated_storage_policies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Get a list of Storage Policies associated to a hyperscale Storage pool&#39;s GDSP</span>

<span class="sd">           Args:</span>
<span class="sd">               storage_pool_name (str) -- Name of the storage pool</span>

<span class="sd">           Return:</span>
<span class="sd">               rows (list) -- List of associated storage policies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">gdsp</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">storage_pool_id</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select name from archgroup where id in (select archgroupid from archgroupcopy where SIDBStoreId =  </span>
<span class="s2">                (select sidbstoreid from archGroupCopy where archgroupid  =  </span>
<span class="s2">                (select gdspid from MMSDSStoragePool where GDSPId = &#39;</span><span class="si">{0}</span><span class="s2">&#39;)))  </span>
<span class="s2">                and id &lt;&gt; (select gdspid from MMSDSStoragePool where GDSPId = &#39;</span><span class="si">{0}</span><span class="s2">&#39;)&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">gdsp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">rows</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_if_storage_pool_is_present"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_if_storage_pool_is_present">[docs]</a>    <span class="k">def</span> <span class="nf">check_if_storage_pool_is_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Check if s hyperscale storage pool is present or not</span>

<span class="sd">            Args:</span>
<span class="sd">                storage_pool_name (str) -- Name of the storage pool</span>

<span class="sd">            Return:</span>
<span class="sd">                 Boolean -- True or False based on whether the storage pool is present or not</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_pools</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_pools</span><span class="o">.</span><span class="n">has_storage_pool</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_associated_mas"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_associated_mas">[docs]</a>    <span class="k">def</span> <span class="nf">get_associated_mas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">               Get all MAs associated with a hyperscale storage pool</span>

<span class="sd">               Args:</span>
<span class="sd">                   storage_pool_name (str) -- Name of the storage pool</span>

<span class="sd">               Return:</span>
<span class="sd">                    rows (list) -- List of associated MAs</span>
<span class="sd">               &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_if_storage_pool_is_present</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">):</span>
            <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
            <span class="n">storage_pool_properties</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">_storage_pool_properties</span>
            <span class="n">storage_pool_node_detail_list</span> <span class="o">=</span> <span class="n">storage_pool_properties</span><span class="p">[</span><span class="s1">&#39;storagePoolDetails&#39;</span><span class="p">][</span>
                <span class="s1">&#39;storagePoolNodeDetailsList&#39;</span><span class="p">]</span>
            <span class="n">ma_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">details</span> <span class="ow">in</span> <span class="n">storage_pool_node_detail_list</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;mediaAgent&#39;</span><span class="p">][</span><span class="s1">&#39;mediaAgentName&#39;</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ma_list</span><span class="p">:</span>
                    <span class="n">ma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Node detils </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ma_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ma_list</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HyperScaleHelper.clean_up_ma"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.clean_up_ma">[docs]</a>    <span class="k">def</span> <span class="nf">clean_up_ma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ma1</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Cleans up all data disks and peer files from an MA</span>
<span class="sd">            Args:</span>
<span class="sd">                ma1 (str) -- Name of primary MA that is being cleaned up</span>
<span class="sd">                storage_pool_name(str) --&gt; Storage Pool name</span>
<span class="sd">            Return:</span>
<span class="sd">                Exception</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># SSH to MA1</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">ma1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred connecting to host </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Trying again&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Run echo &quot;y&quot; | gluster v stop storage_pool_name</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;echo </span><span class="se">\&quot;</span><span class="s2">y</span><span class="se">\&quot;</span><span class="s2"> | gluster v stop &quot;</span> <span class="o">+</span> <span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="c1"># Run echo &quot;y&quot; | gluster v delete storage_pool_name</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;echo </span><span class="se">\&quot;</span><span class="s2">y</span><span class="se">\&quot;</span><span class="s2"> | gluster v delete &quot;</span> <span class="o">+</span> <span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="c1"># Run for i in `lsblk | grep -i /ws/ | awk &#39;{print $7}&#39;` ; do rm -fr $i/* ; ls -l $i ; done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning all /ws/disk drives&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span>
            <span class="s2">&quot;for i in `lsblk | grep -i /ws/ | awk &#39;{print $7}&#39;` ; do rm -fr $i/* ; ls -l $i ; done&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="c1"># gluster peer detach sds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Detaching peers&quot;</span><span class="p">)</span>
        <span class="n">peers</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;gluster peer status | grep &#39;Hostname&#39; | awk &#39;{print $2}&#39;&quot;</span><span class="p">)</span>
        <span class="n">peers</span> <span class="o">=</span> <span class="n">peers</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">peers</span> <span class="o">=</span> <span class="n">peers</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">peers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">peer</span> <span class="ow">in</span> <span class="n">peers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Peer </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">peer</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;echo </span><span class="se">\&quot;</span><span class="s2">y</span><span class="se">\&quot;</span><span class="s2"> | gluster peer detach &quot;</span> <span class="o">+</span> <span class="n">peer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="c1"># cleaning fstab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning fstab entry&quot;</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">ma1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;sed -i &#39;/</span><span class="si">{0}</span><span class="s2">/d&#39; /etc/fstab&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="c1"># commvault restart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restarting MA services&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;commvault restart&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exception </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restarted Services&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.reassociate_all_associated_subclients"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.reassociate_all_associated_subclients">[docs]</a>    <span class="k">def</span> <span class="nf">reassociate_all_associated_subclients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">,</span> <span class="n">sql_login</span><span class="p">,</span> <span class="n">sql_sq_password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Reassociates all subclients associated with a storage policy to none assigned</span>
<span class="sd">            Args:</span>
<span class="sd">                storage_pool_name (str) -- Name of the Storage pool which is to be cleaned up</span>
<span class="sd">                sql_login       (str) -- SQL login name</span>
<span class="sd">                sql_sq_password (str) -- Password to log into the SQL server</span>
<span class="sd">            Return:</span>
<span class="sd">                Exception</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Find all associated storage policies with this GDSP</span>
        <span class="n">sstorage_policy_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_storage_policies</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Associated storage policies: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sstorage_policy_list</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">((</span><span class="n">sstorage_policy_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">])))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">sstorage_policy_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">storage_policy</span> <span class="ow">in</span> <span class="n">sstorage_policy_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">storage_policy_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_policies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">storage_policy</span><span class="p">)</span>

            <span class="c1"># update archgroupid = 1 for all associated subclients to sp.</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;update app_application </span>
<span class="s2">                            set dataArchGrpID = 1, logArchGrpID = 1 </span>
<span class="s2">                            where dataArchGrpID = </span><span class="si">{0}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">storage_policy_obj</span><span class="o">.</span><span class="n">storage_policy_id</span><span class="p">)</span>
            <span class="c1"># self.log.info(&quot;QUERY: %s&quot;, query)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute_update_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">sql_login</span><span class="p">,</span> <span class="n">sql_sq_password</span><span class="p">)</span>

            <span class="c1"># Delete associated storage policies with this GDSP</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_policies</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">storage_policy</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;failed to delete SP </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.clean_up_storage_pool"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.clean_up_storage_pool">[docs]</a>    <span class="k">def</span> <span class="nf">clean_up_storage_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">,</span> <span class="n">sql_login</span><span class="p">,</span> <span class="n">sql_sq_password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Cleans up all entries left by a pre-existing storage pool</span>
<span class="sd">            Args:</span>
<span class="sd">                storage_pool_name (str) -- Name of the Storage pool which is to be cleaned up</span>
<span class="sd">                sql_login (str)       --  SQL login name</span>
<span class="sd">                sql_sq_password (str) -- Password to log into the SQL server</span>
<span class="sd">            Return:</span>
<span class="sd">                Exception</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_if_storage_pool_is_present</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storage pool not present, aborting clean up&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">gluster_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_name_for_storage_pool</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">library_name</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">_storage_pool_properties</span><span class="p">[</span><span class="s1">&#39;storagePoolDetails&#39;</span><span class="p">][</span>
            <span class="s1">&#39;libraryList&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;library&#39;</span><span class="p">][</span><span class="s1">&#39;libraryName&#39;</span><span class="p">]</span>
        <span class="n">mas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_mas</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>

        <span class="c1"># Reassociate all associated subclients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reassociate_all_associated_subclients</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">,</span> <span class="n">sql_login</span><span class="p">,</span> <span class="n">sql_sq_password</span><span class="p">)</span>

        <span class="c1"># Delete Storage Pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_storage_pool</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>

        <span class="c1"># Delete Storage Target</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">_disk_libraries</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">disk_libraries</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">library_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to delete library </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>

        <span class="c1"># SSH to MA1</span>
        <span class="k">for</span> <span class="n">media_agent</span> <span class="ow">in</span> <span class="n">mas</span><span class="p">:</span>
            <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
            <span class="c1"># Unmounting glus mount point and removing folder</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;df -h | grep &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gluster_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;| awk &#39;{print $6}&#39;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;umount </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

            <span class="c1"># removing /ws/glus_</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing glus directory&quot;</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;for i in `ls /ws | grep -i glus | awk &#39;{print $1}&#39;` ; do rm -fr /ws/$i ; done&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">media_agent</span> <span class="ow">in</span> <span class="n">mas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_up_ma</span><span class="p">(</span><span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gluster_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_brick_flag_status"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_brick_flag_status">[docs]</a>    <span class="k">def</span> <span class="nf">check_brick_flag_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Check if the health status is proper for a particular MA&#39;s bricks or not</span>
<span class="sd">         Args:</span>
<span class="sd">            media_agent (str) -- Name of the MA</span>

<span class="sd">        Return:</span>
<span class="sd">            Boolean -- True if all daemons are active</span>
<span class="sd">            Exception if daemons are not active</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hostid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_host_id</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">hostid</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_brick_health_status</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hostid</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All brick daemons for </span><span class="si">{0}</span><span class="s2"> are active&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">media_agent</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not all brick daemons for </span><span class="si">{0}</span><span class="s2"> are active&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">media_agent</span><span class="p">))</span></div>

<div class="viewcode-block" id="HyperScaleHelper.reconfigure_storage_pool"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.reconfigure_storage_pool">[docs]</a>    <span class="k">def</span> <span class="nf">reconfigure_storage_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                   Checks device accessibility before reconfigure and trigger reconfigure</span>
<span class="sd">                   after completion checks pool status and validates pool and accessibility of devices</span>
<span class="sd">                   validation of pool done while checking accessibility</span>
<span class="sd">                    Args:</span>
<span class="sd">                       storage_pool_name (name) -- storage pool name</span>
<span class="sd">                    Return:</span>
<span class="sd">                        True / False</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking brick accessibility for pool </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_accessibility</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Brick Not Accessible&quot;</span>
        <span class="n">nodes_before</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_nodes_hostids</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">))</span>
        <span class="n">nodes_before</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Nodes use for pool creation </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">nodes_before</span><span class="p">)</span>

        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">hyperscale_reconfigure_storage_pool</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1700</span><span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">sp_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_storage</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">nodes_after</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_nodes_hostids</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">))</span>
        <span class="n">nodes_after</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Nodes after reconfigure pool </span><span class="si">%s</span><span class="s2"> are </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">storage_pool_name</span>
                      <span class="p">,</span> <span class="n">nodes_after</span><span class="p">)</span>
        <span class="n">nodes_status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">nodes_before</span> <span class="o">==</span> <span class="n">nodes_after</span><span class="p">:</span>
            <span class="n">nodes_status</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">device_accessible_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_accessibility</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">status</span> <span class="o">&amp;</span> <span class="n">device_accessible_status</span> <span class="o">&amp;</span> <span class="n">nodes_status</span> <span class="o">&amp;</span> <span class="n">sp_status</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">response</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_brick_available_status"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_brick_available_status">[docs]</a>    <span class="k">def</span> <span class="nf">check_brick_available_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Checks the flag values for all bricks for a given MA</span>
<span class="sd">            Args:</span>
<span class="sd">                hostid (int) -- host id for the given MA</span>
<span class="sd">            Return:</span>
<span class="sd">                True / Exception</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">not_configured</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bricks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_bricks_for_hostid</span><span class="p">(</span><span class="n">hostid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">brick</span> <span class="ow">in</span> <span class="n">bricks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Brick </span><span class="si">%s</span><span class="s2"> status;&quot;</span><span class="p">,</span> <span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="n">not_configured</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> Brick does not have the flag set to 0&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Brick </span><span class="si">%s</span><span class="s2"> is available and flag status </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">brick</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HyperScaleHelper.false_hosts"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.false_hosts">[docs]</a>    <span class="k">def</span> <span class="nf">false_hosts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ma1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Update host file with false hosts to break connectivity between</span>
<span class="sd">            th host and commserve</span>
<span class="sd">            Args:</span>
<span class="sd">                ma1(name) --&gt; Media Agent</span>
<span class="sd">            Return:</span>
<span class="sd">                Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ma1_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">ma1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating hosts, Storage pool failure &quot;</span>
                      <span class="s2">&quot;Updating Hosts with wrong details at </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="p">,</span> <span class="n">ma1</span><span class="p">)</span>
        <span class="n">ma1_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot; mkdir /root/false_hosts&quot;</span><span class="p">)</span>
        <span class="n">ma1_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot; mkdir /root/true_hosts&quot;</span><span class="p">)</span>
        <span class="n">ma1_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;cp -f /etc/hosts /root/true_hosts/hosts&quot;</span><span class="p">)</span>
        <span class="n">ma1_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;cp -f /etc/hosts /root/false_hosts/hosts&quot;</span><span class="p">)</span>
        <span class="n">ma1_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;sed -i -e &#39;s/^/#/&#39; /root/false_hosts/hosts&quot;</span><span class="p">)</span>
        <span class="c1"># Run cp -f /root/false_hosts/hosts /etc/hosts</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;cp -f /root/false_hosts/hosts /etc/hosts&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma1_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updated false host file&quot;</span><span class="p">)</span>
        <span class="n">ma1_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;rm -rf /root/false_hosts&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.true_hosts"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.true_hosts">[docs]</a>    <span class="k">def</span> <span class="nf">true_hosts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ma1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Update host file with true hosts to bring up the connectivity b/w</span>
<span class="sd">           host and cs, which was broken by false host</span>
<span class="sd">           Args:</span>
<span class="sd">               ma1(name) --&gt; Media Agent</span>
<span class="sd">           Return:</span>
<span class="sd">               Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ma1_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">ma1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating Hosts with correct details at </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="p">,</span> <span class="n">ma1</span><span class="p">)</span>

        <span class="n">command</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;cp -f /root/true_hosts/hosts /etc/hosts&quot;</span>
        <span class="c1"># Run cp -f /root/true_hosts/hosts /etc/hosts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma1_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updated correct host file&quot;</span><span class="p">)</span>
        <span class="n">ma1_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;rm -rf /root/true_hosts&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_resolution_error"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_resolution_error">[docs]</a>    <span class="k">def</span> <span class="nf">check_resolution_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Checks the flag, blockdevicehealth and brickhealth values for all bricks for a given MA</span>
<span class="sd">            Args:</span>
<span class="sd">                hostid (int) -- host id for the given MA</span>
<span class="sd">            Return:</span>
<span class="sd">                True / False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking Resolution error issue Flags,&quot;</span>
                      <span class="s2">&quot; brickHealth and BlockDeviceHealth set to 0 &quot;</span>
                      <span class="s2">&quot;after creation failure,resolution error&quot;</span><span class="p">)</span>
        <span class="n">bricks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_bricks_for_hostid</span><span class="p">(</span><span class="n">hostid</span><span class="p">)</span>
        <span class="n">not_configured</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">brick</span> <span class="ow">in</span> <span class="n">bricks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Brick </span><span class="si">%s</span><span class="s2"> status;&quot;</span><span class="p">,</span> <span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="n">not_configured</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="n">not_configured</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">!=</span> <span class="n">not_configured</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flags, brickHealth and BlockDeviceHealth are correctly set for </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;For brick: </span><span class="si">%s</span><span class="s2">  &quot;</span>
                              <span class="s2">&quot;Flag: </span><span class="si">%s</span><span class="s2">, brickHealth: </span><span class="si">%s</span><span class="s2"> and &quot;</span>
                              <span class="s2">&quot;BlockDeviceHealth: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">brick</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">brick</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">brick</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Resolution issue, Check hosts file&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_device_controller_details"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_device_controller_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_device_controller_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets the all device details for the storage pool</span>
<span class="sd">            Args:</span>
<span class="sd">                name(name) --&gt; storage pool name</span>
<span class="sd">            Return:</span>
<span class="sd">                devices details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_if_storage_pool_is_present</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">host_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_nodes_hostids</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">bricks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_bricks_for_hostid</span><span class="p">(</span><span class="n">host_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">device_id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">brick</span> <span class="ow">in</span> <span class="n">bricks</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">device_id</span> <span class="o">=</span> <span class="n">brick</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                    <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting all devices for pool </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from MMDeviceController where deviceId = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rows</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No device controller details for storage pool&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_library_details"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_library_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_library_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">library_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Gets the library details for the given library id</span>
<span class="sd">           Args:</span>
<span class="sd">               library_id (int) -- library id for given library</span>
<span class="sd">           Return:</span>
<span class="sd">               library details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting library details for id </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">library_id</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from MMLibrary as lib where lib.LibraryId = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">library_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">library_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">library_details</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No library with id </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">library_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Library Details  </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">library_details</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">library_details</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_library_mount"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_library_mount">[docs]</a>    <span class="k">def</span> <span class="nf">check_library_mount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">library_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Gets the library mount details, accessibility and controller</span>
<span class="sd">              for the given library id</span>
<span class="sd">             Args:</span>
<span class="sd">                 library_id (int) -- library id for given library</span>
<span class="sd">             Return:</span>
<span class="sd">                 library details</span>
<span class="sd">                 &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting library mount details, accessibility and controller &quot;</span>
                      <span class="s2">&quot;for the given library id </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">library_id</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select mmd.DeviceControllerEnabled, mmd.DeviceAccessible, mmd.Folder  </span>
<span class="s2">                from MMlibrary as lib, MMMountPath as mp, MMMountPathToStorageDevice as mps, </span>
<span class="s2">                 MMDeviceController as mmd  </span>
<span class="s2">                where lib.LibraryId = mp.LibraryId and mp.MountPathId = mps.MountPathId and </span>
<span class="s2">                 mps.DeviceId = mmd.DeviceId and lib.LibraryId = </span><span class="si">{0}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">library_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">mount_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mount Deatils </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mount_details</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mount_details</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_policy_details"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_policy_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_policy_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdspid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets the policy details for the given pool</span>
<span class="sd">            Args:</span>
<span class="sd">                gdspid (int) -- gdspid for the policy to be created</span>
<span class="sd">            Return:</span>
<span class="sd">                policy details</span>
<span class="sd">                    &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting Policy details for gdspid </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">gdspid</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from archGroup where id = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gdspid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">policy_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Policy Details &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">policy_details</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">policy_details</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_dedup_details"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_dedup_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_dedup_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets the dedup details for the given pool</span>
<span class="sd">                Args:</span>
<span class="sd">                    name --&gt; storage pool name</span>
<span class="sd">                Return:</span>
<span class="sd">                    dedup details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting dedup store details for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="n">details</span><span class="o">.</span><span class="n">_storage_pool_properties</span><span class="p">[</span><span class="s1">&#39;storagePoolDetails&#39;</span><span class="p">]</span>
        <span class="n">storage_pool_dedup</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="p">[</span><span class="s1">&#39;dedupDBDetailsList&#39;</span><span class="p">]</span>
        <span class="n">dedup_details</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">detail</span> <span class="ow">in</span> <span class="n">storage_pool_dedup</span><span class="p">:</span>
            <span class="n">dedup_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detail</span><span class="p">[</span><span class="s1">&#39;storeName&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dedup Details </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dedup_details</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dedup_details</span></div>

<div class="viewcode-block" id="HyperScaleHelper.validate_dedup_store"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.validate_dedup_store">[docs]</a>    <span class="k">def</span> <span class="nf">validate_dedup_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdspid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Validate dedup present on ma&#39;s or not</span>
<span class="sd">                Args:</span>
<span class="sd">                    gdspid (int) -- gdspid for the policy to be created</span>
<span class="sd">                Return:</span>
<span class="sd">                    dedup details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking ddb stores on ma</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select Distinct pt.IdxAccessPathId, pt.ClientId, pt.Path, client.name, pt.OfflineReason</span>
<span class="s2">                from APP_Client as client, IdxAccessPath as pt, IdxSIDBStore as idx, archGroup as arc,  </span>
<span class="s2">                MMSDSStoragePool as storage, archCopySIDBStore sidb, IdxSIDBSubStore as sub  </span>
<span class="s2">                where storage.GDSPId = arc.id and arc.defaultCopy = sidb.CopyId and  </span>
<span class="s2">                sidb.SIDBStoreId = sub.SIDBStoreId  and sub.IdxAccessPathId = pt.IdxAccessPathId</span>
<span class="s2">                and client.id = pt.ClientId</span>
<span class="s2">                and storage.GDSPId = </span><span class="si">{0}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">gdspid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dedup Partition details </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">details</span><span class="p">)</span>
        <span class="n">ma_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">details</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ma_dict</span><span class="p">:</span>
                <span class="n">ma_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ma_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">media_agent</span> <span class="ow">in</span> <span class="n">ma_dict</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">ma_dict</span><span class="p">[</span><span class="n">media_agent</span><span class="p">]</span>
            <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
            <span class="c1"># checking /ws/ddb mount on node or not</span>
            <span class="n">mount</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;df -h | grep &#39;/ws/ddb&#39; | awk &#39;{print $1}&#39;&quot;</span>
            <span class="n">mount_output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">mount</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mount_output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No mount path for /ws/ddb over </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No mount path /ws/ddb&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;/ws/ddb mount path </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">mount_output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
            <span class="c1"># Restart services to check ddb copy presence, idx file gets created then,</span>
            <span class="c1"># CS sends information and thread creates that</span>
            <span class="n">restart</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;commvault restart&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">restart</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exception </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restarted Services&quot;</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;cd &quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking presence of partition </span><span class="si">%s</span><span class="s2"> on ma </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>
                    <span class="c1"># raise Exception(&quot;Partition %s not present on ma&quot;, entry[2])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Present&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking Offline status&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;DDB partition </span><span class="si">%s</span><span class="s2"> offline with code </span><span class="si">%s</span><span class="s2"> on node </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                   <span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Online&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="HyperScaleHelper.validate_storage"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.validate_storage">[docs]</a>    <span class="k">def</span> <span class="nf">validate_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                   Validates the pool against library and policy</span>
<span class="sd">                   if policy present will have a dedup engine else no</span>
<span class="sd">                   Args:</span>
<span class="sd">                       name (str) -- Storage pool name</span>
<span class="sd">                   Return:</span>
<span class="sd">                       True/False</span>
<span class="sd">               &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking library state for pool </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">lib_id</span> <span class="o">=</span> <span class="n">details</span><span class="o">.</span><span class="n">_storage_pool_properties</span><span class="p">[</span>
            <span class="s1">&#39;storagePoolDetails&#39;</span><span class="p">][</span><span class="s1">&#39;libraryList&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;library&#39;</span><span class="p">][</span><span class="s1">&#39;libraryId&#39;</span><span class="p">]</span>
        <span class="c1"># lib_id = details[2]</span>
        <span class="n">gdspid</span> <span class="o">=</span> <span class="n">details</span><span class="o">.</span><span class="n">storage_pool_id</span>
        <span class="n">library_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_library_details</span><span class="p">(</span><span class="n">lib_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">library_details</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">library_details</span><span class="p">[</span><span class="mi">34</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">46003</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;library offline with error </span><span class="si">%s</span><span class="s2"> and creation incomplete for &quot;</span>
                          <span class="s2">&quot;pool </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">library_details</span><span class="p">[</span><span class="mi">34</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">mount_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_library_mount</span><span class="p">(</span><span class="n">lib_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mount_details</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No Mount path details for library </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">lib_id</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mount</span> <span class="ow">in</span> <span class="n">mount_details</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mount details </span><span class="si">%s</span><span class="s2">, Accessible </span><span class="si">%s</span><span class="s2">, DeviceEnabled </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mount</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">mount</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">mount</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">policy_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_policy_details</span><span class="p">(</span><span class="n">gdspid</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">policy_details</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Policy is not present, pool </span><span class="si">%s</span><span class="s2"> creation failed&quot;</span><span class="p">,</span>
                          <span class="n">name</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">policy_details</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">policy_details</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="o">!=</span> <span class="mi">256</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Not Global Policy for pool </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;policy </span><span class="si">%s</span><span class="s2"> is Global Policy for pool </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">policy_details</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">dedup_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dedup_details</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dedup_details</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No dedup store present for </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_dedup_store</span><span class="p">(</span><span class="n">gdspid</span><span class="p">):</span>
            <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Library </span><span class="si">%s</span><span class="s2"> and Global policy </span><span class="si">%s</span><span class="s2"> and dedup store </span><span class="si">%s</span><span class="s2">&quot;</span>
                          <span class="s2">&quot;up and present for pool </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span>
                          <span class="n">library_details</span><span class="p">,</span> <span class="n">policy_details</span><span class="p">,</span> <span class="n">dedup_details</span><span class="p">,</span>
                          <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storage pool </span><span class="si">%s</span><span class="s2"> created and up&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="HyperScaleHelper.brick_accessibility"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.brick_accessibility">[docs]</a>    <span class="k">def</span> <span class="nf">brick_accessibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                   Check if bricks are accessible for pool creation</span>
<span class="sd">                   Args:</span>
<span class="sd">                       name (str) -- Storage pool name</span>
<span class="sd">                   Return:</span>
<span class="sd">                       library details</span>
<span class="sd">               &quot;&quot;&quot;</span>

        <span class="n">devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_device_controller_details</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Node </span><span class="si">%s</span><span class="s2"> with Device id </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Node </span><span class="si">%s</span><span class="s2"> not accessible&quot;</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Node </span><span class="si">%s</span><span class="s2"> accessible for creation&quot;</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HyperScaleHelper.resiliency"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.resiliency">[docs]</a>    <span class="k">def</span> <span class="nf">resiliency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ma_list</span><span class="p">,</span> <span class="n">setup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine resiliency factor for the storage pool is correct or not at the time</span>
<span class="sd">        of creation</span>
<span class="sd">        Args:</span>
<span class="sd">            ma_list(list) --&gt; List of media agent used</span>
<span class="sd">            setup(name) --&gt; Type of setup (Standard/ Medium/ High)</span>
<span class="sd">        Return:</span>
<span class="sd">            True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Determining Resiliency&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">setup</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;standard&quot;</span><span class="p">:</span>
            <span class="n">scale_out</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Standard configuration, 3 nodes&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">setup</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;medium&quot;</span><span class="p">:</span>
            <span class="n">scale_out</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Medium configuration, 6 nodes&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">setup</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;high&quot;</span><span class="p">:</span>
            <span class="n">scale_out</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;High configuration, 6 nodes&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Setup configuration not present&quot;</span><span class="p">)</span>

        <span class="n">count</span><span class="p">,</span> <span class="n">min_used</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
        <span class="n">node_bricks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">media_agent</span> <span class="ow">in</span> <span class="n">ma_list</span><span class="p">:</span>
            <span class="n">bricks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_bricks_for_hostid</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
            <span class="n">node_bricks</span><span class="p">[</span><span class="n">media_agent</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bricks</span><span class="p">)</span>
            <span class="n">req</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bricks</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">req</span> <span class="o">&lt;=</span> <span class="n">min_used</span><span class="p">:</span>
                <span class="n">min_used</span> <span class="o">=</span> <span class="n">req</span>
        <span class="n">node_bricks_sort</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">node_bricks</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Bricks on nodes are </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">node_bricks_sort</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">min_used</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Disk number not correct for node </span><span class="si">%s</span><span class="s2">, minimum required are&quot;</span>
                           <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">node_bricks_sort</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">min_used</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">node_bricks_sort</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_used</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Disk number not correct for node </span><span class="si">%s</span><span class="s2">, minimum required are&quot;</span>
                           <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">node_bricks_sort</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">min_used</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ma_list</span><span class="p">)</span> <span class="o">*</span> <span class="n">min_used</span>
        <span class="k">if</span> <span class="n">scale_out</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Standard for 3 Nodes, Disperse Factor 6, Redundancy Factor 2.&quot;</span>
                          <span class="s2">&quot;Withstands loss of 2 drives or 1 node&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">scale_out</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Medium for 6 Nodes, Disperse Factor 6, Redundancy Factor 2. &quot;</span>
                          <span class="s2">&quot;Withstands loss of 2 drives or 2 nodes&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">scale_out</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;High for 6 Nodes, Disperse Factor 12, Redundancy Factor 4.&quot;</span>
                          <span class="s2">&quot; Withstands loss of 4 drives or 2 nodes&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_all_nodes_hostids"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_all_nodes_hostids">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_nodes_hostids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets a list of MA ids associated with a particular Storage Pool</span>
<span class="sd">            Args:</span>
<span class="sd">                storage_pool_name (str) -- Name of the Storage Pool</span>
<span class="sd">            Return:</span>
<span class="sd">                rows -- List of all MA ids associated with the given Storage Pool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">storage_pool_properties</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">_storage_pool_properties</span>
        <span class="n">storage_pool_node_detail_list</span> <span class="o">=</span> <span class="n">storage_pool_properties</span><span class="p">[</span><span class="s1">&#39;storagePoolDetails&#39;</span><span class="p">][</span><span class="s1">&#39;storagePoolNodeDetailsList&#39;</span><span class="p">]</span>
        <span class="n">node_id_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">details</span> <span class="ow">in</span> <span class="n">storage_pool_node_detail_list</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;mediaAgent&#39;</span><span class="p">][</span><span class="s1">&#39;mediaAgentId&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_id_list</span><span class="p">:</span>
                <span class="n">node_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;host ids </span><span class="si">%s</span><span class="s2"> for pool </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">node_id_list</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node_id_list</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_disk_uuid"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_disk_uuid">[docs]</a>    <span class="k">def</span> <span class="nf">get_disk_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mas</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get disk uuid information present on all the mas</span>
<span class="sd">        Args:</span>
<span class="sd">            mas(list) --&gt; list of Media Agents</span>
<span class="sd">        Return:</span>
<span class="sd">            Dictionary of data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;getting uuid information&quot;</span><span class="p">)</span>
        <span class="n">command1</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;lsblk | grep -i /ws/disk | awk &#39;{print $1,$7}&#39;&quot;</span>
        <span class="c1"># sdb | awk &#39;{print $2}&#39;&quot;</span>
        <span class="n">ma_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">media_agent</span> <span class="ow">in</span> <span class="n">mas</span><span class="p">:</span>
            <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;UUID&#39;s of disks for </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command1</span><span class="p">)</span>
            <span class="n">output1</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command1</span><span class="p">)</span>
            <span class="n">disks</span> <span class="o">=</span> <span class="n">output1</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">disks</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">disks</span><span class="p">)</span>
            <span class="n">hostid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_host_id</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">disks</span><span class="p">:</span>
                <span class="n">command2</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;blkid | grep -i &quot;</span>
                <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">disk</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">command2</span> <span class="o">=</span> <span class="n">command2</span> <span class="o">+</span> <span class="n">data1</span> <span class="o">+</span> <span class="s2">&quot; | awk &#39;{print $2}&#39;&quot;</span>
                <span class="c1"># self.log.info(&quot;UUID for %s is&quot;, disk)</span>
                <span class="n">output2</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command2</span><span class="p">)</span>
                <span class="n">uuid</span> <span class="o">=</span> <span class="n">output2</span><span class="o">.</span><span class="n">output</span>
                <span class="c1"># self.log.info(output2.output)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">media_agent</span> <span class="o">+</span> <span class="s2">&quot;sds:&quot;</span> <span class="o">+</span> <span class="n">data2</span> <span class="o">+</span> <span class="s2">&quot;/ws_brick&quot;</span>
                <span class="n">ma_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">media_agent</span><span class="p">,</span> <span class="n">data1</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">data2</span><span class="p">,</span> <span class="n">hostid</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ma_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">ma_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ma_dict</span></div>

<div class="viewcode-block" id="HyperScaleHelper.gluster_brick_information"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.gluster_brick_information">[docs]</a>    <span class="k">def</span> <span class="nf">gluster_brick_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get bricks for the gluster</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent(name)  --&gt; Media Agent</span>
<span class="sd">        Return:</span>
<span class="sd">            list of bricks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;getting disk information for gluster&quot;</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command2</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;gluster v info | grep -i &#39;sds&#39; | awk &#39;{print $2}&#39;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command2</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">output1</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output1</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output1</span><span class="o">.</span><span class="n">output</span> <span class="ow">is</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;no gluster on node </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No Gluster information present on ma&quot;</span><span class="p">)</span>
        <span class="n">bricks</span> <span class="o">=</span> <span class="n">output1</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">bricks</span> <span class="o">=</span> <span class="n">bricks</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">bricks</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">bricks</span></div>

<div class="viewcode-block" id="HyperScaleHelper.verify_gluster_disk_uuids"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.verify_gluster_disk_uuids">[docs]</a>    <span class="k">def</span> <span class="nf">verify_gluster_disk_uuids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">ma_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify if same disks were used for gluster creation or not,</span>
<span class="sd">        disks which were present on each node and bricks after gluster creation</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent(name) --&gt; Media Agent (for gluster information)</span>
<span class="sd">            ma_dict(dictionary) --&gt; output of get_disk_uuid ( before creation)</span>
<span class="sd">        Return:</span>
<span class="sd">            True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;getting disk uuids for Gluster&quot;</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;gluster v info | grep -i &#39;auth.allow:&#39; | awk &#39;{print $2}&#39;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;sds&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">gluster_disk_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_disk_uuid</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">bricks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_brick_information</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">brick</span> <span class="ow">in</span> <span class="n">bricks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gluster_disk_ids</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ma_dict</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="n">gluster_disk_ids</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ma_dict</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;For node </span><span class="si">%s</span><span class="s2">, uuid are different </span><span class="si">%s</span><span class="s2"> != </span><span class="si">%s</span><span class="s2"> or disk name different </span><span class="si">%s</span><span class="s2"> != </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                              <span class="n">gluster_disk_ids</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">gluster_disk_ids</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                              <span class="n">ma_dict</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">gluster_disk_ids</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">ma_dict</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Ids same for </span><span class="si">%s</span><span class="s2"> or </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> equals </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">gluster_disk_ids</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                          <span class="n">gluster_disk_ids</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                          <span class="n">gluster_disk_ids</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">ma_dict</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;brick ids checked and are same for gluster and node disk used&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="HyperScaleHelper.gluster_healthy_brick_status"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.gluster_healthy_brick_status">[docs]</a>    <span class="k">def</span> <span class="nf">gluster_healthy_brick_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host_id</span><span class="p">,</span> <span class="n">device_os</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check gluster brick healthy or not from brick information</span>
<span class="sd">        Args:</span>
<span class="sd">            host_id(name) --&gt; Client id for Media Agent</span>
<span class="sd">            device_os(name) --&gt; path for brick</span>
<span class="sd">        Return:</span>
<span class="sd">            True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">brick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_brick_info</span><span class="p">(</span><span class="n">host_id</span><span class="p">,</span> <span class="n">device_os</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> Brick does not have the flag set to 1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">23</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> Brick does not have the BrickHealth set to 23&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">15</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> Brick does not have the BlockDeviceHealth set to 15&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flags, brickHealth and BlockDeviceHealth correctly set for </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HyperScaleHelper.gluster_disk_health"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.gluster_disk_health">[docs]</a>    <span class="k">def</span> <span class="nf">gluster_disk_health</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mas</span><span class="p">,</span> <span class="n">ma_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify if all the bricks are healthy for the gluster</span>
<span class="sd">        or not.</span>
<span class="sd">        Args:</span>
<span class="sd">            mas(list) --&gt; list of media agents</span>
<span class="sd">             ma_dict(dictionary) --&gt; output of get_disk_uuid ( before creation)</span>
<span class="sd">        Return:</span>
<span class="sd">            True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bricks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_brick_information</span><span class="p">(</span><span class="n">mas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">brick</span> <span class="ow">in</span> <span class="n">bricks</span><span class="p">:</span>
            <span class="n">host_id</span> <span class="o">=</span> <span class="n">ma_dict</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">disk</span> <span class="o">=</span> <span class="n">ma_dict</span><span class="p">[</span><span class="n">brick</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Host id </span><span class="si">%s</span><span class="s2"> and disk </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">host_id</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_healthy_brick_status</span><span class="p">(</span><span class="n">host_id</span><span class="p">,</span> <span class="n">disk</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Flags, brickHealth and BlockDeviceHealth bad for </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                               <span class="n">host_id</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HyperScaleHelper.update_storage_policy"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.update_storage_policy">[docs]</a>    <span class="k">def</span> <span class="nf">update_storage_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">rename</span><span class="p">,</span> <span class="n">sql_login</span><span class="p">,</span> <span class="n">sql_sa_password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updating storage policy name for the given storage pool</span>
<span class="sd">        Args:</span>
<span class="sd">            name(name) --&gt; Storage Pool Name</span>
<span class="sd">            rename(name) --&gt; New name for Storage Pool</span>
<span class="sd">            sql_login(name) --&gt; SQL login username</span>
<span class="sd">            sql_sa_password(name) --&gt; SQL login password</span>
<span class="sd">        Return:</span>
<span class="sd">            New name for Storage Pool Policy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating GDSP for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">gdspid</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">storage_pool_id</span>
        <span class="c1"># rename = &quot;rename &quot; + name</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;update archGroup  </span>
<span class="s2">                set name = &#39;</span><span class="si">{0}</span><span class="s2">&#39; </span>
<span class="s2">                where id = </span><span class="si">{1}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rename</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">gdspid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_update_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">sql_login</span><span class="p">,</span> <span class="n">sql_sa_password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_pools</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">rename</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_hostname"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_hostname">[docs]</a>    <span class="k">def</span> <span class="nf">get_hostname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get hostname for the hostid</span>
<span class="sd">        Args:</span>
<span class="sd">            host_id (int) -- hostid</span>
<span class="sd">        Return:</span>
<span class="sd">            hostname</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting hostname for id </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">host_id</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot; select net_hostname from App_Client where id = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">host_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">hostname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;For id </span><span class="si">%s</span><span class="s2">, hostname is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">host_id</span><span class="p">,</span> <span class="n">hostname</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">hostname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="HyperScaleHelper.gluster_vol_info"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.gluster_vol_info">[docs]</a>    <span class="k">def</span> <span class="nf">gluster_vol_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getting gluster volume information form node</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent (name) -- node</span>
<span class="sd">        Return:</span>
<span class="sd">            Volume information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;getting volume information&quot;</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;df -h | grep &#39;/ws/glus&#39;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="n">glus_info</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Glus info </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">glus_info</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">glus_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No gluster /ws/glus present on node </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_new_gluster_volume_size"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_new_gluster_volume_size">[docs]</a>    <span class="k">def</span> <span class="nf">check_new_gluster_volume_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checking gluster volume permissible size</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent (name) -- host</span>
<span class="sd">        Return:</span>
<span class="sd">            True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">glus_metadata_factor</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># percentage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verifying gluster volume size against glus_metadata_factor </span><span class="si">%s</span><span class="s2"> (percentage)&quot;</span><span class="p">,</span>
                      <span class="n">glus_metadata_factor</span><span class="p">)</span>
        <span class="n">glus_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_vol_info</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
        <span class="n">total_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">glus_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">metadata_used</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">glus_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">permissible_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_size</span> <span class="o">*</span> <span class="n">glus_metadata_factor</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Total size of gluster </span><span class="si">%s</span><span class="s2"> and metadata used </span><span class="si">%s</span><span class="s2"> and permissible is </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="p">,</span> <span class="n">total_size</span><span class="p">,</span> <span class="n">metadata_used</span><span class="p">,</span> <span class="n">permissible_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metadata_used</span> <span class="o">&lt;=</span> <span class="n">permissible_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Gluster size permissible for node </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Gluster size not permissible for node </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.node_brick_info"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.node_brick_info">[docs]</a>    <span class="k">def</span> <span class="nf">node_brick_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host_id</span><span class="p">,</span> <span class="n">device_os</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get information for the brick present on the node</span>
<span class="sd">        Args:</span>
<span class="sd">            host_id(name) --&gt; Clint id for the Media Agent</span>
<span class="sd">            device_os(name) --&gt; path for the brick</span>
<span class="sd">        Return:</span>
<span class="sd">            Brick information if present (list)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select flags,BrickHealth, BlockDeviceHealth, deviceospath, diskId, deviceId from mmdiskhwinfo where </span>
<span class="s2">                mountpathusagetype = 2 and hostid = </span><span class="si">{0}</span><span class="s2"> and deviceOSPath = &#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">host_id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">device_os</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">brick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Brick </span><span class="si">%s</span><span class="s2"> not present on node </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">device_os</span><span class="p">,</span> <span class="n">host_id</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Brick not present on node&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Brick </span><span class="si">%s</span><span class="s2"> present on node </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">brick</span><span class="p">,</span> <span class="n">host_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">brick</span></div>

<div class="viewcode-block" id="HyperScaleHelper.gluster_single_brick_info"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.gluster_single_brick_info">[docs]</a>    <span class="k">def</span> <span class="nf">gluster_single_brick_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">brick</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get brick information for the gluster if it is part of the gluster or not</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent(name) --&gt; Media Agent</span>
<span class="sd">            pool(name) --&gt; Storage Pool name</span>
<span class="sd">            brick(name) --&gt; brick name</span>
<span class="sd">        Return:</span>
<span class="sd">            Brick information which is part of gluster (list)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checing brick </span><span class="si">%s</span><span class="s2"> part of gluster or not&quot;</span><span class="p">,</span> <span class="n">brick</span><span class="p">)</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_name_for_storage_pool</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">search</span> <span class="o">=</span> <span class="n">media_agent</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;sds:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">brick</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;gluster v status &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; | grep &#39;&quot;</span> <span class="o">+</span> <span class="n">search</span> <span class="o">+</span> <span class="s2">&quot;&#39;| awk &#39;{print $1,$2,$5,$6}&#39;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;brick </span><span class="si">%s</span><span class="s2"> not part of gluster </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">brick</span><span class="p">,</span> <span class="n">pool</span><span class="p">)</span>
            <span class="c1"># raise Exception(&quot;Brick not part of gluster&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">brick_info</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">brick_info</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">brick_info</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;gluster v status &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; | grep &#39;&quot;</span> <span class="o">+</span> <span class="n">search</span> <span class="o">+</span> <span class="s2">&quot;&#39; -A 1 | awk &#39;{print $1,$2,$4,$5}&#39;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">brick_output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">brick_output</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">brick_output</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">brick_output</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">brick_info</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">brick_output</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">brick_output</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">brick_output</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">brick_output</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Brick part of gluster </span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2">Brick information </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">brick_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">brick_info</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_gluster_brick_online"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_gluster_brick_online">[docs]</a>    <span class="k">def</span> <span class="nf">check_gluster_brick_online</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">brick</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Verify disk part of gluster or not and online or not</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) --&gt; Media Agent of pool</span>
<span class="sd">                pool(name) --&gt; storage pool name</span>
<span class="sd">                brick(name) --&gt; brick to be verified</span>
<span class="sd">            Return:</span>
<span class="sd">                 True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gluster_brick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_single_brick_info</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">brick</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gluster_brick</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">gluster_brick</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Brick </span><span class="si">%s</span><span class="s2"> online </span><span class="si">%s</span><span class="s2"> for gluster </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">brick</span><span class="p">,</span>
                              <span class="n">gluster_brick</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pool</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Brick </span><span class="si">%s</span><span class="s2"> not online for gluster </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">brick</span><span class="p">,</span> <span class="n">pool</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.brick_flag_status"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.brick_flag_status">[docs]</a>    <span class="k">def</span> <span class="nf">brick_flag_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostid</span><span class="p">,</span> <span class="n">device_os</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get flag information for the brick and identify over the flag</span>
<span class="sd">       Args:</span>
<span class="sd">           hostid(name) --&gt; Clint id for the Media Agent</span>
<span class="sd">           device_os(name) --&gt; path for the brick</span>
<span class="sd">       Return:</span>
<span class="sd">          Flag value</span>
<span class="sd">               &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking Flag status for brick&quot;</span><span class="p">)</span>
        <span class="n">brick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_brick_info</span><span class="p">(</span><span class="n">hostid</span><span class="p">,</span> <span class="n">device_os</span><span class="p">)</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">brick</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flag </span><span class="si">%s</span><span class="s2"> Brick </span><span class="si">%s</span><span class="s2"> not configured for host </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">device_os</span><span class="p">,</span> <span class="n">hostid</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;brick not configured&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flag </span><span class="si">%s</span><span class="s2"> Brick </span><span class="si">%s</span><span class="s2"> configured for host </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">device_os</span><span class="p">,</span> <span class="n">hostid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flag </span><span class="si">%s</span><span class="s2"> Replace initiated for</span><span class="se">\t</span><span class="s2"> Brick </span><span class="si">%s</span><span class="s2"> configured for host </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">device_os</span><span class="p">,</span> <span class="n">hostid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flag </span><span class="si">%s</span><span class="s2"> Replace submitted for</span><span class="se">\t</span><span class="s2"> Brick </span><span class="si">%s</span><span class="s2"> configured for host </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">device_os</span><span class="p">,</span> <span class="n">hostid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flag </span><span class="si">%s</span><span class="s2"> Replace Failed for </span><span class="se">\t</span><span class="s2"> Brick </span><span class="si">%s</span><span class="s2"> configured for host </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">device_os</span><span class="p">,</span> <span class="n">hostid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flag </span><span class="si">%s</span><span class="s2"> Brick missing in health update, broken or offline for </span><span class="se">\t</span><span class="s2">&quot;</span>
                          <span class="s2">&quot;Brick </span><span class="si">%s</span><span class="s2"> configured for host </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">device_os</span><span class="p">,</span> <span class="n">hostid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flag value </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flag</span></div>

<div class="viewcode-block" id="HyperScaleHelper.replace_brick"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.replace_brick">[docs]</a>    <span class="k">def</span> <span class="nf">replace_brick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span> <span class="n">pool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Trigger disk replacement</span>
<span class="sd">                        Args:</span>
<span class="sd">                           pool (name) -- storage_pool_name</span>
<span class="sd">                           media_agent (name) -- media_agent</span>
<span class="sd">                           brick_id (int) -- diskId</span>
<span class="sd">                        Return:</span>
<span class="sd">                            status, response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Triggering Disk replacement over node </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;on brick </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">)</span>

        <span class="n">storage_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>

        <span class="n">storage_details</span><span class="o">.</span><span class="n">hyperscale_replace_disk</span><span class="p">(</span><span class="n">brick_id</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">pool</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_disk_by_disk_id</span><span class="p">(</span><span class="n">brick_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_pools</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flag</span><span class="p">,</span> <span class="n">response</span></div>

<div class="viewcode-block" id="HyperScaleHelper.replace_log_status"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.replace_log_status">[docs]</a>    <span class="k">def</span> <span class="nf">replace_log_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getting log details for replace brick</span>
<span class="sd">        flag = 0 no log lines,</span>
<span class="sd">        flag = 1 Replace Failure</span>
<span class="sd">        flag = 2 Replace Success</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting Replace status response from node </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
        <span class="n">version_info</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="n">service_pack</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">service_pack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Version information </span><span class="si">%s</span><span class="s2">, Service Pack information </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">version_info</span><span class="p">,</span> <span class="n">service_pack</span><span class="p">)</span>
        <span class="n">sp_info</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">service_pack</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Service Pack info </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sp_info</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;gluster v status | grep &#39;Status of volume:&#39; | awk &#39;{print $4}&#39;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">gluster_name</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># command_fail = &#39;bzgrep &quot;CVMAWorker::ProcessGlusterFSReplaceActionOperation&quot;&#39; \</span>
        <span class="c1">#                &#39; /var/log/commvault/Log_Files/CVMA.log | tail -4 | grep &quot;Replace brick failure&quot;&#39;</span>
        <span class="n">command_fail</span> <span class="o">=</span> <span class="s1">&#39;bzgrep &quot;CVMAGlusStoragePool::ReplaceDisk&quot; &#39;</span> \
                       <span class="s1">&#39;/var/log/commvault/Log_Files/CVMA.log | tail -8&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command_fail</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command_fail</span><span class="p">)</span>
        <span class="n">log_line</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_line</span> <span class="o">=</span> <span class="n">log_line</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_line</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log_line</span><span class="p">)):</span>
            <span class="n">log_line</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_line</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="k">if</span> <span class="s2">&quot;Replace brick failure&quot;</span> <span class="ow">in</span> <span class="n">log_line</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="s2">&quot;Reset brick failure&quot;</span> <span class="ow">in</span> <span class="n">log_line</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">sp_info</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">log_line</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="c1"># command_success = &#39;bzgrep &quot;CVMAWorker::ProcessGlusterFSReplaceActionOperation&quot;&#39; \</span>
        <span class="c1">#                   &#39; /var/log/commvault/Log_Files/CVMA.log | tail -4 |  grep &quot;Replace Success&quot;&#39;</span>

        <span class="n">command_success</span> <span class="o">=</span> <span class="s1">&#39;bzgrep &quot;CVMAGlusStoragePool::ReplaceDisk &quot;&#39;</span> \
                          <span class="s1">&#39; /var/log/commvault/Log_Files/CVMA.log | tail -7&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command_success</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command_success</span><span class="p">)</span>
        <span class="n">log_line</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_line</span> <span class="o">=</span> <span class="n">log_line</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_line</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log_line</span><span class="p">)):</span>
            <span class="n">log_line</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_line</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="k">if</span> <span class="s2">&quot;Replace Success&quot;</span> <span class="ow">in</span> <span class="n">log_line</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">sp_info</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="s2">&quot;Reset Success&quot;</span> <span class="ow">in</span> <span class="n">log_line</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">sp_info</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">log_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cannot grab success or failure status and logs&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HyperScaleHelper.replace_brick_available"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.replace_brick_available">[docs]</a>    <span class="k">def</span> <span class="nf">replace_brick_available</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Disk present for replace or not</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) -- Node/media agent</span>
<span class="sd">            Return:</span>
<span class="sd">                True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking raw disk availability or not &quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;bzgrep &quot;CVMAGlusStoragePool::ReplaceDisk&quot; &#39;</span> \
                  <span class="sa">r</span><span class="s1">&#39;/var/log/commvault/Log_Files/CVMA.log | tail -4 | &#39;</span> \
                  <span class="sa">r</span><span class="s1">&#39;grep &quot; Replace brick failure, not able to find replacing brick&quot;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">log_line</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_line</span> <span class="o">=</span> <span class="n">log_line</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_line</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log_line</span><span class="p">)):</span>
                <span class="n">log_line</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_line</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">log_line</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disk available for replacement&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_disk_by_disk_id"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_disk_by_disk_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_disk_by_disk_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disk_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get disk information for the given disk Id</span>
<span class="sd">        Args:</span>
<span class="sd">            disk_id(name) --&gt; Disk Id for the disk</span>
<span class="sd">        Return:</span>
<span class="sd">            disk information (list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting brick information for diskId </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">disk_id</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select flags,BrickHealth, BlockDeviceHealth, deviceospath, hostId, deviceId from mmdiskhwinfo where  </span>
<span class="s2">                mountpathusagetype = 2 and diskId = </span><span class="si">{0}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">disk_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row</span></div>

<div class="viewcode-block" id="HyperScaleHelper.heal_disk_entry"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.heal_disk_entry">[docs]</a>    <span class="k">def</span> <span class="nf">heal_disk_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if disk replaced is healed or not, entry present in the directory</span>
<span class="sd">        /opt/commvault/iDataAgent/jobResults/ScaleOut/ReplaceBricksFile</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent(name) --&gt; media Agent on which replace carried out</span>
<span class="sd">            new_path(name) --&gt; disk path</span>
<span class="sd">        Return:</span>
<span class="sd">            True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking entry </span><span class="si">%s</span><span class="s2"> for disk heal&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;bzgrep &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; /opt/commvault/iDataAgent/jobResults/ScaleOut/ReplaceBricksFile&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Gluster heal in progress for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">status</span>

        <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Gluster heal complete for </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_fstab_entry"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_fstab_entry">[docs]</a>    <span class="k">def</span> <span class="nf">check_fstab_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">disk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Checking entry in /etc/fstab for the disk on given ma</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent (name) -- MediaAgent</span>
<span class="sd">                disk (name) -- Brick/disk on Ma</span>
<span class="sd">            Return:</span>
<span class="sd">                list output of entry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking Fstab entry </span><span class="si">%s</span><span class="s2"> on node </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;bzgrep &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">disk</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; /etc/fstab&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span></div>

<div class="viewcode-block" id="HyperScaleHelper.replace_fstab_entry"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.replace_fstab_entry">[docs]</a>    <span class="k">def</span> <span class="nf">replace_fstab_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">old_entry</span><span class="p">,</span> <span class="n">new_entry</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CHecks fstab entry being replaced or not after brick repalcement</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent(name) --&gt; Media Agent</span>
<span class="sd">            old_entry(list) --&gt; list input for old entry</span>
<span class="sd">            new_entry(list) --&gt; list input for new entry</span>
<span class="sd">        Return:</span>
<span class="sd">            True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; Fstab entries for old disk </span><span class="si">%s</span><span class="s2"> and new disk </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">old_entry</span><span class="p">,</span>
                      <span class="n">new_entry</span><span class="p">)</span>

        <span class="n">fstab_replace_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_fstab_replace_entry</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="n">new_entry</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_entry</span> <span class="ow">and</span> <span class="n">fstab_replace_status</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">old_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">new_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s2">&quot;Disk Replacement success, Verified ids for new disk entry </span><span class="si">{0}</span><span class="s2"> &quot;</span> \
                      <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Removed old entry </span><span class="si">{1}</span><span class="s2"> and added new entry </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_entry</span><span class="p">,</span>
                                                                               <span class="n">old_entry</span><span class="p">,</span> <span class="n">new_entry</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">res</span>
            <span class="k">if</span> <span class="n">old_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">new_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s2">&quot;old </span><span class="si">{0}</span><span class="s2"> &quot;</span> \
                      <span class="s2">&quot;same as new </span><span class="si">{1}</span><span class="s2">. Verified the ids for the disk </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">old_entry</span><span class="p">,</span> <span class="n">new_entry</span><span class="p">,</span> <span class="n">new_entry</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">res</span>
        <span class="k">if</span> <span class="n">old_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">new_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s2">&quot;Old entry </span><span class="si">{0}</span><span class="s2"> not removed from fstab&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">old_entry</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="c1"># raise Exception(&quot;Old entry not removed&quot;)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">res</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fstab_replace_status</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s2">&quot;Ids not same for the entry and sd name mounted as&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">res</span></div>

<div class="viewcode-block" id="HyperScaleHelper.verify_fstab_replace_entry"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.verify_fstab_replace_entry">[docs]</a>    <span class="k">def</span> <span class="nf">verify_fstab_replace_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">fstab_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Verify same disk ids, for entry in fstab and mounted on gluster</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) -- MediaAgent</span>
<span class="sd">                fstab_info (name string) -- fstab entry of disk</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verifying uuid for entry </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fstab_info</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;df -h | grep &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fstab_info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="n">sd_name</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;For disk </span><span class="si">%s</span><span class="s2">, mounted with sd name </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fstab_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sd_name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting uuid for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sd_name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">command2</span> <span class="o">=</span> <span class="s2">&quot;blkid &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sd_name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command2</span><span class="p">)</span>
        <span class="n">output_id</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output_id</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="n">id_info</span> <span class="o">=</span> <span class="n">output_id</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verifying ids same for </span><span class="si">%s</span><span class="s2"> which is mounted as </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fstab_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sd_name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">fstab_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">id_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fstab entry for </span><span class="si">%s</span><span class="s2"> is same for mounted as </span><span class="si">%s</span><span class="s2"> with id as </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fstab_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                          <span class="n">sd_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fstab_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">id_info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fstab entry for </span><span class="si">%s</span><span class="s2"> is NOT same for mounted as </span><span class="si">%s</span><span class="s2"> with id as </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fstab_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">sd_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fstab_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">id_info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.gluster_heal_entries"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.gluster_heal_entries">[docs]</a>    <span class="k">def</span> <span class="nf">gluster_heal_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">pool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Checking Heal entries, value should reach 0 after heal process</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) -- media Agent/ node</span>
<span class="sd">                pool(name) -- storage pool name</span>
<span class="sd">            Return:</span>
<span class="sd">                True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking heal entries and making sure they turn to 0 for heal process&quot;</span><span class="p">)</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_name_for_storage_pool</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;gluster v heal &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; info | grep &#39;Number of entries:&#39;&quot;</span>
        <span class="k">while</span> <span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking gluster heal entries: &quot;</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">entry_sum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="n">entry_sum</span> <span class="o">+=</span> <span class="n">entry_sum</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">entry_sum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="HyperScaleHelper.verify_replace_gluster_size"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.verify_replace_gluster_size">[docs]</a>    <span class="k">def</span> <span class="nf">verify_replace_gluster_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before_replace</span><span class="p">,</span> <span class="n">after_replace</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Checking gluster volume  size</span>
<span class="sd">                Args:</span>
<span class="sd">                    before_replace (list) -- gluster info before replace</span>
<span class="sd">                    after_replace (list) -- gluster info after replace</span>
<span class="sd">                Return:</span>
<span class="sd">                    True/False</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verifying Gluster size info before replacement request and after replacement request</span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Gluster size before replacement request </span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> Gluster size after replacement request </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="p">,</span> <span class="n">before_replace</span><span class="p">,</span> <span class="n">after_replace</span><span class="p">)</span>
        <span class="n">total_size_before</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">before_replace</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">used_before</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">before_replace</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">available_before</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">before_replace</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">total_size_after</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">after_replace</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">used_after</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">after_replace</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">available_after</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">after_replace</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total gluster size before </span><span class="si">%s</span><span class="s2">, used </span><span class="si">%s</span><span class="s2">, available </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Total gluster size after replace is </span><span class="si">%s</span><span class="s2">, used </span><span class="si">%s</span><span class="s2">, available </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">total_size_before</span><span class="p">,</span>
                      <span class="n">used_before</span><span class="p">,</span> <span class="n">available_before</span><span class="p">,</span> <span class="n">total_size_after</span><span class="p">,</span> <span class="n">used_after</span><span class="p">,</span> <span class="n">available_after</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">total_size_before</span> <span class="o">==</span> <span class="n">total_size_after</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">used_before</span> <span class="o">==</span> <span class="n">used_after</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">available_before</span> <span class="o">==</span> <span class="n">available_after</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Gluster size same after replacement request &quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Gluster size different after replace request&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_subvolume_for_pool"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_subvolume_for_pool">[docs]</a>    <span class="k">def</span> <span class="nf">get_subvolume_for_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Getting subvolume names for the storage_pool</span>
<span class="sd">            Args:</span>
<span class="sd">                storage_pool_name (name) --&gt; storage_pool_name</span>
<span class="sd">            Returns:</span>
<span class="sd">                sub_volume_name (list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting subVolume names for SP </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_pools</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">host_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_nodes_hostids</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">host_ids</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; select distinct SubVolume </span>
<span class="s2">                    from MMDiskHWInfo </span>
<span class="s2">                    where hostId in (</span><span class="si">{0}</span><span class="s2">)&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sub Volumes for pool </span><span class="si">%s</span><span class="s2"> are </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rows</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_all_bricks_for_subvolume"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_all_bricks_for_subvolume">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_bricks_for_subvolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub_volume</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Get all bricks belonging to a sub volume</span>
<span class="sd">            Args:</span>
<span class="sd">                sub_volume(name) --&gt; SubVolume</span>
<span class="sd">            Returns:</span>
<span class="sd">                bricks(list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting all bricks belonging to the sub volume </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sub_volume</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select flags,BrickHealth, BlockDeviceHealth, deviceospath, hostId, deviceId, diskId </span>
<span class="s2">                 from mmdiskhwinfo where  </span>
<span class="s2">                mountpathusagetype = 2 and SubVolume = &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sub_volume</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">bricks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Bricks belonging to sub volume </span><span class="si">%s</span><span class="s2"> are </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sub_volume</span><span class="p">,</span> <span class="n">bricks</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bricks</span></div>

<div class="viewcode-block" id="HyperScaleHelper.ma_service_down"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.ma_service_down">[docs]</a>    <span class="k">def</span> <span class="nf">ma_service_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Making MA services for node offline and not accessible</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) --&gt; Media Agent</span>
<span class="sd">            Return:</span>
<span class="sd">                Machine Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Making media agent services down for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Bringing down Commvault Media Mount Manager MA services&quot;</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;pkill CvMountd&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Node </span><span class="si">%s</span><span class="s2"> Media Mount Manager  Down&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.ma_service_up"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.ma_service_up">[docs]</a>    <span class="k">def</span> <span class="nf">ma_service_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Making MA services for node online and accessible again</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) --&gt; Media Agent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Making media agent services up for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Bringing up Commvault Media Mount Manager MA services&quot;</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">start_service</span><span class="p">(</span><span class="s2">&quot;CvMountd&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;commvault restart&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exception </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restarted Services&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Node </span><span class="si">%s</span><span class="s2"> Commvault Media Mount Manager Up&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_restore_folders"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_restore_folders">[docs]</a>    <span class="k">def</span> <span class="nf">check_restore_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">,</span> <span class="n">restore_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Create machine object for media_agent and compare backup and restore</span>
<span class="sd">            Here source and destination machine are same</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) -&gt; Media_Agent</span>
<span class="sd">                backup_path(name) -&gt; source destination of file</span>
<span class="sd">                restore_path(name) -&gt; restore destination of file</span>
<span class="sd">            Return:</span>
<span class="sd">                Output(list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verifying Restore data&quot;</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">destination_ma</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">compare_files</span><span class="p">(</span><span class="n">destination_ma</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">,</span> <span class="n">restore_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="HyperScaleHelper.gluster_mount"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.gluster_mount">[docs]</a>    <span class="k">def</span> <span class="nf">gluster_mount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Check /ws/glus mounted on ma or not</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) --&gt; media Agent</span>
<span class="sd">            Return:</span>
<span class="sd">                True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;checking /ws/glus mount on </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="c1"># checking /ws/ddb mount on node or not</span>
        <span class="n">mount</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;df -h | grep &#39;/ws/glus&#39; | awk &#39;{print $1}&#39;&quot;</span>
        <span class="n">mount_output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">mount</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mount_output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No mount path for /ws/glus over </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;/ws/glus is mounted&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HyperScaleHelper.unmount_brick"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.unmount_brick">[docs]</a>    <span class="k">def</span> <span class="nf">unmount_brick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">disk</span><span class="p">,</span> <span class="n">pool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Un mounting brick from gluster</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) --&gt; node</span>
<span class="sd">                disk(name) --&gt; brick to un mount</span>
<span class="sd">                pool(name) --&gt; storage pool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Un Mounting </span><span class="si">%s</span><span class="s2"> from gluster on node </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">brick_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_single_brick_info</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="n">brick_info</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pid to kill </span><span class="si">%s</span><span class="s2"> and un mount disk </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pid</span> <span class="o">!=</span> <span class="s2">&quot;N/A&quot;</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;kill -9 &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
            <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;umount &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">disk</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking gluster brick status&quot;</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_gluster_brick_online</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;gluster disk </span><span class="si">%s</span><span class="s2"> not online&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;commvault restart&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exception </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restarted Services&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;gluster disk un mounted&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.mount_brick"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.mount_brick">[docs]</a>    <span class="k">def</span> <span class="nf">mount_brick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">disk</span><span class="p">,</span> <span class="n">pool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Mounting disk back to gluster</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) --&gt; node</span>
<span class="sd">                disk(name) --&gt; brick to un mount</span>
<span class="sd">                pool(name) --&gt; storage pool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mounting </span><span class="si">%s</span><span class="s2"> back to gluster on node </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">gluster_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_name_for_storage_pool</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking gluster brick status&quot;</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_gluster_brick_online</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;gluster disk </span><span class="si">%s</span><span class="s2"> not online&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;mount &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">disk</span><span class="p">)</span>
        <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restarting gluster to get brick online&quot;</span><span class="p">)</span>

        <span class="c1"># Run echo &quot;y&quot; | gluster v stop storage_pool_name</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;echo </span><span class="se">\&quot;</span><span class="s2">y</span><span class="se">\&quot;</span><span class="s2"> | gluster v stop &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gluster_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="c1"># gluster v start storage_pool_name</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;gluster v start &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gluster_name</span><span class="p">)</span>
                                            <span class="o">+</span> <span class="s2">&quot; force&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking gluster brick status&quot;</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_gluster_brick_online</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;gluster disk </span><span class="si">%s</span><span class="s2"> not online&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;commvault restart&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exception </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restarted Services&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;gluster disk mounted back&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.verify_reset_brick"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.verify_reset_brick">[docs]</a>    <span class="k">def</span> <span class="nf">verify_reset_brick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">disk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Verifying reset-brick used over SP16+</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) --&gt; Media Agent/ Node</span>
<span class="sd">                pool(name) --&gt; Storage Pool name</span>
<span class="sd">                disk(name) --&gt; Disk replaced</span>
<span class="sd">            Return:</span>
<span class="sd">                True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verifying reset-brick used over SP16+&quot;</span><span class="p">)</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_name_for_storage_pool</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>
        <span class="n">disk_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;sds:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">disk</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/ws_brick&quot;</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="s2">&quot;reset-brick &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">disk_name</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;bzgrep &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; /var/log/commvault/Log_Files/CVMA.log | tail -2&quot;</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
        <span class="n">version_info</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="n">service_pack</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">service_pack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Version information </span><span class="si">%s</span><span class="s2">, Service Pack information </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">version_info</span><span class="p">,</span> <span class="n">service_pack</span><span class="p">)</span>
        <span class="n">sp_info</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">service_pack</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">log_info</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_info</span> <span class="o">=</span> <span class="n">log_info</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">log_info</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">log_info</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sp_info</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Service pack version </span><span class="si">%s</span><span class="s2"> higher than 16&quot;</span><span class="p">,</span> <span class="n">sp_info</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reset command used&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Service pack version </span><span class="si">%s</span><span class="s2"> lower than 16&quot;</span><span class="p">,</span> <span class="n">sp_info</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reset command not used&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.brick_data_being_written"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.brick_data_being_written">[docs]</a>    <span class="k">def</span> <span class="nf">brick_data_being_written</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">disk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Get brick data written while backup is running</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) --&gt; Media Agent</span>
<span class="sd">                disk(name) --&gt; brick of gluster</span>
<span class="sd">            Return:</span>
<span class="sd">                list of data and disk</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Check disk </span><span class="si">%s</span><span class="s2"> is in use or not&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;du &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">disk</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; | awk &#39;{print $1,$2}&#39;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">check</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data usage over </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">,</span> <span class="n">check</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">check</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_brick_in_use"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_brick_in_use">[docs]</a>    <span class="k">def</span> <span class="nf">check_brick_in_use</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">disk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Check if brick under use or not</span>
<span class="sd">            Args:</span>
<span class="sd">                media_agent(name) --&gt; Media Agent</span>
<span class="sd">                disk(name) --&gt; brick of gluster</span>
<span class="sd">            Return:</span>
<span class="sd">                True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_data_being_written</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Wait some time&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_data_being_written</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">old</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disk </span><span class="si">%s</span><span class="s2"> under usage, old </span><span class="si">%s</span><span class="s2"> and new </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_gluster_metadata"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_gluster_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">check_gluster_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Check gluster metadata present after pool expansion</span>
<span class="sd">            Args:</span>
<span class="sd">                storage_pool_name(name) --&gt; Storage Pool Name</span>
<span class="sd">            Return:</span>
<span class="sd">                True/Exception</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking gluster meta data over expansion&quot;</span><span class="p">)</span>
        <span class="n">commserve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">commserv_name</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">commserve</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">media_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_mas</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">commserv_name</span><span class="p">)</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">temp</span><span class="se">\\</span><span class="s2">glusterd__</span><span class="si">{0}</span><span class="s2">.tar.gz&quot;</span>
        <span class="n">regex2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">job_results_directory</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">ScaleOut</span><span class="se">\\</span><span class="s2">glusterd__</span><span class="si">{0}</span><span class="s2">.tar.gz&quot;</span>
        <span class="k">for</span> <span class="n">media_agent</span> <span class="ow">in</span> <span class="n">media_agents</span><span class="p">:</span>
            <span class="n">hostid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_host_id</span><span class="p">(</span><span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking gluster metadata for hostid </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">hostid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;checking path </span><span class="si">%s</span><span class="s2"> or </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">regex2</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hostid</span><span class="p">),</span> <span class="n">regex2</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hostid</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">check_file_exists</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hostid</span><span class="p">))</span> <span class="ow">and</span> \
                    <span class="ow">not</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">check_file_exists</span><span class="p">(</span><span class="n">regex2</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hostid</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not present for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hostid</span><span class="p">),</span> <span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;OR </span><span class="si">%s</span><span class="s2"> not present for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">regex2</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hostid</span><span class="p">),</span> <span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Glustermeta data not present&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_ddb_hosts"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_ddb_hosts">[docs]</a>    <span class="k">def</span> <span class="nf">get_ddb_hosts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get hosts, for the ddb partitions</span>
<span class="sd">        Args:</span>
<span class="sd">            storage_pool_name(name) --&gt; Storage Pool Name</span>
<span class="sd">        Return:</span>
<span class="sd">            list of host ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting hosts for dedup partitions present for pool </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">gdsp</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">storage_pool_id</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            select distinct substore.ClientId from </span>
<span class="s2">            IdxSIDBSubStore as substore, IdxSIDBStore as idx, archGroup as arc, MMSDSStoragePool as storage, </span>
<span class="s2">            archCopySIDBStore sidb </span>
<span class="s2">            where storage.GDSPId = arc.id and</span>
<span class="s2">            arc.defaultCopy = sidb.CopyId and</span>
<span class="s2">            sidb.SIDBStoreId = idx.SIDBStoreId and </span>
<span class="s2">            idx.SIDBStoreId = substore.SIDBStoreId and  </span>
<span class="s2">            storage.GDSPId = </span><span class="si">{0}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gdsp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Hosts with ddb partitions present are </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rows</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_control_node"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_control_node">[docs]</a>    <span class="k">def</span> <span class="nf">check_control_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check controlnode or datanode for host</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent(name) --&gt; Media Agent</span>
<span class="sd">        Return:</span>
<span class="sd">            True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking control node or not&quot;</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;bzgrep &#39;HyperScaleNodeType&#39; /etc/CommVaultRegistry/Galaxy/Instance001/MediaAgent/.properties |&quot;</span> \
                  <span class="s2">&quot; awk &#39;{print $2}&#39;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">formatted_output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">formatted_output</span> <span class="o">==</span> <span class="s1">&#39;control&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Host </span><span class="si">%s</span><span class="s2"> is control node&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Host </span><span class="si">%s</span><span class="s2"> is data node&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_ddb_move_job"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_ddb_move_job">[docs]</a>    <span class="k">def</span> <span class="nf">check_ddb_move_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check job initiated and status for ddb move over expansion</span>
<span class="sd">        Args:</span>
<span class="sd">            storage_pool_name(name) --&gt; Storage Pool Name</span>
<span class="sd">        Return:</span>
<span class="sd">            list of jobs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;checking ddb move job over expansion&quot;</span><span class="p">)</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">gdsp</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">storage_pool_id</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        select jobId, status from JMAdminJobStatsTable where opType = 99 and archGrpID = </span><span class="si">{0}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gdsp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;DDB Move job initiated with jobs </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">%s</span><span class="s2"> is completed with status </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">job</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">%s</span><span class="s2"> with status </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">job</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;DDB Move job not initiated&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.check_sds_entry"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.check_sds_entry">[docs]</a>    <span class="k">def</span> <span class="nf">check_sds_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check sds entry populated over ma</span>
<span class="sd">        Args:</span>
<span class="sd">            entry(name) --&gt; media agent entry to check</span>
<span class="sd">            media_agent(name) --&gt; Media Agent on which to check</span>
<span class="sd">        Return:</span>
<span class="sd">            True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking </span><span class="si">%s</span><span class="s2"> sds entry on </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="n">entry</span> <span class="o">+</span> <span class="s2">&quot;sds&quot;</span>
        <span class="n">ma_sessin</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;bzgrep &#39;</span><span class="si">{0}</span><span class="s2">&#39; /etc/hosts&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_sessin</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Entry </span><span class="si">%s</span><span class="s2"> sds present on host </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Entry </span><span class="si">%s</span><span class="s2"> sds not present on host </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.bkp_job_details"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.bkp_job_details">[docs]</a>    <span class="k">def</span> <span class="nf">bkp_job_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Job details for the job id</span>
<span class="sd">        Args:</span>
<span class="sd">            job_id(name) --&gt; Job Id</span>
<span class="sd">        Return:</span>
<span class="sd">            job details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting job details for job </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="n">job_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">job_controller</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="n">details</span> <span class="o">=</span> <span class="n">job_obj</span><span class="o">.</span><span class="n">_get_job_details</span><span class="p">()</span>
        <span class="n">job_details</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;jobDetail&#39;</span><span class="p">][</span><span class="s1">&#39;generalInfo&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">detail</span> <span class="ow">in</span> <span class="n">job_details</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Details: </span><span class="si">%s</span><span class="s2"> --&gt; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">detail</span><span class="p">,</span> <span class="n">job_details</span><span class="p">[</span><span class="n">detail</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">job_details</span></div>

<div class="viewcode-block" id="HyperScaleHelper.admin_job_details"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.admin_job_details">[docs]</a>    <span class="k">def</span> <span class="nf">admin_job_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Job details for the job id</span>
<span class="sd">        Args:</span>
<span class="sd">            job_id(name) --&gt; Job Id</span>
<span class="sd">        Return:</span>
<span class="sd">            job details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting job details for job </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="n">job_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">job_controller</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="n">details</span> <span class="o">=</span> <span class="n">job_obj</span><span class="o">.</span><span class="n">_get_job_summary</span><span class="p">()</span>
        <span class="c1"># job_details = details[&#39;jobDetail&#39;][&#39;generalInfo&#39;]</span>
        <span class="k">for</span> <span class="n">detail</span> <span class="ow">in</span> <span class="n">details</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Details: </span><span class="si">%s</span><span class="s2"> --&gt; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">detail</span><span class="p">,</span> <span class="n">details</span><span class="p">[</span><span class="n">detail</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">details</span></div>

<div class="viewcode-block" id="HyperScaleHelper.kill_sds_network"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.kill_sds_network">[docs]</a>    <span class="k">def</span> <span class="nf">kill_sds_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kill sds network for media agent</span>
<span class="sd">        2 commands,</span>
<span class="sd">        ----&gt;1. eth interface</span>
<span class="sd">        ----&gt;2. ens interface</span>
<span class="sd">        ----&gt;3. bond1 interface</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent(name) --&gt; Media Agent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Killing sds network for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">networks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ens224&#39;</span><span class="p">,</span> <span class="s1">&#39;eth1&#39;</span><span class="p">,</span> <span class="s1">&#39;bond1&#39;</span><span class="p">]</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="n">networks</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;ip link set </span><span class="si">{0}</span><span class="s2"> down&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Command: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
            <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.start_sds_network"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.start_sds_network">[docs]</a>    <span class="k">def</span> <span class="nf">start_sds_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore and start sds network back online again</span>
<span class="sd">        2 commands</span>
<span class="sd">        ----&gt;1. eth interface</span>
<span class="sd">        ----&gt;2. ens interface</span>
<span class="sd">        ----&gt;3. bond interface</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent(name) --&gt; Media Agent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Bringing sds network online&quot;</span><span class="p">)</span>
        <span class="n">networks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ens224&#39;</span><span class="p">,</span> <span class="s1">&#39;eth1&#39;</span><span class="p">,</span> <span class="s1">&#39;bond1&#39;</span><span class="p">]</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="n">networks</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;ip link set </span><span class="si">{0}</span><span class="s2"> up&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Command: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
            <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;systemctl restart network&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.fill_gluster_volume"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.fill_gluster_volume">[docs]</a>    <span class="k">def</span> <span class="nf">fill_gluster_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fill gluster volume with random generated data</span>
<span class="sd">        bs --&gt; buffer size (1Gb = 1073741824)</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent(name) --&gt; Media Agent</span>
<span class="sd">        Return:</span>
<span class="sd">            Response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Filling gluster with random data&quot;</span><span class="p">)</span>
        <span class="n">glus_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_vol_info</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
        <span class="n">available_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">glus_info</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Gluster availble size is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">available_size</span><span class="p">)</span>
        <span class="n">reserve_space</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">fill_size</span> <span class="o">=</span> <span class="n">available_size</span> <span class="o">-</span> <span class="n">reserve_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Filling gluster with size </span><span class="si">%s</span><span class="s2"> and leaving reserve space </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fill_size</span><span class="p">,</span> <span class="n">reserve_space</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating dummy folder under /ws/glus&quot;</span><span class="p">)</span>
        <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s2">&quot;mkdir /ws/glus/dummy&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fill_size</span><span class="p">):</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;dd if=/dev/zero of=/ws/glus/dummy/file</span><span class="si">{0}</span><span class="s2">.txt count=1 bs=1073741824&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;FIlled gluster with size </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">available_size</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.gluster_name_for_storage_pool"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.gluster_name_for_storage_pool">[docs]</a>    <span class="k">def</span> <span class="nf">gluster_name_for_storage_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get gluster name, for the storage pool</span>
<span class="sd">        Args:</span>
<span class="sd">            name(str) --&gt; storage Pool</span>
<span class="sd">        Return:</span>
<span class="sd">            Gluster_name(str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Gluster name for the pool </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">gdsp</span> <span class="o">=</span> <span class="n">details</span><span class="o">.</span><span class="n">storage_pool_id</span>
        <span class="n">media_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_mas</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">media_agent</span> <span class="o">=</span> <span class="n">media_agents</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred connecting to host </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Trying again&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;gluster v status | grep &#39;Status of volume:&#39; | awk &#39;{print $4}&#39;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">gluster_name</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gluster_name</span></div>

<div class="viewcode-block" id="HyperScaleHelper.sd_name_for_disk"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.sd_name_for_disk">[docs]</a>    <span class="k">def</span> <span class="nf">sd_name_for_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">disk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getting sd/scuzzy name for the disk</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent --&gt; Media Agent</span>
<span class="sd">            disk --&gt; disk to format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting sd_name or scuzzy name for the disk </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;lsblk | grep &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">disk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">sd_name</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sd name for disk </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">,</span> <span class="n">sd_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sd_name</span></div>

<div class="viewcode-block" id="HyperScaleHelper.formatting_replaced_disk"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.formatting_replaced_disk">[docs]</a>    <span class="k">def</span> <span class="nf">formatting_replaced_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">scuzzy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formatting disk and removing all data and file system present over it</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent --&gt; Media Agent</span>
<span class="sd">           scuzzy_name --&gt; sd name for the disk to be formatted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Formatting replaced disk </span><span class="si">%s</span><span class="s2"> as sd name on media agent </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">scuzzy_name</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command1</span> <span class="o">=</span> <span class="s2">&quot;dd if=/dev/zero of=/dev/</span><span class="si">{0}</span><span class="s2">  bs=512  count=1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scuzzy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command1</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="HyperScaleHelper.size_of_disk_used_in_storagepool"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.size_of_disk_used_in_storagepool">[docs]</a>    <span class="k">def</span> <span class="nf">size_of_disk_used_in_storagepool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getting disk size for /ws/disk on the node used in storage pool</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent --&gt; Media agent</span>
<span class="sd">            storage_pool_name --&gt; storage pool name</span>
<span class="sd">        Return:</span>
<span class="sd">            size of disk used in gluster (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting disk size for </span><span class="si">%s</span><span class="s2"> on node </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;df -h | grep &#39;/ws/disk&#39;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="n">disks</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span>
        <span class="n">disks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">disks</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">gluster_disk</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">disks</span><span class="p">:</span>
            <span class="n">gluster_disk_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gluster_single_brick_info</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">,</span> <span class="n">disk</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gluster_disk_info</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">gluster_disk</span> <span class="o">=</span> <span class="n">disk</span>
                <span class="k">break</span>
        <span class="n">disk_size</span> <span class="o">=</span> <span class="n">gluster_disk</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;/ws/disk size used in gluster </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2"> for gluster disk </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                      <span class="n">storage_pool_name</span><span class="p">,</span> <span class="n">disk_size</span><span class="p">,</span> <span class="n">gluster_disk</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">disk_size</span></div>

<div class="viewcode-block" id="HyperScaleHelper.disk_for_vertical_scaleout"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.disk_for_vertical_scaleout">[docs]</a>    <span class="k">def</span> <span class="nf">disk_for_vertical_scaleout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Identifying disks available on node for Vertical scale out</span>
<span class="sd">           Args:</span>
<span class="sd">               media_agent --&gt; Media Agent</span>
<span class="sd">               storage_pool_name --&gt; storage pool name</span>
<span class="sd">            Return:</span>
<span class="sd">                list of disks available(list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disks available on node </span><span class="si">%s</span><span class="s2"> for vertical scale out&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;echo </span><span class="se">\&quot;</span><span class="s2">q</span><span class="se">\&quot;</span><span class="s2"> | (cd /opt/commvault/Base &amp;&amp; ./CVSDS -d)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="n">disk_size_req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size_of_disk_used_in_storagepool</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">disk_size_req</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">disk_size_req</span> <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">isdigit</span><span class="p">())))</span>
        <span class="n">disk_available</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;/dev/sd&#39;</span> <span class="ow">in</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> \
                    <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">isdigit</span><span class="p">())))</span> <span class="o">&gt;=</span> <span class="n">disk_size_req</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
                <span class="n">disk_available</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;disk available for vertical scale out are </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">disk_available</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">disk_available</span></div>

<div class="viewcode-block" id="HyperScaleHelper.minimum_disks_for_vertical_scaleout"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.minimum_disks_for_vertical_scaleout">[docs]</a>    <span class="k">def</span> <span class="nf">minimum_disks_for_vertical_scaleout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getting minimum number of disks required to be present on each node for</span>
<span class="sd">        vertical scale out</span>
<span class="sd">        Args:</span>
<span class="sd">            storage_pool_name --&gt; storage pool name</span>
<span class="sd">        Return:</span>
<span class="sd">            dictionary of hosts with disks, min required for vertical scaleout</span>
<span class="sd">            0 --&gt; False(no apt disks present for Vertical scaleout)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verifying nodes have minimum number of disks available for vertical scale out&quot;</span><span class="p">)</span>
        <span class="n">media_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_mas</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Associated media agents are </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">media_agents</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">media_agent</span> <span class="ow">in</span> <span class="n">media_agents</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">vertical_scaleout_disks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">host</span><span class="p">,</span> <span class="n">min_used</span> <span class="o">=</span> <span class="s1">&#39;media_agent&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
        <span class="k">for</span> <span class="n">media_agent</span> <span class="ow">in</span> <span class="n">media_agents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vertical_scaleout_disks</span><span class="p">:</span>
                <span class="n">vertical_scaleout_disks</span><span class="p">[</span><span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vertical_scaleout_disks</span><span class="p">[</span><span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_for_vertical_scaleout</span><span class="p">(</span><span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                                      <span class="n">storage_pool_name</span><span class="p">)</span>
            <span class="n">req</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertical_scaleout_disks</span><span class="p">[</span><span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">req</span> <span class="o">=</span> <span class="p">(</span><span class="n">req</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">req</span> <span class="o">&lt;=</span> <span class="n">min_used</span><span class="p">:</span>
                <span class="n">min_used</span> <span class="o">=</span> <span class="n">req</span>
            <span class="k">if</span> <span class="n">req</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">host</span> <span class="o">=</span> <span class="n">media_agent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">min_used</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Not correct number of disks present on host </span><span class="si">%s</span><span class="s2"> for vertical scaleout, disk count&quot;</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span>
                           <span class="nb">len</span><span class="p">(</span><span class="n">vertical_scaleout_disks</span><span class="p">[</span><span class="n">host</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">vertical_scaleout_disks</span><span class="p">,</span> <span class="n">min_used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Minimum number of disk required for vertical scaleout </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">min_used</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vertical_scaleout_disks</span><span class="p">,</span> <span class="n">min_used</span></div>

<div class="viewcode-block" id="HyperScaleHelper.adding_disk_vertical_scaleout"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.adding_disk_vertical_scaleout">[docs]</a>    <span class="k">def</span> <span class="nf">adding_disk_vertical_scaleout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">disk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adding disks for vertical scale out</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent --&gt; Media agent</span>
<span class="sd">            disk --&gt; disk to be added for VS (/dev/sdx)</span>
<span class="sd">        Return:</span>
<span class="sd">            True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding disk </span><span class="si">%s</span><span class="s2"> over media agent </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;echo -e </span><span class="se">\&quot;</span><span class="si">{0}</span><span class="se">\\</span><span class="s2">nq</span><span class="se">\&quot;</span><span class="s2"> | (cd /opt/commvault/Base &amp;&amp; ./CVSDS -d)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">disk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">HYPERSCALE_CONSTANTS</span><span class="p">[</span><span class="s1">&#39;vertical_scaleout_add_disk_success&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> \
                <span class="ow">and</span> <span class="p">(</span><span class="n">disk</span> <span class="ow">in</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Added disk, Configure status for disk </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;configure status False&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HyperScaleHelper.mount_details"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.mount_details">[docs]</a>    <span class="k">def</span> <span class="nf">mount_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get mount details for the path, for linux ma</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent --&gt; media agent</span>
<span class="sd">            path --&gt; path (which is to be verified and mount details fetched)</span>
<span class="sd">        Return:</span>
<span class="sd">            True/False --&gt; if path mounted</span>
<span class="sd">            details for mount path(list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting mount details for path </span><span class="si">%s</span><span class="s2"> on MA </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">mount_status</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">is_path_mounted</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Path mount status for </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mount_status</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mount_status</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;df -h | grep &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">mount_details</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mount details for </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mount_details</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mount_status</span><span class="p">,</span> <span class="n">mount_details</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disk </span><span class="si">%s</span><span class="s2"> is not mounted on </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mount_status</span><span class="p">,</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HyperScaleHelper.vertical_scaleout_log_status"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.vertical_scaleout_log_status">[docs]</a>    <span class="k">def</span> <span class="nf">vertical_scaleout_log_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getting status for vertical scale out from logs on media agent</span>
<span class="sd">        Args:</span>
<span class="sd">            media_agent --&gt; media agent</span>
<span class="sd">        Return:</span>
<span class="sd">            flag = 0 no log lines,</span>
<span class="sd">            flag = 2 Success</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting vertical scaleout status logs from MA </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ma_session</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">media_agent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;gluster v status | grep &#39;Status of volume:&#39; | awk &#39;{print $4}&#39;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">gluster_name</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="s1">&#39;bzgrep &quot;CvProcess::system() - gluster volume add-brick</span><span class="se">\\</span><span class="s1">&#39;</span> \
                <span class="s1">&#39;|CVMAWorker::add_bricks_to_gluster_volume</span><span class="se">\\</span><span class="s1">&#39;</span> \
                <span class="s1">&#39;|CVMAWorker::AddBricksToGlusterVolume&quot; /var/log/commvault/Log_Files/CVMA.log | tail -5&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ma_session</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">HYPERSCALE_CONSTANTS</span><span class="p">[</span><span class="s1">&#39;Add_Bricks_Success&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> \
                        <span class="n">gluster_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Add Bricks To Gluster Volume Success, </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                                  <span class="n">HYPERSCALE_CONSTANTS</span><span class="p">[</span><span class="s1">&#39;Add_Bricks_Success&#39;</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">log_data</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">:</span>
                        <span class="n">log_data</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_data</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">log_data</span><span class="p">)</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="k">return</span> <span class="n">flag</span>

            <span class="k">if</span> <span class="n">flag</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No logs found!!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No logs found!!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flag</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_vm_object"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_vm_object">[docs]</a>    <span class="k">def</span> <span class="nf">get_vm_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get VM object for the vm name, for the server</span>
<span class="sd">        Args:</span>
<span class="sd">            server --&gt; server url</span>
<span class="sd">            username --&gt; username</span>
<span class="sd">            password --&gt; password</span>
<span class="sd">            name --&gt; name of vm</span>
<span class="sd">        Return:</span>
<span class="sd">            vm object/ Exception</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hv_obj</span> <span class="o">=</span> <span class="n">HypervisorHelper</span><span class="o">.</span><span class="n">Hypervisor</span><span class="p">([</span><span class="n">server</span><span class="p">],</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="s2">&quot;vmware&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="n">vm_help_obj</span> <span class="o">=</span> <span class="n">HypervisorHelper</span><span class="o">.</span><span class="n">VMHelper</span><span class="o">.</span><span class="n">HypervisorVM</span><span class="p">(</span><span class="n">hv_obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vm_help_obj</span></div>

<div class="viewcode-block" id="HyperScaleHelper.get_ddb_reconstruction_job"><a class="viewcode-back" href="../../../source/MediaAgents.MAUtils.html#MediaAgents.MAUtils.hyperscale_helper.HyperScaleHelper.get_ddb_reconstruction_job">[docs]</a>    <span class="k">def</span> <span class="nf">get_ddb_reconstruction_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_pool_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get ddb reconstruction job for storage pool</span>
<span class="sd">        Args:</span>
<span class="sd">            storage_pool_name(name) --&gt; Storage Pool Name</span>
<span class="sd">        Return:</span>
<span class="sd">            list of jobs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting ddb reconstruction job&quot;</span><span class="p">)</span>
        <span class="n">storage_pool_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_pool_details</span><span class="p">(</span><span class="n">storage_pool_name</span><span class="p">)</span>
        <span class="n">gdsp</span> <span class="o">=</span> <span class="n">storage_pool_details</span><span class="o">.</span><span class="n">storage_pool_id</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        select jobId, status from JMAdminJobInfoTable where servStart = </span>
<span class="s2">        (select max(servStart) from JMAdminJobInfoTable where opType = 80) and archGrpID = </span><span class="si">{0}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gdsp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No ddb reconstruction job running at present&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">%s</span><span class="s2"> with status </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">job</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">job</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking ddb reconstruction job if completed&quot;</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                select jobId, status from JMAdminJobStatsTable where servStart = </span>
<span class="s2">                (select max(servStart) from JMAdminJobStatsTable where opType = 80) and archGrpID = </span><span class="si">{0}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gdsp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No ddb reconstruction jobs&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">%s</span><span class="s2"> with status </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">job</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">%s</span><span class="s2"> is completed with status </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">job</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">%s</span><span class="s2"> with status </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">job</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">job</span></div></div>



</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>