

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Web.AdminConsole.Helper.VirtualServerHelper &mdash; Commvault Automation 11.21 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>Web.AdminConsole.Helper.VirtualServerHelper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Web.AdminConsole.Helper.VirtualServerHelper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provides the function or operations that can be used to run VSA</span>
<span class="sd">AdminConsole Automation test cases.</span>

<span class="sd">Class:</span>

<span class="sd">    AdminConsoleVirtualServer()</span>

<span class="sd">    VMWareAdminConsole() -&gt; AdminConsoleVirtualServer()</span>

<span class="sd">    HyperVAdminConsole() -&gt; AdminConsoleVirtualServer()</span>

<span class="sd">    OracleCloudAdminConsole() -&gt; AdminConsoleVirtualServer()</span>

<span class="sd">    AliCloudAdminConsole() -&gt; AdminConsoleVirtualServer()</span>

<span class="sd">    OracleCloudInfrastructureAdminConsole() -&gt; AdminConsoleVirtualServer()</span>

<span class="sd">    GoogleCloudAdminConsole() -&gt; AdminConsoleVirtualServer()</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">from</span> <span class="nn">past.builtins</span> <span class="k">import</span> <span class="n">basestring</span>
<span class="kn">from</span> <span class="nn">cvpysdk.policies.storage_policies</span> <span class="k">import</span> <span class="n">StoragePolicies</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="k">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="k">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="k">import</span> <span class="n">By</span>

<span class="kn">from</span> <span class="nn">Web.AdminConsole.Components.panel</span> <span class="k">import</span> <span class="n">Backup</span>
<span class="kn">from</span> <span class="nn">Web.Common.exceptions</span> <span class="k">import</span> <span class="n">CVWebAutomationException</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="k">import</span> <span class="n">logger</span><span class="p">,</span> <span class="n">cvhelper</span><span class="p">,</span> <span class="n">constants</span><span class="p">,</span> <span class="n">machine</span>
<span class="kn">from</span> <span class="nn">VirtualServer.VSAUtils</span> <span class="k">import</span> <span class="n">VirtualServerUtils</span><span class="p">,</span> <span class="n">VirtualServerConstants</span>
<span class="kn">from</span> <span class="nn">VirtualServer.VSAUtils.HypervisorHelper</span> <span class="k">import</span> <span class="n">Hypervisor</span>
<span class="kn">from</span> <span class="nn">.LoadModule</span> <span class="k">import</span> <span class="n">load_module</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="k">import</span> <span class="n">config</span>
<span class="kn">from</span> <span class="nn">Web.AdminConsole.adminconsole</span> <span class="k">import</span> <span class="n">AdminConsole</span>
<span class="kn">from</span> <span class="nn">Web.AdminConsole.DR.replication</span> <span class="k">import</span> <span class="n">ReplicationGroup</span>
<span class="kn">from</span> <span class="nn">Web.AdminConsole.DR.recovery_targets</span> <span class="k">import</span> <span class="n">RecoveryTargets</span><span class="p">,</span> <span class="n">TargetDetails</span>


<div class="viewcode-block" id="AdminConsoleVirtualServer"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer">[docs]</a><span class="k">class</span> <span class="nc">AdminConsoleVirtualServer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Adminconsole helper for VSA agent &quot;&quot;&quot;</span>

    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the object based in instance_type</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object)   --  object of the instance class</span>

<span class="sd">            driver      (object)   --  the browser object</span>

<span class="sd">            commcell    (object)   --  an instance of the commcell class</span>

<span class="sd">            csdb        (object)   --  the cs DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hv_type</span> <span class="o">=</span> <span class="n">VirtualServerConstants</span><span class="o">.</span><span class="n">hypervisor_type</span>
        <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">MS_VIRTUAL_SERVER</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">HyperVAdminConsole</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">VIRTUAL_CENTER</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">VMwareAdminConsole</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">Oracle_Cloud_Classic</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">OracleCloudAdminConsole</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">Alibaba_Cloud</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">AlibabaCloudAdminConsole</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">AZURE_V2</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">AzureRMAdminConsole</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">AMAZON_AWS</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">AmazonAdminConsole</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">Vcloud</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">VcloudAdminConsole</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">ORACLE_CLOUD_INFRASTRUCTURE</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">OracleCloudInfrastructureAdminConsole</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">Google_Cloud</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">GoogleCloudAdminConsole</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The given hypervisor has not been automated yet&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">browser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A class that represents the VSA functions that can be performed for AdminConsole</span>
<span class="sd">            Automation</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object)   --  the instance object</span>

<span class="sd">            browser      (object)   --  the browser object</span>

<span class="sd">            commcell    (object)   --  the commcell object</span>

<span class="sd">            csdb        (object)   --  the commcell database object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">browser</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Driver&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">driver</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span> <span class="o">=</span> <span class="n">csdb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_login_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_obj</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subclient_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span> <span class="o">=</span> <span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subclient</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hypervisor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_vm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inplace_overwrite</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_power_on_vm_after_restore</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overwrite_vm</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vm_restore_prefix</span> <span class="o">=</span> <span class="s2">&quot;DeleteMe_AC_&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage_policy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_aux</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_copy</span> <span class="o">=</span> <span class="s2">&quot;aux&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ci_enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_method</span> <span class="o">=</span> <span class="s2">&quot;Regular&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_directory</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexing_v2</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oci_finger_print</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oci_private_key_password</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oci_region_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oci_tenancy_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oci_user_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_job</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_azure_cross_region_restore</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">admin_console</span> <span class="o">=</span> <span class="n">AdminConsole</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">webconsole_hostname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_targets_obj</span> <span class="o">=</span> <span class="n">RecoveryTargets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">admin_console</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_details_obj</span> <span class="o">=</span> <span class="n">TargetDetails</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">admin_console</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span> <span class="o">=</span> <span class="n">ReplicationGroup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">admin_console</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;Jobs&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">AdminConsolePages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">Jobs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">admin_console</span><span class="p">)</span>

        <span class="n">content_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;manage_content&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span> <span class="o">=</span> <span class="n">content_module</span><span class="o">.</span><span class="n">ManageContent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="n">vol_restore_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;guest_files_restore_select_volume&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span> <span class="o">=</span> <span class="n">vol_restore_module</span><span class="o">.</span><span class="n">GuestFilesRestoreSelectVolume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="n">restore_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;guest_files_restore_select_folder&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restore_files_obj</span> <span class="o">=</span> <span class="n">restore_module</span><span class="o">.</span><span class="n">GuestFilesRestoreSelectFolder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="n">restore_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;enduser_guestfiles_restore&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enduser_restore_files_obj</span> <span class="o">=</span> <span class="n">restore_module</span><span class="o">.</span><span class="n">EndUserGuestFilesRestoreSelectFolder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="n">restore_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;enduser_fullvmrestore&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enduser_fullvm_obj</span> <span class="o">=</span> <span class="n">restore_module</span><span class="o">.</span><span class="n">EndUserFullVMRestore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="n">vm_files_restore_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;virtual_machine_files_restore&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vm_files_restore_obj</span> <span class="o">=</span> <span class="n">vm_files_restore_module</span><span class="o">.</span><span class="n">VirtualMachineFilesRestore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="n">full_vm_restore_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;full_vm_restore&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span> <span class="o">=</span> <span class="n">full_vm_restore_module</span><span class="o">.</span><span class="n">FullVMRestore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="n">disk_level_restore</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;disk_level_restore&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_level_restore_obj</span> <span class="o">=</span> <span class="n">disk_level_restore</span><span class="o">.</span><span class="n">DiskLevelRestore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="n">hypervisor_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;hypervisors&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span> <span class="o">=</span> <span class="n">hypervisor_module</span><span class="o">.</span><span class="n">Hypervisors</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="n">vsa_sc_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;vsa_subclient_details&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span> <span class="o">=</span> <span class="n">vsa_sc_module</span><span class="o">.</span><span class="n">VsaSubclientDetails</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="n">hypervisor_details_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;hypervisor_details&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span> <span class="o">=</span> <span class="n">hypervisor_details_module</span><span class="o">.</span><span class="n">HypervisorDetails</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;select_restore&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_restore</span><span class="o">.</span><span class="n">SelectRestore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machine</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;virtual_machines&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machine</span><span class="o">.</span><span class="n">VirtualMachines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vm_details</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;vm_details&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vm_details_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_details</span><span class="o">.</span><span class="n">VMDetails</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;vsa_search_restore&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search</span><span class="o">.</span><span class="n">VsaSearchRestore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;replication_group_details&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">AdminConsolePages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details</span><span class="o">.</span>\
            <span class="n">ReplicationGroupDetails</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">configure_replication_group</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;configure_replication_group&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">AdminConsolePages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_replication_group_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_replication_group</span><span class="o">.</span> \
            <span class="n">ConfigureReplicationGroup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">configure_vsa_replication_group</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;configure_vsa_replication_group&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_vsa_replication_group_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_vsa_replication_group</span><span class="o">.</span> \
            <span class="n">ConfigureVSAReplicationGroup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_targets_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;replication_targets&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_targets_module</span><span class="o">.</span><span class="n">ReplicationTargets</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_details</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;replication_target_details&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_details_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_details</span><span class="o">.</span><span class="n">ReplicationTargetDetails</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="n">live_mount_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;live_mount&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">live_mount_obj</span> <span class="o">=</span> <span class="n">live_mount_module</span><span class="o">.</span><span class="n">LiveMount</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="c1"># backup options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backup_type</span> <span class="o">=</span> <span class="n">Backup</span><span class="o">.</span><span class="n">BackupType</span><span class="o">.</span><span class="n">FULL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">granular_recovery</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_testdata_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_testdata_before_backup</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_testdata</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_testdata</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span> <span class="n">commcell</span><span class="p">)</span>

<div class="viewcode-block" id="AdminConsoleVirtualServer.VmValidation"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.VmValidation">[docs]</a>    <span class="k">class</span> <span class="nc">VmValidation</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the source and restore VMs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vmobj</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vm</span> <span class="o">=</span> <span class="n">vmobj</span>

        <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;compares the source vm and restored vm&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">no_of_cpu</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">no_of_cpu</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">disk_count</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">disk_count</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">memory</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">azure_cross_region_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns if cross region restore or not</span>
<span class="sd">        Returns:</span>
<span class="sd">            true/false     (boolenan):  value of _cross_region_restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_azure_cross_region_restore</span>

    <span class="nd">@azure_cross_region_restore</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">azure_cross_region_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of  cross region restore fro Azure</span>

<span class="sd">        Args:</span>
<span class="sd">            true/false   (boolean): value for cross region restore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_azure_cross_region_restore</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_testdata</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_testdata</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_testdata</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">backup_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the backup type</span>

<span class="sd">        Returns:</span>
<span class="sd">            _backup_type    (backupType enum)   --  the backup level in Backup.BackupType</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backup_type</span>

    <span class="nd">@backup_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">backup_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the backup level of the subclient</span>

<span class="sd">        Args:</span>
<span class="sd">            value    (basestring)   --  the level of backup to be run on the subclient</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">Backup</span><span class="o">.</span><span class="n">BackupType</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_backup_type</span> <span class="o">=</span> <span class="n">data</span>
                    <span class="k">break</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">type_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">Backup</span><span class="o">.</span><span class="n">BackupType</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">CVWebAutomationException</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;backup type : </span><span class="si">{value}</span><span class="s2">, isn&#39;t &quot;</span>
                                           <span class="n">f</span><span class="s2">&quot;among the types in [</span><span class="si">{type_list}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">collect_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the metadata collection property</span>

<span class="sd">        Returns:</span>
<span class="sd">            granular_recovery   (bool)   --   true / false for collecting metadata</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">granular_recovery</span>

    <span class="nd">@collect_metadata</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">collect_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the metadata collection property</span>

<span class="sd">        Args:</span>
<span class="sd">            value    (bool)  --  True / False for collecting metadata during backup</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">granular_recovery</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">testdata_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the testdata path</span>

<span class="sd">        Returns:</span>
<span class="sd">            testdata_path  (basestring)   --  the location where testdata needs to be copied</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testdata_path</span>

    <span class="nd">@testdata_path</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">testdata_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the testdata path where files needs to be copied before backup</span>

<span class="sd">        Args:</span>
<span class="sd">            value    (basestring)   --  the location for copying test data</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_testdata_path</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subclient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the subclient name</span>

<span class="sd">        Returns:</span>
<span class="sd">            subclient  (basestring)   --  the name of the subclient to be backed up or restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subclient</span>

    <span class="nd">@subclient</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">subclient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the subclient name</span>

<span class="sd">        Args:</span>
<span class="sd">            value    (basestring)   --  the name of the subclient to be backed up or restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subclient</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the hypervisor name</span>

<span class="sd">        Returns:</span>
<span class="sd">            hypervisor  (basestring)   --  the name of the hypervisor</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hypervisor</span>

    <span class="nd">@hypervisor</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the hypervisor name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  the name of the hypervisor</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hypervisor</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restore_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the restore proxy name</span>

<span class="sd">        Returns:</span>
<span class="sd">            restore_proxy  (basestring)   --  the name of the restore proxy</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">machine_name</span>

    <span class="nd">@restore_proxy</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">restore_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the restore proxy value</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring / obj / tuple)  -- the restore proxy value to be set</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please pass the correct type for the restore proxy value&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">os_info</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">:</span>
            <span class="n">_storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">get_storage_details</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">drive</span> <span class="ow">in</span> <span class="n">_storage</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_storage</span><span class="p">[</span><span class="n">drive</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span> <span class="o">=</span> <span class="n">drive</span> <span class="o">+</span> <span class="s2">&quot;:</span><span class="se">\\</span><span class="s2">&quot;</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span> <span class="o">=</span> <span class="s1">&#39;/tmp&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restore_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the restore client name</span>

<span class="sd">        Returns:</span>
<span class="sd">            restore_client  (basestring)   --  the name of the restore client</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_client</span>

    <span class="nd">@restore_client</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">restore_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the restore client value</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --   the name of the restore client</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_client</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restore_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the restore path location</span>

<span class="sd">        Returns:</span>
<span class="sd">            restore_path  (basestring)   --  the location to restore to</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_path</span>

    <span class="nd">@restore_path</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">restore_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the restore path</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --   the path where files are to be restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_path</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">agentless_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the agentless name</span>

<span class="sd">        Returns:</span>
<span class="sd">            agentless_vm  (basestring)   --  the name of the agentless VM where files needs to be</span>
<span class="sd">                                           restored to</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_vm</span>

    <span class="nd">@agentless_vm</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">agentless_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the agentless VM where the backed up files are to be restored during agentless restore</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  the name of the agentless VM</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the type of the input variable is not a basestring</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_vm</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please pass the correct type for the agentless vm variable&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the instance name</span>

<span class="sd">        Returns:</span>
<span class="sd">            instance  (basestring)   --  the name of the instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span>

    <span class="nd">@instance</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the instance name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   -- the name of the instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">co_ordinator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the coordinator name</span>

<span class="sd">        Returns:</span>
<span class="sd">            co_ordinator  (basestring)   --  the name of the first proxy in the instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span><span class="o">.</span><span class="n">machine_name</span>

    <span class="nd">@co_ordinator</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">co_ordinator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the co-ordinator of the client</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --   the name of the co-ordinator proxy client</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the server name</span>

<span class="sd">        Returns:</span>
<span class="sd">            server  (basestring)   --  the name of the server where commands will be executed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span>

    <span class="nd">@server</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the server name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  sets the name of the server</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the content</span>

<span class="sd">        Returns:</span>
<span class="sd">            VMs  (basestring)   --  the list of VMs to be backed up and restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span>

    <span class="nd">@content</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the content of the subclient</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  like    [VM]=startswith=test*,test1</span>
<span class="sd">                                        [VM] - represent type</span>
<span class="sd">                                                        like [DNS],[HN]</span>
<span class="sd">                                        startswith  represent equality in admin console</span>
<span class="sd">                                                like endswith,equals</span>
<span class="sd">                                        test* - include all VM starts with test</span>
<span class="sd">                                               adding dynamic content in admin console</span>
<span class="sd">                                        , - to include multiple content</span>
<span class="sd">                                        test1 -  non-dynamic content</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_subclient_content</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">power_on_after_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the power on after restore variable</span>

<span class="sd">        Returns:</span>
<span class="sd">            power_on_vm_after_restore  (bool)   --  True / False to power on the VM</span>
<span class="sd">                                                          after restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_on_vm_after_restore</span>

    <span class="nd">@power_on_after_restore</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">power_on_after_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the power on after restore variable</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  -- True / False to power on the VM after restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_power_on_vm_after_restore</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unconditional_overwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the unconditional overwrite variable</span>

<span class="sd">        Returns:</span>
<span class="sd">            overwrite_vm  (bool)   --  True / False to overwrite the VM during restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overwrite_vm</span>

    <span class="nd">@unconditional_overwrite</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">unconditional_overwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the unconditional overwrite variable</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  --  True / False to overwrite the VM during restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overwrite_vm</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vm_restore_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the prefix to be attached to the restore VM name</span>

<span class="sd">        Returns:</span>
<span class="sd">            vm_restore_prefix  (basestring)   --  the prefix to tbe attached to the restore VM name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vm_restore_prefix</span>

    <span class="nd">@vm_restore_prefix</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vm_restore_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the prefix to be attached to the restore VM name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the prefix to be attached to the restore VM name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vm_restore_prefix</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">full_vm_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the full VM in place variable</span>

<span class="sd">        Returns:</span>
<span class="sd">            inplace_overwrite  (bool)   --  True / False to do an inplace restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inplace_overwrite</span>

    <span class="nd">@full_vm_in_place</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">full_vm_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the full VM inplace variable</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  --  True / False to do an inplace restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inplace_overwrite</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">storage_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the storage policy sdk object</span>

<span class="sd">        Returns:</span>
<span class="sd">            storage_policy  (object):   the object of the storage policy class</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage_policy</span>

    <span class="nd">@storage_policy</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">storage_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the storage policy value</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring):   name of the storage policy</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The storage policy name should be a string&quot;</span><span class="p">)</span>
        <span class="n">policies</span> <span class="o">=</span> <span class="n">StoragePolicies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage_policy</span> <span class="o">=</span> <span class="n">policies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ci_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the ci flag whether it is enabled or disabled</span>

<span class="sd">        Returns:</span>
<span class="sd">            ci_enabled  (bool): whether content indexing is enabled or not</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ci_enabled</span>

    <span class="nd">@ci_enabled</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ci_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        enables / disables content indexing</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool):     enable / disable content indexing</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The content indexing value should be True / False&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ci_enabled</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of all VMs in the subclient content</span>

<span class="sd">        Returns:</span>
<span class="sd">            vms (list): list of all VMs in subclient content</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span>

    <span class="k">def</span> <span class="nf">_set_agentless_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agentless_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the agentless VM where the backed up files are to be restored during agentless restore for individual VMs</span>

<span class="sd">        Args:</span>
<span class="sd">            agentless_dict   (dict)   -- VMname :  the name of the agentless VM</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                iffails to set agentless VM</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_dict</span> <span class="o">=</span> <span class="n">agentless_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_dict</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agentless_dict</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        over ride deepcopy method to copy every attribute of an object to other</span>

<span class="sd">        Args:</span>
<span class="sd">            temp_obj    (object)   --  the object to be copied</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if deep copy fails to set the object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">temp_obj</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">temp_obj</span><span class="p">,</span> <span class="n">temp_obj</span><span class="o">.</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">temp_obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Failed to deepcopy Exception: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span>

    <span class="k">def</span> <span class="nf">_create_hypervisor_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create Hypervisor Object</span>

<span class="sd">        Args:</span>
<span class="sd">            client_name  (basestring)   --  the name of the client to create the hypervisor</span>
<span class="sd">                                                object for</span>
<span class="sd">                    default :   None</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if initialization fails in creating object</span>

<span class="sd">        Returns:</span>
<span class="sd">            hvobj   (object)   --  the object of the hypervisor class of the corresponding instance</span>

<span class="sd">            instance_name   (basestring)    --  the instance name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">client_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_obj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
                <span class="n">agent</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Virtual Server&#39;</span><span class="p">)</span>
                <span class="n">instance_keys</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">_instances</span><span class="p">))</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instance_keys</span><span class="p">)</span>

            <span class="n">host_machine</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">co_ordinator</span>
            <span class="n">host_machine1</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">server_host_name</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">server_host_name</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_compute_credentials</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">==</span> <span class="s1">&#39;azure resource manager&#39;</span><span class="p">:</span>

                <span class="n">hvobj</span> <span class="o">=</span> <span class="n">Hypervisor</span><span class="p">(</span><span class="n">server_host_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">password1</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">host_machine1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">==</span> <span class="s1">&#39;Amazon&#39;</span><span class="p">:</span>
                <span class="n">hvobj</span> <span class="o">=</span> <span class="n">Hypervisor</span><span class="p">(</span><span class="n">server_host_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">password2</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">host_machine1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">==</span> <span class="s2">&quot;Oracle Cloud Infrastructure&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server_host_name</span> <span class="o">=</span> <span class="n">server_host_name</span>
                <span class="n">oci_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;oci_tenancy_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">oci_tenancy_id</span><span class="p">,</span>
                            <span class="s1">&#39;oci_user_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">oci_user_id</span><span class="p">,</span>
                            <span class="s1">&#39;oci_finger_print&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">oci_finger_print</span><span class="p">,</span>
                            <span class="s1">&#39;oci_private_file_name&#39;</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.config.Virtualization.oci.key_file_path&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;oci_region_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">oci_region_name</span><span class="p">,</span>
                            <span class="s1">&#39;oci_private_key_password&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">oci_private_key_password</span>
                            <span class="p">}</span>
                <span class="n">server_host_name</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">]</span>
                <span class="n">hvobj</span> <span class="o">=</span> <span class="n">Hypervisor</span><span class="p">(</span><span class="n">server_host_name</span><span class="p">,</span> <span class="n">oci_dict</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">host_machine1</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">hvobj</span> <span class="o">=</span> <span class="n">Hypervisor</span><span class="p">(</span><span class="n">server_host_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">host_machine</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">hvobj</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An Exception occurred in creating the Hypervisor object  </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span>

    <span class="k">def</span> <span class="nf">_compute_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the credentials required to call the server</span>

<span class="sd">        Args:</span>
<span class="sd">            client_name (basestring)   --   the name of the client whose credentials are</span>
<span class="sd">                                            to be obtained</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if compute credentials fails to get the credentials from the database</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select ac.*from (select Row_Number() Over ( Order By id ) as num, </span><span class="se">\</span>
<span class="s2">                     * from app_Instanceprop where componentNameid =( </span><span class="se">\</span>
<span class="s2">                     select TOP 1 instance  from APP_Application where clientId= ( </span><span class="se">\</span>
<span class="s2">                     Select TOP 1 id from App_Client where name = &#39;</span><span class="si">%s</span><span class="s2">&#39;) and appTypeId = &#39;106&#39;))ac </span><span class="se">\</span>
<span class="s2">                     where ac.num between 6 and 9&quot;</span> <span class="o">%</span> <span class="n">client_name</span>

            <span class="c1"># &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_results</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;An exception occurred getting server details&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span> <span class="o">=</span> <span class="n">_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">_password</span> <span class="o">=</span> <span class="n">_results</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">id1</span> <span class="o">=</span> <span class="n">_results</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">id2</span> <span class="o">=</span> <span class="n">_results</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="n">_aws_access_key</span> <span class="o">=</span> <span class="n">cvhelper</span><span class="o">.</span><span class="n">format_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span>
                                                     <span class="n">_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">_aws_secret_key</span> <span class="o">=</span> <span class="n">cvhelper</span><span class="o">.</span><span class="n">format_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span>
                                                     <span class="n">_results</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">cvhelper</span><span class="o">.</span><span class="n">format_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">_password</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">password1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">password2</span> <span class="o">=</span> <span class="p">(</span><span class="n">_aws_access_key</span><span class="p">,</span> <span class="n">_aws_secret_key</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An Exception occurred in getting credentials for Compute Credentials  </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_disk_list</span><span class="p">(</span><span class="n">disk_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the names of the disks to be restored</span>

<span class="sd">        Args:</span>
<span class="sd">            disk_list    (list)  --  the list containing all the disks to be restored</span>

<span class="sd">        Returns:</span>
<span class="sd">            final_disk_list     (list)  --  the list of disk names to be restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">final_disk_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">disk_list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The disk list is empty. Please check the logs.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">disk_list</span><span class="p">:</span>
                <span class="n">final_disk_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">final_disk_list</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exp</span>

    <span class="k">def</span> <span class="nf">_navigate_to_vmgroup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Navigates to VM group details page to submit backup</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_navigate_to_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Navigates to the individual VM page to trigger restore from VM level</span>

<span class="sd">        Args:</span>
<span class="sd">            vm_name     (basestring):   the name of the VM to restore</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the restore page from VM level could not be opened</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">navigate_to_virtual_machines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">open_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vm_details_obj</span><span class="o">.</span><span class="n">vm_restore</span><span class="p">()</span>

<div class="viewcode-block" id="AdminConsoleVirtualServer.logout_command_center"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.logout_command_center">[docs]</a>    <span class="k">def</span> <span class="nf">logout_command_center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs out of the command center session</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="s2">&quot;//a[@class=&#39;modal__close-btn&#39;]&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not logout of command center&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.get_all_vms"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.get_all_vms">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_vms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of all VMs from the subclient content</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if it fails to get the list of all VMs in the subclient from adminconsole</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient_obj</span><span class="p">:</span>
                <span class="n">proxies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient_obj</span><span class="o">.</span><span class="n">_get_subclient_proxies</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">proxies</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">co_ordinator</span> <span class="o">=</span> <span class="n">proxies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span><span class="p">:</span>
                <span class="n">proxy_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">proxy_info</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">proxy_list</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_obj</span><span class="o">.</span><span class="n">associated_clients</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The proxy list does not match.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">co_ordinator</span> <span class="o">=</span> <span class="n">proxy_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Coordinator is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient_obj</span><span class="p">:</span>
                <span class="n">proxy_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient_obj</span><span class="o">.</span><span class="n">_get_subclient_proxies</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">proxy_list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">co_ordinator</span> <span class="o">=</span> <span class="n">proxy_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span><span class="p">:</span>
                <span class="n">proxy_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">proxy_info</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">proxy_list</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_obj</span><span class="o">.</span><span class="n">associated_clients</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The proxy list does not match.&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">co_ordinator</span> <span class="o">=</span> <span class="n">proxy_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Coordinator is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">co_ordinator</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">manage_content</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">preview</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">get_storage_policy</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception while getting all the VMs &quot;</span>
                               <span class="s2">&quot;in the subclient content: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.set_subclient_content"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.set_subclient_content">[docs]</a>    <span class="k">def</span> <span class="nf">set_subclient_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the content for the given subclient</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if it fails to set the subclient content via admin console</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting the subclient content&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">manage_content</span><span class="p">()</span>

            <span class="n">content</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;vm&quot;</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">add_vm</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s2">&quot;vm&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;rule&quot;</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">rules_list</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules_list</span><span class="p">:</span>
                    <span class="n">rule_type</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">rule_type</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception while setting subclient content: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.vsa_discovery"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.vsa_discovery">[docs]</a>    <span class="k">def</span> <span class="nf">vsa_discovery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        VSA discovery to copy all test data</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the discovery fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Creating Hypervisor and VM objects&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">get_all_vms</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">each_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">,</span> <span class="n">each_vm</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">each_vm</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">azure_cross_region_restore</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span> <span class="o">=</span> <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">get_testdata_path</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">machine</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_testdata_before_backup</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_testdata</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_testdata</span><span class="p">:</span>
                    <span class="n">generate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s2">&quot;Generating TestData at path&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">generate</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="n">generate</span> <span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating object for VM </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_vm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">azure_cross_region_restore</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_testdata</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">_drive</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying Testdata to Drive </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">copy_test_data_to_each_volume</span><span class="p">(</span>
                            <span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci_enabled</span><span class="p">:</span>
                        <span class="n">_drive</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">copy_content_indexing_data</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception while copying test data: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.backup"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.backup">[docs]</a>    <span class="k">def</span> <span class="nf">backup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run backup for the given subclient from admin console</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">               If backup job does not complete successfully</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_discovery</span><span class="p">()</span>

            <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Running backup for the subclient&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span> <span class="o">==</span> <span class="n">Backup</span><span class="o">.</span><span class="n">BackupType</span><span class="o">.</span><span class="n">SYNTH</span><span class="p">:</span>
                <span class="n">_bc_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">Backup</span><span class="o">.</span><span class="n">BackupType</span><span class="o">.</span><span class="n">INCR</span><span class="p">,</span> <span class="n">Backup</span><span class="o">.</span><span class="n">BackupType</span><span class="o">.</span><span class="n">SYNTH</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_bc_types</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">_bc_type</span> <span class="ow">in</span> <span class="n">_bc_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_bc_type</span> <span class="o">==</span> <span class="n">Backup</span><span class="o">.</span><span class="n">BackupType</span><span class="o">.</span><span class="n">SYNTH</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vmgroup</span><span class="p">()</span>
                <span class="n">_backup_jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">backup_now</span><span class="p">(</span><span class="n">_bc_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_backup_jobs</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="n">_backup_jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">_backup_jobs</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">_backup_job</span> <span class="ow">in</span> <span class="n">_backup_jobs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">backup_job</span> <span class="o">=</span> <span class="n">_backup_job</span>
                    <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_job</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">Backup</span><span class="o">.</span><span class="n">BackupType</span><span class="o">.</span><span class="n">SYNTH</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_method</span> <span class="o">==</span> <span class="s2">&quot;Regular&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Backup type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;synthetic full&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">indexing_v2</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">verify_synth_full_backup</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_aux</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">copies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">aux_copies</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">aux_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">aux_copies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">aux_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">run_aux_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_copy</span><span class="p">)</span>
                    <span class="n">aux_job</span> <span class="o">=</span> <span class="n">aux_job</span><span class="o">.</span><span class="n">job_id</span>
                    <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">aux_job</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;snap&quot;</span><span class="p">:</span>
                <span class="n">bkpcopy_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">run_backup_copy</span><span class="p">()</span>
                <span class="n">bkpcopy_job</span> <span class="o">=</span> <span class="n">bkpcopy_job</span><span class="o">.</span><span class="n">job_id</span>
                <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">bkpcopy_job</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci_enabled</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                <span class="n">ci_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">run_file_indexing</span><span class="p">()</span>
                <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">ci_job</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception while submitting backup: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.get_job_status_from_jobsPage"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.get_job_status_from_jobsPage">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_status_from_jobsPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the status of the given job ID</span>

<span class="sd">        Args:</span>
<span class="sd">            job_id   (basestring)   --  the job id whose status should be collected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting the status for the job </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_obj</span><span class="o">.</span><span class="n">job_completion</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred in getting the job status: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.verify_synth_full_backup"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.verify_synth_full_backup">[docs]</a>    <span class="k">def</span> <span class="nf">verify_synth_full_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify whether synth full job is triggered after incremental backup</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if it fails to obtain the synth full job ID</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting the synth full job ID&quot;</span><span class="p">)</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;Select jobId from JMBkpJobInfo where bkpLevel=64 and applicationId=(&quot;</span> \
                     <span class="s2">&quot;select id from App_Application where subclientName=&#39;</span><span class="si">{0}</span><span class="s2">&#39; and clientId=(&quot;</span> \
                     <span class="s2">&quot;select id from App_Client where displayName=&#39;</span><span class="si">{1}</span><span class="s2">&#39;))&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span>
                                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">job_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;Completed w/ one or more errors&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during synth full job.&quot;</span>
                                <span class="s2">&quot;Please check the logs for more details.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred while getting the synth full job ID:&quot;</span>
                               <span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.fs_testdata_validation"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.fs_testdata_validation">[docs]</a>    <span class="k">def</span> <span class="nf">fs_testdata_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest_client</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the testdata restored</span>

<span class="sd">        Args:</span>
<span class="sd">            dest_client      (object)   --  the machine class object of the client where</span>
<span class="sd">                                            the testdata was restored to</span>

<span class="sd">            dest_path        (basestring)   --  the path in the destination client where the</span>
<span class="sd">                                                testdata was restored to</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if test data validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validating the testdata&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexing_v2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">Backup</span><span class="o">.</span><span class="n">BackupType</span><span class="o">.</span><span class="n">SYNTH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping test data validation since there is no backup&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">compare_folders</span><span class="p">(</span><span class="n">dest_client</span><span class="p">,</span>
                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">,</span>
                                                                 <span class="n">dest_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">difference</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Checksum mismatch failed for source and destination. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                                   <span class="n">difference</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Folder comparison failed for source </span><span class="si">{0}</span><span class="s2"> and destination &quot;</span>
                                <span class="s2">&quot;</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validation completed successfully&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during testdata validation. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.file_level_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.file_level_restore">[docs]</a>    <span class="k">def</span> <span class="nf">file_level_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_level</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        File level restore to guest agent in the commcell</span>

<span class="sd">        Args:</span>
<span class="sd">            vm_level    (bool):     Performs file level restore to guest agent from VM level</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the file level restore fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Performing file level restore to guest agent&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_drive</span><span class="p">,</span> <span class="n">_folder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span><span class="p">,</span> <span class="s2">&quot;AdminConsole&quot;</span><span class="p">,</span> <span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>
                    <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                        <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">restore_path</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">restore_path</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci_enabled</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">navigate_to_virtual_machines</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">open_vm</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vm_details_obj</span><span class="o">.</span><span class="n">vm_search_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">search_for_content</span><span class="p">(</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="n">_drive</span><span class="p">,</span>
                            <span class="n">include_folders</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">select_data_type</span><span class="p">(</span><span class="s2">&quot;Folder&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">validate_contains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span>
                                                              <span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">validate_contains</span><span class="p">(</span><span class="n">_drive</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                              <span class="n">folder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">vm_level</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;snap&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">snap_copy</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_aux</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_copy</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;snap&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_guest_files</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">latest_backups</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">_folder</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span><span class="o">.</span><span class="n">select_volume</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_folder</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span><span class="o">.</span><span class="n">select_volume</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>
                    <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_files_obj</span><span class="o">.</span><span class="n">submit_guest_agent_restore</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span>
                    <span class="p">)</span>
                    <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_details</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="p">,</span> <span class="n">validate_path</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during file level restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.guest_files_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.guest_files_restore">[docs]</a>    <span class="k">def</span> <span class="nf">guest_files_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vm_level</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">end_user</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        File level restore to source VM</span>

<span class="sd">        Args:</span>
<span class="sd">            in_place    (bool):     if the files should be restored to the source path</span>
<span class="sd">            vm_level    (bool):     if the restore should be initiated from VM level</span>
<span class="sd">            end_user    (bool):     if the restore is initiated by end user</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the file level restore fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span> <span class="o">=</span> <span class="n">_vm</span>

                <span class="k">for</span> <span class="n">_drive</span><span class="p">,</span> <span class="n">_folder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                        <span class="n">restore_path</span> <span class="o">=</span> <span class="n">_folder</span>
                        <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">_folder</span><span class="p">,</span> <span class="s2">&quot;AdminConsole&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>
                        <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">restore_path</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">restore_path</span> <span class="o">!=</span> <span class="n">_folder</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">restore_path</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci_enabled</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">navigate_to_virtual_machines</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">open_vm</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vm_details_obj</span><span class="o">.</span><span class="n">vm_search_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">search_for_content</span><span class="p">(</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="n">_drive</span><span class="p">,</span>
                            <span class="n">include_folders</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">select_data_type</span><span class="p">(</span><span class="s2">&quot;Folder&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">validate_contains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span>
                                                              <span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">validate_contains</span><span class="p">(</span><span class="n">_drive</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                              <span class="n">folder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">vm_level</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_aux</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_copy</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;snap&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">snap_copy</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;snap&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_guest_files</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">latest_backups</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">_folder</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span><span class="o">.</span><span class="n">select_volume</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_folder</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span><span class="o">.</span><span class="n">select_volume</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">end_user</span><span class="p">:</span>
                        <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_files_obj</span><span class="o">.</span><span class="n">submit_this_vm_restore</span><span class="p">(</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                            <span class="n">restore_path</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enduser_restore_files_obj</span><span class="o">.</span><span class="n">enduser_files_restore</span><span class="p">(</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                            <span class="n">restore_path</span>
                        <span class="p">)</span>

                    <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_details</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Agentless restore job failed. Please check the logs&quot;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">validate_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during agentless restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.agentless_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.agentless_restore">[docs]</a>    <span class="k">def</span> <span class="nf">agentless_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_level</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        File level restore to VM in server which does not have Content Store installed</span>

<span class="sd">        Args:</span>
<span class="sd">            vm_level    (bool):     if the restore should be initiated from VM level</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the restore to a VM without content store fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_dict</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_vm</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;A different VM for agentless restore has not been specified&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_dict</span><span class="p">[</span><span class="n">_vm</span><span class="p">]]</span>
                <span class="n">destination_drive</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">destination_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">drive_list</span><span class="p">[</span><span class="n">destination_drive</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">_drive</span><span class="p">,</span> <span class="n">_folder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">guest_os</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;windows&#39;</span><span class="p">:</span>
                        <span class="n">_drive_for_validation</span> <span class="o">=</span> <span class="n">_drive</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                        <span class="n">_drive_for_validation</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span>
                                                 <span class="p">(</span><span class="o">*</span><span class="n">_drive_for_validation</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_drive_for_validation</span> <span class="o">=</span> <span class="n">_drive</span>
                    <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                        <span class="n">destination_folder</span><span class="p">,</span> <span class="s2">&quot;AdminConsole&quot;</span><span class="p">,</span> <span class="n">_vm</span><span class="p">,</span> <span class="n">_drive_for_validation</span><span class="p">)</span>

                    <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                        <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">restore_path</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci_enabled</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">navigate_to_virtual_machines</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">open_vm</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vm_details_obj</span><span class="o">.</span><span class="n">vm_search_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">search_for_content</span><span class="p">(</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="n">_drive</span><span class="p">,</span>
                            <span class="n">include_folders</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">select_data_type</span><span class="p">(</span><span class="s2">&quot;Folder&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">validate_contains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span>
                                                              <span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">validate_contains</span><span class="p">(</span><span class="n">_drive</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                              <span class="n">folder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">vm_level</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_aux</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_copy</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;snap&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">snap_copy</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;snap&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_guest_files</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">latest_backups</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">_folder</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span><span class="o">.</span><span class="n">select_volume</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_folder</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span><span class="o">.</span><span class="n">select_volume</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>

                    <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_files_obj</span><span class="o">.</span><span class="n">submit_other_vm_restore</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_dict</span><span class="p">[</span><span class="n">_vm</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                        <span class="n">restore_path</span>
                    <span class="p">)</span>

                    <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">validate_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during agentless restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.disk_validation"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.disk_validation">[docs]</a>    <span class="k">def</span> <span class="nf">disk_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_obj</span><span class="p">,</span> <span class="n">disk_restore_destination</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs Disk Validation by mounting the restored disk on the Host</span>

<span class="sd">        Args:</span>

<span class="sd">            vm_obj                      (object)       --  instance of the VM class</span>

<span class="sd">            disk_restore_destination    (basestring)   --   restore path of all the disk</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing disk validation&quot;</span><span class="p">)</span>
            <span class="n">_drive_letter</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>

            <span class="n">_list_of_disks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">get_disk_in_the_path</span><span class="p">(</span>
                <span class="n">disk_restore_destination</span><span class="p">)</span>

            <span class="n">_vm_disk_list</span> <span class="o">=</span> <span class="n">vm_obj</span><span class="o">.</span><span class="n">disk_list</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_vm_disk_list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot validate the Disk as we cannot find the disk attached to the VM&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">_list_of_disks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_list_of_disks</span> <span class="o">==</span> <span class="p">[])):</span>
                <span class="n">_final_mount_disk_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">each_disk</span> <span class="ow">in</span> <span class="n">_vm_disk_list</span><span class="p">:</span>
                    <span class="n">each_disk_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">each_disk</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">disk_path</span> <span class="ow">in</span> <span class="n">_list_of_disks</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">each_disk_name</span> <span class="ow">in</span> <span class="n">disk_path</span><span class="p">:</span>
                            <span class="n">_final_mount_disk_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;The Disk cannot be validated as we cannot find disk with Hypervisor&quot;</span>
                    <span class="s2">&quot; extension, could be converted disk&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">_final_mount_disk_list</span><span class="p">:</span>
                <span class="n">_final_mount_disk_list</span> <span class="o">=</span> <span class="n">_list_of_disks</span>

            <span class="k">for</span> <span class="n">_file</span> <span class="ow">in</span> <span class="n">_final_mount_disk_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validation Started For Disk :[</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">_file</span><span class="p">)</span>
                <span class="n">_file</span> <span class="o">=</span> <span class="n">disk_restore_destination</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">_file</span>
                <span class="n">_drive_letter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">mount_disk</span><span class="p">(</span><span class="n">vm_obj</span><span class="p">,</span> <span class="n">_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_drive_letter</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">each_drive</span> <span class="ow">in</span> <span class="n">_drive_letter</span><span class="p">:</span>
                        <span class="n">dest_folder_path</span> <span class="o">=</span> <span class="n">VirtualServerConstants</span><span class="o">.</span><span class="n">get_folder_to_be_compared</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">each_drive</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Folder comparison started...&quot;</span><span class="p">)</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">dest_folder_path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR - Error mounting VMDK </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_file</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception at Mounting Disk &quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">un_mount_disk</span><span class="p">(</span><span class="n">vm_obj</span><span class="p">,</span> <span class="n">_file</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_drive_letter</span> <span class="ow">and</span> <span class="n">_drive_letter</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">un_mount_disk</span><span class="p">(</span><span class="n">vm_obj</span><span class="p">,</span> <span class="n">_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during disk validation. Please check the logs.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.disk_level_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.disk_level_restore">[docs]</a>    <span class="k">def</span> <span class="nf">disk_level_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_level</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disk level restore to another VM in the server</span>

<span class="sd">        Args:</span>
<span class="sd">            vm_level    (bool):     if the restore should be initiated from VM level</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the disk level restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Performing disk level restore&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">vm_level</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_disk_restore</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Attach disk restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.virtual_machine_files_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.virtual_machine_files_restore">[docs]</a>    <span class="k">def</span> <span class="nf">virtual_machine_files_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_level</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disks restores to a client in the commcell</span>

<span class="sd">        Args:</span>
<span class="sd">            vm_level    (bool):     if the restore should be initiated from VM level</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the virtual machine files restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Performing virtual machine files restore&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span><span class="p">,</span> <span class="s2">&quot;AdminConsole&quot;</span><span class="p">,</span> <span class="n">_vm</span><span class="p">)</span>

                <span class="c1"># Clearing the restore path</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">restore_path</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">restore_path</span><span class="p">)</span>

                <span class="n">disks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_disk_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">disk_list</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">vm_level</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_vm_files</span><span class="p">()</span>

                <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_files_restore_obj</span><span class="o">.</span><span class="n">vm_files_restore</span><span class="p">(</span>
                    <span class="n">_vm</span><span class="p">,</span>
                    <span class="n">disks</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                    <span class="n">restore_path</span>
                <span class="p">)</span>

                <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">disk_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">],</span> <span class="n">restore_path</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Virtual Machine Files restore.&quot;</span>
                               <span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.full_vm_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.full_vm_restore">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs Full VM restore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing full VM restore&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.attach_disk_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.attach_disk_restore">[docs]</a>    <span class="k">def</span> <span class="nf">attach_disk_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs attach_disk_restore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing attach_disk_restore&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.vm_restore_validation"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.vm_restore_validation">[docs]</a>    <span class="k">def</span> <span class="nf">vm_restore_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the full VM restore job</span>

<span class="sd">        Args:</span>
<span class="sd">            vm_name          (basestring)   --  the name of the source VM that was backed up</span>

<span class="sd">            restore_vm       (basestring)   --  the name of the restored VM</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if full VM / instance restore validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Validating full VM restore&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">update_hosts</span><span class="p">()</span>
            <span class="n">on_premise</span> <span class="o">=</span> <span class="n">VirtualServerConstants</span><span class="o">.</span><span class="n">on_premise_hypervisor</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;It is Inplace restore&quot;</span><span class="p">)</span>
                <span class="n">source_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__deepcopy__</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">src_attempt</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">src_attempt</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="n">source_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">ip</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">src_attempt</span> <span class="o">=</span> <span class="mi">5</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Attempt number </span><span class="si">%s</span><span class="s2"> failed. Waiting for 2 mins for VM to&quot;</span>
                                      <span class="s2">&quot;come up&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">src_attempt</span><span class="p">))</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
                        <span class="n">src_attempt</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">restore_vm</span>
                <span class="n">attempt</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">==</span> <span class="s1">&#39;azure resource manager&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">resource_group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_group</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span>
                                                                                   <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="n">restore_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">5</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Attempt number </span><span class="si">%s</span><span class="s2"> failed. Waiting for 2 mins for VM to&quot;</span>
                                      <span class="s2">&quot;come up&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">attempt</span><span class="p">))</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
                        <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VmValidation</span><span class="p">(</span><span class="n">source_obj</span><span class="p">)</span>
                <span class="n">_dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VmValidation</span><span class="p">(</span><span class="n">restore_obj</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">_source</span> <span class="o">==</span> <span class="n">_dest</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Config validation is successful&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error while validating configuration&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span> <span class="ow">and</span> <span class="n">on_premise</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">guid</span> <span class="o">==</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">guid</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="s2">&quot;The GUID id of the in place restored VM does not match the source VM&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">azure_cross_region_restore</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">VirtualServerConstants</span><span class="o">.</span><span class="n">Ip_regex</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">ip</span><span class="p">))</span> <span class="ow">and</span>
                            <span class="n">restore_obj</span><span class="o">.</span><span class="n">ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">each_drive</span> <span class="ow">in</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">drive_list</span><span class="p">:</span>
                            <span class="n">dest_location</span> <span class="o">=</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                                <span class="n">source_obj</span><span class="o">.</span><span class="n">drive_list</span><span class="p">[</span><span class="n">each_drive</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span>
                                <span class="n">restore_obj</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">dest_location</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="s2">&quot;This is Linux VM and the destination Ip is not proper ,&quot;</span>
                            <span class="s2">&quot;so no Data Validation cannot be performed&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">instance_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;amazon&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;amazon&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overwrite_vm</span><span class="p">:</span>
                            <span class="n">source_obj</span><span class="o">.</span><span class="n">validate_name_tag</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">restore_obj</span><span class="o">.</span><span class="n">validate_name_tag</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">source_obj</span><span class="o">.</span><span class="n">validate_name_tag</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">restore_obj</span><span class="o">.</span><span class="n">validate_name_tag</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">source_obj</span> <span class="o">==</span> <span class="n">restore_obj</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;AWS EC2 instance specific validation successful&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">azure_cross_region_restore</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span><span class="o">.</span><span class="n">guest_os</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">)</span> <span class="ow">and</span> <span class="n">on_premise</span><span class="p">):</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">instance_type</span> <span class="o">==</span> <span class="s2">&quot;hyper-v&quot;</span><span class="p">:</span>
                        <span class="n">dest_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">,</span>
                                                     <span class="s2">&quot;Virtual Hard Disks&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">disk_validation</span><span class="p">(</span><span class="n">restore_obj</span><span class="p">,</span> <span class="n">dest_location</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping disk validation for powered off restore VM.&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during full VM restore validation. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                               <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.cleanup_testdata"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.cleanup_testdata">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup_testdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleans up testdata that is copied from each vm in the subclient</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if clean up of testdata from the backup VMs fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Testdata cleanup from subclient started&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">azure_cross_region_restore</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No need for cleanup testdata in Azure cross region restore&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;VM selected is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_vm</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_vm</span><span class="p">):</span>
                            <span class="k">continue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_testdata_before_backup</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_drive</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="k">for</span> <span class="n">folder_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;FULL&quot;</span><span class="p">,</span> <span class="s2">&quot;INCR&quot;</span><span class="p">,</span> <span class="s2">&quot;SYNTH&quot;</span><span class="p">]:</span>
                                    <span class="n">_testdata_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">_drive</span><span class="p">,</span>
                                                                                           <span class="n">folder_name</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_testdata_path</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span>
                                            <span class="n">_testdata_path</span><span class="p">):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">_testdata_path</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">_drive</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                                <span class="n">_testdata_path</span> <span class="o">=</span> <span class="n">VirtualServerConstants</span><span class="o">.</span><span class="n">get_folder_to_be_compared</span><span class="p">(</span>
                                    <span class="n">folder_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span> <span class="n">_driveletter</span><span class="o">=</span><span class="n">_drive</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_testdata_path</span><span class="p">)</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">_testdata_path</span><span class="p">):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">_testdata_path</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning testdata in the controller&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception while doing cleaning up test data directory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.search_and_download"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.search_and_download">[docs]</a>    <span class="k">def</span> <span class="nf">search_and_download</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches for and downloads content</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci_enabled</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Content Indexing is not enabled. Search will be live browse&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_drive</span><span class="p">,</span> <span class="n">_folder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">navigate_to_virtual_machines</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">open_vm</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_details_obj</span><span class="o">.</span><span class="n">vm_search_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">search_for_content</span><span class="p">(</span>
                    <span class="n">file_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="n">_drive</span><span class="p">,</span>
                    <span class="n">include_folders</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">select_data_type</span><span class="p">(</span><span class="s2">&quot;Folder&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">validate_contains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span>
                                                      <span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">validate_contains</span><span class="p">(</span><span class="n">_drive</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                      <span class="n">folder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_files_obj</span><span class="o">.</span><span class="n">download_content</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>

                <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">invisibility_of_element_located</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;download-tracker&quot;</span><span class="p">)</span>
                <span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">check_file_exists</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">download_directory</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">download_directory</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Download could not be completed.&quot;</span><span class="p">)</span>

                <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">get_files_in_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">download_directory</span><span class="p">)</span>
                <span class="kn">import</span> <span class="nn">zipfile</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_file</span><span class="p">:</span>
                        <span class="n">zip_file</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">download_directory</span><span class="p">)</span>

                    <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">download_directory</span><span class="p">,</span>
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                                      <span class="s2">&quot;TestData&quot;</span><span class="p">,</span>
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="p">,</span> <span class="n">validate_path</span><span class="p">)</span>
                <span class="k">break</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.ci_download_file"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.ci_download_file">[docs]</a>    <span class="k">def</span> <span class="nf">ci_download_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches for and downloads a file</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">files_path</span> <span class="o">=</span> <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">get_content_indexing_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="p">)</span>
        <span class="n">file_path_beforebackup</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">get_files_in_path</span><span class="p">(</span><span class="n">files_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">file_path_beforebackup</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">download_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span> <span class="o">+</span> <span class="s2">&quot;/Downloads/&quot;</span><span class="p">)</span>
        <span class="n">file_path_afterdownload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci_enabled</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;Content Indexing is not enabled. Search will be live browse&quot;</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">navigate_to_virtual_machines</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">open_vm</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vm_details_obj</span><span class="o">.</span><span class="n">vm_search_content</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">select_data_type</span><span class="p">(</span> <span class="n">file</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_files_obj</span><span class="o">.</span><span class="n">download_content</span><span class="p">(</span> <span class="p">[</span> <span class="n">file</span> <span class="p">],</span> <span class="n">select_one</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

            <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">invisibility_of_element_located</span><span class="p">(</span>
                <span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;download-tracker&quot;</span><span class="p">)))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">check_file_exists</span><span class="p">(</span><span class="n">file_path_afterdownload</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Download could not be completed.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validating file checksum&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_folder</span><span class="p">):</span>
                    <span class="n">file_path_afterdownload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">compare_files</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="p">,</span> <span class="n">file_path_beforebackup</span><span class="p">,</span>
                                                       <span class="n">file_path_afterdownload</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s2">&quot;File checksum validation completed successfully&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">file_path_afterdownload</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="s2">&quot;File checksum failed </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.get_job_status"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.get_job_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the job status via SDK. To be used as a workaround when facing issues with</span>
<span class="sd">        job progress in Command Center.</span>

<span class="sd">        Args:</span>
<span class="sd">            job_id             (str) : Job ID whose status has to be checked.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Job Status</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">Server.JobManager.jobmanager_helper</span> <span class="k">import</span> <span class="n">JobManager</span>
        <span class="n">job_obj</span> <span class="o">=</span> <span class="n">JobManager</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job_obj</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="n">expected_state</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">,</span> <span class="s2">&quot;completed w/ one or more errors&quot;</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="VMwareAdminConsole"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">VMwareAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    VMware class to perform VMware related adminconsole tasks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize any VMware related variables</span>

<span class="sd">        Args:</span>
<span class="sd">            instance        (object)    --  the instance class object</span>

<span class="sd">            driver          (object)    --  the browser driver object</span>

<span class="sd">            commcell        (object)    --  the commcell object</span>

<span class="sd">            csdb            (object)    --  the commserve DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">VMwareAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest_client_vm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disk_provisioning</span> <span class="o">=</span> <span class="s2">&quot;Thin&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport_mode</span> <span class="o">=</span> <span class="s2">&quot;Auto&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_datastore</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">live_recovery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live recovery enable/disable option</span>

<span class="sd">        Returns:</span>
<span class="sd">            _live_recovery     (bool)  --  True / False to enable or disable live recovery</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery</span>

    <span class="nd">@live_recovery</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">live_recovery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the live recovery option during restore</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  --  True / False to enable or disable live recovery during restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">live_recovery_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the dict containing the live recovery options</span>

<span class="sd">        Returns:</span>
<span class="sd">            _live_recovery_options     (dict)  --  dict containing the live recovery options</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">redirect_datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the redirect datatore option</span>

<span class="sd">        Returns:</span>
<span class="sd">            _live_recovery_options[&#39;redirect_datastore&#39;]   (str)   --  the name of the</span>
<span class="sd">                                                                        datastore where writes</span>
<span class="sd">                                                                        will be redirected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span><span class="p">[</span><span class="s1">&#39;redirect_datastore&#39;</span><span class="p">]</span>

    <span class="nd">@redirect_datastore</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">redirect_datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the redirect datastore option for live recovery</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the name of the datastore to redirect writes during live</span>
<span class="sd">                                            recovery restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span><span class="p">[</span><span class="s1">&#39;redirect_datastore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">delay_migration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the delay migration value</span>

<span class="sd">        Returns:</span>
<span class="sd">            _live_recovery_options[&#39;delay_migration&#39;]  (int)   --  the amount of time in hrs</span>
<span class="sd">                                                                    the migration has to be</span>
<span class="sd">                                                                    delayed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span><span class="p">[</span><span class="s1">&#39;delay_migration&#39;</span><span class="p">]</span>

    <span class="nd">@delay_migration</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">delay_migration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the delay migration hours</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring / int)    --    the no of hours the migration has to be delayed</span>
<span class="sd">                                                during live recovery</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span><span class="p">[</span><span class="s1">&#39;delay_migration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transport_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the transport mode to be used for restore</span>

<span class="sd">        Returns:</span>
<span class="sd">            _transport_mode    (basestring)   --  the transport mode to be used for restore</span>
<span class="sd">                    default:    Auto</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport_mode</span>

    <span class="nd">@transport_mode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">transport_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the transport mode to be used for restore</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the transport mode to be used</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport_mode</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">disk_provisioning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the disk provisioning option to be used during restore</span>

<span class="sd">        Returns:</span>
<span class="sd">            _disk_provisioning     (basestring)   --  the type of disk provisioning to be used</span>
<span class="sd">                                                      during restore</span>
<span class="sd">                        default :   Thin</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disk_provisioning</span>

    <span class="nd">@disk_provisioning</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">disk_provisioning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the disk provisioning option</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the disk provisioning to be used for the disks in the</span>
<span class="sd">                                        restore VM</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disk_provisioning</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">different_vcenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the option to restore to a different vcenter or not</span>

<span class="sd">        Returns:</span>
<span class="sd">            full_vm_restore_options[&#39;different_vCenter&#39;]   (bool)  --  restore to a different</span>
<span class="sd">                                                                        new vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter</span>

    <span class="nd">@different_vcenter</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">different_vcenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the different vcenter flag</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  if a different vcenter has to be used during restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">different_vcenter_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the information about the new vcenter client to create during restore</span>

<span class="sd">        Returns:</span>
<span class="sd">            _different_vcenter_info (dict)   --  different vcenter username and password</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">different_vcenter_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the name of the new vcenter to restore to</span>

<span class="sd">        Returns:</span>
<span class="sd">            _different_vcenter_info[&#39;vcenter_hostname&#39;]   (basestring)  --  name of the new vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_hostname&#39;</span><span class="p">]</span>

    <span class="nd">@different_vcenter_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">different_vcenter_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the name of the different vcenter</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the name of the different vcenter to be used during restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_hostname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">different_vcenter_username</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the username of the new vcenter to restore to</span>

<span class="sd">        Returns:</span>
<span class="sd">            _different_vcenter_info[&#39;vcenter_username&#39;] (basestring)  --  username of the</span>
<span class="sd">                                                                            new vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_username&#39;</span><span class="p">]</span>

    <span class="nd">@different_vcenter_username</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">different_vcenter_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the different vcenter user name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the username for the different vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">different_vcenter_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the password of the new vcenter to restore to</span>

<span class="sd">        Returns:</span>
<span class="sd">            _different_vcenter_info[&#39;vcenter_password&#39;]   (basestring)  --  password of the</span>
<span class="sd">                                                                            new vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_password&#39;</span><span class="p">]</span>

    <span class="nd">@different_vcenter_password</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">different_vcenter_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the password for the different vcenter</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the password of the different vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_get_nfs_datastore_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the NFS datastore name in the given ESX</span>

<span class="sd">        Args:</span>
<span class="sd">            restore_vm   (basestring)   --  the name of the restored VM</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if it fails to get the name of the NFS datastore that are mounted</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting the name of the 3DFS datastore where VM is mounted&quot;</span><span class="p">)</span>
            <span class="n">datastore_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">datastore</span> <span class="ow">in</span> <span class="n">datastore_list</span><span class="p">:</span>
                <span class="n">datastore</span> <span class="o">=</span> <span class="n">datastore</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="s1">&#39;3DFS_GX_BACKUP_0&#39;</span> <span class="ow">in</span> <span class="n">datastore</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_datastore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datastore</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The 3DFS datastore is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_datastore</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exp</span>

<div class="viewcode-block" id="VMwareAdminConsole.live_recovery_validation"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.live_recovery_validation">[docs]</a>    <span class="k">def</span> <span class="nf">live_recovery_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the live VM recovery job</span>

<span class="sd">        Args:</span>
<span class="sd">            restore_vm  (str)   :   the name of the restored VM</span>

<span class="sd">            vm_name     (str)   :   the name of the backed up VM</span>

<span class="sd">        Raises:</span>
<span class="sd">             Exception:</span>
<span class="sd">                if validation failed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting live VM recovery validation&quot;</span><span class="p">)</span>
            <span class="n">ds_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">live_browse_ds_exists</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_datastore</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ds_exists</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The datastore is not unmounted yet. Cleanup failed&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">datastore</span> <span class="o">!=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Something went wrong during migration. The destination&quot;</span>
                                <span class="s2">&quot; datastore is wrong.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Live VM recovery validation completed successfully&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Live VM recovery validation failed. </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div>

    <span class="k">def</span> <span class="nf">_set_vm_restore_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the VM restore options for each VM to be restored</span>
<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if there is any exception in setting the restore options</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">each_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">each_vm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__deepcopy__</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">each_vm</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target</span><span class="p">:</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">compute_free_resources</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;network&#39;</span><span class="p">][</span><span class="s1">&#39;destination&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resources</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resources</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;datastore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resources</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;respool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;prefix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;network&#39;</span><span class="p">][</span><span class="s1">&#39;destination&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target</span><span class="o">.</span><span class="n">_destination_network</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target</span><span class="o">.</span><span class="n">_destination_host</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;datastore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target</span><span class="o">.</span><span class="n">_datastore</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;respool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target</span><span class="o">.</span><span class="n">_resource_pool</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;prefix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target</span><span class="o">.</span><span class="n">_vm_prefix</span>

    <span class="k">def</span> <span class="nf">_restore_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submits a restore job with the given inputs</span>
<span class="sd">        Args:</span>
<span class="sd">            vm_list     (list):    VMs to restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dest_target</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target</span><span class="p">:</span>
            <span class="n">dest_target</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">full_vm_restore</span><span class="p">(</span>
            <span class="n">vm_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">,</span>
            <span class="n">proxy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
            <span class="n">destination_server</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
            <span class="n">vm_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">,</span>
            <span class="n">different_vcenter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">different_vcenter</span><span class="p">,</span>
            <span class="n">different_vcenter_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">different_vcenter_info</span><span class="p">,</span>
            <span class="n">disk_prov</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">disk_provisioning</span><span class="p">,</span>
            <span class="n">transport_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport_mode</span><span class="p">,</span>
            <span class="n">power_on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
            <span class="n">over_write</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">,</span>
            <span class="n">live_recovery</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">live_recovery</span><span class="p">,</span>
            <span class="n">live_recovery_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_options</span><span class="p">,</span>
            <span class="n">dest_target</span><span class="o">=</span><span class="n">dest_target</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
            <span class="c1"># Copy testdata when the VM is migrating</span>
            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="n">vm_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">_vm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting Restore Destination Client&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">restore_vm</span>
                <span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">retry</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collecting properties of destination client&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span>
                                                                                       <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;VM Info couldn&#39;t be updated. Trying again. Try No </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retry</span><span class="p">))</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">240</span><span class="p">)</span>
                        <span class="n">retry</span> <span class="o">=</span> <span class="n">retry</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">_drive</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying TDFS data to Drive </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">copy_test_data_to_each_volume</span><span class="p">(</span>
                        <span class="n">restore_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">,</span> <span class="s2">&quot;TDFSDataToTestWrite&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Done copying TDFS data&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_get_nfs_datastore_name</span><span class="p">(</span><span class="n">restore_vm</span><span class="p">)</span>

        <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_end_user_restore_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submits a restore job with the given inputs for end user</span>
<span class="sd">        Args:</span>
<span class="sd">        vm_list     (list):    VMs to restore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enduser_fullvm_obj</span><span class="o">.</span><span class="n">enduser_full_vm_restore</span><span class="p">(</span>
            <span class="n">vm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">restore_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span>
        <span class="p">)</span>

        <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>

<div class="viewcode-block" id="VMwareAdminConsole.live_mount"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.live_mount">[docs]</a>    <span class="k">def</span> <span class="nf">live_mount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">replication_target</span><span class="p">,</span>
                   <span class="n">copy_precedence</span><span class="o">=</span><span class="s2">&quot;Default copy&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        performs Live Mount for each VM in subclient</span>

<span class="sd">        Args:</span>
<span class="sd">            replication_target (string):    name of the replication target</span>

<span class="sd">            copy_precedence    (string):    supports &quot;snap&quot;,&quot;backupcopy&quot; as of now</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if Live Mount or Validation Fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_replication_targets</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recovery_targets_obj</span><span class="o">.</span><span class="n">access_target</span><span class="p">(</span><span class="n">replication_target</span><span class="p">)</span>
                <span class="n">rep_target_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_details_obj</span><span class="o">.</span><span class="n">get_target_summary</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during getting summary/accessing recovery target. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">exp</span>

            <span class="k">if</span> <span class="n">copy_precedence</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;snap&quot;</span><span class="p">:</span>
                <span class="n">copy_precedence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">snap_copy</span>
            <span class="k">elif</span> <span class="n">copy_precedence</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;backupcopy&quot;</span><span class="p">:</span>
                <span class="n">copy_precedence</span> <span class="o">=</span> <span class="s2">&quot;Primary&quot;</span>

            <span class="n">vm_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">live_mount_jobs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_live_mount</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">rep_target_dict</span><span class="p">[</span><span class="s1">&#39;Destination network&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Not Connected&quot;</span><span class="p">:</span>
                    <span class="n">rep_target_dict</span><span class="p">[</span><span class="s1">&#39;Destination network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Original network&quot;</span>

                <span class="n">live_mount_job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_mount_obj</span><span class="o">.</span><span class="n">submit_live_mount</span><span class="p">(</span><span class="n">replication_target</span><span class="p">,</span>
                                                                          <span class="n">rep_target_dict</span><span class="p">[</span><span class="s1">&#39;Destination network&#39;</span><span class="p">],</span>
                                                                          <span class="n">copy_precedence</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">live_mount_job_id</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Live Mount Job&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span>

                <span class="n">vm_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                <span class="n">live_mount_jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">live_mount_job_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">vm_names</span><span class="p">,</span> <span class="n">live_mount_jobs</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Live Mount. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_level</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs full VM restore for a VMware subclient</span>

<span class="sd">        Args:</span>
<span class="sd">            vm_level    (bool):     if the restore should be initiated from VM level</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if full VM restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Performing VMware Full VM restore&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">has_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">recovery_targets</span><span class="o">.</span><span class="n">has_recovery_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">recovery_targets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target</span><span class="o">.</span><span class="n">destination_hypervisor</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target</span><span class="o">.</span><span class="n">_vm_prefix</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_vm_restore_options</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">vm_level</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_job</span><span class="p">([</span><span class="n">_vm</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_restore_job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">_vm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery</span><span class="p">:</span>
                    <span class="n">source_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">each_drive</span> <span class="ow">in</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">drive_list</span><span class="p">:</span>
                        <span class="n">dest_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">source_obj</span><span class="o">.</span><span class="n">drive_list</span><span class="p">[</span><span class="n">each_drive</span><span class="p">],</span>
                            <span class="s2">&quot;TDFSDataToTestWrite&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;TestData&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">dest_location</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_validation</span><span class="p">(</span><span class="n">restore_vm</span><span class="p">,</span> <span class="n">_vm</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during full VM restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.conversion_validation"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.conversion_validation">[docs]</a>    <span class="k">def</span> <span class="nf">conversion_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restore_obj</span><span class="p">,</span> <span class="n">source_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">,</span> <span class="n">restore_option</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs validation for VM restore to OCIinstance fromVMWare</span>

<span class="sd">        Args:</span>
<span class="sd">            restore_obj    (vsa object):     for VMware to Oci conversion ,pass OCi object</span>
<span class="sd">            source_vm     : name of source vm</span>
<span class="sd">            restore_vm  : name of restored vm</span>
<span class="sd">            restore_option : restore hypervisor properties</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Validating full VM restore&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="n">restore_obj</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">update_hosts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">source_vm</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">source_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">source_vm</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">:</span>
            <span class="n">restore_obj</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">restore_vm</span>
            <span class="n">attempt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">restore_obj</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">restore_vm_obj</span> <span class="o">=</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">restore_vm_obj</span><span class="o">.</span><span class="n">ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">attempt</span> <span class="o">=</span> <span class="mi">5</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Attempt number </span><span class="si">%s</span><span class="s2"> failed. Waiting for 2 mins for VM to&quot;</span>
                                  <span class="s2">&quot;come up&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">attempt</span><span class="p">))</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
                    <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">restore_vm_obj</span><span class="o">.</span><span class="n">VmConversionValidation</span><span class="p">(</span><span class="n">restore_vm_obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dest</span><span class="o">.</span><span class="n">conversion_validation</span><span class="p">(</span><span class="n">restore_option</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;config validation is successful&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;error while configuration validation&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error while configuration validation&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">VirtualServerConstants</span><span class="o">.</span><span class="n">Ip_regex</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">restore_vm_obj</span><span class="o">.</span><span class="n">ip</span><span class="p">))</span> <span class="ow">and</span>
                <span class="n">restore_vm_obj</span><span class="o">.</span><span class="n">ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">each_drive</span> <span class="ow">in</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">drive_list</span><span class="p">:</span>
                <span class="n">dest_location</span> <span class="o">=</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                    <span class="n">source_obj</span><span class="o">.</span><span class="n">drive_list</span><span class="p">[</span><span class="n">each_drive</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span>
                    <span class="n">restore_vm_obj</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">dest_location</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;This is Linux VM and the destination Ip is not proper ,&quot;</span>
                <span class="s2">&quot;so no Data Validation cannot be performed&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.full_vmw_oci_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.full_vmw_oci_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vmw_oci_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restore_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs full VM restore for a VMware subclient</span>

<span class="sd">        Args:</span>
<span class="sd">            restore_obj    (vsa object):     for VMware to Oci conversion ,pass OCi object</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if full VM restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Performing VMware Full VM restore&quot;</span><span class="p">)</span>

            <span class="n">restore_obj</span><span class="o">.</span><span class="n">get_all_vms</span><span class="p">()</span>
            <span class="n">restore_obj</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="s2">&quot;Oracle Cloud Infrastructure&quot;</span>
            <span class="n">restore_obj</span><span class="o">.</span><span class="n">hvobj</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">_co_ordinator</span>
            <span class="k">for</span> <span class="n">each_vm</span> <span class="ow">in</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">restore_obj</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">,</span> <span class="n">each_vm</span><span class="p">):</span>
                    <span class="n">restore_obj</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">each_vm</span>
            <span class="n">vm_obj</span> <span class="o">=</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">restore_obj</span><span class="o">.</span><span class="n">_vms</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>
            <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">full_vm_restore</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">,</span>
                <span class="n">restore_as</span><span class="o">=</span><span class="s2">&quot;Oracle Cloud Infrastructure&quot;</span><span class="p">,</span>
                <span class="n">proxy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                <span class="n">destination_server</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                <span class="n">vm_info</span><span class="o">=</span><span class="n">vm_obj</span><span class="p">,</span>
                <span class="n">power_on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                <span class="n">over_write</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>
                <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">720</span><span class="p">)</span>
                <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">job_details</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">vm_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">vm_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conversion_validation</span><span class="p">(</span><span class="n">restore_obj</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">,</span> <span class="n">vm_obj</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during full VM restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.end_user_full_vm_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.end_user_full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">end_user_full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Performs full VM restore at VM level as end user</span>
<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        if full VM restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_user_restore_job</span><span class="p">([</span><span class="n">_vm</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">_vm</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.setup_backup_validation"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.setup_backup_validation">[docs]</a>    <span class="k">def</span> <span class="nf">setup_backup_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_validation_options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setting up details for backup validation</span>

<span class="sd">        Args:</span>
<span class="sd">            backup_validation_options   (dict):     Username, password etc options needed</span>
<span class="sd">                                                    for backup validation</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                If setting backup validation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Setting up Backup validation&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">set_backup_validation</span><span class="p">(</span><span class="n">backup_validation_options</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during setting validation backup. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.run_validate_backup_vmgroup"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.run_validate_backup_vmgroup">[docs]</a>    <span class="k">def</span> <span class="nf">run_validate_backup_vmgroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_validation_options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trigger backup validation from vm group level</span>

<span class="sd">        Args:</span>
<span class="sd">            backup_validation_options   (dict):     Recovery target etc needed for validation backup validation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Running Validate Backup from vm group&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
        <span class="n">backup_validation_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">run_validate_backup</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">backup_validation_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report_validation&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail_backup_validation_job</span><span class="p">(</span><span class="n">backup_validation_job</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_backup</span><span class="p">(</span><span class="n">backup_validation_options</span><span class="p">,</span> <span class="n">backup_validation_job</span><span class="p">)</span></div>
        <span class="c1"># Add the key to have minimum of 15 mins of wait time before the job gets over</span>

<div class="viewcode-block" id="VMwareAdminConsole.run_validate_backup_vm"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.run_validate_backup_vm">[docs]</a>    <span class="k">def</span> <span class="nf">run_validate_backup_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_validation_options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trigger backup validation from vm level</span>

<span class="sd">        Args:</span>
<span class="sd">            backup_validation_options   (dict):     Recovery target etc needed for validation backup validation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Running Validate Backup from vm level&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">each_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_virtual_machines</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">open_vm</span><span class="p">(</span><span class="n">each_vm</span><span class="p">)</span>
            <span class="n">backup_validation_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">run_validate_backup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_backup</span><span class="p">(</span><span class="n">backup_validation_options</span><span class="p">,</span> <span class="n">backup_validation_job</span><span class="p">,</span> <span class="n">each_vm</span><span class="p">)</span></div>
            <span class="c1"># Add the key to have minimum of 15 mins of wait time before the job gets over</span>

<div class="viewcode-block" id="VMwareAdminConsole.run_validate_backup_schedule"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.run_validate_backup_schedule">[docs]</a>    <span class="k">def</span> <span class="nf">run_validate_backup_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_validation_options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validating and triggering backup validation from backup schedule</span>

<span class="sd">        Args:</span>
<span class="sd">            backup_validation_options   (dict):     Recovery target etc needed for validation backup validation</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                Exception in running job from schedule</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">schedule_backup_validation</span><span class="p">(</span><span class="n">only_schedule</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">after_time</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for 6 mins for schedule to trigger&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>
        <span class="n">job_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">job_controller</span>
        <span class="n">vm_jobs</span> <span class="o">=</span> <span class="n">job_controller</span><span class="o">.</span><span class="n">all_jobs</span><span class="p">(</span><span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">job_filter</span><span class="o">=</span><span class="s1">&#39;VM_Management&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_job</span> <span class="ow">in</span> <span class="n">vm_jobs</span><span class="p">:</span>
            <span class="n">_job_detail</span> <span class="o">=</span> <span class="n">job_controller</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_job</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_job_detail</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;jobDetail&#39;</span><span class="p">][</span><span class="s1">&#39;generalInfo&#39;</span><span class="p">][</span><span class="s1">&#39;jobStartedFrom&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Scheduled&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_job_detail</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;jobDetail&#39;</span><span class="p">][</span><span class="s1">&#39;generalInfo&#39;</span><span class="p">][</span><span class="s1">&#39;scheduleName&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">session_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> was started by schedule&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_job</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">validate_backup</span><span class="p">(</span><span class="n">backup_validation_options</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">_job</span><span class="p">))</span>
                    <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Backup validation job not triggered&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.fail_backup_validation_job"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.fail_backup_validation_job">[docs]</a>    <span class="k">def</span> <span class="nf">fail_backup_validation_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_validation_job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fails Backup validation job</span>

<span class="sd">        Args:</span>
<span class="sd">            backup_validation_job      (string):     backup validation job</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                If deleting the vms failed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
            <span class="n">vm_list</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">each_vm</span> <span class="ow">in</span> <span class="n">vm_list</span><span class="p">:</span>
                <span class="n">dest_vm</span> <span class="o">=</span> <span class="n">each_vm</span> <span class="o">+</span> <span class="s1">&#39;_LM_&#39;</span> <span class="o">+</span> <span class="n">backup_validation_job</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">dest_vm</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">check_vms_exist</span><span class="p">([</span><span class="n">dest_vm</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Deleting the VM </span><span class="si">{}</span><span class="s2"> ---&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">))</span>
                    <span class="n">restore_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">dest_vm</span><span class="p">]</span>
                    <span class="n">restore_obj</span><span class="o">.</span><span class="n">backup_validation</span><span class="p">()</span>
                    <span class="n">restore_obj</span><span class="o">.</span><span class="n">delete_vm</span><span class="p">()</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Deleted VM </span><span class="si">{}</span><span class="s2"> Successfully ---&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred deletion of LM vms </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.validate_backup"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.validate_backup">[docs]</a>    <span class="k">def</span> <span class="nf">validate_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_validation_options</span><span class="p">,</span> <span class="n">backup_validation_job</span><span class="p">,</span> <span class="n">each_vm</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs and validates Backup validation job and status</span>

<span class="sd">        Args:</span>
<span class="sd">            backup_validation_options   (dict):     Recovery target etc needed for validation backup validation</span>

<span class="sd">            backup_validation_job      (string):     backup validation job</span>

<span class="sd">            each_vm                    (string):     Vm for which backup validation has been run</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                If running and validating backup validation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">each_vm</span><span class="p">:</span>
                <span class="n">vm_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">each_vm</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vm_list</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">backup_validation_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recovery_target&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_life_cycle_policies</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_obj</span><span class="o">.</span><span class="n">select_replication_target</span><span class="p">(</span><span class="n">backup_validation_options</span><span class="p">[</span><span class="s1">&#39;recovery_target&#39;</span><span class="p">])</span>
                <span class="n">target_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_details_obj</span><span class="o">.</span><span class="n">replication_target_summary</span><span class="p">()</span>
                <span class="n">target_client</span> <span class="o">=</span> <span class="n">target_details</span><span class="p">[</span><span class="s1">&#39;Destination hypervisor&#39;</span><span class="p">]</span>
                <span class="n">dest_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span><span class="n">target_client</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">target_esx</span> <span class="o">=</span> <span class="n">target_details</span><span class="p">[</span><span class="s1">&#39;Destination host&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dest_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>

            <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;sleeping for 5 mins so that all the vms are mounted and booted&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
            <span class="kn">from</span> <span class="nn">Server.JobManager.jobmanager_helper</span> <span class="k">import</span> <span class="n">JobManager</span>
            <span class="n">_job</span> <span class="o">=</span> <span class="n">JobManager</span><span class="p">(</span><span class="n">backup_validation_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_job</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="s1">&#39;killed&#39;</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;completed w/ one or more errors&#39;</span><span class="p">,</span> <span class="s1">&#39;failed&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;The Backup validation job has either failed/killed or completed too early.&quot;</span>
                    <span class="s2">&quot;Please check the vm management log&quot;</span><span class="p">)</span>
            <span class="n">no_of_vms_mounted</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">mounted_data_stores</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">each_vm</span> <span class="ow">in</span> <span class="n">vm_list</span><span class="p">:</span>
                <span class="n">dest_vm</span> <span class="o">=</span> <span class="n">each_vm</span> <span class="o">+</span> <span class="s1">&#39;_LM_&#39;</span> <span class="o">+</span> <span class="n">backup_validation_job</span>
                <span class="n">dest_client</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">dest_vm</span>
                <span class="k">if</span> <span class="n">dest_client</span><span class="o">.</span><span class="n">check_vms_exist</span><span class="p">([</span><span class="n">dest_vm</span><span class="p">]):</span>
                    <span class="n">no_of_vms_mounted</span> <span class="o">=</span> <span class="n">no_of_vms_mounted</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">no_of_vms_mounted</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Maximum number of mounted vms is 5&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Validation for vm </span><span class="si">{}</span><span class="s2"> ---&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">))</span>
                    <span class="n">restore_obj</span> <span class="o">=</span> <span class="n">dest_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">dest_vm</span><span class="p">]</span>
                    <span class="n">restore_obj</span><span class="o">.</span><span class="n">backup_validation</span><span class="p">()</span>
                    <span class="n">mounted_data_stores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">restore_obj</span><span class="o">.</span><span class="n">datastore</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">power_state</span> <span class="o">==</span> <span class="s1">&#39;poweredOn&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;VM: </span><span class="si">{}</span><span class="s2"> is powered on&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">tools</span> <span class="o">!=</span> <span class="s1">&#39;running&#39;</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Boot up properly failed&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;VM: </span><span class="si">{}</span><span class="s2"> booted properly&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Power on failed&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">backup_validation_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recovery_target&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">esx_host</span> <span class="o">==</span> <span class="n">target_esx</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;VM recovery target validated: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_esx</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">esx_host</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">each_vm</span><span class="p">]</span><span class="o">.</span><span class="n">esx_host</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;VM recovery target validated&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vm_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">no_of_vms_mounted</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">vm_list</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;All vms are not mounted&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">no_of_vms_mounted</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Total number of vms mounted at a time should be 5.&quot;</span><span class="p">)</span>
            <span class="n">unique_datastores</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mounted_data_stores</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;backup_validation_job: </span><span class="si">{0}</span><span class="s1"> backup_job: </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">backup_validation_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_job</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">backup_validation_job</span><span class="p">):</span>
                <span class="n">job_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">job_controller</span>
                <span class="n">_job_detail</span> <span class="o">=</span> <span class="n">job_controller</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">backup_validation_job</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_job_detail</span><span class="o">.</span><span class="n">job_type</span> <span class="o">!=</span> <span class="s1">&#39;Virtual Machine Management&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job type should be Virtual Machine Management&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> job is of Virtual Machine Management&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_validation_job</span><span class="p">))</span>

            <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Checking if the Vms are deleted&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">each_vm</span> <span class="ow">in</span> <span class="n">vm_list</span><span class="p">:</span>
                <span class="n">dest_vm</span> <span class="o">=</span> <span class="n">each_vm</span> <span class="o">+</span> <span class="s1">&#39;_LM_&#39;</span> <span class="o">+</span> <span class="n">backup_validation_job</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;--- Verifying Cleanup of the vm: </span><span class="si">{}</span><span class="s2"> ---&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">dest_client</span><span class="o">.</span><span class="n">check_vms_exist</span><span class="p">([</span><span class="n">dest_vm</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;VMs is not cleaned up&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;VM:</span><span class="si">{}</span><span class="s2"> is cleaned&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">))</span>

            <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Checking if the Datastores are deleted&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dest_client</span><span class="o">.</span><span class="n">check_ds_exist</span><span class="p">(</span><span class="n">unique_datastores</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Some Mounted Datastores are not cleaned up&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Datastores are all cleaned&quot;</span><span class="p">)</span>

            <span class="c1"># validating for status for each vm</span>
            <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">decorative_log</span><span class="p">(</span><span class="s2">&quot;Validating the backup validation results&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">each_vm</span> <span class="ow">in</span> <span class="n">vm_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_virtualization</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">open_vm</span><span class="p">(</span><span class="n">each_vm</span><span class="p">)</span>
                <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_details_obj</span><span class="o">.</span><span class="n">backup_validation_results</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;Boot status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Success&#39;</span>
                        <span class="ow">and</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;Last validation job ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">backup_validation_job</span>
                        <span class="ow">and</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;Backup validated&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_job</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;failure in backup validation of vm</span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">each_vm</span><span class="p">,</span> <span class="n">details</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;failure in backup validations&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backup validation verified for vm </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">each_vm</span><span class="p">))</span>
                <span class="n">script_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_details_obj</span><span class="o">.</span><span class="n">backup_validation_scripts</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">script_result</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">backup_validation_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;agent&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">backup_validation_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="s1">&#39;unc_path_win&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">backup_validation_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unc_path_unix&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;VM </span><span class="si">{}</span><span class="s2"> has agent installed or custom script added. &quot;</span>
                                       <span class="s2">&quot;Script result is empty&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">each_vm</span><span class="p">))</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;failure in backup validations&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">_script_status</span> <span class="ow">in</span> <span class="n">script_result</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">_script_status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Success&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Name: </span><span class="si">{}</span><span class="s2">  Script status: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_script_status</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                               <span class="n">_script_status</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Name: </span><span class="si">{}</span><span class="s2">  Failure reason: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_script_status</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                                  <span class="n">_script_status</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during validation backup </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.backup_validation_report_validation"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.backup_validation_report_validation">[docs]</a>    <span class="k">def</span> <span class="nf">backup_validation_report_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testcase_obj</span><span class="p">,</span> <span class="n">test_status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates Report and the actual data is correct</span>

<span class="sd">        Args:</span>
<span class="sd">            testcase_obj   (object):     Testcase object</span>

<span class="sd">            test_status     (string):       Status of the validation job</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                If Report data mismatches</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">Web.AdminConsole.AdminConsolePages.dashboard</span> <span class="k">import</span> <span class="n">Dashboard</span>
            <span class="n">board</span> <span class="o">=</span> <span class="n">Dashboard</span><span class="p">(</span><span class="n">testcase_obj</span><span class="o">.</span><span class="n">admin_console</span><span class="p">)</span>
            <span class="n">board</span><span class="o">.</span><span class="n">navigate_to_given_dashboard</span><span class="p">(</span><span class="s1">&#39;Virtualization Dashboard&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">board</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="s2">&quot;//span[contains(text(),&#39;VALIDATION FAILED&#39;)]&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">test_status</span> <span class="o">==</span> <span class="s1">&#39;success&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;VALIDATION FAILED should not be visible &quot;</span>
                                   <span class="s2">&quot;when there is no failed backup validation job&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Report validation failed&quot;</span><span class="p">)</span>
            <span class="n">board</span><span class="o">.</span><span class="n">access_details_page</span><span class="p">(</span><span class="s1">&#39;VMs&#39;</span><span class="p">,</span> <span class="s1">&#39;VALIDATION FAILED&#39;</span><span class="p">)</span>
            <span class="kn">from</span> <span class="nn">Web.WebConsole.webconsole</span> <span class="k">import</span> <span class="n">WebConsole</span>
            <span class="n">web_c</span> <span class="o">=</span> <span class="n">WebConsole</span><span class="p">(</span><span class="n">testcase_obj</span><span class="o">.</span><span class="n">browser</span><span class="p">,</span> <span class="n">testcase_obj</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">webconsole_hostname</span><span class="p">)</span>
            <span class="kn">from</span> <span class="nn">Web.WebConsole.Reports.Custom</span> <span class="k">import</span> <span class="n">viewer</span>
            <span class="n">viewer_obj</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">CustomReportViewer</span><span class="p">(</span><span class="n">web_c</span><span class="p">)</span>
            <span class="n">table_obj</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span><span class="s2">&quot;Actively protected Virtual machines&quot;</span><span class="p">)</span>
            <span class="n">viewer_obj</span><span class="o">.</span><span class="n">associate_component</span><span class="p">(</span><span class="n">table_obj</span><span class="p">)</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="n">table_obj</span><span class="o">.</span><span class="n">get_table_data</span><span class="p">()</span>
            <span class="n">report</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
            <span class="n">vms_in_vm_group</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="n">report</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="n">vms_in_vm_group</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_virtual_machines</span><span class="p">()</span>
                    <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select name from APP_Client where displayName=</span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_vm</span><span class="p">[</span><span class="s1">&#39;VM Name&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
                    <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">_results</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;An exception occurred getting server details&quot;</span><span class="p">)</span>
                    <span class="n">_vm_name</span> <span class="o">=</span> <span class="n">_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">open_vm</span><span class="p">(</span><span class="n">_vm_name</span><span class="p">)</span>
                    <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_details_obj</span><span class="o">.</span><span class="n">backup_validation_results</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;Boot status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">_vm</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span>
                            <span class="ow">and</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;Last validation job ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">_vm</span><span class="p">[</span><span class="s1">&#39;Last validation job ID&#39;</span><span class="p">]</span>
                            <span class="ow">and</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;Backup validated&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">_vm</span><span class="p">[</span><span class="s1">&#39;Validated Backup Job ID&#39;</span><span class="p">]):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;failure in backup validation of vm</span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">details</span><span class="p">))</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;failure in backup validations&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Report matches for all the VMs&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during report validation </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.get_replication_job"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.get_replication_job">[docs]</a>    <span class="k">def</span> <span class="nf">get_replication_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replication_group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return Live Sync job in progress for the replication group</span>
<span class="sd">        Args:</span>
<span class="sd">            replication_group_name: Name of replication Group</span>

<span class="sd">        Returns: JOB ID</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">access_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>
        <span class="n">replication_job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_replication_job</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">replication_job_id</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.validate_snapshot_pruning"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.validate_snapshot_pruning">[docs]</a>    <span class="k">def</span> <span class="nf">validate_snapshot_pruning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replication_group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            replication_group_name (string) : name of the replication group</span>
<span class="sd">            Raises:</span>
<span class="sd">             Exception:</span>
<span class="sd">                If validation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">admin_console</span><span class="o">.</span><span class="n">navigator</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">access_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>

            <span class="kn">from</span> <span class="nn">VirtualServer.VSAUtils.VirtualServerHelper</span> <span class="k">import</span> <span class="n">AutoVSACommcell</span>
            <span class="n">auto_commcell_obj</span> <span class="o">=</span> <span class="n">AutoVSACommcell</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="p">)</span>
            <span class="c1"># get control host id of the configured storage array</span>
            <span class="n">control_host_id</span> <span class="o">=</span> <span class="n">auto_commcell_obj</span><span class="o">.</span><span class="n">get_control_host_id</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>

            <span class="c1"># xml to get to get the snapshot list on the storage array</span>
            <span class="n">deploy_xml</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;&lt;EVGui_GetVolumesOfSnapBackupReq jobId=&quot;0&quot; copyId=&quot;0&quot; clientId=&quot;0&quot; controlHostId=&quot;</span><span class="si">{0}</span><span class="s2">&quot;/&gt;&quot;&quot;&quot;</span><span class="o">.</span> \
                <span class="nb">format</span><span class="p">(</span><span class="n">control_host_id</span><span class="p">)</span>
            <span class="c1"># executing qoperation by passing above xml</span>
            <span class="n">snaphots_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">qoperation_execute</span><span class="p">(</span><span class="n">deploy_xml</span><span class="p">)</span>
            <span class="n">snapshot_jobids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">response_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">snaphots_response</span><span class="p">[</span><span class="s1">&#39;listOfVolumes&#39;</span><span class="p">])):</span>
                <span class="n">snapshot_jobids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">snaphots_response</span><span class="p">[</span><span class="s1">&#39;listOfVolumes&#39;</span><span class="p">][</span><span class="n">response_index</span><span class="p">][</span><span class="s1">&#39;jobId&#39;</span><span class="p">])</span>

            <span class="n">snapshot_retention</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># default value</span>

            <span class="kn">from</span> <span class="nn">cvpysdk.client</span> <span class="k">import</span> <span class="n">Client</span>
            <span class="kn">from</span> <span class="nn">cvpysdk.job</span> <span class="k">import</span> <span class="n">JobController</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="n">snap_backup_jobids</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">job_controller_obj</span> <span class="o">=</span> <span class="n">JobController</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
                <span class="n">client_obj</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">_vm</span><span class="p">)</span>
                <span class="n">client_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">client_obj</span><span class="o">.</span><span class="n">client_id</span><span class="p">)</span>

                <span class="c1"># getting finished job id&#39;s</span>
                <span class="n">jobs_details</span> <span class="o">=</span> <span class="n">job_controller_obj</span><span class="o">.</span><span class="n">finished_jobs</span><span class="p">(</span><span class="n">client_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">destination_client</span><span class="p">,</span>
                                                                <span class="n">lookup_time</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span>
                                                                <span class="n">job_filter</span><span class="o">=</span><span class="s1">&#39;snapbackup&#39;</span><span class="p">,</span>
                                                                <span class="n">job_summary</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span>
                                                                <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="c1"># filtering jobs with client id</span>
                <span class="k">for</span> <span class="n">job_id</span> <span class="ow">in</span> <span class="n">jobs_details</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">jobs_details</span><span class="p">[</span><span class="n">job_id</span><span class="p">][</span><span class="s1">&#39;subclient&#39;</span><span class="p">][</span><span class="s1">&#39;clientId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">client_id</span><span class="p">:</span>
                        <span class="n">snap_backup_jobids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">job_id</span><span class="p">))</span>

                <span class="c1"># getting backup job id&#39;s yet to replicate</span>
                <span class="n">pending_backup_jobids</span> <span class="o">=</span> <span class="n">auto_commcell_obj</span><span class="o">.</span><span class="n">get_backup_pending_jobs_to_replicate</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>

                <span class="n">jobids_exist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">jobids_notexist</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># logic to get the list of job id&#39;s to be there and list of job id&#39;s not to be there</span>
                <span class="n">snap_backup_jobids</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pending_backup_jobids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># if we are having backup jobs yet to replicate</span>
                    <span class="c1"># converting job id&#39;s string to int</span>
                    <span class="k">for</span> <span class="n">jobid_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pending_backup_jobids</span><span class="p">)):</span>
                        <span class="n">pending_backup_jobids</span><span class="p">[</span><span class="n">jobid_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pending_backup_jobids</span><span class="p">[</span><span class="n">jobid_index</span><span class="p">])</span>

                    <span class="c1"># adding all backup job id&#39;s yet to replicate to</span>
                    <span class="c1"># the list of snapshot job id&#39;s to be present on the storage array</span>
                    <span class="k">for</span> <span class="n">jobid</span> <span class="ow">in</span> <span class="n">pending_backup_jobids</span><span class="p">:</span>
                        <span class="n">jobids_exist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jobid</span><span class="p">)</span>
                        <span class="n">snapshot_retention</span> <span class="o">=</span> <span class="n">snapshot_retention</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">jobid_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">snap_backup_jobids</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">jobid_index</span> <span class="o">&lt;</span> <span class="n">snapshot_retention</span><span class="p">:</span>
                        <span class="n">jobids_exist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snap_backup_jobids</span><span class="p">[</span><span class="n">jobid_index</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">jobids_notexist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snap_backup_jobids</span><span class="p">[</span><span class="n">jobid_index</span><span class="p">])</span>

                <span class="c1"># validating snapshot job id&#39;s to be present on the storage array</span>
                <span class="k">for</span> <span class="n">jobid</span> <span class="ow">in</span> <span class="n">jobids_exist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">jobid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">snapshot_jobids</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;snapshot corresponding to jobid:</span><span class="si">{jobid}</span><span class="s1"> is not found on array&#39;</span><span class="p">)</span>
                <span class="c1"># validating snapshot job id&#39;s not to be present on the storage array</span>
                <span class="k">for</span> <span class="n">jobid</span> <span class="ow">in</span> <span class="n">jobids_notexist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">jobid</span> <span class="ow">in</span> <span class="n">snapshot_jobids</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;snapshot corresponding to jobid:</span><span class="si">{jobid}</span><span class="s1"> is found on array and should be pruned&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to complete snapshot pruning validation.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.validate_status"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.validate_status">[docs]</a>    <span class="k">def</span> <span class="nf">validate_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_list</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate values in status list</span>
<span class="sd">        Raises:</span>
<span class="sd">             Exception:</span>
<span class="sd">                If validation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">status_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="VMwareAdminConsole.validate_live_sync"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.validate_live_sync">[docs]</a>    <span class="k">def</span> <span class="nf">validate_live_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replication_group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">live_sync_direct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Validates Live Sync functionality for VMW.</span>

<span class="sd">                Args:</span>
<span class="sd">                    replication_group_name (basestring):     Name of the replication group, if not set,</span>
<span class="sd">                    a replication group is automatically set</span>
<span class="sd">                    live_sync_direct (bool) :   true if it is a live sync direct validation</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        If validation fails.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">access_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>
        <span class="n">recovery_target_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_recovery_target</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_obj</span><span class="o">.</span><span class="n">navigate_to_replication_targets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_obj</span><span class="o">.</span><span class="n">select_replication_target</span><span class="p">(</span><span class="n">recovery_target_name</span><span class="p">)</span>

        <span class="n">destination_client_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_obj</span><span class="o">.</span><span class="n">get_destination_hypervisor</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">access_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>

        <span class="n">sync_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_sync_status</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_status</span><span class="p">(</span><span class="n">sync_status</span><span class="p">,</span> <span class="s2">&quot;in sync&quot;</span><span class="p">),</span> <span class="s2">&quot;Sync status is not &#39;In Sync&#39;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vm_pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_source_and_destination</span><span class="p">()</span>

            <span class="n">source_vms</span> <span class="o">=</span> <span class="n">vm_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">destination_vms</span> <span class="o">=</span> <span class="n">vm_pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">destination_client_name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                <span class="n">destination_client_name</span> <span class="o">=</span> <span class="n">destination_client_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span><span class="n">destination_client_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">source_vm_name</span><span class="p">,</span> <span class="n">destination_vm_name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">source_vms</span><span class="p">,</span> <span class="n">destination_vms</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">destination_client</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">destination_vm_name</span>
                <span class="n">dest_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">destination_vm_name</span><span class="p">]</span>
                <span class="n">source_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">source_vm_name</span><span class="p">]</span>

                <span class="n">dest_vm</span><span class="o">.</span><span class="n">power_on</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully powered on VM: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">destination_vm_name</span><span class="p">)</span>

                <span class="c1"># Wait for IP to be generated</span>
                <span class="n">wait</span> <span class="o">=</span> <span class="mi">10</span>

                <span class="k">while</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Waiting for 60 seconds for the IP to be generated&#39;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">dest_vm</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="n">os_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>

                    <span class="k">if</span> <span class="n">dest_vm</span><span class="o">.</span><span class="n">ip</span> <span class="ow">and</span> <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">validate_ip</span><span class="p">(</span><span class="n">dest_vm</span><span class="o">.</span><span class="n">ip</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="n">wait</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Valid IP not generated within 10 minutes&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Valid IP for VM: </span><span class="si">{destination_vm_name}</span><span class="s1"> not generated within 5 minutes&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;IP is generated&#39;</span><span class="p">)</span>

                <span class="n">_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VmValidation</span><span class="p">(</span><span class="n">source_vm</span><span class="p">)</span>
                <span class="n">_dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VmValidation</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">)</span>

                <span class="c1"># Validate Configuration</span>
                <span class="k">assert</span> <span class="n">_source</span> <span class="o">==</span> <span class="n">_dest</span> <span class="ow">and</span> <span class="n">dest_vm</span><span class="o">.</span><span class="n">NicName</span><span class="p">,</span> <span class="s2">&quot;error while configuration validation&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;config validation is successful&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">live_sync_direct</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="s1">&#39;__GX_BACKUP__&#39;</span> <span class="ow">in</span> <span class="n">dest_vm</span><span class="o">.</span><span class="n">VMSnapshot</span><span class="p">,</span> <span class="s1">&#39;Snapshot validation failed&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Snapshot validation successful&#39;</span><span class="p">)</span>

                <span class="c1"># To validate test data between source and destination</span>
                <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">drive</span> <span class="ow">in</span> <span class="n">dest_vm</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span>
                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span><span class="n">dest_vm</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Testdata validation successful&#39;</span><span class="p">)</span>

                <span class="n">dest_vm</span><span class="o">.</span><span class="n">power_off</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully powered off VM: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">destination_vm_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">live_sync_direct</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_snapshot_pruning</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">),</span> <span class="s2">&quot;snapshot pruning validation failed&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;snapshot pruning validation successful&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Validation completed successfully&#39;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to complete live sync validation.&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HyperVAdminConsole"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.HyperVAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">HyperVAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hyper-V class to perform Hyper-V related adminconsole tasks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize any Hyper-V related variables</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object)   --  object of the instance class</span>

<span class="sd">            driver      (object)   --  the browser object</span>

<span class="sd">            commcell    (object)   --  an instance of the commcell class</span>

<span class="sd">            csdb        (object)   --  the cs DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HyperVAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_register_to_failover</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_location</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">register_to_failover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the register to failover option</span>

<span class="sd">        Returns:</span>
<span class="sd">            register_to_failover   (bool)  --  True / False to register to failover cluster</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_to_failover</span>

    <span class="nd">@register_to_failover</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">register_to_failover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the register to failover option</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  --  True / False to register the VM to failover after restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_register_to_failover</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restore_location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the restore location, hyper-v default folder or new folder or original location</span>

<span class="sd">        Returns:</span>
<span class="sd">            restore_location   (basestring)   --  the location to restore the VM to</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_location</span>

    <span class="nd">@restore_location</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">restore_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the location to restore the VM to</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the location where the VM should be restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_location</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="HyperVAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.HyperVAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform full VM restore for hyper-V</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if full VM restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_location</span> <span class="o">=</span> <span class="s2">&quot;Original folder&quot;</span>
                <span class="n">restore_path</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_location</span> <span class="o">=</span> <span class="s2">&quot;Hyper-V default folder&quot;</span>
                <span class="n">restore_path</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_location</span> <span class="o">==</span> <span class="s2">&quot;Select a folder&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The restore path was not provided&quot;</span><span class="p">)</span>
                <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span>

            <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">hv_full_vm_restore</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_location</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">,</span>
                <span class="n">restore_path</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">register_to_failover</span>
            <span class="p">)</span>

            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                             <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">_vm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">)</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Hyper-v Full VM restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>


<div class="viewcode-block" id="OracleCloudAdminConsole"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">OracleCloudAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This module is for performing Oracle Cloud related actions from AdminConsole</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the Oracle Cloud related inputs</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object)   --  object of the instance class</span>

<span class="sd">            driver      (object)   --  the browser object</span>

<span class="sd">            commcell    (object)   --  an instance of the commcell class</span>

<span class="sd">            csdb        (object)   --  the cs DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">OracleCloudAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_account</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_security_groups</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh_keys</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_shape</span> <span class="o">=</span> <span class="s2">&quot;Auto&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instance_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the instance shape option</span>

<span class="sd">        Returns:</span>
<span class="sd">            _instance_shape     (basestring)    --  the shape to be used for the restore instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance_shape</span>

    <span class="nd">@instance_shape</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">instance_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the instance shape option</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the instance shape to be used for the restore VMs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The instance shape should be a string&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_shape</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user_account</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the user account name</span>

<span class="sd">        Returns:</span>
<span class="sd">            _user_account   (basestring)    --  the name of the user account to restore to</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_account</span>

    <span class="nd">@user_account</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">user_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the user account</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the user account where the instances are to be restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The user account name should be a string&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_account</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">security_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the security groups</span>

<span class="sd">        Returns:</span>
<span class="sd">            _security_groups    (list)  --  list of all security groups to be associated with</span>
<span class="sd">                                            the restored instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_security_groups</span>

    <span class="nd">@security_groups</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">security_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the security groups</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (list)  --  list of all security groups to be associated with the</span>
<span class="sd">                                restored instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_security_groups</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_security_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The security group should either be a list or string.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ssh_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the ssh keys</span>

<span class="sd">        Returns:</span>
<span class="sd">            _ssh_keys   (list)  --  list of all ssh keys to be associated with instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssh_keys</span>

    <span class="nd">@ssh_keys</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ssh_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the ssh keys</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (list)  --  list of all ssh keys to be associated with the restored instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh_keys</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The ssh keys should either be a list or string.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">networks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the networks list</span>

<span class="sd">        Returns:</span>
<span class="sd">            _networks   (list)  --  list of all networks to be attached to instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span>

    <span class="nd">@networks</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">networks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the networks list</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (list)  --  list of all networks to be attached to the restored instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The networks should either be a list or string.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_restore_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the restore options for full VM restore</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if there is any error in setting the restore options</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting the restore options&quot;</span><span class="p">)</span>
            <span class="n">dest_vm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_account</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">_get_instance_user_name</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">security_groups</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">security_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">_get_security_list_of_instance</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssh_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ssh_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">_get_ssh_keys_of_instance</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;An error occurred while setting the restore options. &quot;</span>
                            <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>

<div class="viewcode-block" id="OracleCloudAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Full instance restore of Oracle Cloud instances</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if full instance restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restoring the Oracle Cloud Instance&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_set_restore_options</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>

            <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">opc_full_vm_restore</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_account</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instance_shape</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">security_groups</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ssh_keys</span>
            <span class="p">)</span>

            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                             <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Oracle Cloud Full VM restore.&quot;</span>
                               <span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>


<div class="viewcode-block" id="AlibabaCloudAdminConsole"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AlibabaCloudAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">AlibabaCloudAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for Ali Cloud related operations to be done in admin console</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the Oracle Cloud related inputs</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object)   --  object of the instance class</span>

<span class="sd">            driver      (object)   --  the browser object</span>

<span class="sd">            commcell    (object)   --  an instance of the commcell class</span>

<span class="sd">            csdb        (object)   --  the cs DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AlibabaCloudAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy_input</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_set_instance_restore_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the restore options for each instance to be restored</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if there is any exception in setting the restore options</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">availability_zone</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="n">security_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">compute_free_resources</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
            <span class="c1"># instance_type will always come from the backup VM</span>
            <span class="c1"># availability_zone, network and security_groups will be obtained from proxy</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="s1">&#39;availability_zone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">availability_zone</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="s1">&#39;instance_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm</span><span class="p">]</span><span class="o">.</span><span class="n">instance_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="s1">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">network</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="s1">&#39;security_groups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">security_groups</span>

    <span class="k">def</span> <span class="nf">_restore_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submits a restore job with the given inputs</span>

<span class="sd">        Args:</span>
<span class="sd">            vm_list     (list):    VMs to restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">ali_cloud_full_vm_restore</span><span class="p">(</span>
            <span class="n">vm_list</span><span class="p">,</span>
            <span class="n">destination_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
            <span class="n">destination_proxy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
            <span class="n">power_on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
            <span class="n">overwrite_instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">,</span>
            <span class="n">in_place</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">,</span>
            <span class="n">restore_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">,</span>
            <span class="n">instance_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span>
        <span class="p">)</span>

        <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job_details</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="AlibabaCloudAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AlibabaCloudAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_level</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs a full instance restore of Alibaba cloud instances</span>

<span class="sd">        Args:</span>
<span class="sd">            vm_level    (bool):     if the VM should be restored from the VM level</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy_input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy_input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>

            <span class="n">proxy_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">to_vm_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collecting proxy disk count before restore for HotAdd validation&quot;</span><span class="p">)</span>
            <span class="n">proxy_before_restore_disks_count</span> <span class="o">=</span> <span class="n">proxy_info</span><span class="o">.</span><span class="n">storage_disks</span><span class="p">()[</span><span class="s1">&#39;TotalCount&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;disk count : </span><span class="si">%s</span><span class="s1"> &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">proxy_before_restore_disks_count</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="p">{</span><span class="n">vm</span><span class="p">:</span> <span class="nb">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_instance_restore_options</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">vm_level</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_job</span><span class="p">([</span><span class="n">_vm</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_restore_job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vms</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">_vm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collecting proxy disk count after restore for HotAdd validation&quot;</span><span class="p">)</span>
            <span class="n">proxy_after_restore_disks_count</span> <span class="o">=</span> <span class="n">proxy_info</span><span class="o">.</span><span class="n">storage_disks</span><span class="p">()[</span><span class="s1">&#39;TotalCount&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;disk count : </span><span class="si">%s</span><span class="s1"> &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">proxy_after_restore_disks_count</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">proxy_before_restore_disks_count</span> <span class="o">==</span> <span class="n">proxy_after_restore_disks_count</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Hot Add validation successful&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;HotAdd Validation failed&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during full VM restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>


<div class="viewcode-block" id="AzureRMAdminConsole"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AzureRMAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">AzureRMAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Azure RM class to perform AzureRM related adminconsole tasks</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize any Azure RM related variables</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object):  object of the instance class</span>

<span class="sd">            driver      (object):  the browser object</span>

<span class="sd">            commcell    (object):  an instance of the commcell class</span>

<span class="sd">            csdb        (object): the cs DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AzureRMAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resource_group</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage_account</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_region</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vm_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network_interface</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_security_group</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_public_ip</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_managed_vm</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resource_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live resource_group</span>

<span class="sd">        Returns:</span>
<span class="sd">            resource_group     (str):    value of resource group</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource_group</span>

    <span class="nd">@resource_group</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">resource_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of  resource_group</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (str):  value for resource_group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resource_group</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">managed_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live Managed VM value</span>

<span class="sd">        Returns:</span>
<span class="sd">            managed_     (bool): True / False to enable or disable managed_vm</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_managed_vm</span>

    <span class="nd">@managed_vm</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">managed_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the  Managed VM value</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  :  value for managed_v</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_managed_vm</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">create_public_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live create public IP value</span>

<span class="sd">        Returns:</span>
<span class="sd">            create_public_ip     (bool): True / False to enable or disable Create Public IP</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_public_ip</span>

    <span class="nd">@create_public_ip</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">create_public_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the  create public IP value</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  :  value for _create_public_ip</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_public_ip</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">storage_account</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live storage_account</span>
<span class="sd">        Returns:</span>
<span class="sd">            storage_account     (st):  value of storage_account</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage_account</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">region</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live region</span>
<span class="sd">        Returns:</span>
<span class="sd">            region     (st):  value of region</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_region</span>

    <span class="nd">@storage_account</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">storage_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of  storage_account</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (str): value for storage_account</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage_account</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@region</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of  region</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (str): value for region</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_region</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vm_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live vmsize</span>

<span class="sd">        Returns:</span>
<span class="sd">            vmsize     (str):  value of vm_size</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vm_size</span>

    <span class="nd">@vm_size</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vm_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the live vmsize</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (str):  value for vmsize</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vm_size</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">network_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live network inerface</span>

<span class="sd">        Returns:</span>
<span class="sd">            network_interface     (bool):  True / False to enable or disable live recovery</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network_interface</span>

    <span class="nd">@network_interface</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">network_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the live network inerface</span>
<span class="sd">        Args:</span>
<span class="sd">            value  (str): value for network_interface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network_interface</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">security_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live security_group</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_security_group</span>

    <span class="nd">@security_group</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">security_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets value of security_group</span>
<span class="sd">        Args:</span>
<span class="sd">            value   (str):  value for security_group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_security_group</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_set_azure_vm_restore_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Sets the VM restore options for each VM to be restored</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        if there is any exception in setting the restore options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_vm_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="n">_vm_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_group</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resource_group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span> \
                        <span class="n">compute_free_resources</span><span class="p">(</span><span class="n">_vm_list</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">vm_size</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">security_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">security_group</span> <span class="o">=</span> <span class="s2">&quot;--Auto Select--&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_interface</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">network_interface</span> <span class="o">=</span> <span class="s2">&quot;--Auto Select--&quot;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;resource_group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_group</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;storage_account&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_account</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;vm_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;security_group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">security_group</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;network_interface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_interface</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during setting restore options&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">exp</span>

<div class="viewcode-block" id="AzureRMAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AzureRMAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Performs full VM restore for a Azure RM</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        if full VM restore or validation fails</span>

<span class="sd">                &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Performing full VM restore&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_azure_vm_restore_options</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">=</span> <span class="s1">&#39;DEL&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>

            <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">azure_full_vm_restore</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_public_ip</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">managed_vm</span><span class="p">,</span>
                <span class="n">restore_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span>
            <span class="p">)</span>

            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">job_details</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">_vm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">12</span><span class="p">:</span>
                        <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">azure_cross_region_restore</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">azure_cross_region_restore</span><span class="p">:</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">get_vm_location</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_group</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">location</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Region validation successful. Location = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">location</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="s2">&quot;Region validation failed because input region = </span><span class="si">%s</span><span class="s2"> and restored VM region = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">location</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Azure Full VM restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AzureRMAdminConsole.attach_disk_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AzureRMAdminConsole.attach_disk_restore">[docs]</a>    <span class="k">def</span> <span class="nf">attach_disk_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Performs attach disk restore for a Azure RM</span>

<span class="sd">           Raises:</span>
<span class="sd">               Exception:</span>
<span class="sd">                   if attach disk restore or validation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_destination_vm_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_total_disk_attached_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_after_disk_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Performing attach disk operation&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">_destination_vm_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>

            <span class="n">_destination_resource_group</span><span class="p">,</span> <span class="n">_storage_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span>\
                <span class="n">compute_free_resources</span><span class="p">(</span><span class="n">_destination_vm_list</span><span class="p">)</span>

            <span class="n">_destination_vm_disk_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span>\
                <span class="n">get_data_disk_info</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">vm_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="n">_disks</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">_disks_to_attached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span><span class="o">.</span><span class="n">get_data_disk_info</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_disks_to_attached</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_disk_restore</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">_disks_to_attached</span><span class="p">:</span>
                    <span class="n">_disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                    <span class="n">_total_disk_attached_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">disk</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

                <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_level_restore_obj</span><span class="o">.</span> \
                    <span class="n">azure_attach_disk</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                                      <span class="n">_disks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">,</span>
                                      <span class="n">_destination_resource_group</span><span class="p">,</span> <span class="n">_storage_account</span><span class="p">)</span>

                <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>

            <span class="n">after_disk_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span>\
                <span class="n">get_data_disk_info</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">each_disk</span> <span class="ow">in</span> <span class="n">after_disk_info</span><span class="p">:</span>
                <span class="n">_after_disk_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">each_disk</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">attach_disks_validation</span><span class="p">(</span><span class="n">_destination_vm_disk_list</span><span class="p">,</span> <span class="n">_total_disk_attached_list</span><span class="p">,</span>
                                         <span class="n">_after_disk_list</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred in Attach disk operation </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AzureRMAdminConsole.attach_disks_validation"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AzureRMAdminConsole.attach_disks_validation">[docs]</a>    <span class="k">def</span> <span class="nf">attach_disks_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before_dest_data_disk</span><span class="p">,</span> <span class="n">attached_disk_info</span><span class="p">,</span>
                                <span class="n">after_dest_disk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs a attach disk  restore Validation</span>
<span class="sd">        Args:</span>
<span class="sd">            before_dest_data_disk    (list):     list of datadisks before attach disk restore</span>

<span class="sd">            attached_disk_info       (list):     disks attached</span>

<span class="sd">            after_dest_disk          (list):      list of data disks after attach disk restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">before_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">before_dest_data_disk</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No of disks before restore&quot;</span><span class="p">,</span> <span class="n">before_length</span><span class="p">)</span>
            <span class="n">after_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">after_dest_disk</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No of disks after restore&quot;</span><span class="p">,</span> <span class="n">after_length</span><span class="p">)</span>
            <span class="n">attached_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attached_disk_info</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;total no of disks attached&quot;</span><span class="p">,</span> <span class="n">attached_length</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">before_length</span> <span class="o">+</span> <span class="n">attached_length</span> <span class="o">!=</span> <span class="n">after_length</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No of disks attached validation is successfull&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">attached_name</span> <span class="ow">in</span> <span class="n">attached_disk_info</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">attached_name</span> <span class="ow">in</span> <span class="n">attached_disk_info</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Attach Disk Restore validation failed&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disk validation is succesfull&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in disks validation </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>


<div class="viewcode-block" id="AmazonAdminConsole"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AmazonAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">AmazonAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Amazon class to perform Amazon related adminconsole tasks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize any VMware related variables</span>

<span class="sd">        Args:</span>
<span class="sd">            instance        (object)    --  the instance class object</span>

<span class="sd">            driver          (object)    --  the browser driver object</span>

<span class="sd">            commcell        (object)    --  the commcell object</span>

<span class="sd">            csdb            (object)    --  the commserve DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AmazonAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol_restore_prefix</span> <span class="o">=</span> <span class="s1">&#39;Restored_&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ami</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_availability_zone</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_select_instance_type</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ins_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_select_security_grp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_security_group</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_existing_instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">existing_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the existing instance name</span>

<span class="sd">        Returns:</span>
<span class="sd">            existing_instance  (basestring)   --  the existing instance name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_existing_instance</span>

    <span class="nd">@existing_instance</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">existing_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the existing instance name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  the existing instance name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_existing_instance</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">security_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the security group name</span>

<span class="sd">        Returns:</span>
<span class="sd">            security_group  (basestring)   --  the name of the security group</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_security_group</span>

    <span class="nd">@security_group</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">security_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the security group name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  the name of the security group</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_security_group</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">auto_select_security_grp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the auto_select_security_grp&#39;s value</span>

<span class="sd">        Returns:</span>
<span class="sd">            auto_select_security_grp  (bool)   --  if security group should be auto selected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_select_security_grp</span>

    <span class="nd">@auto_select_security_grp</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">auto_select_security_grp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the auto_select_security_grp&#39;s value</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  if security group should be auto selected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_select_security_grp</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the network</span>

<span class="sd">        Returns:</span>
<span class="sd">            network  (basestring)   --  the name of the network</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span>

    <span class="nd">@network</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the network name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  the name of the network</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ins_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the instance type</span>

<span class="sd">        Returns:</span>
<span class="sd">            ins_type  (basestring)   --  the instance type</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ins_type</span>

    <span class="nd">@ins_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ins_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the ins_type name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  the instance type</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ins_type</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">auto_select_instance_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the auto_select_instance_type&#39;s value</span>

<span class="sd">        Returns:</span>
<span class="sd">            auto_select_instance_type  (bool)   --  if instance type should be auto selected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_select_instance_type</span>

    <span class="nd">@auto_select_instance_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">auto_select_instance_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the auto_select_instance_type&#39;s value</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)   --  if instance type should be auto selected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_select_instance_type</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">availability_zone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the availability_zone</span>

<span class="sd">        Returns:</span>
<span class="sd">            availability_zone  (basestring)   --  the name of the availability zone</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_availability_zone</span>

    <span class="nd">@availability_zone</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">availability_zone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the availability_zone name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  the name of the availability zone</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_availability_zone</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ami</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the ami name</span>

<span class="sd">        Returns:</span>
<span class="sd">            ami  (basestring)   --  the name of the ami</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ami</span>

    <span class="nd">@ami</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ami</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the ami name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  the name of the ami</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ami</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vol_restore_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the prefix to be attached to the restore VM name</span>

<span class="sd">        Returns:</span>
<span class="sd">            vm_restore_prefix  (basestring)   --  the prefix to tbe attached to the restore VM name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vol_restore_prefix</span>

    <span class="nd">@vol_restore_prefix</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vol_restore_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the prefix to be attached to the restore VM name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the prefix to be attached to the restore VM name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vol_restore_prefix</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="AmazonAdminConsole.attach_disk_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.AmazonAdminConsole.attach_disk_restore">[docs]</a>    <span class="k">def</span> <span class="nf">attach_disk_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attach_vol_to</span><span class="p">,</span> <span class="n">vm_level</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attach disk restore</span>

<span class="sd">        Args:</span>
<span class="sd">            attach_vol_to (basestring) : Disk has to be attached to existing instance or new volume</span>

<span class="sd">            vm_level      (bool)       :  if the restore should be initiated from VM level</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the Attach disk restore or validation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Performing disk level restore&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">has_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The destination client is not a client in the Commserv&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="n">disks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_disk_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">disk_list</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">vm_level</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_disk_restore</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">attach_vol_to</span> <span class="o">==</span> <span class="s1">&#39;Other instance&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore to Other Instance is not given by user&quot;</span><span class="p">)</span>
                    <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_level_restore</span><span class="o">.</span><span class="n">aws_attach_disk_restore</span><span class="p">(</span>
                        <span class="n">_vm</span><span class="p">,</span>
                        <span class="n">disks</span><span class="p">,</span>
                        <span class="n">attach_vol_to</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">existing_instance</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ami</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Ami is mandatory for new instance restore&quot;</span><span class="p">)</span>
                    <span class="n">inst_display_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>

                    <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_level_restore_obj</span><span class="o">.</span><span class="n">aws_attach_disk_restore</span><span class="p">(</span>
                        <span class="n">_vm</span><span class="p">,</span> <span class="n">disks</span><span class="p">,</span>
                        <span class="n">attach_vol_to</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                        <span class="n">vol_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">,</span>
                        <span class="n">power_on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                        <span class="n">overwrite</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">,</span>
                        <span class="n">inst_display_name</span><span class="o">=</span><span class="n">inst_display_name</span><span class="p">,</span>
                        <span class="n">ami</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ami</span><span class="p">,</span>
                        <span class="n">available_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">availability_zone</span><span class="p">,</span>
                        <span class="n">auto_select_instance_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_select_instance_type</span><span class="p">,</span>
                        <span class="n">ins_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ins_type</span><span class="p">,</span>
                        <span class="n">network</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
                        <span class="n">auto_select_security_grp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_select_security_grp</span><span class="p">,</span>
                        <span class="n">security_group</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">security_group</span><span class="p">)</span>
                <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                                 <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">attach_vol_to</span> <span class="o">==</span> <span class="s1">&#39;New instance&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                        <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Attach disk restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>


<div class="viewcode-block" id="VcloudAdminConsole"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VcloudAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">VcloudAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       Vcloud class to perform Vcloud related adminconsole tasks</span>
<span class="sd">       &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize any vCloud VM related variables</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object):  object of the instance class</span>

<span class="sd">            driver      (object):  the browser object</span>

<span class="sd">            commcell    (object):  an instance of the commcell class</span>

<span class="sd">            csdb        (object): the cs DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VcloudAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_organization</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_org_vdc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vapp_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network_setting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_network</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_destination_network</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vapp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vdc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_vapp</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vm_restore_prefix</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">organization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the  organization</span>

<span class="sd">        Returns:</span>
<span class="sd">            organization     (str):    value of organization</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_organization</span>

    <span class="nd">@organization</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">organization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of  organization</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (str):  value for organization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_organization</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">org_vdc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live org_vdc value</span>

<span class="sd">        Returns:</span>
<span class="sd">            org_vdc     (str): True / False to enable or disable managed_vm</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_org_vdc</span>

    <span class="nd">@org_vdc</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">org_vdc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the org_vdc value</span>

<span class="sd">        Args:</span>
<span class="sd">            value     :  org_vdc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_org_vdc</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vapp_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live vapp_name</span>
<span class="sd">        Returns:</span>
<span class="sd">            storage_account     (str):  value of vapp_name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vapp_name</span>

    <span class="nd">@vapp_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vapp_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of  vapp_name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (str): value for _vapp_name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vapp_name</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">network_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live _network_setting</span>

<span class="sd">        Returns:</span>
<span class="sd">            vmsize     (str):  value of vm_size</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network_setting</span>

    <span class="nd">@network_setting</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">network_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the live _network_setting</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (str):  value for vmsize</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network_setting</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live source_network</span>

<span class="sd">        Returns:</span>
<span class="sd">            network_interface     (bool):  True / False to enable or disable live recovery</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_network</span>

    <span class="nd">@source_network</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">source_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the live _source_network</span>
<span class="sd">        Args:</span>
<span class="sd">            value  (str): value for _source_network</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_network</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">destination_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live security_group</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_network</span>

    <span class="nd">@destination_network</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">destination_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets value of _destination_network</span>
<span class="sd">        Args:</span>
<span class="sd">            value   (str):  value for _destination_network</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_destination_network</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">destination_vapp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value of Destination Vapp</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vapp</span>

    <span class="nd">@destination_vapp</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">destination_vapp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets value of _destination_Vapp</span>
<span class="sd">        Args:</span>
<span class="sd">            value   (str):  value for _destination_Vapp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vapp</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">new_vapp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value of Destination Vapp</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_vapp</span>

    <span class="nd">@new_vapp</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">new_vapp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets value of _destination_Vapp</span>
<span class="sd">        Args:</span>
<span class="sd">            value   (str):  value for _destination_Vapp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_vapp</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_set_vcloud_vm_restore_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Sets the VM restore options for each VM to be restored</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        if there is any exception in setting the restore options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vapp_name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_network</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vapp_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span> \
                        <span class="n">compute_free_resources</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_vapp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_vapp</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vapp_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_vapp</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vapp_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_vapp</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_network</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">destination_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_network</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;vapp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapp_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;source_network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_network</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;destination_network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_network</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during setting restore options&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">exp</span>

<div class="viewcode-block" id="VcloudAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.VcloudAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_level</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Performs full VM restore for a vCloud VM</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        if full VM restore or validation fails</span>

<span class="sd">                &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Performing full VM restore&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_vcloud_vm_restore_options</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">org_vdc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Org_vdc is none.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">vm_level</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>

            <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">vcloud_full_vm_restore</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">org_vdc</span><span class="p">,</span>
                <span class="n">power_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">restore_vapp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">restore_prefix</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">job_details</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">_vm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">)</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vm_restore_prefix</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during full VM restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>


<div class="viewcode-block" id="OracleCloudInfrastructureAdminConsole"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudInfrastructureAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">OracleCloudInfrastructureAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Oracle Cloud Infrastructure class to perform functions specific to Oracle Cloud Infrastructure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OracleCloudInfrastructureAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oci_subnet_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oci_shape_1</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">oci_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set shape&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">oci_shape_1</span>

    <span class="nd">@oci_shape</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">oci_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets shape &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oci_shape_1</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restore_location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_location</span>

    <span class="nd">@restore_location</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">restore_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_location</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">oci_subnet_name_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">oci_subnet_name</span>

    <span class="nd">@oci_subnet_name_prop</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">oci_subnet_name_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oci_subnet_name</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">oci_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set shape&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">oci_shape2</span>

    <span class="nd">@oci_shape</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">oci_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets shape &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oci_shape2</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="OracleCloudInfrastructureAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudInfrastructureAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_level</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Full VM restore for subclient.</span>
<span class="sd">        Args:</span>
<span class="sd">            vm_level: Enable vm_level restore</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>

            <span class="k">if</span> <span class="n">vm_level</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
            <span class="n">vm_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">oci_full_vm_restore</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">,</span>
                <span class="n">vm_obj</span><span class="p">,</span>
                <span class="n">restore_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span>
            <span class="p">)</span>
            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                             <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">for</span> <span class="n">vm_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">vm_name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                    <span class="n">vm_name</span> <span class="o">=</span> <span class="n">vm_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">vm_name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;VM restore validation failed for VM: </span><span class="si">{vm_name}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">exp</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception occurred during OCI Full VM restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="OracleCloudInfrastructureAdminConsole.validate_live_sync"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudInfrastructureAdminConsole.validate_live_sync">[docs]</a>    <span class="k">def</span> <span class="nf">validate_live_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replication_group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Validate Live Sync function, validates the live sync operation.</span>

<span class="sd">                Args:</span>
<span class="sd">                    replication_group_name (basestring)   --   Name of the replication group,</span>
<span class="sd">                    if not set, a replication group is automatically configured.</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        If the validation fails</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vm_backupgroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span>
        <span class="n">vm_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">replication_target_name</span> <span class="o">=</span> <span class="s2">&quot;Automation_Replication_Target&quot;</span>
        <span class="n">created_replication_group</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">dict_vals</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;hypervisor&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hypervisor</span><span class="p">,</span>
            <span class="s1">&#39;replication_group_name&#39;</span><span class="p">:</span> <span class="s2">&quot;Automation_Replication_Group&quot;</span><span class="p">,</span>
            <span class="s1">&#39;vm_backupgroup&#39;</span><span class="p">:</span> <span class="n">vm_backupgroup</span><span class="p">,</span>
            <span class="s1">&#39;replication_target&#39;</span><span class="p">:</span> <span class="n">replication_target_name</span><span class="p">,</span>
            <span class="s1">&#39;proxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span><span class="o">.</span><span class="n">machine_name</span><span class="p">,</span>
            <span class="s1">&#39;compartment&#39;</span><span class="p">:</span> <span class="n">vm_instance</span><span class="o">.</span><span class="n">compartment_name</span><span class="p">,</span>
            <span class="s1">&#39;datastore&#39;</span><span class="p">:</span> <span class="n">vm_instance</span><span class="o">.</span><span class="n">datastore</span><span class="p">,</span>
            <span class="s1">&#39;vcn&#39;</span><span class="p">:</span> <span class="n">vm_instance</span><span class="o">.</span><span class="n">vcn_name</span><span class="p">,</span>
            <span class="s1">&#39;shape&#39;</span><span class="p">:</span> <span class="n">vm_instance</span><span class="o">.</span><span class="n">instance_size</span><span class="p">,</span>
            <span class="s1">&#39;vm_name&#39;</span><span class="p">:</span> <span class="n">vm_instance</span><span class="o">.</span><span class="n">vm_name</span><span class="p">,</span>
            <span class="s1">&#39;subnet_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">oci_subnet_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oci_subnet_name</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">replication_group_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">configure_ls_replication_group</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configure_replication_group_obj</span><span class="o">.</span><span class="n">select_live_sync</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configure_vsa_replication_group_obj</span><span class="o">.</span><span class="n">configure_vsa_replication_group</span><span class="p">(</span><span class="n">dict_vals</span><span class="p">)</span>
            <span class="n">replication_group_name</span> <span class="o">=</span> <span class="s2">&quot;Automation_Replication_Group&quot;</span>
            <span class="n">created_replication_group</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">access_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>
        <span class="n">replication_job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_replication_job</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Getting status for the job </span><span class="si">{replication_job_id}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">replication_job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Completed&quot;</span><span class="p">,</span> <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Replication job failed. Please check the logs&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception occurred in getting the job status: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">access_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>

        <span class="n">sync_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_sync_status</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_status</span><span class="p">(</span><span class="n">sync_status</span><span class="p">,</span> <span class="s2">&quot;in sync&quot;</span><span class="p">),</span> <span class="s2">&quot;Sync status is not &#39;In Sync&#39;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
        <span class="n">source_vms</span><span class="p">,</span> <span class="n">destination_vms</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_source_and_destination</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">vm_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">vm_name</span> <span class="ow">in</span> <span class="n">source_vms</span> <span class="ow">or</span> <span class="n">vm_name</span> <span class="ow">in</span> <span class="n">destination_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">vm_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">source_vms</span><span class="p">)):</span>
            <span class="n">vm_restore_name</span> <span class="o">=</span> <span class="n">destination_vms</span><span class="p">[</span><span class="n">vm_index</span><span class="p">]</span>
            <span class="n">source_vm_name</span> <span class="o">=</span> <span class="n">source_vms</span><span class="p">[</span><span class="n">vm_index</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">vm_restore_name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                <span class="n">vm_restore_name</span> <span class="o">=</span> <span class="n">vm_restore_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">source_vm_name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                <span class="n">source_vm_name</span> <span class="o">=</span> <span class="n">source_vm_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">source_vm_name</span><span class="p">,</span> <span class="n">vm_restore_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;VM restore validation failed for VM: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_vms</span><span class="p">[</span><span class="n">vm_index</span><span class="p">]))</span>
                <span class="k">raise</span> <span class="n">exp</span>
        <span class="k">for</span> <span class="n">vm_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">vm_name</span> <span class="ow">in</span> <span class="n">destination_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span><span class="o">.</span><span class="n">vm_power_off</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">created_replication_group</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting Replication Group&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">delete_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_obj</span><span class="o">.</span><span class="n">navigate_to_replication_targets</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_obj</span><span class="o">.</span><span class="n">action_delete</span><span class="p">(</span><span class="n">replication_target_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="OracleCloudInfrastructureAdminConsole.perform_unplanned_failover"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudInfrastructureAdminConsole.perform_unplanned_failover">[docs]</a>    <span class="k">def</span> <span class="nf">perform_unplanned_failover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_vms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform Unplanned failover</span>
<span class="sd">        Args:</span>
<span class="sd">            source_vms: List of source VMs to perform failover</span>

<span class="sd">        Returns: Job ID of failover job</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">unplanned_failover</span><span class="p">(</span><span class="n">source_vms</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job_id</span></div>

<div class="viewcode-block" id="OracleCloudInfrastructureAdminConsole.perform_planned_failover"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudInfrastructureAdminConsole.perform_planned_failover">[docs]</a>    <span class="k">def</span> <span class="nf">perform_planned_failover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_vms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform planned failover</span>
<span class="sd">        Args:</span>
<span class="sd">            source_vms: List of source VMs to perform failover</span>

<span class="sd">        Returns: Job ID of failover job</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">planned_failover</span><span class="p">(</span><span class="n">source_vms</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job_id</span></div>

<div class="viewcode-block" id="OracleCloudInfrastructureAdminConsole.validate_unplanned_failover"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudInfrastructureAdminConsole.validate_unplanned_failover">[docs]</a>    <span class="k">def</span> <span class="nf">validate_unplanned_failover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replication_group_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Validate Planned Failover.</span>

<span class="sd">          Args:</span>
<span class="sd">              replication_group_name (basestring)   --   Name of the replication group,</span>
<span class="sd">                if not set, a replication group is automatically configured.</span>

<span class="sd">          Raises:</span>
<span class="sd">              Exception:</span>
<span class="sd">              If the validation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">access_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>
        <span class="n">source_vms</span><span class="p">,</span> <span class="n">destination_vms</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_source_and_destination</span><span class="p">()</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_unplanned_failover</span><span class="p">(</span><span class="n">source_vms</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">failover_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_failover_status</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_status</span><span class="p">(</span><span class="n">failover_status</span><span class="p">,</span> <span class="s2">&quot;failover in progress&quot;</span><span class="p">),</span> <span class="s2">&quot;Failover status not valid&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting status for the job </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Completed&quot;</span><span class="p">,</span> <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failover job failed. Please check the logs&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception occurred in getting the job status: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">vm_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">source_vms</span><span class="p">)):</span>
            <span class="n">source_vm</span> <span class="o">=</span> <span class="n">source_vms</span><span class="p">[</span><span class="n">vm_index</span><span class="p">]</span>
            <span class="n">destination_vm</span> <span class="o">=</span> <span class="n">destination_vms</span><span class="p">[</span><span class="n">vm_index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">source_vm</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                <span class="n">source_vm</span> <span class="o">=</span> <span class="n">source_vm</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">destination_vm</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                <span class="n">destination_vm</span> <span class="o">=</span> <span class="n">destination_vm</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">instance_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">get_vm_property</span><span class="p">(</span><span class="n">source_vm</span><span class="p">)</span>
            <span class="n">instance_destination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">get_vm_property</span><span class="p">(</span><span class="n">destination_vm</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">instance_source</span><span class="p">[</span><span class="s1">&#39;power_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;STOPPED&quot;</span> <span class="ow">and</span> \
                   <span class="n">instance_destination</span><span class="p">[</span><span class="s1">&#39;power_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;RUNNING&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Source VM is POWERED OFF and Destination VM is RUNNING&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unplanned failover validation successful&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OracleCloudInfrastructureAdminConsole.validate_planned_failover"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudInfrastructureAdminConsole.validate_planned_failover">[docs]</a>    <span class="k">def</span> <span class="nf">validate_planned_failover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replication_group_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate Planned Failover</span>
<span class="sd">        Args:</span>
<span class="sd">              replication_group_name (basestring)   --   Name of the replication group</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">              If the validation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">access_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>
        <span class="n">recovery_target_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_recovery_target</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_obj</span><span class="o">.</span><span class="n">navigate_to_replication_targets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_obj</span><span class="o">.</span><span class="n">select_replication_target</span><span class="p">(</span><span class="n">recovery_target_name</span><span class="p">)</span>

        <span class="n">destination_client_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_target_obj</span><span class="o">.</span><span class="n">get_destination_hypervisor</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">access_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>

        <span class="n">source_vms</span><span class="p">,</span> <span class="n">destination_vms</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_source_and_destination</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span> <span class="o">=</span> <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">get_testdata_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">machine</span><span class="p">)</span>
        <span class="n">checksum_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">vm_name</span> <span class="ow">in</span> <span class="n">source_vms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vm_name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                <span class="n">vm_name</span> <span class="o">=</span> <span class="n">vm_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">vm_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">vm_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vm_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_testdata</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">)</span>
            <span class="n">checksum_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">get_checksum_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">destination_client_name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
            <span class="n">destination_client_name</span> <span class="o">=</span> <span class="n">destination_client_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span><span class="n">destination_client_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Validating successfull completion of job</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_planned_failover</span><span class="p">(</span><span class="n">source_vms</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">failover_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_failover_status</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_status</span><span class="p">(</span><span class="n">failover_status</span><span class="p">,</span> <span class="s2">&quot;failover in progress&quot;</span><span class="p">),</span> <span class="s2">&quot;Failover status not valid&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting status for the job </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Completed&quot;</span><span class="p">,</span> <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failover job failed. Please check the logs&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception occurred in getting the job status: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span>

        <span class="c1"># Checksum list on destination</span>
        <span class="n">dest_checksum_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">vm_name</span> <span class="ow">in</span> <span class="n">destination_vms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vm_name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                <span class="n">vm_name</span> <span class="o">=</span> <span class="n">vm_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destination_client</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">vm_name</span>
            <span class="n">dest_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span>
            <span class="n">dest_vm</span><span class="o">.</span><span class="n">vm_power_on</span><span class="p">()</span>
            <span class="n">dest_checksum_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dest_vm</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">get_checksum_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">))</span>

        <span class="c1"># Testdata validation</span>
        <span class="k">assert</span> <span class="n">checksum_lst</span> <span class="o">==</span> <span class="n">dest_checksum_lst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Testdata Validation Completed Successfully.&quot;</span><span class="p">)</span>

        <span class="c1"># Config Validation</span>
        <span class="k">for</span> <span class="n">source_vm_name</span><span class="p">,</span> <span class="n">dest_vm_name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">source_vms</span><span class="p">,</span> <span class="n">destination_vms</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">source_vm_name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                <span class="n">source_vm_name</span> <span class="o">=</span> <span class="n">source_vm_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dest_vm_name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                <span class="n">dest_vm_name</span> <span class="o">=</span> <span class="n">dest_vm_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">source_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">source_vm_name</span><span class="p">]</span>
            <span class="n">dest_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">dest_vm_name</span><span class="p">]</span>
            <span class="n">_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VmValidation</span><span class="p">(</span><span class="n">source_vm</span><span class="p">)</span>
            <span class="n">_dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VmValidation</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Powering off source and destination VMs&quot;</span><span class="p">)</span>
            <span class="n">source_vm</span><span class="o">.</span><span class="n">vm_power_off</span><span class="p">()</span>
            <span class="n">dest_vm</span><span class="o">.</span><span class="n">vm_power_off</span><span class="p">()</span>

            <span class="k">assert</span> <span class="n">_source</span> <span class="o">==</span> <span class="n">_dest</span><span class="p">,</span> <span class="s2">&quot;Failed while config validation&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Config Validation Successfull&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OracleCloudInfrastructureAdminConsole.validate_failback"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudInfrastructureAdminConsole.validate_failback">[docs]</a>    <span class="k">def</span> <span class="nf">validate_failback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replication_group_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate Failback.</span>

<span class="sd">         Args:</span>
<span class="sd">              replication_group_name (basestring)   --   Name of the replication group</span>

<span class="sd">         Raises:</span>
<span class="sd">             Exception:</span>
<span class="sd">                If the validation fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">access_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>
        <span class="n">source_vms</span><span class="p">,</span> <span class="n">destination_vms</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_source_and_destination</span><span class="p">()</span>

        <span class="n">failover_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_failover_status</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_status</span><span class="p">(</span><span class="n">failover_status</span><span class="p">,</span> <span class="s2">&quot;failover complete&quot;</span><span class="p">),</span> <span class="s2">&quot;Failover status not valid&quot;</span>

        <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">failback</span><span class="p">(</span><span class="n">source_vms</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting status for the job </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Completed&quot;</span><span class="p">,</span> <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failback job failed. Please check the logs&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception occurred in getting the job status: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">vm_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">source_vms</span><span class="p">)):</span>
            <span class="n">source_vm</span> <span class="o">=</span> <span class="n">source_vms</span><span class="p">[</span><span class="n">vm_index</span><span class="p">]</span>
            <span class="n">destination_vm</span> <span class="o">=</span> <span class="n">destination_vms</span><span class="p">[</span><span class="n">vm_index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">source_vm</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                <span class="n">source_vm</span> <span class="o">=</span> <span class="n">source_vm</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">destination_vm</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_DN&quot;</span><span class="p">:</span>
                <span class="n">destination_vm</span> <span class="o">=</span> <span class="n">destination_vm</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">instance_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">get_vm_property</span><span class="p">(</span><span class="n">source_vm</span><span class="p">)</span>
            <span class="n">instance_destination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">get_vm_property</span><span class="p">(</span><span class="n">destination_vm</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">instance_source</span><span class="p">[</span><span class="s1">&#39;power_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;RUNNING&quot;</span> <span class="ow">and</span> \
                   <span class="n">instance_destination</span><span class="p">[</span><span class="s1">&#39;power_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;STOPPED&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Source VM is RUNNING and Destination VM is POWERED OFF&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failback validation successful&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">navigate_to_replication_groups</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_obj</span><span class="o">.</span><span class="n">access_group</span><span class="p">(</span><span class="n">replication_group_name</span><span class="p">)</span>
        <span class="n">failover_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replication_group_details_obj</span><span class="o">.</span><span class="n">get_failover_status</span><span class="p">()</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_status</span><span class="p">(</span><span class="n">failover_status</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;Failover status not valid&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failback validation successfull&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OracleCloudInfrastructureAdminConsole.validate_status"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudInfrastructureAdminConsole.validate_status">[docs]</a>    <span class="k">def</span> <span class="nf">validate_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_list</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">status_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_compute_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Credentials function, this has been overriden because the default</span>
<span class="sd">        function does not account for ocid, etc</span>

<span class="sd">        Args:</span>
<span class="sd">            client_name (basestring)   --   the name of the client whose credentials are</span>
<span class="sd">                                            to be obtained</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if compute credentials fails to get the credentials from the database</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">row_begin</span> <span class="o">=</span> <span class="s1">&#39;5&#39;</span>
            <span class="n">row_end</span> <span class="o">=</span> <span class="s1">&#39;15&#39;</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select ac.*</span><span class="se">\</span>
<span class="s2">                                  from (select Row_Number() Over ( Order By id ) as num, </span><span class="se">\</span>
<span class="s2">                                  * from app_Instanceprop where componentNameid =( </span><span class="se">\</span>
<span class="s2">                                  select TOP 1 instance  from APP_Application where clientId= ( </span><span class="se">\</span>
<span class="s2">                                  Select TOP 1 id from App_Client where name = &#39;</span><span class="si">%s</span><span class="s2">&#39;) </span><span class="se">\</span>
<span class="s2">                                   and appTypeId = &#39;106&#39;))ac </span><span class="se">\</span>
<span class="s2">                                  where ac.num between </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">client_name</span><span class="p">,</span> <span class="n">row_begin</span><span class="p">,</span> <span class="n">row_end</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_results</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;An exception occurred getting server details&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">_results</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;Oracle Cloud Infrastructure Tenancy Id&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">oci_tenancy_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="s1">&#39;Oracle Cloud Infrastructure User Id&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">oci_user_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="s1">&#39;Oracle Cloud Infrastructure Finger Print&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">oci_finger_print</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="s1">&#39;Oracle Cloud Infrastructure Private Key Password&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">oci_private_key_password</span> <span class="o">=</span> \
                        <span class="n">cvhelper</span><span class="o">.</span><span class="n">format_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">elif</span> <span class="s1">&#39;Oracle Cloud Infrastructure Region Name&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">oci_region_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An Exception occurred in getting credentials for Compute Credentials  </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span></div>


<div class="viewcode-block" id="GoogleCloudAdminConsole"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.GoogleCloudAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">GoogleCloudAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       Google Cloud class to perform functions specific to Google Cloud.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GoogleCloudAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>

<div class="viewcode-block" id="GoogleCloudAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.GoogleCloudAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                                Performs full VM restore for a Google Cloud VM</span>

<span class="sd">                                Raises:</span>
<span class="sd">                                    Exception:</span>
<span class="sd">                                        if full VM restore or validation fails</span>

<span class="sd">                                &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restoring the Google Cloud Instance&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">google_cloud_full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">,</span>
                                                                                <span class="n">proxy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                                                                                <span class="n">power_on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                                                                                <span class="n">overwrite_instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">)</span>
            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Google Cloud VM restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="GoogleCloudAdminConsole.guest_files_restore"><a class="viewcode-back" href="../../../../source/Web.AdminConsole.Helper.html#Web.AdminConsole.Helper.VirtualServerHelper.GoogleCloudAdminConsole.guest_files_restore">[docs]</a>    <span class="k">def</span> <span class="nf">guest_files_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vm_level</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        File level restore to source VM</span>

<span class="sd">        Args:</span>
<span class="sd">            in_place    (bool):     if the files should be restored to the source path</span>

<span class="sd">            vm_level    (bool):     if the restore should be initiated from VM level</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the file level restore fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span> <span class="o">=</span> <span class="n">_vm</span>

                <span class="k">for</span> <span class="n">_drive</span><span class="p">,</span> <span class="n">_folder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                        <span class="n">restore_path</span> <span class="o">=</span> <span class="n">_folder</span>
                        <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">_folder</span><span class="p">,</span> <span class="s2">&quot;AdminConsole&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>
                        <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">restore_path</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">restore_path</span> <span class="o">!=</span> <span class="n">_folder</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">restore_path</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci_enabled</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">navigate_to_virtual_machines</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_machines_obj</span><span class="o">.</span><span class="n">open_vm</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vm_details_obj</span><span class="o">.</span><span class="n">vm_search_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">search_for_content</span><span class="p">(</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="n">_drive</span><span class="p">,</span>
                            <span class="n">include_folders</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">select_data_type</span><span class="p">(</span><span class="s2">&quot;Folder&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">validate_contains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span>
                                                              <span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_search_obj</span><span class="o">.</span><span class="n">validate_contains</span><span class="p">(</span><span class="n">_drive</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                              <span class="n">folder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">vm_level</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_navigate_to_vm_restore</span><span class="p">(</span><span class="n">_vm</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_aux</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_copy</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;snap&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">snap_copy</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;snap&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_source_copy</span><span class="p">(</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_guest_files</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">latest_backups</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">_folder</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span><span class="o">.</span><span class="n">select_volume</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_folder</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span><span class="o">.</span><span class="n">select_volume</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>

                    <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_files_obj</span><span class="o">.</span><span class="n">submit_google_cloud_vm_restore</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()],</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                        <span class="n">restore_path</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="p">,</span> <span class="n">validate_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during guest files restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>