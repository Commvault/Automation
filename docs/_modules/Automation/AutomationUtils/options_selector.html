
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Automation.AutomationUtils.options_selector &#8212; Commvault Automation 11.14 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for Automation.AutomationUtils.options_selector</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Helper file consisting of common operations that may be required for automating any test case.</span>

<span class="sd">Any common operations that are not any machine specific can be added to this file.</span>

<span class="sd">The instance of the OptionsSelector can be used to perform operations such as,</span>

<span class="sd">1. Creating a Unique directory name to restore the contents to</span>
<span class="sd">2. Get the Windows client to restore the data to, in case of Out-of-Place restore</span>
<span class="sd">3. Get the UNIX client to restore the data to, in case of Out-of-Place restore</span>


<span class="sd">OptionsSelector:</span>

<span class="sd">    __init__()                      --  initializes instance of the OptionsSelector class</span>

<span class="sd">    __repr__()                      --  Representation string for the instance of the</span>
<span class="sd">                                        OptionsSelector class</span>

<span class="sd">    pop_keys()                      --  Remove specific keys of a dictionary send as a list</span>

<span class="sd">    sleep_time()                    --  Calls time.sleep for specified time and logs it</span>

<span class="sd">    get_var()                       --  Return default value if variable value is empty</span>

<span class="sd">    get_custom_str()                --  Returns a unique string based on pre &amp; post substrings</span>

<span class="sd">    _get_restore_dir_name()         --  returns the directory name to restore the contents at</span>

<span class="sd">    get_windows_restore_client()    --  returns windows restore client object and restore path</span>

<span class="sd">    get_linux_restore_client()      --  returns linux restore client object and restore path</span>

<span class="sd">    get_client()                    --  Gets the client data from DB for given query type</span>

<span class="sd">    get_ma()                        --  Gets the media agent data from DB for given query type</span>

<span class="sd">    get_ready_clients()             --  Takes a list of clients and returns a tuple of</span>
<span class="sd">                                        ready clients and number of clients</span>

<span class="sd">    get_client_ids()                 --  Gets the client data from DB for given query type</span>

<span class="sd">    exec_commserv_query()           --  Executes DB query against Commserve DB</span>

<span class="sd">    remove_directory()              --  Removes a directory from file system from client</span>

<span class="sd">    create_directory()              --  Creates a directory on file system for client</span>

<span class="sd">    create_test_data()              --  Creates test data on client</span>

<span class="sd">    check_reg_key()                 --  Check/Gets the registry key value for given registry key</span>
<span class="sd">                                            on a client.</span>

<span class="sd">    get_machine_object()            --  Creates/Returns machine object based on user defined</span>
<span class="sd">                                            input of client name as string or machine object.</span>

<span class="sd">    _get_resultset()                --  Gets the resultset from the DB</span>

<span class="sd">CVEntities:</span>
<span class="sd">    __init__()                  -- Initialize instance of the CVEntities class</span>

<span class="sd">    __repr__()                  -- Representation string for the instance of the</span>
<span class="sd">                                    CVEntities class for specific test case</span>

<span class="sd">    create()                    -- Creates various commcell entities</span>

<span class="sd">    delete()                    -- Deletes various commcell entities</span>

<span class="sd">    cleanup()                   -- Deletes all the entities created as part of</span>
<span class="sd">                                    multiple testcase calls to create() module</span>

<span class="sd">    get_mount_path()            -- Returns the mount path where library shall be</span>
<span class="sd">                                    created for a given Media Agent</span>

<span class="sd">    create_client_groups()      -- Creates client groups from a given list of client</span>
<span class="sd">                                    group names</span>

<span class="sd">    delete_client_groups()      -- Deletes client groups from a given dictionary of</span>
<span class="sd">                                    client group properties</span>

<span class="sd">    update_clientgroup()        -- Updates the properties of an existing client group</span>

<span class="sd">    create_sp_copy()</span>
<span class="sd">                                -- Creates a storage policy copy for the given storage policy.</span>

<span class="sd">    post_delete()                -- Performs the post delete configuration for the entity.</span>

<span class="sd">    post_create()                -- Performs the post creation configuration for the entity</span>

<span class="sd">    existing_config()            -- Performs configuration for existing entity.</span>

<span class="sd">    _get_entity_objects()       -- Private module to get the dependent entity objects</span>
<span class="sd">                                    for a given entity.</span>

<span class="sd">    _get_target_props()         -- Gets the target entity properties from target: key</span>
<span class="sd">                                    if specified, otherwise gets the properties from</span>
<span class="sd">                                    individual entity properties.</span>

<span class="sd">    _get_target_str()           -- Target string where the entity will be created.</span>

<span class="sd">    _purge_entities()           -- Private module to remove entity properties and</span>
<span class="sd">                                    object details from cleanup map dictionary</span>

<span class="sd">    refresh()                   -- Refreshes the entity dictionaries and individual</span>
<span class="sd">                                    entity configuration dictionaries, which are</span>
<span class="sd">                                    created dynamically to hold entity properties.</span>

<span class="sd">    Properties:</span>
<span class="sd">    ----------</span>

<span class="sd">    entity_object_map            -- Dictionary containing created entities and their</span>
<span class="sd">                                    properties.</span>

<span class="sd">_Backupset/_Subclient/_StoragePolicy/_Disklibrary/_Clientgroup:</span>

<span class="sd">    __init__()                   -- Initializes instance of specific class  (Private class)</span>

<span class="sd">    object()                     -- Gets the associated object and checks if the entity exists</span>

<span class="sd">    target()                     -- Gets the target string on which the entity shall be created</span>

<span class="sd">    post_delete()                -- Performs the post delete configuration for the entity</span>

<span class="sd">    post_create()                -- Performs the post creation configuration for the entity</span>

<span class="sd">    get_properties()             -- Takes in dictionary of entity properties to be created and</span>
<span class="sd">                                        dictionary of created entities and sets the entity</span>
<span class="sd">                                        properties based on input association and defaults.</span>

<span class="sd">    existing_config()            -- Performs configuration for existing entity which</span>
<span class="sd">                                        will not be created by the CVEntities class,</span>
<span class="sd">                                        due to force option set to False.</span>

<span class="sd">    add_args()                   -- Returns the keyword arguments to send to add()</span>
<span class="sd">                                        module for creating the entity</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">inspect</span>

<span class="kn">from</span> <span class="nn">past.types.basestring</span> <span class="k">import</span> <span class="n">basestring</span>

<span class="kn">from</span> <span class="nn">cvpysdk.commcell</span> <span class="k">import</span> <span class="n">Commcell</span>
<span class="kn">from</span> <span class="nn">cvpysdk.policies.storage_policies</span> <span class="k">import</span> <span class="n">StoragePolicy</span>

<span class="kn">from</span> <span class="nn">Server.serverhandlers</span> <span class="k">import</span> <span class="n">argtypes</span><span class="p">,</span> <span class="n">returntype</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">database_constants</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">.machine</span> <span class="k">import</span> <span class="n">Machine</span>
<span class="kn">from</span> <span class="nn">.database_helper</span> <span class="k">import</span> <span class="n">get_csdb</span>


<div class="viewcode-block" id="OptionsSelector"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector">[docs]</a><span class="k">class</span> <span class="nc">OptionsSelector</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class that provides common utilities for running automation&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commcell</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes CommonUtils object</span>

<span class="sd">            Args:</span>
<span class="sd">                commcell    (object)    --  CvPySDK commcell object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testdata_folder</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Representation string for the instance of the OptionsSelector class.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;OptionsSelector class instance&quot;</span>

<div class="viewcode-block" id="OptionsSelector.pop_keys"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.pop_keys">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">pop_keys</span><span class="p">(</span><span class="n">source_dict</span><span class="p">,</span> <span class="n">source_keys</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Remove keys of a dictionary&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">source_keys</span><span class="p">:</span>
            <span class="n">source_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">source_dict</span></div>

<div class="viewcode-block" id="OptionsSelector.sleep_time"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.sleep_time">[docs]</a>    <span class="k">def</span> <span class="nf">sleep_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_time</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">logmessage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Sleep for the specified interval of time. Default time = 60 seconds.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">logmessage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">logmessage</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for [</span><span class="si">%s</span><span class="s2">] seconds&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">_time</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_time</span><span class="p">)</span></div>

<div class="viewcode-block" id="OptionsSelector.get_var"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.get_var">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_var</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">defaultval</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return default property value if property value is empty&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">defaultval</span> <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">prop</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="n">prop</span></div>

<div class="viewcode-block" id="OptionsSelector.get_custom_str"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.get_custom_str">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_custom_str</span><span class="p">(</span><span class="n">presubstr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">postsubstr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a unique string based on pre and post sub strings &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">presubstr</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">DESCRIPTION</span> <span class="k">if</span> <span class="n">presubstr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">presubstr</span>
            <span class="n">postsubstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span> <span class="k">if</span> <span class="n">postsubstr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">postsubstr</span>
            <span class="n">_time</span> <span class="o">=</span> <span class="s1">&#39;{date:%m-</span><span class="si">%d</span><span class="s1">-%Y_%H_%M_%S}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
            <span class="k">return</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">presubstr</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">_time</span><span class="p">),</span> <span class="n">postsubstr</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_restore_dir_name</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Returns the directory name with current time to restore the contents at.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H-%M-%S&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;CVAutomationRestore-&#39;</span> <span class="o">+</span> <span class="n">current_time</span>

<div class="viewcode-block" id="OptionsSelector.get_drive"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.get_drive">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_drive</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5120</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterates over the drives and returns drive with free space greater than specified</span>

<span class="sd">            Args:</span>
<span class="sd">                machine     (object)    --  Machine class object on which the free space is to be</span>
<span class="sd">                                                determined</span>

<span class="sd">                size        (int)       --  free space required on this machine</span>
<span class="sd">                    default: 5120 MB</span>

<span class="sd">            Returns:</span>
<span class="sd">                str     -   drive path on which free space is greater than specified size</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">machine</span><span class="o">.</span><span class="n">os_info</span> <span class="o">==</span> <span class="s1">&#39;WINDOWS&#39;</span><span class="p">:</span>
            <span class="n">drives_dict</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">get_storage_details</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">drive</span> <span class="ow">in</span> <span class="n">drives_dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">drives_dict</span><span class="p">[</span><span class="n">drive</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="n">drives_dict</span><span class="p">[</span><span class="n">drive</span><span class="p">][</span><span class="s1">&#39;available&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">drive</span> <span class="o">+</span> <span class="s2">&quot;:</span><span class="se">\\</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">drives_dict</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">get_storage_details</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">drives_dict</span><span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/root/Desktop/&#39;</span>

        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
            <span class="s2">&quot;Low disk space on </span><span class="si">{0}</span><span class="s2">. Please free up some space.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OptionsSelector.get_windows_restore_client"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.get_windows_restore_client">[docs]</a>    <span class="k">def</span> <span class="nf">get_windows_restore_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5120</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterates over the list of available Windows clients on the Commcell,</span>
<span class="sd">            and Returns the instance of the Machine class for the valid client,</span>
<span class="sd">            and the directory path to restore the contents at.</span>

<span class="sd">            The Restore Directory is created on the drive which has the minimum required free</span>
<span class="sd">            space available.</span>

<span class="sd">                e.g.:</span>
<span class="sd">                    C:\\CVAutomationRestore-DATETIME</span>

<span class="sd">                    E:\\CVAutomationRestore-DATETIME</span>

<span class="sd">            Args:</span>
<span class="sd">                size    (int)   --  minimum available free space required on restore machine</span>

<span class="sd">                    default: 5120 MB</span>

<span class="sd">            Returns:</span>
<span class="sd">                (object, str)   -   (instance of the Machine class, the restore directory path)</span>

<span class="sd">                    object  -   instance of the Machine class for the Windows client</span>

<span class="sd">                    str     -   directory path to restore the contents at</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if no windows client with specified size exists on commcell</span>

<span class="sd">                    if any exception is raised while determining restore client</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get Windows restore client from commcell&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">all_clients</span><span class="p">:</span>
                <span class="n">client_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

                <span class="k">if</span> <span class="s1">&#39;windows&#39;</span> <span class="ow">in</span> <span class="n">client_object</span><span class="o">.</span><span class="n">os_info</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">windows_client</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">client_object</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="c1"># raises Exception if machine is not reachable / services are down</span>
                        <span class="c1"># continue to next client in such cases</span>
                        <span class="k">continue</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_drive</span><span class="p">(</span><span class="n">windows_client</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">drive</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_restore_dir_name</span><span class="p">()</span>
                    <span class="n">windows_client</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Windows Restore Client obtained: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">windows_client</span><span class="o">.</span><span class="n">machine_name</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Windows Restore location: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">windows_client</span><span class="p">,</span> <span class="n">dir_path</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;No Windows client with size equal or more than </span><span class="si">{0}</span><span class="s2">MB exists on commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">size</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get windows restore client with error: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span></div>

<div class="viewcode-block" id="OptionsSelector.get_linux_restore_client"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.get_linux_restore_client">[docs]</a>    <span class="k">def</span> <span class="nf">get_linux_restore_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5120</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterates over the list of available UNIX clients on the Commcell,</span>
<span class="sd">            and Returns the instance of the Machine class for the valid client,</span>
<span class="sd">            and the directory path to restore the contents at.</span>

<span class="sd">            The Restore Directory is created in the Desktop of root on the client,</span>
<span class="sd">            which has the minimum required free space available.</span>

<span class="sd">                e.g.:</span>
<span class="sd">                    /root/Desktop/CVAutomationRestore-DATETIME</span>

<span class="sd">            Args:</span>
<span class="sd">                size    (int)   --  minimum available free space required on restore machine</span>

<span class="sd">                    default: 5120 MB</span>

<span class="sd">            Returns:</span>
<span class="sd">                (object, str)   -   (instance of the Machine class, the restore directory path)</span>

<span class="sd">                    object  -   instance of the Machine class for the Windows client</span>

<span class="sd">                    str     -   directory path to restore the contents at</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if no linux client with specified size exists on commcell</span>

<span class="sd">                    if any exception is raised while determining restore client</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get UNIX restore client from commcell&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">all_clients</span><span class="p">:</span>
                <span class="n">client_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;linux&#39;</span> <span class="ow">in</span> <span class="n">client_object</span><span class="o">.</span><span class="n">os_info</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span>
                        <span class="s1">&#39;unix&#39;</span> <span class="ow">in</span> <span class="n">client_object</span><span class="o">.</span><span class="n">os_info</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">linux_client</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">client_object</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="c1"># raises Exception if machine is not reachable / services are down</span>
                        <span class="c1"># continue to next client in such cases</span>
                        <span class="k">continue</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">mount_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_drive</span><span class="p">(</span><span class="n">linux_client</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">mount_path</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_restore_dir_name</span><span class="p">()</span>
                    <span class="n">linux_client</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Linux Restore Client obtained: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">linux_client</span><span class="o">.</span><span class="n">machine_name</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Linux Restore location: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>

                    <span class="k">return</span> <span class="n">linux_client</span><span class="p">,</span> <span class="n">dir_path</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;No Linux client with size equal or more than </span><span class="si">{0}</span><span class="s2"> MB exists on commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">size</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get linux restore client with error: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span></div>

<div class="viewcode-block" id="OptionsSelector.get_client"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.get_client">[docs]</a>    <span class="k">def</span> <span class="nf">get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ready</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="s1">&#39;client&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetches the details from Commserve DB with specific requirement.</span>
<span class="sd">            Requirement is mapped to query_type</span>

<span class="sd">            Args:</span>
<span class="sd">                query_type   (str)   -- query type to execute, to fetch data from Commserver DB</span>

<span class="sd">                num (int)             -- Number of clients to return</span>
<span class="sd">                                         Default value = 1</span>
<span class="sd">                                         If num=&#39;all&#39; fetch all available clients</span>

<span class="sd">                ready (bool)          -- True - Clients passing readiness check will be returned</span>
<span class="sd">                                         False - Clients whether ready or not shall be returned</span>

<span class="sd">                entity (str)          -- Supported strings -&gt; &#39;client&#39; or &#39;mediaagent&#39;</span>
<span class="sd">                                            Default is &#39;client&#39;</span>

<span class="sd">                *args -- Arguments to this module to control module execution and return value</span>

<span class="sd">                    &#39;all&#39;: Returns tuple with (&lt;first column list&gt;, Complete resultset)</span>

<span class="sd">                **kwargs (dict) -- Contains name value pairs for various arguments</span>

<span class="sd">            Returns:</span>
<span class="sd">                (list) -- First column list from the resultset</span>

<span class="sd">                (tuple) -- tuple with (&lt;first column list&gt;, Complete resultset)</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if query argument value is not supported</span>

<span class="sd">                    if failed to execute DB query.</span>

<span class="sd">            Usage:</span>
<span class="sd">                get_client() - Returns 1 ready client</span>

<span class="sd">                get_client(&#39;all&#39;, 3, False)</span>
<span class="sd">                    Returns 3 clients [ Might or might not be ready ]</span>

<span class="sd">                get_client(&#39;non_ma&#39;, 2)</span>
<span class="sd">                    Returns 2 clients on which media agent is not installed/configured</span>

<span class="sd">                clients = get_client()</span>
<span class="sd">                    Returns 1 ready client.</span>
<span class="sd">                    Return type - (Str)</span>
<span class="sd">                    clients = &#39;client1&#39;</span>

<span class="sd">                clients = get_client(&#39;all&#39;, 3, False)</span>
<span class="sd">                    Returns 3 client(s) [ Might or might not be ready ] [False]</span>
<span class="sd">                    Return type - (List)</span>
<span class="sd">                    clients = [&#39;client1&#39;, &#39;client2&#39;, &#39;client3&#39;]</span>

<span class="sd">                clients = get_client(&#39;non_ma&#39;, 3)</span>
<span class="sd">                    Returns 3 &#39;ready&#39; clients on which media agent is not installed</span>
<span class="sd">                    Return type - (list)</span>
<span class="sd">                    clients = [&#39;client1&#39;, &#39;client2&#39;, &#39;client3&#39;]</span>

<span class="sd">                clients = get_client(&#39;all&#39;, 3, True, &#39;all&#39;)</span>
<span class="sd">                    Returns 3 ready client list and their resultset</span>
<span class="sd">                    Return type - tuple</span>
<span class="sd">                    clients = ([&#39;client1&#39;, &#39;client2&#39;], [&lt;client1 resultset&gt;, &lt;client2 resultset&gt;])</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">exception_</span> <span class="o">=</span> <span class="s2">&quot;Failed to get </span><span class="si">{0}</span><span class="s2"> details with error&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
        <span class="n">validate</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">rs_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_resultset</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">query_type</span><span class="p">,</span> <span class="n">validate</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rs_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">num</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">num</span>

            <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rs_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Number of required </span><span class="si">{0}</span><span class="s2">(s): [</span><span class="si">{1}</span><span class="s2">], Available&quot;</span>
                                <span class="s2">&quot; (from DB): [</span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rs_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>

            <span class="k">if</span> <span class="n">ready</span><span class="p">:</span>
                <span class="n">new_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ready_clients</span><span class="p">(</span><span class="n">rs_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_list</span> <span class="o">=</span> <span class="n">rs_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="n">num</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="c1"># Tuple-&gt; ([&#39;cl1&#39;, &#39;cl2&#39;], [cl1 db resultset , cl2 db resultset])</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">new_list</span><span class="p">,</span> <span class="n">rs_list</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="n">num</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># String-&gt; &#39;cl1&#39;</span>
                <span class="k">return</span> <span class="n">new_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># List-&gt; [&#39;cl1&#39;, &#39;cl2&#39;]</span>
            <span class="k">return</span> <span class="n">new_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">exception_</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OptionsSelector.get_ma"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.get_ma">[docs]</a>    <span class="k">def</span> <span class="nf">get_ma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;disk&#39;</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ready</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetches the details from Commserve DB with specific requirement.</span>
<span class="sd">            Requirement is mapped to query</span>

<span class="sd">            Args:</span>
<span class="sd">                query   (str)   -- query type to execute, to fetch data from Commserver DB</span>

<span class="sd">                    Supported types:</span>

<span class="sd">                        diskless: No disk library is configured</span>

<span class="sd">                        disk    : At least 1 disk library configured</span>

<span class="sd">                        windows : Windows media agent</span>

<span class="sd">                        aliasname : Gets the media agent from alias name</span>

<span class="sd">                num (int)             -- Number of media agents to fetch from DB</span>
<span class="sd">                                         Default value : 1</span>

<span class="sd">                ready (bool)           -- True  - Media agents passing readiness check shall be</span>
<span class="sd">                                                    returned</span>

<span class="sd">                                          False - All clients whether ready or not shall be</span>
<span class="sd">                                                      returned</span>

<span class="sd">                *args -- Arguments to this module to control module execution and return value</span>

<span class="sd">                    &#39;all&#39;: Returns tuple with (&lt;first column list&gt;, Complete resultset)</span>

<span class="sd">                    -Otherwise returns a list or a string based on the argument &#39;num&#39; value</span>

<span class="sd">                **kwargs (dict) -- Contains name value pairs for various arguments</span>

<span class="sd">            Returns:</span>
<span class="sd">                (list) -- First column list from the resultset</span>

<span class="sd">                (tuple) -- tuple with (&lt;first column list&gt;, Complete resultset)</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if query argument value is not supported</span>

<span class="sd">                    if failed to execute DB query.</span>

<span class="sd">            Usage:</span>
<span class="sd">                ma = get_ma()</span>
<span class="sd">                    Returns 1 ready media agent of any platform</span>
<span class="sd">                    Return type - (Str)</span>
<span class="sd">                    ma = &#39;client1&#39;</span>

<span class="sd">                ma = get_ma(&#39;windows&#39;)</span>
<span class="sd">                    Returns 1 ready media agent (Windows)</span>
<span class="sd">                    Return type - (Str)</span>
<span class="sd">                    ma = &#39;client1&#39;</span>

<span class="sd">                ma = get_ma(&#39;aliasname&#39;, ready=False, mount_path=&#39;C:\\disklib01&#39;)</span>
<span class="sd">                    Returns Disklibrary alias for given mount_path  [ May or may not be ready ]</span>
<span class="sd">                    Return type - (Str)</span>
<span class="sd">                    ma = &#39;client1&#39;</span>

<span class="sd">                ma = get_ma(&#39;disk&#39;, 3, True, &#39;all&#39;)</span>
<span class="sd">                    Returns 3 ready media agents with at least one disk library configured</span>
<span class="sd">                    and their resultset</span>
<span class="sd">                    Return type - tuple</span>
<span class="sd">                    ma = ([&#39;client1&#39;, &#39;client2&#39;], [&lt;client1 resultset&gt;, &lt;client2 resultset&gt;])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">arg_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;aliasname&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mount_path&#39;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">query_type</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">ready</span><span class="p">,</span> <span class="s1">&#39;mediaagent&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="OptionsSelector.get_ready_clients"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.get_ready_clients">[docs]</a>    <span class="k">def</span> <span class="nf">get_ready_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clients</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">os_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Takes a list of clients and returns a list of ready clients</span>

<span class="sd">            Args:</span>
<span class="sd">                clients(list)    -- list of clients on which check readiness needs to</span>
<span class="sd">                                    be performed.</span>

<span class="sd">                num (int)        -- Total number of clients to be fetched which pass</span>
<span class="sd">                                    readiness checked from &#39;clients&#39;</span>
<span class="sd">                                    Default = 1 client</span>

<span class="sd">                validate (bool)  -- Validate if number of clients which passed</span>
<span class="sd">                                    readiness check equals &#39;num&#39; [Total clients</span>
<span class="sd">                                    to be fetched]</span>

<span class="sd">                os_type (string) -- OS info for the clients for which readiness has to be checked</span>
<span class="sd">                                    Eg, &quot;Unix&quot;</span>
<span class="sd">            Returns:</span>
<span class="sd">                (tuple)        -- (Clients list passed readiness check,</span>
<span class="sd">                                    total clients passed)</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    If failed to get client list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clientlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)</span> <span class="k">if</span> <span class="n">num</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">num</span>
            <span class="n">_clients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span>

            <span class="k">if</span> <span class="n">os_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">os_type_clients</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">clients</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os_type</span> <span class="ow">in</span> <span class="n">_clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="o">.</span><span class="n">os_info</span><span class="p">:</span>
                        <span class="n">os_type_clients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
                <span class="n">clients</span> <span class="o">=</span> <span class="n">os_type_clients</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Number of ready clients to fetch = [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">clients</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">client_</span> <span class="o">=</span> <span class="n">_clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executing readiness check on [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">client_</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Readiness check passed.&quot;</span><span class="p">)</span>

                    <span class="n">clientlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clientlist</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">num</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Readiness check failed.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">validate</span> <span class="ow">and</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">clientlist</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Required client(s): [</span><span class="si">{0}</span><span class="s2">], Clients passed readiness&quot;</span>
                                <span class="s2">&quot; check: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">clientlist</span><span class="p">)))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Ready clients fetched: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clientlist</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Number of clients fetched: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clientlist</span><span class="p">)))</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">clientlist</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">clientlist</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2"> failed to get ready client(s) with&quot;</span>
                            <span class="s2">&quot; error </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OptionsSelector.get_client_ids"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.get_client_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_client_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;GROUP_ID&#39;</span><span class="p">,</span>
                       <span class="n">entity</span><span class="o">=</span><span class="s1">&#39;client&#39;</span><span class="p">,</span>
                       <span class="n">id_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetches the details from Commserve DB with specific requirement.</span>
<span class="sd">           Requirement is mapped to query_type</span>

<span class="sd">            Args:</span>
<span class="sd">                query_type(str)         -- query type to execute, to fetch data from Commserver DB</span>

<span class="sd">                entity    (str)         --  Supported string -&gt; &#39;client&#39; Default is &#39;client&#39;</span>

<span class="sd">                id_value  (str)         --  value to be passed to filter the query</span>

<span class="sd">            Returns:</span>
<span class="sd">                (tuple) -- tuple with (&lt;first column list&gt;, Complete resultset)</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>

<span class="sd">                    if failed to execute DB query.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">exception_</span> <span class="o">=</span> <span class="s2">&quot;Failed to get [</span><span class="si">{0}</span><span class="s2">] details with error&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started executing DB query for entity: </span><span class="si">{0}</span><span class="s2"> with query_typ: </span><span class="si">{1}</span><span class="s2">&quot;</span>
                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">query_type</span><span class="p">))</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">database_constants</span><span class="o">.</span><span class="n">CLASS_MAP</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span>
            <span class="n">class_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">database_constants</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>
            <span class="n">dbquery</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">class_obj</span><span class="p">,</span> <span class="n">query_type</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="n">id_value</span><span class="p">:</span>
                <span class="n">dbquery</span> <span class="o">=</span> <span class="n">dbquery</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">id_value</span><span class="p">)</span>
            <span class="n">rs_tuple</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="n">dbquery</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rs_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception_</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OptionsSelector.exec_commserv_query"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.exec_commserv_query">[docs]</a>    <span class="k">def</span> <span class="nf">exec_commserv_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Executes a DB query against Commserv Database</span>

<span class="sd">            Args:</span>
<span class="sd">                query (str) -- Database query to execute</span>

<span class="sd">            Returns:</span>
<span class="sd">                (tuple) -- tuple with (&lt;first column list&gt;, Complete resultset)</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - if failed to get data from DB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executing DB query: </span><span class="se">\n</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>

            <span class="n">csdb</span> <span class="o">=</span> <span class="n">get_csdb</span><span class="p">()</span>
            <span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Commserv DB resultset: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

            <span class="c1"># Return tuple of 1st column list and the complete resultset</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OptionsSelector.remove_directory"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.remove_directory">[docs]</a>    <span class="k">def</span> <span class="nf">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targethost</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Removes a directory on a commcell client</span>

<span class="sd">            Args:</span>
<span class="sd">                targethost    (str)/(Machine object)</span>
<span class="sd">                                       -- Machine on which the directory has to be</span>
<span class="sd">                                            removed</span>

<span class="sd">                directory     (str)    -- Directory that needs to be removed</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to remove directory</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">targethost</span><span class="p">)</span>
            <span class="n">machine_name</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting directory [</span><span class="si">{0}</span><span class="s2">] on [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">machine_name</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to delete directory [</span><span class="si">{0}</span><span class="s2">] on [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">machine_name</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully deleted directory [</span><span class="si">{0}</span><span class="s2">] on [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">machine_name</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OptionsSelector.create_directory"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.create_directory">[docs]</a>    <span class="k">def</span> <span class="nf">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targethost</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dirstring</span><span class="o">=</span><span class="s2">&quot;TestData&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Creates a directory on a commcell client</span>

<span class="sd">            Args:</span>
<span class="sd">                targethost    (str)/(Machine object)</span>
<span class="sd">                                       -- Machine on which the directory has to be created</span>

<span class="sd">                directory     (str)    -- Directory that needs to be created</span>

<span class="sd">                dirstring     (str)    -- In case directory is not provided, a new directory will</span>
<span class="sd">                                            be created with this string as sub-directory under</span>
<span class="sd">                                            parent directory.</span>

<span class="sd">            Returns:</span>
<span class="sd">                directory that was created</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to create directory</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">targethost</span><span class="p">)</span>
            <span class="n">_name</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span>

            <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">testdata_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">parent_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_drive</span><span class="p">(</span><span class="n">machine</span><span class="p">)</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">TESTDATA_DIR_NAME</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">testdata_folder</span> <span class="o">=</span> <span class="n">parent_folder</span>
                <span class="n">unique_subdir</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">get_custom_str</span><span class="p">(</span><span class="s1">&#39;Auto&#39;</span><span class="p">,</span> <span class="s1">&#39;subdir&#39;</span><span class="p">)</span>
                <span class="n">_dir</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">os_sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata_folder</span><span class="p">,</span> <span class="n">dirstring</span><span class="p">,</span> <span class="n">unique_subdir</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating directory [</span><span class="si">{0}</span><span class="s2">] on [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_dir</span><span class="p">,</span> <span class="n">_name</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">_dir</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to create directory [</span><span class="si">{0}</span><span class="s2">] on [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_dir</span><span class="p">,</span> <span class="n">_name</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created directory [</span><span class="si">{0}</span><span class="s2">] on [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_dir</span><span class="p">,</span> <span class="n">_name</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">_dir</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OptionsSelector.create_test_data"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.create_test_data">[docs]</a>    <span class="k">def</span> <span class="nf">create_test_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">client</span><span class="p">,</span>
                         <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">levels</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_DIR_LEVEL</span><span class="p">,</span>
                         <span class="n">file_size</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_FILE_SIZE</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Creates test data on the client machine provided</span>

<span class="sd">        Args:</span>
<span class="sd">            client (str)/(Machine object)</span>
<span class="sd">                                --  Client name on which data needs to be created</span>

<span class="sd">            data_path  (str)    --  Path where test data is to be generated</span>
<span class="sd">                                    Default: Will be defined if not set</span>

<span class="sd">            level (int)         --  Depth of folders under test data</span>

<span class="sd">            size (int)          --  size of each test file to be generated in KB</span>

<span class="sd">        Returns:</span>
<span class="sd">            Parent directory path to test data directory path</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                When failed to create testdata</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">machine_name</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span>

            <span class="k">if</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">machine</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating test data on client </span><span class="si">{0}</span><span class="s2"> with level </span><span class="si">{1}</span><span class="s2">, file size </span><span class="si">{2}</span><span class="s2">&quot;</span>
                           <span class="s2">&quot;KB, path </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">machine_name</span><span class="p">,</span>
                                                 <span class="nb">str</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span>
                                                 <span class="nb">str</span><span class="p">(</span><span class="n">file_size</span><span class="p">),</span>
                                                 <span class="n">file_path</span><span class="p">))</span>

            <span class="n">machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">file_path</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OptionsSelector.check_reg_key"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.check_reg_key">[docs]</a>    <span class="k">def</span> <span class="nf">check_reg_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">reg_key</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">expected_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fail</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check/Gets the registry key value for given registry key on a client</span>

<span class="sd">            Args:</span>
<span class="sd">                clients    (str)/(Machine object)</span>
<span class="sd">                                           -- Client name</span>

<span class="sd">                reg_key    (str)           -- Registry key path. e.g -&gt; &#39;Session&#39;</span>

<span class="sd">                flag       (str)           -- Reg key name to check the value.</span>
<span class="sd">                                                e.g -&gt; &#39;nChatterFlag&#39;</span>

<span class="sd">                expected_value</span>
<span class="sd">                           (str/int)       -- Expected value if provided will be validated and</span>
<span class="sd">                                                module will return the key value or False based</span>
<span class="sd">                                                on the &#39;fail&#39; argument.</span>

<span class="sd">                fail       (bool)          -- If true, will throw exception in case of failed</span>
<span class="sd">                                                validation.</span>
<span class="sd">                                              If false, will return False if validation fails</span>

<span class="sd">            Returns:</span>
<span class="sd">                (bool)                     -- Based on validation failed (False)</span>

<span class="sd">                (str/int)                  -- If validation succeeds or reg key value exists in</span>
<span class="sd">                                                registry, then return value of registry.</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - if validation failed (fail = True)</span>

<span class="sd">                    - if module failed to execute due to some error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span>
            <span class="n">machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">machine_name</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">machine_name</span>

            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking </span><span class="si">{0}</span><span class="s2"> reg key value on [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">machine_name</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">machine</span><span class="o">.</span><span class="n">check_registry_exists</span><span class="p">(</span><span class="n">reg_key</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">get_registry_value</span><span class="p">(</span><span class="n">reg_key</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> value: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">expected_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> expected value: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">expected_value</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">expected_value</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> value not as expected in registry&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validation succeeded.&quot;</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">expected_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> does not exist in registry&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fail</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2"> validation failed </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="OptionsSelector.get_machine_object"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.OptionsSelector.get_machine_object">[docs]</a>    <span class="k">def</span> <span class="nf">get_machine_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates/Returns machine object based on user defined input of client name as string</span>
<span class="sd">            or machine object.</span>

<span class="sd">            Args:</span>
<span class="sd">                machine    (str/[Machine/Windows/Unix object])</span>
<span class="sd">                                            -- Client string or object</span>

<span class="sd">                username  (str)             -- Username to access client</span>

<span class="sd">                password  (str)             -- Password to access client</span>

<span class="sd">            Returns:</span>

<span class="sd">                Machine object</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>

<span class="sd">                    - if failed to get the machine object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="n">Machine</span><span class="p">):</span>
                <span class="n">machine_obj</span> <span class="o">=</span> <span class="n">machine</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing Machine class instance for machine [</span><span class="si">{0}</span><span class="s2">] with user&quot;</span>
                               <span class="s2">&quot; [</span><span class="si">{1}</span><span class="s2">], password [</span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
                <span class="n">machine_obj</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Wrong input type for &lt;machine&gt; to get_machine_object.&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">machine_obj</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

    <span class="k">def</span> <span class="nf">_get_resultset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">query_type</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the result set from DB for given query and arguments</span>

<span class="sd">            Args:</span>

<span class="sd">                entity (str)            - Entity for which to execute the query. Entity is mapped</span>
<span class="sd">                                            to database_constants enum classes.</span>

<span class="sd">                query_type (str)        - Type of query to execute as defined in</span>
<span class="sd">                                            database_constants for a given entity class</span>

<span class="sd">                validate (bool)         - Validate if the resultset is not empty</span>

<span class="sd">                kwargs (dict)           - Dictionary containing the key value pair for the</span>
<span class="sd">                                            arguments passed to the modules</span>

<span class="sd">                Returns:</span>
<span class="sd">                    - (tuple) -- tuple with (&lt;first column list&gt;, Complete resultset)</span>

<span class="sd">                Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - When arguments list required is not passed to execute a given query</span>

<span class="sd">                    - When failed to get the resultset from the Database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">exception_</span> <span class="o">=</span> <span class="s2">&quot;Failed to get [</span><span class="si">{0}</span><span class="s2">] details with error&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
            <span class="n">argerror_</span> <span class="o">=</span> <span class="s2">&quot;Invalid argument in [</span><span class="si">{0}</span><span class="s2">] for query type </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">query_type</span><span class="p">)</span>

            <span class="n">class_name</span> <span class="o">=</span> <span class="n">database_constants</span><span class="o">.</span><span class="n">CLASS_MAP</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span>
            <span class="n">class_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">database_constants</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>
            <span class="n">dbquery</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">class_obj</span><span class="p">,</span> <span class="n">query_type</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span><span class="o">.</span><span class="n">value</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_map</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_type</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">[]):</span>
                    <span class="k">assert</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">= argument required&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>

            <span class="n">dbquery</span> <span class="o">=</span> <span class="n">dbquery</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="k">if</span> <span class="n">args</span> <span class="k">else</span> <span class="n">dbquery</span>
            <span class="n">rs_tuple</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="n">dbquery</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">rs_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">rs_tuple</span><span class="p">,</span> <span class="s2">&quot;DB resultset is empty.&quot;</span>

            <span class="k">return</span> <span class="n">rs_tuple</span>

        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">aserr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">:[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">argerror_</span><span class="p">,</span> <span class="n">dbquery</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception_</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">aserr</span><span class="p">)))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception_</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>


<div class="viewcode-block" id="CVEntities"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities">[docs]</a><span class="k">class</span> <span class="nc">CVEntities</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Class to create/delete various commcell objects &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_object</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Initialize instance of CVEntities class</span>

<span class="sd">        Args:</span>
<span class="sd">        init_object : Should be either the commcell or the testcase object&#39;&#39;&#39;</span>

        <span class="c1"># Pre-initialized attributes applicable for all instances of the class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_object</span> <span class="o">=</span> <span class="n">init_object</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_object</span><span class="p">,</span> <span class="n">Commcell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">init_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="o">=</span> <span class="n">init_object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">commcell</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>

        <span class="c1"># Instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&#39;&#39;&#39; Based on type of entity_config sent to create/delete modules, this</span>
<span class="sd">                dictionary will be constructed with entity and it&#39;s properties</span>
<span class="sd">                and will be fed to the private &lt;entity_name&gt;_create() modules</span>
<span class="sd">         &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entity_props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Contains dependent objects and properties for entities created with</span>
<span class="sd">            create module.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_created_entities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Contains details of entities already created as part of create() modules.</span>
<span class="sd">            This is dynamic and it&#39;s life is limited to the create/delete calls.</span>
<span class="sd">            Once all required objects are created, this is reset with refresh()</span>
<span class="sd">            This is utilized to access properties of created entities by other</span>
<span class="sd">            dependent entities during runtime of create(), delete() modules</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_object_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            _entity_object_map will be updated with entity properties whenever a</span>
<span class="sd">                call is made to the create() module.</span>

<span class="sd">            This dictionary mapping will be used by cleanup module to delete the</span>
<span class="sd">                entities in the map.</span>

<span class="sd">            From the testcase &#39;finally:&#39; block user just needs to call</span>
<span class="sd">                entities.cleanup() to delete all the entities created by testcase.</span>
<span class="sd">                where entities is an instance of CVEntities class.</span>

<span class="sd">            Sample dictionary mapping:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;backupset&#39;        :[{ backupset1 object properties },</span>
<span class="sd">                                     { backupset2 object properties } ...],</span>
<span class="sd">                &#39;subclient&#39;        :[{ subclient1 object properties },</span>
<span class="sd">                                     { subclient2 object properties } ...],</span>
<span class="sd">                &#39;disklibrary&#39;      :[{ disklibrary1 object properties },</span>
<span class="sd">                                     { disklibrary2 object properties } ...],</span>
<span class="sd">                &#39;storagepolicy&#39;    :[{ storagepolicy1 object properties },</span>
<span class="sd">                                     { storagepolicy2 object properties } ...],</span>
<span class="sd">            }</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Representation string for the instance of the CVEntities class.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;CVEntities class instance&quot;</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Destroy the objects created in the class &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="CVEntities.create"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_entities</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Method to create commcell entities</span>

<span class="sd">        Note: All possible usages and examples of create() module are provided in detail</span>
<span class="sd">                in testcase 52713.</span>

<span class="sd">        definitions:</span>
<span class="sd">        -----------</span>
<span class="sd">            entity     :    backupset, subclient, library, storagepolicy, clientgroup</span>
<span class="sd">                                etc. to be created on Commcell.</span>

<span class="sd">            target     :    where the entity will be created</span>

<span class="sd">            property   :    entity name, client, agent etc..</span>

<span class="sd">            force      :    Set to True:</span>
<span class="sd">                            ------------</span>
<span class="sd">                            The existing entity with same name on commcell for a</span>
<span class="sd">                            given target will be deleted and the entity will be</span>
<span class="sd">                            created again.</span>

<span class="sd">                            Be careful in using this option for entities which</span>
<span class="sd">                            already exists, as an attempt will be made to delete them</span>
<span class="sd">                            It will remove all data associated with the entity.</span>

<span class="sd">                             Set to False:</span>
<span class="sd">                             -------------</span>
<span class="sd">                             The existing entity (if it exists) shall not be deleted</span>
<span class="sd">                             and will return existing entities properties.</span>

<span class="sd">                             If the entity did not exist, a new entity will be</span>
<span class="sd">                             created on target and will also be removed as part of</span>
<span class="sd">                             cleanup()</span>

<span class="sd">        Args:</span>
<span class="sd">        -----</span>
<span class="sd">            entity_config  (dict or list or string)</span>

<span class="sd">                -- Could be a dictionary containing entity and properties of the</span>
<span class="sd">                    entity which needs to be created</span>

<span class="sd">                -- Could be a list of entities to create</span>

<span class="sd">                -- Can be a single entity (string) to create</span>

<span class="sd">            Common target properties can be defined as part of &#39;target&#39; key</span>
<span class="sd">            Common target properties can be</span>
<span class="sd">            &#39;target&#39;:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;client&#39;: &quot;&lt;client name&gt;&quot;,</span>
<span class="sd">                &#39;agent&#39;: &quot;&lt;agent name&gt;&quot;,</span>
<span class="sd">                &#39;instance&#39;: &quot;&lt;instance name&gt;&quot;,</span>
<span class="sd">                &#39;storagepolicy&#39;: &quot;&lt;storage policy&gt;&quot;,</span>
<span class="sd">                &#39;mediaagent&#39;: &quot;&lt;media agent&gt;&quot;,</span>
<span class="sd">                &#39;library&#39;: &quot;&lt;library name&gt;&quot;,</span>
<span class="sd">                &#39;force&#39;: False</span>
<span class="sd">            },</span>

<span class="sd">            Common properties that could be relevant to disklibrary:</span>
<span class="sd">                mediaagent</span>
<span class="sd">                force  (Default: True)</span>

<span class="sd">            Common properties that could be relevant to storagepolicy:</span>
<span class="sd">                mediaagent</span>
<span class="sd">                library</span>
<span class="sd">                force  (Default: True)</span>

<span class="sd">            Common properties that could be relevant to backupset:</span>
<span class="sd">                client</span>
<span class="sd">                agent</span>
<span class="sd">                instance</span>
<span class="sd">                force  (Default: True)</span>

<span class="sd">            Common properties that could be relevant to subclient:</span>
<span class="sd">                client</span>
<span class="sd">                agent</span>
<span class="sd">                instance</span>
<span class="sd">                force  (Default: True)</span>

<span class="sd">            Common properties that could be relevant to clientgroup:</span>
<span class="sd">                force  (Default: True)</span>

<span class="sd">            Defaults will be used in case the entity properties are not defined in</span>
<span class="sd">            the input configuration to create() module</span>

<span class="sd">            Default client = TestCase initialized client</span>
<span class="sd">            Default storagepolicy = TestCase initialized subclient&#39;s storage policy</span>
<span class="sd">            Default mediaagent = TestCase initialized subclient&#39;s media agent</span>
<span class="sd">            Default library = TestCase initialized subclient&#39;s library</span>

<span class="sd">            If all entities have to be created with these target properties, then</span>
<span class="sd">                they can be defined in &#39;target&#39; key as values.</span>

<span class="sd">            In case some individual entities need to be created on different target</span>
<span class="sd">                properties then can be defined as part of that entity&#39;s properties.</span>

<span class="sd">            Entity properties shall always override the target properties.</span>

<span class="sd">            Names of the entities can be skipped too. If name is not provided then</span>
<span class="sd">                entity with a unique name would be created.</span>

<span class="sd">        Returns:</span>
<span class="sd">        -------</span>
<span class="sd">            A dictionary with key(s) as entity type and value(s) as entity properties</span>
<span class="sd">            Sample e.g:</span>

<span class="sd">            {</span>
<span class="sd">                &#39;backupset&#39;:</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;agent&#39;: &quot;File System&quot; Agent instance for Client: &quot;client1&quot;,</span>
<span class="sd">                    &#39;agent_name&#39;: &#39;file system&#39;,</span>
<span class="sd">                    &#39;object&#39;: Backupset class instance for Backupset:</span>
<span class="sd">                                    &quot;bkp01&quot; for Instance:</span>
<span class="sd">                                    &quot;defaultinstancename&quot; of Agent: &quot;file system&quot;,</span>
<span class="sd">                    &#39;client&#39;: Client class instance for Client: &quot;client1&quot;,</span>
<span class="sd">                    &#39;client_name&#39;: &#39;client1&#39;,</span>
<span class="sd">                    &#39;force&#39;: True,</span>
<span class="sd">                    &#39;id&#39;: &#39;4004&#39;,</span>
<span class="sd">                    &#39;instance&#39;: Instance class instance for Instance:</span>
<span class="sd">                                    &quot;DefaultInstanceName&quot; of Agent: &quot;file system&quot;,</span>
<span class="sd">                    &#39;instance_name&#39;: &#39;defaultinstancename&#39;,</span>
<span class="sd">                    &#39;name&#39;: &#39;bkp01&#39;,</span>
<span class="sd">                    &#39;target&#39;: &#39;client1-&gt;file system-&gt;defaultinstancename&#39;</span>
<span class="sd">                 },</span>
<span class="sd">                &#39;disklibrary&#39;:</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;object&#39;: DiskLibrary class instance for library:</span>
<span class="sd">                                    &quot;lib01&quot; of Commcell:</span>
<span class="sd">                                    &quot;csclient&quot;,</span>
<span class="sd">                    &#39;force&#39;: True,</span>
<span class="sd">                    &#39;id&#39;: &#39;1484&#39;,</span>
<span class="sd">                    &#39;mediaagent&#39;: MediaAgent class instance for MA:</span>
<span class="sd">                                    &quot;csclient&quot;, of Commcell: &quot;csclient&quot;,</span>
<span class="sd">                    &#39;mediaagent_name&#39;: &#39;csclient&#39;,</span>
<span class="sd">                    &#39;mount_path&#39;: &#39;C:\\DiskLibrary&#39;,</span>
<span class="sd">                    &#39;name&#39;: &#39;lib01&#39;,</span>
<span class="sd">                    &#39;password&#39;: &#39;&#39;,</span>
<span class="sd">                    &#39;target&#39;: &#39;csclient-&gt;C:\\DiskLibrary&#39;,</span>
<span class="sd">                    &#39;username&#39;: &#39;&#39;</span>
<span class="sd">                },</span>
<span class="sd">                &#39;storagepolicy&#39;:</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;dedup_path&#39;: None,</span>
<span class="sd">                    &#39;force&#39;: True,</span>
<span class="sd">                    &#39;id&#39;: &#39;676&#39;,</span>
<span class="sd">                    &#39;incremental_sp&#39;: None,</span>
<span class="sd">                    &#39;library&#39;: DiskLibrary class instance for library:</span>
<span class="sd">                                    &quot;lib01&quot; of Commcell: &quot;csclient&quot;,</span>
<span class="sd">                    &#39;library_name&#39;: &#39;lib01&#39;,</span>
<span class="sd">                    &#39;mediaagent&#39;: MediaAgent class instance for MA:</span>
<span class="sd">                                    &quot;csclient&quot;, of Commcell: &quot;csclient&quot;,</span>
<span class="sd">                    &#39;mediaagent_name&#39;: &#39;csclient&#39;,</span>
<span class="sd">                    &#39;name&#39;: &#39;sp01&#39;,</span>
<span class="sd">                    &#39;retention_period&#39;: 5,</span>
<span class="sd">                    &#39;object&#39;: Storage Policy class instance for Storage Policy</span>
<span class="sd">                                        : &quot;sp01&quot;,</span>
<span class="sd">                    &#39;target&#39;: &#39;csclient-&gt;lib01&#39;</span>
<span class="sd">                },</span>
<span class="sd">                &#39;subclient&#39;:</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;agent&#39;: &quot;File System&quot; Agent instance for Client: &quot;client1&quot;,</span>
<span class="sd">                    &#39;agent_name&#39;: &#39;file system&#39;,</span>
<span class="sd">                    &#39;backupset&#39;: Backupset class instance for Backupset:</span>
<span class="sd">                                    &quot;bkp01&quot; for Instance:</span>
<span class="sd">                                    &quot;defaultinstancename&quot; of Agent: &quot;file system&quot;,</span>
<span class="sd">                    &#39;backupset_name&#39;: &#39;bkp01&#39;,</span>
<span class="sd">                    &#39;client&#39;: Client class instance for Client: &quot;client1&quot;,</span>
<span class="sd">                    &#39;client_name&#39;: &#39;client1&#39;,</span>
<span class="sd">                    &#39;content&#39;: None,</span>
<span class="sd">                    &#39;force&#39;: True,</span>
<span class="sd">                    &#39;id&#39;: &#39;5931&#39;,</span>
<span class="sd">                    &#39;instance&#39;: Instance class instance for Instance:</span>
<span class="sd">                                &quot;DefaultInstanceName&quot; of Agent: &quot;file system&quot;,</span>
<span class="sd">                    &#39;instance_name&#39;: &#39;defaultinstancename&#39;,</span>
<span class="sd">                    &#39;name&#39;: &#39;sc01&#39;,</span>
<span class="sd">                    &#39;storagepolicy_name&#39;: &#39;sp01&#39;,</span>
<span class="sd">                    &#39;object&#39;: Subclient class instance for Subclient:</span>
<span class="sd">                                &quot;sc01&quot; of Backupset: &quot;bkp01&quot;,</span>
<span class="sd">                    &#39;target&#39;: &#39;client1-&gt;file system-&gt;defaultinstancename-&gt;bkp01&#39;</span>
<span class="sd">                },</span>
<span class="sd">                &#39;clientgroup&#39;:</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;object&#39;: ClientGroup class instance for ClientGroup: &quot;cg3&quot;,</span>
<span class="sd">                    &#39;clients&#39;: [&#39;client1&#39;, &#39;client2&#39;, &#39;client3&#39;],</span>
<span class="sd">                    &#39;default_client&#39;: True,</span>
<span class="sd">                    &#39;description&#39;: &#39;&#39;,</span>
<span class="sd">                    &#39;enable_backup&#39;: True,</span>
<span class="sd">                    &#39;enable_data_aging&#39;: True,</span>
<span class="sd">                    &#39;enable_restore&#39;: True,</span>
<span class="sd">                    &#39;force&#39;: True,</span>
<span class="sd">                    &#39;id&#39;: &#39;1167&#39;,</span>
<span class="sd">                    &#39;name&#39;: &#39;cg3&#39;,</span>
<span class="sd">                    &#39;target&#39;: []</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        Raises:</span>
<span class="sd">                Exception:</span>

<span class="sd">                    If the entity_config is not a supported type</span>

<span class="sd">                    If the entity_config keys are not a part of supported entity types</span>

<span class="sd">                    Post creation configuration failed</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create entities configuration: </span><span class="se">\n</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">input_entities</span><span class="p">)))</span>

            <span class="c1"># Create a dictionary mapping based on input type to the module</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_entities</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">ORDERED_ENTITIES_DICT</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_entities</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">input_entities</span><span class="p">}</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_entities</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">input_entities</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">ORDERED_ENTITIES_DICT</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">OptionsSelector</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">input_entities</span><span class="p">,</span>
                                                                                <span class="nb">dict</span><span class="p">()))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_entities</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span><span class="p">[</span><span class="n">input_entities</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ORDERED_ENTITIES</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;target&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Wrong input </span><span class="si">{0}</span><span class="s2"> configured. Key(s) can be &quot;</span>
                                    <span class="s2">&quot; </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">ORDERED_ENTITIES</span><span class="p">))</span>

            <span class="c1"># Loop through each entity and create</span>
            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ORDERED_ENTITIES</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Entity = [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">))</span>

                <span class="c1"># Call the entity class object and work in it&#39;s context</span>
                <span class="n">entity_class</span> <span class="o">=</span> <span class="s2">&quot;_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
                <span class="n">entity_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">entity_class</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_object</span><span class="p">)</span>
                <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_entity_objects</span><span class="p">(</span><span class="n">entity_obj</span><span class="o">.</span><span class="n">associated_entities</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">entity_obj</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">entity_obj</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>
                <span class="p">(</span><span class="n">assocobj</span><span class="p">,</span> <span class="n">has_obj</span><span class="p">)</span> <span class="o">=</span> <span class="n">entity_obj</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">entity</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">target</span><span class="p">]</span>
                <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">has_obj</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] already exists for </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] for </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

                        <span class="n">obj</span> <span class="o">=</span> <span class="n">assocobj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">id_</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">entity_obj</span><span class="o">.</span><span class="n">entity_id</span><span class="p">)</span>
                        <span class="n">assocobj</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_purge_entities</span><span class="p">(</span>
                            <span class="n">entity</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">id_</span>
                            <span class="p">}</span>
                        <span class="p">)</span>

                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleted </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing existing </span><span class="si">{}</span><span class="s2"> configuration&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">))</span>

                        <span class="n">obj</span> <span class="o">=</span> <span class="n">assocobj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">_</span> <span class="o">=</span> <span class="n">entity_obj</span><span class="o">.</span><span class="n">existing_config</span><span class="p">()</span>
                        <span class="n">props</span> <span class="o">=</span> <span class="n">entity_obj</span><span class="o">.</span><span class="n">props</span>
                        <span class="n">target</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">create</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] for </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;istape&#39;</span><span class="p">):</span>
                        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">entity_obj</span><span class="o">.</span><span class="n">add_tape_args</span><span class="p">()</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="n">assocobj</span><span class="o">.</span><span class="n">add_tape_sp</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="c1"># For tape storage policy the object is not returned from sdk</span>
                        <span class="c1"># instead the sdk response text is returned or the policy</span>
                        <span class="c1"># name. Will fix this with any change from SDK side later.</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="n">assocobj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">entity_obj</span><span class="o">.</span><span class="n">add_args</span><span class="p">()</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="n">assocobj</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] successfully for </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">props</span> <span class="o">=</span> <span class="n">entity_obj</span><span class="o">.</span><span class="n">props</span>
                    <span class="n">props</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">entity_obj</span><span class="o">.</span><span class="n">entity_id</span><span class="p">)</span>
                    <span class="n">props</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
                    <span class="n">props</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">entity_obj</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Performing post creation configuration for </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">entity</span><span class="p">,</span> <span class="n">name</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                    <span class="n">entity_obj</span><span class="o">.</span><span class="n">post_create</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">has_obj</span><span class="p">)</span> <span class="o">=</span> <span class="n">entity_obj</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>

                    <span class="k">assert</span> <span class="n">has_obj</span><span class="p">,</span> <span class="s2">&quot;Validation failed for </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validation succeeded.&quot;</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Post creation configuration failed&quot;</span><span class="p">)</span>
                    <span class="k">raise</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">props</span> <span class="o">=</span> <span class="n">entity_obj</span><span class="o">.</span><span class="n">props</span>

                    <span class="c1"># Only update the cleanup entity object if the entity has been created</span>
                    <span class="c1"># by create() module. Do not want to remove pre-existing entities.</span>
                    <span class="k">if</span> <span class="n">create</span><span class="p">:</span>
                        <span class="n">obj_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_object_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="p">[])</span>
                        <span class="n">obj_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_object_map</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_list</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] properties </span><span class="se">\n</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
                                                                       <span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                                                       <span class="nb">str</span><span class="p">(</span><span class="n">props</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_created_entities</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">entity_props</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span> <span class="o">=</span> <span class="n">props</span>

            <span class="k">return</span> <span class="p">{</span><span class="n">entity</span><span class="p">:</span> <span class="n">properties</span> <span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="n">properties</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_props</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">props</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CVEntities.delete"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.delete">[docs]</a>    <span class="nd">@argtypes</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_entities</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Method to delete commcell entities</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_config (dict)   -- Dictionary containing the entity(s) as key,</span>
<span class="sd">                                        and value(s) as a dictionary of the entity</span>
<span class="sd">                                        properties.</span>
<span class="sd">            Example Usage:</span>
<span class="sd">                entities = CVEntities()</span>
<span class="sd">                all_inputs = entities.create()</span>
<span class="sd">                self._entities.delete(all_inputs)</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises Exception:</span>
<span class="sd">            - If failed to delete any entity</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting following entities: </span><span class="se">\n</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">input_entities</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span> <span class="o">=</span> <span class="n">input_entities</span>

            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">DELETE_ENTITIES_ORDER</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">entity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">)</span>
                <span class="n">has_entity</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">entity_class</span> <span class="o">=</span> <span class="s2">&quot;_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
                <span class="n">entityobj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">entity_class</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_object</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
                <span class="p">(</span><span class="n">target_obj</span><span class="p">,</span> <span class="n">has_entity</span><span class="p">)</span> <span class="o">=</span> <span class="n">entityobj</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">target_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get parent object for </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">has_entity</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> doesn&#39;t exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
                    <span class="k">continue</span>

                <span class="c1"># Delete entity</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] for [</span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>

                <span class="n">target_obj</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleted </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] successfully.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

                <span class="c1"># Remove the entity and its properties from the cleanup map</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_purge_entities</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing post deletion configuration for </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">]&quot;</span>
                              <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

                <span class="n">entityobj</span><span class="o">.</span><span class="n">post_delete</span><span class="p">()</span>

                <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">has_obj</span><span class="p">)</span> <span class="o">=</span> <span class="n">entityobj</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="n">has_obj</span><span class="p">,</span> <span class="s2">&quot;Validation failed for </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validation succeeded.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CVEntities.cleanup"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Delete all entities in the self._entity_object_map dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">            Sample self._entity_object_map dictionary mapping:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;backupset&#39;        :[{ backupset1 object properties },</span>
<span class="sd">                                     { backupset2 object properties } ...],</span>
<span class="sd">                &#39;subclient&#39;        :[{ subclient1 object properties },</span>
<span class="sd">                                     { subclient2 object properties } ...],</span>
<span class="sd">                &#39;disklibrary&#39;      :[{ disklibrary1 object properties },</span>
<span class="sd">                                     { disklibrary2 object properties } ...],</span>
<span class="sd">                &#39;storagepolicy&#39;    :[{ storagepolicy1 object properties },</span>
<span class="sd">                                     { storagepolicy2 object properties } ...],</span>
<span class="sd">                &#39;clientgroup&#39;      :[{ clientgroup object properties },</span>
<span class="sd">                                     { clientgroup object properties } ...],</span>
<span class="sd">            }</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises Exception:</span>
<span class="sd">                - If failed to delete any entity</span>
<span class="sd">         &#39;&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up entities for test case&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleanup configuration </span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity_object_map</span><span class="p">)))</span>

            <span class="n">cleanup_failed</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">for</span> <span class="n">entity_key</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">DELETE_ENTITIES_ORDER</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entity_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_object_map</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">props</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_object_map</span><span class="p">[</span><span class="n">entity_key</span><span class="p">]:</span>
                        <span class="c1"># If cleanup is set to False for the entity, then skip cleanup.</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;cleanup&#39;</span><span class="p">]:</span>
                            <span class="k">continue</span>

                        <span class="c1"># Deletion may fall during cleanup due to various reasons</span>
                        <span class="c1"># Cleanup should happen for all entities and should not stop</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">({</span><span class="n">entity_key</span><span class="p">:</span> <span class="n">props</span><span class="p">})</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cleanup failed for </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity_key</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
                            <span class="n">cleanup_failed</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">cleanup_failed</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to cleanup entities.&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CVEntities.get_mount_path"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.get_mount_path">[docs]</a>    <span class="nd">@argtypes</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@returntype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_mount_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mediagent</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the mount path where library shall be created for a given</span>
<span class="sd">            Media Agent</span>

<span class="sd">        Args:</span>
<span class="sd">            mediagent (str)    -- Media agent client name</span>

<span class="sd">        Returns:</span>
<span class="sd">            mount_path (str)    -- Directory path where disk library will be created</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mount_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">mediagent</span><span class="p">,</span> <span class="n">dirstring</span><span class="o">=</span><span class="s2">&quot;DiskLibrary&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mount path for disklibrary = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mount_path</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">mount_path</span></div>

<div class="viewcode-block" id="CVEntities.create_client_groups"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.create_client_groups">[docs]</a>    <span class="nd">@argtypes</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">create_client_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_groups</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates client groups from a given list of client group names</span>
<span class="sd">            These client groups will be empty and without any clients</span>

<span class="sd">        Args:</span>
<span class="sd">            client_groups    (list)  -- Names of client groups to be created</span>

<span class="sd">        Returns:</span>
<span class="sd">            Client group properties dictionary with name to properties mapping</span>
<span class="sd">            e.g:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;testproxy&#39;:</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;name&#39;: testproxy,</span>
<span class="sd">                    &#39;clients&#39;: [],</span>
<span class="sd">                    &#39;description&#39;: &#39;&#39;,</span>
<span class="sd">                    &#39;enable_backup&#39;: True,</span>
<span class="sd">                    &#39;enable_restore&#39;: True,</span>
<span class="sd">                    &#39;enable_data_aging&#39;: True,</span>
<span class="sd">                    &#39;id&#39;: &#39;1119&#39;,</span>
<span class="sd">                    &#39;force&#39;: True,</span>
<span class="sd">                    &#39;target&#39;: [],</span>
<span class="sd">                    &#39;clientgroup&#39;: ClientGroup class instance for ClientGroup</span>
<span class="sd">                                         :&quot;testproxy&quot;</span>
<span class="sd">                },</span>
<span class="sd">                &#39;test&#39;:</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;name&#39;: testproxy,</span>
<span class="sd">                    &#39;clients&#39;: [],</span>
<span class="sd">                    &#39;description&#39;: &#39;&#39;,</span>
<span class="sd">                    &#39;enable_backup&#39;: True,</span>
<span class="sd">                    &#39;enable_restore&#39;: True,</span>
<span class="sd">                    &#39;enable_data_aging&#39;: True,</span>
<span class="sd">                    &#39;id&#39;: &#39;1119&#39;,</span>
<span class="sd">                    &#39;force&#39;: True,</span>
<span class="sd">                    &#39;target&#39;: [],</span>
<span class="sd">                    &#39;clientgroup&#39;: ClientGroup class instance for ClientGroup</span>
<span class="sd">                                         :&quot;test&quot;</span>
<span class="sd">                },</span>

<span class="sd">            }</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception</span>
<span class="sd">                - When failed to create any client group</span>

<span class="sd">        Example:</span>
<span class="sd">            [&quot;testproxy&quot;, &quot;test&quot;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client_groups_properties</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">client_group</span> <span class="ow">in</span> <span class="n">client_groups</span><span class="p">:</span>
                <span class="n">client_group_props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;clientgroup&#39;</span><span class="p">:</span>
                            <span class="p">{</span>
                                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">client_group</span><span class="p">,</span>
                                <span class="s1">&#39;clients&#39;</span><span class="p">:</span> <span class="p">[],</span>
                                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;enable_backup&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="s1">&#39;enable_restore&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="s1">&#39;enable_data_aging&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="p">},</span>
                    <span class="p">}</span>
                <span class="p">)</span>

                <span class="n">key</span> <span class="o">=</span> <span class="n">client_group_props</span><span class="p">[</span><span class="s1">&#39;clientgroup&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">client_group_props</span><span class="p">[</span><span class="s1">&#39;clientgroup&#39;</span><span class="p">]</span>

                <span class="n">client_groups_properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">return</span> <span class="n">client_groups_properties</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CVEntities.delete_client_groups"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.delete_client_groups">[docs]</a>    <span class="nd">@argtypes</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delete_client_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_groups</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes client groups from a given dictionary of client group properties</span>

<span class="sd">        Args:</span>
<span class="sd">            client_groups    (dict)  -- Client group properties dictionary</span>

<span class="sd">        e.g:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;testproxy&#39;:</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;name&#39;: testproxy,</span>
<span class="sd">                    &#39;clients&#39;: [],</span>
<span class="sd">                    &#39;description&#39;: &#39;&#39;,</span>
<span class="sd">                    &#39;enable_backup&#39;: True,</span>
<span class="sd">                    &#39;enable_restore&#39;: True,</span>
<span class="sd">                    &#39;enable_data_aging&#39;: True,</span>
<span class="sd">                    &#39;id&#39;: &#39;1119&#39;,</span>
<span class="sd">                    &#39;force&#39;: True,</span>
<span class="sd">                    &#39;target&#39;: [],</span>
<span class="sd">                    &#39;clientgroup&#39;: ClientGroup class instance for ClientGroup</span>
<span class="sd">                                         :&quot;testproxy&quot;</span>
<span class="sd">                },</span>
<span class="sd">                &#39;test&#39;:</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;name&#39;: testproxy,</span>
<span class="sd">                    &#39;clients&#39;: [],</span>
<span class="sd">                    &#39;description&#39;: &#39;&#39;,</span>
<span class="sd">                    &#39;enable_backup&#39;: True,</span>
<span class="sd">                    &#39;enable_restore&#39;: True,</span>
<span class="sd">                    &#39;enable_data_aging&#39;: True,</span>
<span class="sd">                    &#39;id&#39;: &#39;1119&#39;,</span>
<span class="sd">                    &#39;force&#39;: True,</span>
<span class="sd">                    &#39;target&#39;: [],</span>
<span class="sd">                    &#39;clientgroup&#39;: ClientGroup class instance for ClientGroup</span>
<span class="sd">                                         :&quot;test&quot;</span>
<span class="sd">                },</span>
<span class="sd">            }</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception</span>
<span class="sd">                - When failed to delete any client group</span>

<span class="sd">        Example:</span>
<span class="sd">            [&quot;testproxy&quot;, &quot;test&quot;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">client_groups</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">({</span><span class="s1">&#39;clientgroup&#39;</span><span class="p">:</span> <span class="n">client_groups</span><span class="p">[</span><span class="n">name</span><span class="p">]})</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CVEntities.update_clientgroup"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.update_clientgroup">[docs]</a>    <span class="k">def</span> <span class="nf">update_clientgroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">clientgroup</span><span class="p">,</span>
                           <span class="n">new_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">clients_to_add</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">clients_to_remove</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Modifies client group properties</span>

<span class="sd">            Args:</span>
<span class="sd">                clientgroup (obj)       -- Client group object</span>

<span class="sd">                new_name (str)          -- New client group name</span>

<span class="sd">                description (str)       -- New client group description</span>

<span class="sd">                add_clients(list)       -- List of clients to be added to the client</span>
<span class="sd">                                            group.</span>

<span class="sd">                overwrite   (bool)      -- if set to true will remove old clients,</span>
<span class="sd">                                            and add new clients</span>

<span class="sd">                remove_clients(list)    -- List of clients to be added to the</span>
<span class="sd">                                            client group.</span>
<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - if any error occurred while updating the</span>
<span class="sd">                                client group properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">clientgroup</span><span class="o">.</span><span class="n">clientgroup_name</span>

            <span class="k">def</span> <span class="nf">get_associated_clients</span><span class="p">():</span>
                <span class="sd">&#39;&#39;&#39; Logs associated clients in a client group &#39;&#39;&#39;</span>
                <span class="n">clients</span> <span class="o">=</span> <span class="n">clientgroup</span><span class="o">.</span><span class="n">associated_clients</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Associated clients for client group </span><span class="si">{0}</span><span class="s2"> are </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">clients</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">new_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Changing name of client group [</span><span class="si">{0}</span><span class="s2">] to [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">))</span>
                <span class="n">clientgroup</span><span class="o">.</span><span class="n">clientgroup_name</span> <span class="o">=</span> <span class="n">new_name</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">new_name</span>

            <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Changing client group [</span><span class="si">{0}</span><span class="s2">] description to &quot;</span>
                         <span class="s2">&quot;[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clientgroup</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">description</span><span class="p">))</span>
                <span class="n">clientgroup</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>

            <span class="k">if</span> <span class="n">clients_to_add</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">get_associated_clients</span><span class="p">()</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding clients </span><span class="si">{0}</span><span class="s2"> to the client group &quot;</span>
                         <span class="s2">&quot;[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clients_to_add</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
                <span class="n">clientgroup</span><span class="o">.</span><span class="n">add_clients</span><span class="p">(</span><span class="n">clients_to_add</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">)</span>
                <span class="n">get_associated_clients</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">clients_to_remove</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">get_associated_clients</span><span class="p">()</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing clients </span><span class="si">{0}</span><span class="s2"> from the client group &quot;</span>
                         <span class="s2">&quot;[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clients_to_remove</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
                <span class="n">clientgroup</span><span class="o">.</span><span class="n">remove_clients</span><span class="p">(</span><span class="n">clients_to_remove</span><span class="p">)</span>
                <span class="n">get_associated_clients</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CVEntities.create_sp_copy"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.create_sp_copy">[docs]</a>    <span class="k">def</span> <span class="nf">create_sp_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">storage_policy</span><span class="p">,</span>
                       <span class="n">copy_name</span><span class="p">,</span>
                       <span class="n">library</span><span class="p">,</span>
                       <span class="n">mediaagent</span><span class="p">,</span>
                       <span class="n">drive_pool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">spare_pool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">tape_library_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">drive_pool_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">spare_pool_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a storage policy copy for the given storage policy.</span>

<span class="sd">            Args:</span>
<span class="sd">                storage_policy    (obj/str)   -- storage policy name OR corresponding storage</span>
<span class="sd">                                                    policy SDK instance of class StoragePolicy</span>

<span class="sd">                copy_name         (str)       -- name of the storage policy copy to create</span>

<span class="sd">                library           (str)       -- Library name to associate to copy</span>

<span class="sd">                mediaagent        (str)       -- Media agent associated to the input library</span>

<span class="sd">                drive_pool         (str)      -- Drive pool name in case library is TapeLibrary</span>

<span class="sd">                spare_pool         (str)      -- Spare pool name in case library is TapeLibrary</span>

<span class="sd">                tape_library_id    (int)      -- Tape library id in case library is TapeLibrary</span>

<span class="sd">                drive_pool_id      (int)      -- Drive pool id</span>

<span class="sd">                spare_pool_id      (int)      -- Spare pool id</span>

<span class="sd">                force              (bool)      -- If True, will delete any existing copy with the</span>
<span class="sd">                                                    same name</span>

<span class="sd">                                                  If False, will not create the copy and will log</span>
<span class="sd">                                                      error.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception if :</span>

<span class="sd">                    - failed during execution of module</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># If storage_policy is not an instance of StoragePolicy SDK class, then get the</span>
            <span class="c1"># storage policy object from name</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storage_policy</span><span class="p">,</span> <span class="n">StoragePolicy</span><span class="p">):</span>
                <span class="n">storage_policies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">storage_policies</span>
                <span class="n">storage_policy</span> <span class="o">=</span> <span class="n">storage_policies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">storage_policy</span><span class="p">)</span>

            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;StoragePolicy copy&#39;</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">,</span> <span class="n">storage_policy</span><span class="p">]</span>
            <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">storage_policy</span><span class="o">.</span><span class="n">has_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] already exists for </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] for </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

                    <span class="n">storage_policy</span><span class="o">.</span><span class="n">delete_secondary_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleted </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Copy not created as it already exits.&quot;</span><span class="p">)</span>
                    <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">create</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] for </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

                <span class="n">storage_policy</span><span class="o">.</span><span class="n">create_secondary_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span>
                                                     <span class="n">library</span><span class="p">,</span>
                                                     <span class="n">mediaagent</span><span class="p">,</span>
                                                     <span class="n">drive_pool</span><span class="p">,</span>
                                                     <span class="n">spare_pool</span><span class="p">,</span>
                                                     <span class="n">tape_library_id</span><span class="p">,</span>
                                                     <span class="n">drive_pool_id</span><span class="p">,</span>
                                                     <span class="n">spare_pool_id</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] for </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">:[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CVEntities.post_delete"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.post_delete">[docs]</a>    <span class="k">def</span> <span class="nf">post_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Performing post delete configuration&#39;&#39;&#39;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CVEntities.post_create"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.post_create">[docs]</a>    <span class="k">def</span> <span class="nf">post_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Performing post creation configuration&#39;&#39;&#39;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CVEntities.existing_config"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.existing_config">[docs]</a>    <span class="k">def</span> <span class="nf">existing_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Performs configuration for existing entity&#39;&#39;&#39;</span>
        <span class="k">pass</span></div>

    <span class="nd">@argtypes</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="nd">@returntype</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_get_entity_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">entity_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Method to retrieve entity objects/properties</span>

<span class="sd">        This module creates relevant entity objects/properties for the</span>
<span class="sd">        object_types and returns a dictionary of entity properties/objects</span>


<span class="sd">        Args:</span>

<span class="sd">            object_types  (list)  --    List of objects to be returned by module</span>
<span class="sd">                                        e.g:</span>
<span class="sd">                                        [&#39;client&#39;,</span>
<span class="sd">                                        &#39;agent&#39;,</span>
<span class="sd">                                        &#39;instance&#39;,</span>
<span class="sd">                                        &#39;backupset&#39;,</span>
<span class="sd">                                        &#39;mediaagent&#39;,</span>
<span class="sd">                                        &#39;library&#39;]</span>

<span class="sd">            entity_type    (str)   --   One of the entity types</span>
<span class="sd">                                        e.g:</span>
<span class="sd">                                        &#39;backupset&#39;</span>
<span class="sd">                                        &#39;subclient&#39;</span>
<span class="sd">                                        &#39;disklibrary&#39;</span>
<span class="sd">                                        &#39;storagepolicy&#39;</span>
<span class="sd">                                        &#39;clientgroup&#39;</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dictionary containing properties required to create the entity mentioned</span>
<span class="sd">            in entity_type</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if failed to get object/properties for an entity</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">all_objects</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_type</span><span class="p">)</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="nb">dict</span><span class="p">())</span>

            <span class="c1"># If name is not defined, define name for entity_type</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">get_custom_str</span><span class="p">(</span><span class="n">entity_type</span><span class="p">)</span>
            <span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

            <span class="c1"># Set force and cleanup option for the entity</span>
            <span class="k">for</span> <span class="n">_option</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">,</span> <span class="s1">&#39;cleanup&#39;</span><span class="p">]:</span>
                <span class="n">_opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_props</span><span class="p">(</span><span class="n">_option</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">)</span>
                <span class="n">props</span><span class="p">[</span><span class="n">_option</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">_opt</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_ENTITY_FORCE</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="n">_option</span><span class="p">],</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Get properties failed for </span><span class="si">{0}</span><span class="s2">.  force option should be bool&quot;</span>
                                    <span class="s2">&quot; (True/False)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity_type</span><span class="p">))</span>

            <span class="n">entity_class</span> <span class="o">=</span> <span class="s2">&quot;_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">entity_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">entity_class</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_object</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">get_properties</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_entities</span><span class="p">)</span>

            <span class="c1"># Validate common entity properties and values</span>
            <span class="k">for</span> <span class="n">obj_type</span> <span class="ow">in</span> <span class="n">object_types</span><span class="p">:</span>

                <span class="c1"># Find the obj_type in individual/target properties</span>
                <span class="c1"># May come out to be None, in which case would be assigned default</span>
                <span class="c1"># assignments.</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_props</span><span class="p">(</span><span class="n">obj_type</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;default_&#39;</span> <span class="o">+</span> <span class="n">obj_type</span><span class="p">)</span>

                <span class="n">obj_name_key</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">obj_type</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">])</span>

                <span class="c1"># Get entity objects for each property</span>
                <span class="k">if</span> <span class="n">obj_type</span> <span class="o">==</span> <span class="s1">&#39;client&#39;</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="n">obj_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">client_name</span>

                <span class="k">elif</span> <span class="n">obj_type</span> <span class="o">==</span> <span class="s1">&#39;agent&#39;</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">all_objects</span><span class="p">[</span><span class="s1">&#39;client&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="n">obj_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">agent_name</span>

                <span class="k">elif</span> <span class="n">obj_type</span> <span class="o">==</span> <span class="s1">&#39;instance&#39;</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">all_objects</span><span class="p">[</span><span class="s1">&#39;agent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="n">obj_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">instance_name</span>

                <span class="k">elif</span> <span class="n">obj_type</span> <span class="o">==</span> <span class="s1">&#39;backupset&#39;</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">all_objects</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">backupsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="n">obj_name_key</span><span class="p">])</span>
                    <span class="n">obj_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">backupset_name</span>

                <span class="k">elif</span> <span class="n">obj_type</span> <span class="o">==</span> <span class="s1">&#39;mediaagent&#39;</span><span class="p">:</span>
                    <span class="n">obj_name</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_name_key</span><span class="p">)</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">media_agents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_name</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">obj_type</span> <span class="o">==</span> <span class="s1">&#39;library&#39;</span><span class="p">:</span>
                    <span class="n">obj_name</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_name_key</span><span class="p">)</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">disk_libraries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_name</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unable to get </span><span class="si">{0}</span><span class="s2"> object&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obj_type</span><span class="p">))</span>

                <span class="n">all_objects</span><span class="p">[</span><span class="n">obj_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
                <span class="n">all_objects</span><span class="p">[</span><span class="n">obj_name_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_name</span>

            <span class="n">props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">all_objects</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> properties to be created </span><span class="se">\n</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
                                                                       <span class="nb">str</span><span class="p">(</span><span class="n">all_objects</span><span class="p">)))</span>

            <span class="k">return</span> <span class="n">props</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">:[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">all_objects</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_target_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_prop</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the property value based on whether the target property is defined</span>
<span class="sd">            in the entity map</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_prop (str)     --</span>
<span class="sd">                                    One of the supported entity property types</span>
<span class="sd">                                        e.g:</span>
<span class="sd">                                            &#39;backupset&#39;</span>
<span class="sd">                                            &#39;subclient&#39;</span>
<span class="sd">                                            &#39;disklibrary&#39;</span>
<span class="sd">                                            &#39;storagepolicy&#39;</span>
<span class="sd">                                            &#39;mediaagent&#39;</span>
<span class="sd">                                            &#39;library&#39; ... etc</span>

<span class="sd">            entity_type    (str)   --   One of the supported entity types</span>
<span class="sd">                                        e.g:</span>
<span class="sd">                                        &#39;backupset&#39;</span>
<span class="sd">                                        &#39;subclient&#39;</span>
<span class="sd">                                        &#39;disklibrary&#39;</span>
<span class="sd">                                        &#39;storagepolicy&#39;</span>
<span class="sd">                                        &#39;clientgroup&#39;</span>

<span class="sd">            entity_config (dict)   -- Entity properties if specified by user</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if failed to get the entity property</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entity_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">entity_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span>

            <span class="n">prop_value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Get property value from common properties, but if individual</span>
            <span class="c1"># property is defined then give preference to it and override the</span>
            <span class="c1"># common property</span>
            <span class="k">if</span> <span class="n">entity_prop</span> <span class="ow">in</span> <span class="n">entity_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">prop_value</span> <span class="o">=</span> <span class="n">entity_config</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_prop</span><span class="p">)</span>

            <span class="n">properties</span> <span class="o">=</span> <span class="n">entity_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_type</span><span class="p">)</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="nb">dict</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_prop</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">prop_value</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_prop</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">prop_value</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">:[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_target_str</span><span class="p">(</span><span class="n">dest_targets</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Gets a target string where entities shall be created &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s2">&quot;-&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_targets</span><span class="p">)</span>

    <span class="nd">@argtypes</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_purge_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">entity_objects</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Updates the entity object map and removes properties for a</span>
<span class="sd">                entity in self._entity_object_map</span>

<span class="sd">        Args:</span>
<span class="sd">            entity (str)          --</span>
<span class="sd">                                    One of the supported entity types</span>
<span class="sd">                                        e.g:</span>
<span class="sd">                                            &#39;backupset&#39;</span>
<span class="sd">                                            &#39;subclient&#39;</span>
<span class="sd">                                            &#39;disklibrary&#39;</span>
<span class="sd">                                            &#39;storagepolicy&#39;</span>

<span class="sd">            entity_objects (dict) --</span>
<span class="sd">                                    Entity properties</span>
<span class="sd">                                        e.g:</span>
<span class="sd">                                            {</span>
<span class="sd">                                                &#39;force&#39;: True,</span>
<span class="sd">                                                &#39;incremental_sp&#39;: None,</span>
<span class="sd">                                                &#39;library&#39;: &#39;library_name&#39;,</span>
<span class="sd">                                                &#39;mediaagent&#39;: &#39;ma_name&#39;,</span>
<span class="sd">                                                &#39;name&#39;: &#39;storagepolicy_name&#39;,</span>
<span class="sd">                                                &#39;retention_period&#39;: 5,</span>
<span class="sd">                                                &#39;target&#39;: &#39;ma_name-&gt;library_name&#39;</span>
<span class="sd">                                            }</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if failed to remove the entity properties to the cleanup map</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing </span><span class="si">{0}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">] from cleanup map&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span>
                                                                       <span class="n">entity_objects</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>

            <span class="n">entity_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_object_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">updated_entity_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">entity_dict</span> <span class="ow">in</span> <span class="n">entity_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">entity_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">entity_objects</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">and</span>
                        <span class="n">entity_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">entity_objects</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]):</span>
                    <span class="n">updated_entity_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity_dict</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_entity_object_map</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_entity_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">:[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">entity_object_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns dictionary containing the entity properties created</span>
<span class="sd">            from the create() function calls &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_object_map</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns default testcase client &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">client</span>
            <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">client_name</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to get default client name&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns default testcase agent name&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">agent</span>
            <span class="k">return</span> <span class="n">agent</span><span class="o">.</span><span class="n">agent_name</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to get default agent&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns default testcase instance &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">instance</span>
            <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to get default instance&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_backupset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns default testcase backupset &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">backupset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">backupset</span>
            <span class="k">return</span> <span class="n">backupset</span><span class="o">.</span><span class="n">backupset_name</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to get default backupset&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_subclient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns default testcase subclient &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">subclient</span>
            <span class="k">return</span> <span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to get default subclient&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_storagepolicy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns default testcase subclient&#39;s storagepolicy&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">subclient</span>
            <span class="k">return</span> <span class="n">subclient</span><span class="o">.</span><span class="n">storage_policy</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to get default storagepolicy&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_mediaagent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns default testcase media agent &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">subclient</span>
            <span class="k">return</span> <span class="n">subclient</span><span class="o">.</span><span class="n">storage_ma</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to get default media agent name&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_library</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns default testcase subclient&#39;s library name &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">subclient</span>
            <span class="n">storagepolicy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">storage_policies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subclient</span><span class="o">.</span><span class="n">storage_policy</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">storagepolicy</span><span class="o">.</span><span class="n">library_name</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to get default library&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="CVEntities.refresh"><a class="viewcode-back" href="../../../Automation.AutomationUtils.html#Automation.AutomationUtils.options_selector.CVEntities.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Refreshes the properties/dynamic dictionary of the CVEntities class&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_created_entities</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entity_props</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_config</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div></div>


<span class="k">class</span> <span class="nc">_Backupset</span><span class="p">(</span><span class="n">CVEntities</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Class to support CVEntities class with common backupset operations&#39;&#39;&#39;</span>

    <span class="n">associated_entities</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;client&#39;</span><span class="p">,</span> <span class="s1">&#39;agent&#39;</span><span class="p">,</span> <span class="s1">&#39;instance&#39;</span><span class="p">]</span>
    <span class="n">entity_id</span> <span class="o">=</span> <span class="s1">&#39;backupset_id&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_object</span><span class="p">,</span> <span class="n">entity_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes Backupset class object</span>
<span class="sd">        Args:</span>
<span class="sd">            init_object (object) : Should be either the commcell or the testcase object</span>

<span class="sd">            entity_properties (dict) : Entity properties to be created/modified.&quot;&quot;&quot;</span>

        <span class="c1"># Pre-initialized attributes applicable for all instances of the class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_object</span><span class="p">,</span> <span class="n">Commcell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">init_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="o">=</span> <span class="n">init_object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">commcell</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">_Backupset</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">entity_properties</span>

    <span class="k">def</span> <span class="nf">object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Get associated object and checks if backupset exist&#39;&#39;&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">bkpset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">backupsets</span>

        <span class="c1"># Return tuple of (object, True/False)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">bkpset</span><span class="p">,</span> <span class="n">bkpset</span><span class="o">.</span><span class="n">has_backupset</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns target string where backupset shall be created &#39;&#39;&#39;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;client_name&#39;</span><span class="p">]</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;agent_name&#39;</span><span class="p">]</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;instance_name&#39;</span><span class="p">]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_str</span><span class="p">([</span><span class="n">client</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">instance</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">return</span> <span class="n">target</span>

    <span class="k">def</span> <span class="nf">get_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Sets entity properties based on dynamic evaluation of input properties</span>

<span class="sd">            Returns:</span>
<span class="sd">                - Modified entity properties based on dynamic evaluation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Entity properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;on_demand_backupset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;on_demand_backupset&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span>

    <span class="k">def</span> <span class="nf">add_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the keyword arguments for add() module&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;backupset_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;on_demand_backupset&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;on_demand_backupset&#39;</span><span class="p">]</span>
        <span class="p">}</span>


<span class="k">class</span> <span class="nc">_Subclient</span><span class="p">(</span><span class="n">CVEntities</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Class to support CVEntities class with common subclient operations&#39;&#39;&#39;</span>

    <span class="n">associated_entities</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;client&#39;</span><span class="p">,</span> <span class="s1">&#39;agent&#39;</span><span class="p">,</span> <span class="s1">&#39;instance&#39;</span><span class="p">,</span> <span class="s1">&#39;backupset&#39;</span><span class="p">]</span>
    <span class="n">entity_id</span> <span class="o">=</span> <span class="s1">&#39;subclient_id&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_object</span><span class="p">,</span> <span class="n">entity_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes Subclient class object</span>
<span class="sd">        Args:</span>
<span class="sd">            init_object (object) : Should be either the commcell or the testcase object</span>

<span class="sd">            entity_properties (dict) : Entity properties to be created/modified.&quot;&quot;&quot;</span>

        <span class="c1"># Pre-initialized attributes applicable for all instances of the class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_object</span><span class="p">,</span> <span class="n">Commcell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">init_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="o">=</span> <span class="n">init_object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">commcell</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">_Subclient</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">entity_properties</span>

    <span class="k">def</span> <span class="nf">object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Gets the associated object and checks if the subclient exists &#39;&#39;&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">subc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;backupset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subclients</span>

        <span class="c1"># Return tuple of (object, True/False)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">subc</span><span class="p">,</span> <span class="n">subc</span><span class="o">.</span><span class="n">has_subclient</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns target string on which the subclient shall be created &#39;&#39;&#39;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;client_name&#39;</span><span class="p">]</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;agent_name&#39;</span><span class="p">]</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;instance_name&#39;</span><span class="p">]</span>
        <span class="n">backupset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;backupset_name&#39;</span><span class="p">]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_str</span><span class="p">([</span><span class="n">client</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">backupset</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">return</span> <span class="n">target</span>

    <span class="k">def</span> <span class="nf">post_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Performing post delete configuration for subclient &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cleanup_content&#39;</span><span class="p">):</span>
            <span class="c1"># Delete subclient content</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;client_name&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">post_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subclient</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform post creation configuration for subclient</span>

<span class="sd">        Args:</span>
<span class="sd">            subclient (object)  -- subclient object</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                - failed to do post creation configuration&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">subclient</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subclient</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">create_test_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;client_name&#39;</span><span class="p">],</span>
                                                                    <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;data_path&#39;</span><span class="p">],</span>
                                                                    <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">],</span>
                                                                    <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting subclient content </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subclient</span><span class="o">.</span><span class="n">content</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;cleanup_content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cleanup_content&#39;</span><span class="p">,</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">:[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">get_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_config</span><span class="p">,</span> <span class="n">created_entities</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Sets entity properties based on dynamic evaluation of input properties</span>

<span class="sd">            Args:</span>
<span class="sd">                entity_config (dict) -- Dict of properties of all entities to be created</span>

<span class="sd">                created_entities (dict) -- Dict of created entities and their properties</span>

<span class="sd">            Returns:</span>
<span class="sd">                - Modified entity properties based on dynamic evaluation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Target properties</span>
        <span class="k">for</span> <span class="n">_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">,</span> <span class="s1">&#39;backupset&#39;</span><span class="p">]:</span>
            <span class="n">_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_props</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="s1">&#39;subclient&#39;</span><span class="p">,</span> <span class="n">entity_config</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">_type</span> <span class="ow">in</span> <span class="n">entity_config</span><span class="p">:</span>
                <span class="n">_name</span> <span class="o">=</span> <span class="n">created_entities</span><span class="p">[</span><span class="n">_type</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;storagepolicy&#39;</span><span class="p">:</span>
                <span class="n">_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_storagepolicy</span>

            <span class="k">elif</span> <span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;backupset&#39;</span><span class="p">:</span>
                <span class="n">_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_backupset</span>

            <span class="n">_name</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">_default</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">_type</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">_name</span>

            <span class="k">if</span> <span class="n">_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to fetch </span><span class="si">{0}</span><span class="s2"> for </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="s1">&#39;subclient&#39;</span><span class="p">))</span>

        <span class="c1"># Entity properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;subclient_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subclient_type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">DESCRIPTION</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;data_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_DIR_LEVEL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_FILE_SIZE</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span>

    <span class="k">def</span> <span class="nf">existing_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Performs configuration for existing subclient &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the keyword arguments for add() module&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;subclient_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;storage_policy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;storagepolicy_name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;subclient_type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;subclient_type&#39;</span><span class="p">],</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
        <span class="p">}</span>


<span class="k">class</span> <span class="nc">_Storagepolicy</span><span class="p">(</span><span class="n">CVEntities</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Class to support CVEntities class with common storagepolicy operations&#39;&#39;&#39;</span>

    <span class="n">associated_entities</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mediaagent&#39;</span><span class="p">,</span> <span class="s1">&#39;library&#39;</span><span class="p">]</span>
    <span class="n">entity_id</span> <span class="o">=</span> <span class="s1">&#39;storage_policy_id&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_object</span><span class="p">,</span> <span class="n">entity_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes Storagepolicy class object</span>
<span class="sd">        Args:</span>
<span class="sd">            init_object (object) : Should be either the commcell or the testcase object</span>

<span class="sd">            entity_properties (dict) : Entity properties to be created/modified.&quot;&quot;&quot;</span>

        <span class="c1"># Pre-initialized attributes applicable for all instances of the class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_object</span><span class="p">,</span> <span class="n">Commcell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">init_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="o">=</span> <span class="n">init_object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">commcell</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">_Storagepolicy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">entity_properties</span>

    <span class="k">def</span> <span class="nf">object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Gets the associated object and checks if the storagepolicy exists &#39;&#39;&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">storagepolicy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">storage_policies</span>

        <span class="c1"># Return tuple of (object, True/False)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">storagepolicy</span><span class="p">,</span> <span class="n">storagepolicy</span><span class="o">.</span><span class="n">has_policy</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns target string on which the storagepolicy shall be created &#39;&#39;&#39;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_str</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;library_name&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">return</span> <span class="n">target</span>

    <span class="k">def</span> <span class="nf">post_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform post creation configuration for storage policy &#39;&#39;&#39;</span>
        <span class="c1"># Create Storage policy copy</span>
        <span class="k">if</span> <span class="s1">&#39;copy_name&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_sp_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;copy_name&#39;</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;library_name&#39;</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;drive_pool&#39;</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;spare_pool&#39;</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;tape_library_id&#39;</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;drive_pool_id&#39;</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;spare_pool_id&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_config</span><span class="p">,</span> <span class="n">created_entities</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Sets entity properties based on dynamic evaluation of input properties</span>

<span class="sd">            Args:</span>
<span class="sd">                entity_config (dict) -- Dict of properties of all entities to be created</span>

<span class="sd">                created_entities (dict) -- Dict of created entities and their properties</span>

<span class="sd">            Returns:</span>
<span class="sd">                - Modified entity properties based on dynamic evaluation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Target properties</span>
        <span class="n">mediaagent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_props</span><span class="p">(</span><span class="s1">&#39;mediaagent&#39;</span><span class="p">,</span> <span class="s1">&#39;storagepolicy&#39;</span><span class="p">,</span> <span class="n">entity_config</span><span class="p">)</span>
        <span class="n">library</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_props</span><span class="p">(</span><span class="s1">&#39;library&#39;</span><span class="p">,</span> <span class="s1">&#39;storagepolicy&#39;</span><span class="p">,</span> <span class="n">entity_config</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">library</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;disklibrary&#39;</span> <span class="ow">in</span> <span class="n">entity_config</span><span class="p">:</span>
            <span class="n">library</span> <span class="o">=</span> <span class="n">created_entities</span><span class="p">[</span><span class="s1">&#39;disklibrary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
            <span class="n">mediaagent</span> <span class="o">=</span> <span class="n">created_entities</span><span class="p">[</span><span class="s1">&#39;disklibrary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">library</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">library</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_library</span>
            <span class="n">mediaagent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mediaagent</span>

        <span class="k">if</span> <span class="n">library</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to assign library and mediaagent for storagepolicy entity&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;library_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mediaagent</span>

        <span class="c1"># Entity properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;dedup_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dedup_path&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;incremental_sp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;incremental_sp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;retention_period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;retention_period&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;drivepool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;drivepool&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;scratchpool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scratchpool&#39;</span><span class="p">,</span> <span class="s1">&#39;Default Scratch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;incremental_sp_tape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;incremental_sp_tape&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;istape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;istape&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;number_of_streams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;number_of_streams&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;ocum_server&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ocum_server&#39;</span><span class="p">)</span>

        <span class="c1"># Storage policy copy properties</span>
        <span class="k">if</span> <span class="s1">&#39;copy_name&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;copy_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copy_name&#39;</span><span class="p">,</span>
                                                     <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">get_custom_str</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;spare_pool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spare_pool&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;spare_pool_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spare_pool_id&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;tape_library_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tape_library_id&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;drive_pool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;drive_pool&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;drive_pool_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;drive_pool_id&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span>

    <span class="k">def</span> <span class="nf">existing_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Performs configuration for existing storagepolicy &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">pop_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">,</span>
                                              <span class="p">[</span><span class="s1">&#39;dedup_path&#39;</span><span class="p">,</span> <span class="s1">&#39;incremental_sp&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;retention_period&#39;</span><span class="p">,</span> <span class="s1">&#39;mediaagent&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;mediaagent_name&#39;</span><span class="p">,</span> <span class="s1">&#39;drivepool&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;scratchpool&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;library&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">library_name</span>

    <span class="k">def</span> <span class="nf">add_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the keyword arguments for add() module&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;storage_policy_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;library&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;library_name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;media_agent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;dedup_path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;dedup_path&#39;</span><span class="p">],</span>
            <span class="s1">&#39;incremental_sp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;incremental_sp&#39;</span><span class="p">],</span>
            <span class="s1">&#39;retention_period&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;retention_period&#39;</span><span class="p">],</span>
            <span class="s1">&#39;number_of_streams&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;number_of_streams&#39;</span><span class="p">],</span>
            <span class="s1">&#39;ocum_server&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;ocum_server&#39;</span><span class="p">]</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">add_tape_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the keyword arguments for add_tape_sp() module&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;storage_policy_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;library&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;library_name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;media_agent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;drive_pool&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;drivepool&#39;</span><span class="p">],</span>
            <span class="s1">&#39;scratch_pool&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;scratchpool&#39;</span><span class="p">],</span>
            <span class="s1">&#39;incremental_sp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;incremental_sp_tape&#39;</span><span class="p">]</span>
        <span class="p">}</span>


<span class="k">class</span> <span class="nc">_Disklibrary</span><span class="p">(</span><span class="n">CVEntities</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Class to support CVEntities class with common disklibrary operations&#39;&#39;&#39;</span>

    <span class="n">associated_entities</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mediaagent&#39;</span><span class="p">]</span>
    <span class="n">entity_id</span> <span class="o">=</span> <span class="s1">&#39;library_id&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_object</span><span class="p">,</span> <span class="n">entity_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes Disklibrary class object</span>
<span class="sd">        Args:</span>
<span class="sd">            init_object (object) : Should be either the commcell or the testcase object</span>

<span class="sd">            entity_properties (dict) : Entity properties to be created/modified.&quot;&quot;&quot;</span>

        <span class="c1"># Pre-initialized attributes applicable for all instances of the class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_object</span><span class="p">,</span> <span class="n">Commcell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">init_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="o">=</span> <span class="n">init_object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">commcell</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">_Disklibrary</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">entity_properties</span>

    <span class="k">def</span> <span class="nf">object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Gets the associated object and checks if the disklibrary exists &#39;&#39;&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">disklibrary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">disk_libraries</span>

        <span class="c1"># Return tuple of (object, True/False)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">disklibrary</span><span class="p">,</span> <span class="n">disklibrary</span><span class="o">.</span><span class="n">has_library</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns target string on which the disklibrary shall be created &#39;&#39;&#39;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_str</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mount_path&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">return</span> <span class="n">target</span>

    <span class="k">def</span> <span class="nf">post_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform post delete configuration for disklibrary &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cleanup_mount_path&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mount_path&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># Delete disklibrary mount path on the Media Agent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mount_path&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_config</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Sets entity properties based on dynamic evaluation of input properties</span>

<span class="sd">            Args:</span>
<span class="sd">                entity_config (dict) -- Dict of properties of all entities to be created</span>

<span class="sd">            Returns:</span>
<span class="sd">                - Modified entity properties based on dynamic evaluation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Target properties</span>
        <span class="n">mediaagent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_props</span><span class="p">(</span><span class="s1">&#39;mediaagent&#39;</span><span class="p">,</span> <span class="s1">&#39;disklibrary&#39;</span><span class="p">,</span> <span class="n">entity_config</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mediaagent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mediaagent</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">mediaagent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mediaagent</span>

        <span class="k">if</span> <span class="n">mediaagent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mediaagent</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">mediaagent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">get_ma</span><span class="p">(</span><span class="s1">&#39;windows&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mediaagent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Media agent for creating disklibrary: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mediaagent</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mediaagent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to fetch media agent for creating disk library&quot;</span><span class="p">)</span>

        <span class="c1"># Entity properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mount_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mount_path&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mount_path&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mount_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mount_path</span><span class="p">(</span><span class="n">mediaagent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;cleanup_mount_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cleanup_mount_path&#39;</span><span class="p">,</span>
                                                          <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mount_path&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span>

    <span class="k">def</span> <span class="nf">existing_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Performs configuration for existing disklibrary &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mount_path&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">pop_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;mediaagent&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;mount_path&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">add_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the keyword arguments for add() module&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;library_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;media_agent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mediaagent_name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;mount_path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;mount_path&#39;</span><span class="p">],</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
        <span class="p">}</span>


<span class="k">class</span> <span class="nc">_Clientgroup</span><span class="p">(</span><span class="n">CVEntities</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Class to support CVEntities class with common clientgroup operations&#39;&#39;&#39;</span>

    <span class="n">associated_entities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">entity_id</span> <span class="o">=</span> <span class="s1">&#39;clientgroup_id&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_object</span><span class="p">,</span> <span class="n">entity_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes Clientgroup class object</span>
<span class="sd">        Args:</span>

<span class="sd">            init_object (object)     : Should be either the commcell or the testcase object</span>

<span class="sd">            entity_properties (dict) : Entity properties &quot;&quot;&quot;</span>

        <span class="c1"># Pre-initialized attributes applicable for all instances of the class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_object</span><span class="p">,</span> <span class="n">Commcell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">init_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="o">=</span> <span class="n">init_object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">commcell</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">_Clientgroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">entity_properties</span>

    <span class="k">def</span> <span class="nf">object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Gets the associated object and checks if the clientgroup exists &#39;&#39;&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">clientgroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">client_groups</span>

        <span class="c1"># Return tuple of (object, True/False)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">clientgroup</span><span class="p">,</span> <span class="n">clientgroup</span><span class="o">.</span><span class="n">has_clientgroup</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns target string on which the clientgroup shall be created &#39;&#39;&#39;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;clients&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">return</span> <span class="n">target</span>

    <span class="k">def</span> <span class="nf">get_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_config</span><span class="p">,</span> <span class="n">created_entities</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Sets entity properties based on dynamic evaluation of input properties</span>

<span class="sd">            Args:</span>
<span class="sd">                entity_config (dict) -- Dict of properties of all entities to be created</span>

<span class="sd">                created_entities (dict) -- Dict of created entities and their properties</span>

<span class="sd">            Returns:</span>
<span class="sd">                - Modified entity properties based on dynamic evaluation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">clients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_props</span><span class="p">(</span><span class="s1">&#39;clients&#39;</span><span class="p">,</span> <span class="s1">&#39;clientgroup&#39;</span><span class="p">,</span> <span class="n">entity_config</span><span class="p">)</span>
        <span class="n">default_client_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default_client&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># If no clients are provided in input dictionary and default client</span>
        <span class="c1"># has to be set in the client group then assign default client.</span>
        <span class="c1"># Other wise set clients as empty.</span>
        <span class="k">if</span> <span class="n">clients</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">default_client_flag</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">DELETE_ENTITIES_ORDER</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">entity_config</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;clientgroup&#39;</span><span class="p">:</span>
                    <span class="n">_client</span> <span class="o">=</span> <span class="n">created_entities</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_name&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">_client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">clients</span> <span class="o">=</span> <span class="p">[</span><span class="n">_client</span><span class="p">]</span>
                        <span class="k">break</span>

            <span class="n">clients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_client</span> <span class="k">if</span> <span class="n">clients</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clients</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;clients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clients</span> <span class="k">if</span> <span class="n">clients</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="c1"># Entity properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">DESCRIPTION</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;enable_backup&#39;</span><span class="p">,</span> <span class="s1">&#39;enable_restore&#39;</span><span class="p">,</span> <span class="s1">&#39;enable_data_aging&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span>

    <span class="k">def</span> <span class="nf">add_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the keyword arguments for add() module&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;clientgroup_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;clients&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;clients&#39;</span><span class="p">],</span>
            <span class="s1">&#39;clientgroup_description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
            <span class="s1">&#39;enable_backup&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;enable_backup&#39;</span><span class="p">],</span>
            <span class="s1">&#39;enable_restore&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;enable_restore&#39;</span><span class="p">],</span>
            <span class="s1">&#39;enable_data_aging&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;enable_data_aging&#39;</span><span class="p">],</span>
            <span class="s1">&#39;scg_rule&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scg_rule&#39;</span><span class="p">)</span>

        <span class="p">}</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Commvault Systems Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>