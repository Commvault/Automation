
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Automation.FileSystem.SNAPUtils.snaphelper &#8212; Commvault Automation 11.14 documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for Automation.FileSystem.SNAPUtils.snaphelper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;Helper file for performing IntelliSnap operations</span>

<span class="sd">SNAPHelper is the only class defined in this file</span>

<span class="sd">SNAPHeper: Helper class to perform IntelliSnap operations</span>

<span class="sd">SNAPHeper:</span>
<span class="sd">    __init__()                   --  initializes Snap helper object</span>

<span class="sd">    setup()                      --  Setup function which calls create_locations() and</span>
<span class="sd">                                     create_snap_environment()</span>

<span class="sd">    create_locations()           --  Create MountPath, Restore and DisKlibrary Locations</span>
<span class="sd">                                     if does not exists</span>

<span class="sd">    create_snap_copy()           --  wrapper for creating snap, snapvault, snapmirror, replica,</span>
<span class="sd">                                     and replica mirror copies</span>

<span class="sd">    create_secondary_snap_copy()       --  creates snapvault, snapmirror, replica,</span>
<span class="sd">                                     and replica mirror copies</span>

<span class="sd">    create_snap_environment()    --  includes Add Array, Enabling IntelliSnap at Subclient</span>
<span class="sd">                                     Create Library, Storage Policy, Snap Copy, Aux Copy, BackupSet</span>
<span class="sd">                                     Subclient, set content and Enable IntelliSnap on it,</span>
<span class="sd">                                     add test data folder to subclient content</span>

<span class="sd">    kill_job()                   --  Starts a SnapBackup job and kills it after Snap Phase</span>
<span class="sd">                                     completes and adds the job in to</span>
<span class="sd">                                     Job_Tracker to check while DA validation</span>

<span class="sd">    delete_copy()                --  deletes storage policy copy</span>

<span class="sd">    snap_backup()                --  Runs SnapBackup based on the following inputs</span>
<span class="sd">                                     if only inlinebkpcpy is True, Runs Backup with Catalog and</span>
<span class="sd">                                     inline backup copy</span>
<span class="sd">                                     if only skipCatalog is True, Runs Backup with Skip Catalog</span>
<span class="sd">                                     if Both inlinebkpcpy, skipCatalog are True, Runs Backup with</span>
<span class="sd">                                     skip catalog and inline backup copy</span>
<span class="sd">                                     if Both inlinebkpcpy, skipCatalog are False, Runs Backup with</span>
<span class="sd">                                     Catalog, Also if inline is true, monitors backup copy job.</span>

<span class="sd">    execute_query()              --  Executes SQL query and fetches single row</span>

<span class="sd">    folder_name()                --  Generates a random sting with 3 charactor&#39;s</span>

<span class="sd">    snap_outplace()              --  OutPlace Restore from Snap copy</span>

<span class="sd">    snap_inplace()               --  Inplace Restore from Snap copy</span>

<span class="sd">    time_formattor()             --  Takes job times as input and Formats it for Browse</span>

<span class="sd">    snap_inplace_validation()    --  Validate inplace restored content from snap by</span>
<span class="sd">                                     mounting the snapshot</span>

<span class="sd">    snap_outplace_validation()   --  Validate outplace restored content from snap with</span>
<span class="sd">                                     subclient content</span>

<span class="sd">    compare()                    --  Compares two directories</span>

<span class="sd">    tape_outplace()              --  Outplace Restore from tape copy</span>

<span class="sd">    tape_inplace()               --  Inplace restore from tape copy</span>

<span class="sd">    tape_outplace_validation()   --  Validate outplace restored content with the subclient content</span>

<span class="sd">    tape_inplace_validation()    --  Validate inplace restored content</span>

<span class="sd">    mount_snap()                 --  Mounts Snap of the given job_id</span>

<span class="sd">    unmount_snap()               --  UnMounts Snap of the given job_id</span>

<span class="sd">    revert_snap()                --  Reverts Snap of the given job_id</span>

<span class="sd">    delete_snap()                --  Deletes Snap of the given job_id</span>

<span class="sd">    mount_validation()           --  Validates mounted snap with subclient content</span>

<span class="sd">    unmount_validation()         --  Validates if snap is unmounted</span>

<span class="sd">    revert_validation()          --  Validates reverted snap by mounting the snap</span>

<span class="sd">    delete_validation()          --  Validates if the snap is deleted</span>

<span class="sd">    unmount_status()             --  checks if the snap is unmounted</span>

<span class="sd">    backup_copy()                --  Runs Offline backup copy for the given storage policy</span>

<span class="sd">    snapshot_cataloging()        --  Runs Offline Snapshot Cataloging for the given storage policy</span>

<span class="sd">    aux_copy()                   --  Runs Aux copy for the given storage policy and copy</span>

<span class="sd">    data_aging()                 --  Runs Data aging for the given storage policy and copy</span>

<span class="sd">    get_volumeid_list()          --  Fetches jobid&#39;s for the snap copy</span>

<span class="sd">    data_aging_validation()      --  Validates Pruning of Snap jobs</span>

<span class="sd">    execute_query_all_rows()     --  Executes SQL query and Fetches all rows</span>

<span class="sd">    clean_snap_environment()     --  includes disable intellisnap at subclient, delete subclient,</span>
<span class="sd">                                     backupset, auxcopy, snapcopy, storage policy, library,</span>
<span class="sd">                                     disable intellisnap at client and delete array</span>

<span class="sd">    clear_locations()            --  Deletes MountPath, Restores and DiskLibrary locations</span>

<span class="sd">    cleanup()                    --  Calls clean_snap_environment() and clear_locations()</span>

<span class="sd">    Snap_Template1()             --  Snap Template1 to Perform Snap backup and Restore opertaions</span>
<span class="sd">    </span>
<span class="sd">    add_array()                  --  To add array in the array management</span>

<span class="sd">    delete array()               --  To delete array entry from the array managament</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="kn">from</span> <span class="nn">base64</span> <span class="k">import</span> <span class="n">b64encode</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.machine</span> <span class="k">import</span> <span class="n">Machine</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="k">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="k">import</span> <span class="n">OptionsSelector</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="k">import</span> <span class="n">CVEntities</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.idautils</span> <span class="k">import</span> <span class="n">CommonUtils</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.database_helper</span> <span class="k">import</span> <span class="n">get_csdb</span>
<span class="kn">from</span> <span class="nn">cvpysdk.job</span> <span class="k">import</span> <span class="n">Job</span>
<span class="kn">from</span> <span class="nn">cvpysdk.backupset</span> <span class="k">import</span> <span class="n">Backupsets</span>
<span class="kn">from</span> <span class="nn">cvpysdk.policies.storage_policies</span> <span class="k">import</span> <span class="n">StoragePolicyCopy</span>
<span class="kn">from</span> <span class="nn">cvpysdk.exception</span> <span class="k">import</span> <span class="n">SDKException</span>


<div class="viewcode-block" id="SNAPHelper"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper">[docs]</a><span class="k">class</span> <span class="nc">SNAPHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class to perform snap operations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">tcinputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes Snaphelper object and gets the commserv database object if not specified</span>

<span class="sd">            Args:</span>
<span class="sd">                commcell    (object)    --  commcell object</span>

<span class="sd">                client      (object)    --  client object</span>

<span class="sd">                agent       (object)    --  agent object</span>

<span class="sd">                tcinputs    (dict)      --  Test case inputs dictionary</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span> <span class="o">=</span> <span class="n">get_csdb</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span> <span class="o">=</span> <span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="n">agent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backupset</span> <span class="o">=</span> <span class="n">Backupsets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span> <span class="o">=</span> <span class="n">tcinputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span> <span class="o">=</span> <span class="n">CVEntities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commonutils</span> <span class="o">=</span> <span class="n">CommonUtils</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_tracker</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data_folder</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;SnapAutomationOutput&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snap_automation_output</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">CommvaultAutomationOutput&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snap_automation_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;SnapAutomationOutput&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_location</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_outplace_restore_location</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tape_outplace_restore_location</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mount_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib_loc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">commonutils</span><span class="o">.</span><span class="n">check_client_readiness</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ClientName&#39;</span><span class="p">]]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Check readiness for the Client and Media Agent successful&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_engine_at_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;SnapEngineAtArray&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_engine_at_subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;SnapEngineAtSubclient&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ocum_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;OCUMServerName&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prov_policy_vault</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ProvisioningPolicyForVault&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prov_policy_mirror</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ProvisioningPolicyForMirror&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_pool_vault</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ResourcePoolForVault&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_pool_mirror</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ResourcePoolForMirror&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snap_engine_at_array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib_name</span> <span class="o">=</span> <span class="s2">&quot;Auto_Lib_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy_name</span> <span class="o">=</span> <span class="s2">&quot;Auto_SP_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subclient_name</span> <span class="o">=</span> <span class="s2">&quot;Auto_SC_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backupset_name</span> <span class="o">=</span> <span class="s2">&quot;Auto_BS_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mountpath_val</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mount_status</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entity_properties</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inline_bkp_cpy</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_catalog</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span> <span class="o">=</span> <span class="s1">&#39;FULL&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_copy_name</span> <span class="o">=</span> <span class="s2">&quot;AuxCopy&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_copy_name</span> <span class="o">=</span> <span class="s2">&quot;Snap&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SCAN&quot;</span><span class="p">,</span> <span class="s2">&quot;CATALOG&quot;</span><span class="p">,</span> <span class="s2">&quot;ARCHIVE INDEX&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_support</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;skip_revert&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_backup_copy_job</span> <span class="o">=</span> <span class="s2">&quot;SELECT childJobId FROM JMJobWF WHERE processedJobId = </span><span class="si">{0}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_mount_path</span> <span class="o">=</span> <span class="s2">&quot;SELECT MountPath FROM SMVolume WHERE JobId = </span><span class="si">{0}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_total_backup_size</span> <span class="o">=</span> <span class="s2">&quot;SELECT totalBackupSize FROM JMBkpStats WHERE jobID = </span><span class="si">{0}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_volume_id</span> <span class="o">=</span> <span class="s2">&quot;SELECT SMVolumeId FROM SMVolume WHERE jobID = </span><span class="si">{0}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_control_host</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT ControlHostId FROM SMsnap WHERE SMSnapId in</span>
<span class="s2">                                (SELECT SMSnapId FROM SMVolSnapMap WHERE SMVolumeId = </span><span class="si">{0}</span><span class="s2">)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_mount_status</span> <span class="o">=</span> <span class="s2">&quot;SELECT MountStatus FROM SMVolume WHERE JobId = </span><span class="si">{0}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_snap_copy_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;(select name from archGroupCopy where copy=</span>
<span class="s2">                        1 and archGroupId in (select id from archGroup where name like &#39;</span><span class="si">{0}</span><span class="s2">&#39;))&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fetch_job_ids</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select JobId from SMVolume where CopyId =</span>
<span class="s2">                               (select id from archGroupCopy where copy =1 and archGroupId in</span>
<span class="s2">                               (select id from archGroup where name like &#39;</span><span class="si">{0}</span><span class="s2">&#39;))&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_volumeid_da</span> <span class="o">=</span> <span class="s2">&quot;SELECT SMVolumeId FROM SMVolume WHERE jobID = </span><span class="si">{0}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrayname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayUserName&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayPassword&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controlhost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ControlHost&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_controlhost_id</span> <span class="o">=</span> <span class="s2">&quot;SELECT ControlHostId from SMCONTROLHOST where SMArrayId =&#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span>


<div class="viewcode-block" id="SNAPHelper.setup"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Setup function to create locations and snap entities &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_locations</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_environment</span><span class="p">()</span></div>

<div class="viewcode-block" id="SNAPHelper.create_locations"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.create_locations">[docs]</a>    <span class="k">def</span> <span class="nf">create_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clean subclient content if exists and create new one</span>
<span class="sd">            Create restore location</span>
<span class="sd">            Create Mountpath</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_engine_at_array</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="n">temp1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_engine_at_subclient</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="n">temp2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1">#Create Restore Location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_location</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="se">\\</span><span class="si">{1}</span><span class="se">\\</span><span class="si">{2}</span><span class="se">\\</span><span class="s2">Restores&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snap_automation_output</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;snap restore location: </span><span class="si">{0}</span><span class="s2"> exists, cleaning it and creating new folder&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;snap restore location does not exists, creating one! &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Created restore location : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">)</span>
                     <span class="p">)</span>

        <span class="c1">#Create MountPath Location</span>
        <span class="n">mount_path</span> <span class="o">=</span> <span class="s2">&quot;MountPath_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mount_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="se">\\</span><span class="si">{1}</span><span class="se">\\</span><span class="si">{2}</span><span class="se">\\</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snap_automation_output</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">mount_path</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Mount path location: </span><span class="si">{0}</span><span class="s2"> exists, cleaning it and creating new folder&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mount_path</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mountpath location does not exists, creating one! &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Created Mount path location : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount_path</span><span class="p">))</span>

        <span class="c1">#Create DiskLibrary Location</span>
        <span class="n">dsik_library</span> <span class="o">=</span> <span class="s2">&quot;DiskLibrary_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib_loc</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="se">\\</span><span class="si">{1}</span><span class="se">\\</span><span class="si">{2}</span><span class="se">\\</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snap_automation_output</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">dsik_library</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disk_lib_loc</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Disk library location: </span><span class="si">{0}</span><span class="s2"> exists, Not creating!!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib_loc</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disk library location does not exists, creating one! &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disk_lib_loc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Created Disk Library location : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib_loc</span><span class="p">)</span>
                         <span class="p">)</span></div>

      <span class="c1">#Adding array management entry</span>
<div class="viewcode-block" id="SNAPHelper.add_array"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.add_array">[docs]</a>    <span class="k">def</span> <span class="nf">add_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding array management entry&quot;</span><span class="p">)</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">add_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snap_engine_at_array</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">controlhost</span><span class="p">,</span>
                                                                     <span class="n">is_ocum</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SDKException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">exception_id</span> <span class="o">==</span> <span class="s1">&#39;101&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Array already exist&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="SNAPHelper.create_snap_copy"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.create_snap_copy">[docs]</a>    <span class="k">def</span> <span class="nf">create_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">copy_name</span><span class="p">,</span>
                         <span class="n">is_mirror_copy</span><span class="p">,</span>
                         <span class="n">is_snap_copy</span><span class="p">,</span>
                         <span class="n">library_name</span><span class="p">,</span>
                         <span class="n">media_agent_name</span><span class="p">,</span>
                         <span class="n">source_copy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">provisioning_policy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">resource_pool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">is_replica_copy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; includes adding Snap Copy, Snapvault Copy, SnapMirror Copy, Replica/Vault Copy,</span>
<span class="sd">            Replica Mirror Copy etc</span>
<span class="sd">            Args:</span>
<span class="sd">                copy_name           (str)       -- Copy Name to create</span>

<span class="sd">                is_mirror_copy      (bool)      -- Creates Mirror Copy if true</span>

<span class="sd">                is_snap_copy        (bool)      -- Creates Snap Copy if true</span>

<span class="sd">                library_name        (str)       -- library name for creating copy</span>

<span class="sd">                media_agent_name    (str)       -- Media Agent name for creating copy</span>

<span class="sd">                source_copy         (str)       -- Source Copy for the Copy</span>
<span class="sd">                default: None</span>

<span class="sd">                provisioning_policy (str)       -- Provisioning Policy Name for the Vault/Mirror</span>
<span class="sd">                                                   Copy</span>
<span class="sd">                default: None</span>

<span class="sd">                resource_pool       (str)       -- Resource Pool for the Vault/Mirror Copy</span>
<span class="sd">                default: None</span>

<span class="sd">                is_replica_copy     (bool)      -- Creates Replica Copy if true</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">has_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storage policy : </span><span class="si">{0}</span><span class="s2"> already has copy named : </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">)</span>
                         <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copy with name </span><span class="si">{0}</span><span class="s2"> does not exists, Creating one!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">copy_name</span><span class="p">)</span>
                         <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span> <span class="n">is_mirror_copy</span><span class="p">,</span> <span class="n">is_snap_copy</span><span class="p">,</span>
                                                 <span class="n">library_name</span><span class="p">,</span> <span class="n">media_agent_name</span><span class="p">,</span> <span class="n">source_copy</span><span class="p">,</span>
                                                 <span class="n">provisioning_policy</span><span class="p">,</span> <span class="n">resource_pool</span><span class="p">,</span>
                                                 <span class="n">is_replica_copy</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.create_secondary_snap_copy"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.create_secondary_snap_copy">[docs]</a>    <span class="k">def</span> <span class="nf">create_secondary_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">source_copy</span><span class="p">,</span>
                                   <span class="n">snapvault</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">snapmirror</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">replica_vault</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates Snapvault, Snapmirror, Replica Vault and Replica Mirror Copies</span>
<span class="sd">            Agrs:</span>
<span class="sd">                source_copy     (str)     -- Source copy for the copy</span>

<span class="sd">                snapvault       (bool)    -- creates snapvault copy if true</span>

<span class="sd">                snapmirror      (bool)    -- creates snapmirror copy if true</span>

<span class="sd">                replica_vault   (bool)    -- creates replica vault copy if true</span>

<span class="sd">                replica_mirror  (bool)    -- creates replica mirror copy if true</span>
<span class="sd">            Returns:</span>
<span class="sd">                copy name       (string)  -- Newly created Copy Name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_snap</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">snapmirror</span> <span class="ow">or</span> <span class="n">replica_mirror</span><span class="p">:</span>
            <span class="n">is_mirror</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_mirror</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">snapvault</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating SnapVault copy&quot;</span><span class="p">)</span>
            <span class="n">copy_name</span> <span class="o">=</span> <span class="s2">&quot;Vault&quot;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span> <span class="n">is_mirror</span><span class="p">,</span> <span class="n">is_snap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib</span><span class="o">.</span><span class="n">library_name</span><span class="p">,</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">]),</span> <span class="n">source_copy</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">prov_policy_vault</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_pool_vault</span>
                                 <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created SnapVault Copy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">snapmirror</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating SnapMirror copy&quot;</span><span class="p">)</span>
            <span class="n">copy_name</span> <span class="o">=</span> <span class="s2">&quot;Mirror&quot;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span> <span class="n">is_mirror</span><span class="p">,</span> <span class="n">is_snap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib</span><span class="o">.</span><span class="n">library_name</span><span class="p">,</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">]),</span> <span class="n">source_copy</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">prov_policy_mirror</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_pool_mirror</span>
                                 <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created SnapMirror Copy : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">replica_vault</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating Replica/vault copy&quot;</span><span class="p">)</span>
            <span class="n">copy_name</span> <span class="o">=</span> <span class="s2">&quot;Replica_Vault&quot;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span> <span class="n">is_mirror</span><span class="p">,</span> <span class="n">is_snap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib</span><span class="o">.</span><span class="n">library_name</span><span class="p">,</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span>
                                  <span class="n">is_replica_copy</span><span class="o">=</span><span class="kc">True</span>
                                 <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created Replica/Vault Copy : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating Replica/vault copy&quot;</span><span class="p">)</span>
            <span class="n">copy_name</span> <span class="o">=</span> <span class="s2">&quot;Replica_Mirror&quot;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span> <span class="n">is_mirror</span><span class="p">,</span> <span class="n">is_snap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib</span><span class="o">.</span><span class="n">library_name</span><span class="p">,</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span>
                                  <span class="n">is_replica_copy</span><span class="o">=</span><span class="kc">True</span>
                                 <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created Replica/Mirror Copy : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">copy_name</span></div>

<div class="viewcode-block" id="SNAPHelper.create_snap_environment"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.create_snap_environment">[docs]</a>    <span class="k">def</span> <span class="nf">create_snap_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; includes Add Array, Enabling IntelliSnap at Client, Create Library, Storage Policy,</span>
<span class="sd">        Snap Copy, Aux Copy,BackupSet, Subclient and Enable IntelliSnap on it, Set Retention</span>
<span class="sd">        Snap Copy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Enable Intellisnap at client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enabling Intellisnap on client: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">enable_intelli_snap</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Enabled Intellisnap on client: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocum_server</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocum_server</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ocum_server</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entity_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;target&#39;</span><span class="p">:</span>
                <span class="p">{</span>
                    <span class="s1">&#39;force&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s1">&#39;mediaagent&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">])</span>
                    <span class="p">},</span>
            <span class="s1">&#39;disklibrary&#39;</span><span class="p">:</span>
                <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib_name</span><span class="p">,</span>
                    <span class="s1">&#39;mount_path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib_loc</span>
                    <span class="p">},</span>
            <span class="s1">&#39;storagepolicy&#39;</span><span class="p">:</span>
                <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">,</span>
                    <span class="s1">&#39;library&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disk_lib_name</span><span class="p">),</span>
                    <span class="s1">&#39;copy_name&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">aux_copy_name</span><span class="p">,</span>
                    <span class="s1">&#39;ocum_server&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocum_server</span><span class="p">,</span>
                    <span class="s1">&#39;retention_period&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;number_of_streams&#39;</span><span class="p">:</span> <span class="mi">50</span>
                    <span class="p">},</span>
            <span class="s1">&#39;backupset&#39;</span><span class="p">:</span>
                <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">backupset_name</span><span class="p">,</span>
                    <span class="s1">&#39;agent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">agent_name</span><span class="p">,</span>
                    <span class="s1">&#39;client&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span>
                    <span class="s1">&#39;instance&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;InstanceName&#39;</span><span class="p">])</span>
                    <span class="p">},</span>
            <span class="s1">&#39;subclient&#39;</span><span class="p">:</span>
                <span class="p">{</span>
                    <span class="s1">&#39;agent&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">agent_name</span><span class="p">,</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">,</span>
                    <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s2">&quot;SubclientContent&quot;</span><span class="p">])],</span>
                    <span class="s1">&#39;instance&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;InstanceName&#39;</span><span class="p">]),</span>
                    <span class="s1">&#39;storagepolicy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">,</span>
                    <span class="s1">&#39;backupset&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">backupset_name</span><span class="p">,</span>
                    <span class="s1">&#39;client&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_name</span>
                    <span class="p">},</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;subclient&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;disklibrary&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>

        <span class="c1">#Create Snap Copy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocum_server</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;This is OCUM SP, Not creating Snap primary Copy&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snap_copy_name</span> <span class="o">=</span> <span class="s2">&quot;Primary&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating Snap copy&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_lib</span><span class="o">.</span><span class="n">library_name</span><span class="p">,</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">])</span>
                                 <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created Snap Copy &quot;</span><span class="p">)</span>

        <span class="c1">#Enabling Intellisnap on subclient and setting Snap engine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enabling Intellisnap on subclient: </span><span class="si">{0}</span><span class="s2"> and setting Snap engine: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_engine_at_subclient</span><span class="p">)</span>
                     <span class="p">)</span>
        <span class="n">proxy_options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;snap_proxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">],</span>
            <span class="s1">&#39;backupcopy_proxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">],</span>
            <span class="s1">&#39;use_source_if_proxy_unreachable&#39;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">enable_intelli_snap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snap_engine_at_subclient</span><span class="p">,</span> <span class="n">proxy_options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Enabled Intellisnap on subclient: </span><span class="si">{0}</span><span class="s2"> and set Snap engine: </span><span class="si">{1}</span><span class="s2">&quot;</span>
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_engine_at_subclient</span><span class="p">)</span>
                     <span class="p">)</span>

        <span class="c1">#Add Test data folder on the subclient content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Read subclient content&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Subclient Content: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
        <span class="n">drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span>
        <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">drive</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;TestData&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;path : </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;TestData Folder already exists under </span><span class="si">{0}</span><span class="s2">, deleting it and creating&quot;</span>
                <span class="s2">&quot;new one!!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;TestData Folder does not exists under </span><span class="si">{0}</span><span class="s2">, creating one!!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created TestData Folder&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span> <span class="o">=</span> <span class="n">path</span></div>

<div class="viewcode-block" id="SNAPHelper.delete_copy"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.delete_copy">[docs]</a>    <span class="k">def</span> <span class="nf">delete_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes Copy</span>
<span class="sd">            Args:</span>
<span class="sd">                string  : copy_name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleting  copy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">delete_secondary_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully deleted  copy : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.kill_job"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.kill_job">[docs]</a>    <span class="k">def</span> <span class="nf">kill_job</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Kills SnapBackup job</span>
<span class="sd">            Returns:</span>
<span class="sd">                    object : job Object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;successfully started </span><span class="si">{0}</span><span class="s2"> job :</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;killing the job </span><span class="si">{0}</span><span class="s2"> to verify snap cleanup&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">while</span> <span class="n">job</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;will check the phase status after 10 seconds&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;pending&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;job is in pending state with reason </span><span class="si">{0}</span><span class="s2">, killing it and raising</span>
<span class="s2">                              the exception, please check the logs!&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">pending_reason</span><span class="p">))</span>
                <span class="n">job</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job status is pending, killing the job&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snap phase completed, killing the job now&quot;</span><span class="p">)</span>
        <span class="n">job</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;killed&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;will check the killed status after 10 seconds&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span> <span class="s2">&quot;failed to start&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job status is failed or completed, we did not get the killed job&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully killed the job :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_tracker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_backup"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_backup">[docs]</a>    <span class="k">def</span> <span class="nf">snap_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs Snap Backup from Commcell for the given subclient</span>
<span class="sd">        Returns:</span>
<span class="sd">                    object : job Object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data_folder</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating test data at: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data_folder</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data_folder</span><span class="p">)</span>

        <span class="n">advanced_option</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;inline_bkp_cpy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_bkp_cpy</span><span class="p">,</span>
            <span class="s1">&#39;skip_catalog&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_catalog</span>
        <span class="p">}</span>

        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span> <span class="n">advanced_options</span><span class="o">=</span><span class="n">advanced_option</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started </span><span class="si">{0}</span><span class="s2"> Snap backup with Job ID: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                     <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;backup level :</span><span class="si">{0}</span><span class="s2">, job type </span><span class="si">{1}</span><span class="s2">, job status </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">job_type</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
                     <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run </span><span class="si">{0}</span><span class="s2"> backup job with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;backup level is same as we started&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;backup level is not same as we started&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished </span><span class="si">{0}</span><span class="s2"> Snap backup job&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_bkp_cpy</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">bkp_cpy_jid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_backup_copy_job</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;This is Inline backup job and Backup copy job id is: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">bkp_cpy_jid</span><span class="p">)</span>
                         <span class="p">)</span>
            <span class="k">if</span> <span class="n">bkp_cpy_jid</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;backup copy job for the snap job : </span><span class="si">{0}</span><span class="s2"> is not started&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bkp_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">bkp_cpy_jid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Monitoring backup copy job: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bkp_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">bkp_job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to run </span><span class="si">{0}</span><span class="s2"> backup job with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">bkp_job</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span> <span class="n">bkp_job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;successfully completed backup copy job: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bkp_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_tracker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job</span></div>

<div class="viewcode-block" id="SNAPHelper.execute_query"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.execute_query">[docs]</a>    <span class="k">def</span> <span class="nf">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">option1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Executes SQL Queries</span>
<span class="sd">            Return:</span>
<span class="sd">                    str : first column of the sql output</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">option1</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="SNAPHelper.folder_name"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.folder_name">[docs]</a>    <span class="k">def</span> <span class="nf">folder_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns random charactor&#39;s &quot;&quot;&quot;</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">backup_level</span> <span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_restore"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_restore">[docs]</a>    <span class="k">def</span> <span class="nf">snap_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">copy_precedence</span><span class="p">,</span>
                     <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">outplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method for Restore from Snap job</span>
<span class="sd">            Return :</span>
<span class="sd">                    Object : job object of restore job</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot; Running restore from Snap Backup &quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running outplace restore from snap :&quot;</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">restore_out_of_place</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_outplace_restore_location</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">],</span>
                <span class="n">copy_precedence</span><span class="o">=</span><span class="n">copy_precedence</span><span class="p">,</span>
                <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running inplace restore from snap :&quot;</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">restore_in_place</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">],</span>
                <span class="n">copy_precedence</span><span class="o">=</span><span class="n">copy_precedence</span><span class="p">,</span>
                <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started Restore from Snap Backup with job id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run restore from Snap Backup: &quot;</span> <span class="o">+</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished restore from Snap Backup&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_outplace"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_outplace">[docs]</a>    <span class="k">def</span> <span class="nf">snap_outplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; OutPlace restore from snapbackup</span>
<span class="sd">            Args :</span>
<span class="sd">                copy_precedence : precedence of snap copy</span>
<span class="sd">                from_time : from time for browse, default: None</span>
<span class="sd">                to_time : to time for Browse,  default: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dir_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span><span class="o">.</span><span class="n">_get_restore_dir_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;dir name: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_outplace_restore_location</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_location</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">dir_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snap_outplace_restore_location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;restore location is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_outplace_restore_location</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">(</span>
            <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">outplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_inplace"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_inplace">[docs]</a>    <span class="k">def</span> <span class="nf">snap_inplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; OutPlace restore from snapbackup</span>
<span class="sd">            Args :</span>
<span class="sd">                copy_precedence : precedence of snap copy</span>
<span class="sd">                from_time : from time for browse, default: None</span>
<span class="sd">                to_time : to time for Browse,  default: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">(</span>
            <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_inplace_validation"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_inplace_validation">[docs]</a>    <span class="k">def</span> <span class="nf">snap_inplace_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validation for inplace restore from snap</span>
<span class="sd">            Args:</span>
<span class="sd">                jobId : Job id of the snap to validate</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mount_snap</span><span class="p">(</span><span class="n">jobid</span><span class="p">)</span>
        <span class="n">mountpath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mount_path</span><span class="p">,</span> <span class="n">jobid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;TestData&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="n">mountpath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unmount_snap</span><span class="p">(</span><span class="n">jobid</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_outplace_validation"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_outplace_validation">[docs]</a>    <span class="k">def</span> <span class="nf">snap_outplace_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validation for outplace restore from snap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">snap_outplace_restore_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_outplace_restore_location</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;TestData&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span>
            <span class="n">snap_outplace_restore_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.compare"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.compare">[docs]</a>    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_obj</span><span class="p">,</span> <span class="n">destclient_obj</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Compare two directories</span>
<span class="sd">            Args:</span>
<span class="sd">                client_obj : client Object of the Source machine</span>
<span class="sd">                destclient_obj : client Object of the Destination machine</span>
<span class="sd">                source_dir : Source directory Path</span>
<span class="sd">                dest_dir : Destination directory Path</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;comparing content&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;source dir: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;dest dir : </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">)</span>

        <span class="n">difference</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">client_obj</span><span class="o">.</span><span class="n">compare_folders</span><span class="p">(</span>
            <span class="n">destclient_obj</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">,</span> <span class="n">dest_dir</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">difference</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Validation failed. List of different files </span><span class="se">\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;validation failed. Please check logs for more details.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Compare folder validation was successful&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.tape_restore"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.tape_restore">[docs]</a>    <span class="k">def</span> <span class="nf">tape_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">copy_precedence</span><span class="p">,</span>
                     <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">outplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Restore from Tape Copy</span>
<span class="sd">            Args:</span>
<span class="sd">                copy_precedence : precedence of snap copy</span>
<span class="sd">                from_time : from time for browse, default: None</span>
<span class="sd">                to_time : to time for Browse,  default: None</span>
<span class="sd">                outplace : set to True if outplace restore</span>
<span class="sd">                inplace : set to True if inplace restore</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot; Running restore from tape copy &quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running out of place restore from Tape&quot;</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">restore_out_of_place</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_client</span><span class="o">.</span><span class="n">machine_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tape_outplace_restore_location</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">],</span>
                <span class="n">copy_precedence</span><span class="o">=</span><span class="n">copy_precedence</span><span class="p">,</span>
                <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running in place restore from Tape&quot;</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">restore_in_place</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">],</span>
                <span class="n">copy_precedence</span><span class="o">=</span><span class="n">copy_precedence</span><span class="p">,</span>
                <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started Restore from tape copy with job id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run restore from Tape copy: &quot;</span> <span class="o">+</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished restore from Tape copy&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.tape_outplace"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.tape_outplace">[docs]</a>    <span class="k">def</span> <span class="nf">tape_outplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,):</span>
        <span class="sd">&quot;&quot;&quot; Outplace restore from tape copy</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : jobid to find total nackup size</span>
<span class="sd">                copy_precedence : precedence of snap copy</span>
<span class="sd">                from_time : from time for browse, default: None</span>
<span class="sd">                to_time : to time for Browse,  default: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">size</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_total_backup_size</span><span class="p">,</span> <span class="n">jobid</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Total Backed up size: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="c1"># Find a client to restore the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tape_outplace_restore_location</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span><span class="o">.</span><span class="n">get_windows_restore_client</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tape_restore</span><span class="p">(</span>
            <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">outplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.tape_inplace"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.tape_inplace">[docs]</a>    <span class="k">def</span> <span class="nf">tape_inplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,):</span>
        <span class="sd">&quot;&quot;&quot; Inplace restore from tape copy</span>
<span class="sd">            Args:</span>
<span class="sd">                copy_precedence : precedence of snap copy</span>
<span class="sd">                from_time : from time for browse, default: None</span>
<span class="sd">                to_time : to time for Browse,  default: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tape_restore</span><span class="p">(</span>
            <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.tape_inplace_validation"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.tape_inplace_validation">[docs]</a>    <span class="k">def</span> <span class="nf">tape_inplace_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validates inplace restore from Tape&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span>
            <span class="p">)</span></div>
        <span class="c1"># This is not implemented properly</span>

<div class="viewcode-block" id="SNAPHelper.tape_outplace_validation"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.tape_outplace_validation">[docs]</a>    <span class="k">def</span> <span class="nf">tape_outplace_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validates outplace restore from Tape with the subclient content&quot;&quot;&quot;</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tape_outplace_restore_location</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;TestData&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_client</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_operations"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_operations">[docs]</a>    <span class="k">def</span> <span class="nf">snap_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mountpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">mount</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">unmount</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">revert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">reconcile</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Common Method for Snap Operations</span>
<span class="sd">            Args :</span>
<span class="sd">                jobid : jobid for the Snap operation</span>
<span class="sd">                client_name : name of the destination client, default: None</span>
<span class="sd">                MountPath : MountPath for Snap operation, default: None</span>
<span class="sd">            Return :</span>
<span class="sd">                object : Job object of Snap Operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting SMVolumeId using JobId: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
        <span class="n">volumeid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_volume_id</span><span class="p">,</span> <span class="n">jobid</span><span class="p">))</span>
        <span class="n">control_host</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_control_host</span><span class="p">,</span> <span class="n">volumeid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;SMvolumeId is : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volumeid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;destination client name is :</span><span class="si">{0}</span><span class="s2">&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;mountpath is </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mountpath</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mount</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="n">volumeid</span><span class="p">,</span> <span class="n">client_name</span><span class="p">,</span> <span class="n">mountpath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">unmount</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">unmount</span><span class="p">(</span><span class="n">volumeid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">revert</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">revert</span><span class="p">(</span><span class="n">volumeid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">delete</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">volumeid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">reconcile</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">reconcile</span><span class="p">(</span><span class="n">control_host</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get Snap Operation Type&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started  job : </span><span class="si">{0}</span><span class="s2"> for Snap Operation&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run   job </span><span class="si">{0}</span><span class="s2"> for Snap operation with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;job: </span><span class="si">{0}</span><span class="s2"> for snap operation is completed with errors, Reason: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;successfully completed Snap operation of jobid :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job</span></div>

<div class="viewcode-block" id="SNAPHelper.mount_snap"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.mount_snap">[docs]</a>    <span class="k">def</span> <span class="nf">mount_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Mounts Snap of the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : jobid for mount operation</span>
<span class="sd">            Return:</span>
<span class="sd">                object : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mounting snapshot of jobid : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
        <span class="n">mountpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount_path</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span> <span class="n">mountpath</span><span class="p">,</span> <span class="n">mount</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.unmount_snap"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.unmount_snap">[docs]</a>    <span class="k">def</span> <span class="nf">unmount_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; UnMounts Snap of the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : jobid for unmount operation</span>
<span class="sd">            Return:</span>
<span class="sd">                object : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;UnMounting snapshot of jobid : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">unmount</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.revert_snap"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.revert_snap">[docs]</a>    <span class="k">def</span> <span class="nf">revert_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Revers Snap of the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : jobid for revert operation</span>
<span class="sd">            Return:</span>
<span class="sd">                object : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reverting snapshot of jobid : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleting subclient content before revert operation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">revert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.delete_snap"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.delete_snap">[docs]</a>    <span class="k">def</span> <span class="nf">delete_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes Snap of the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : jobid for delete operation</span>
<span class="sd">            Return:</span>
<span class="sd">                object : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting snapshot of jobid : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.reconcile_snap"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.reconcile_snap">[docs]</a>    <span class="k">def</span> <span class="nf">reconcile_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs Reconcile Operation of the array for the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : jobid for Reconcile operation</span>
<span class="sd">            Return:</span>
<span class="sd">                object : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Jobid for the Reconcile Operation: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">reconcile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snapop_validation"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.snapop_validation">[docs]</a>    <span class="k">def</span> <span class="nf">snapop_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">mount</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">revert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unmount</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Common Method for Snap Operation Validations</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : snap backup jobid</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;validating snap operation&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mount</span> <span class="ow">or</span> <span class="n">revert</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mountpath_val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mount_path</span><span class="p">,</span> <span class="n">jobid</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">TestData&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpath_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;comparing files/folders was successful&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">delete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking if the snapshot of JobId: </span><span class="si">{0}</span><span class="s2"> exists in the DB&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;smvolumeid from DB is: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_volume_id</span><span class="p">,</span> <span class="n">jobid</span><span class="p">)))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_volume_id</span><span class="p">,</span> <span class="n">jobid</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snapshot is successfully deleted&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Snapshot of jobid: </span><span class="si">{0}</span><span class="s2"> is not deleted yet, please check the CVMA logs&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">jobid</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully verified Snapshot cleanup&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mountpath_val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mount_path</span><span class="p">,</span> <span class="n">jobid</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mountpath_val</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;MountPath folder still exists under </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mountpath_val</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MountPath folder does not exists &quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.mount_validation"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.mount_validation">[docs]</a>    <span class="k">def</span> <span class="nf">mount_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Mount Snap validation</span>
<span class="sd">            Args :</span>
<span class="sd">                jobid : snap backup jobid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapop_validation</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">mount</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;mount validation was successful&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.revert_validation"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.revert_validation">[docs]</a>    <span class="k">def</span> <span class="nf">revert_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Revert Snap validation</span>
<span class="sd">            Args :</span>
<span class="sd">                jobid : snap backup jobid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mount_snap</span><span class="p">(</span><span class="n">jobid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapop_validation</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">revert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unmount_snap</span><span class="p">(</span><span class="n">jobid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;revert validation was successful&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.delete_validation"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.delete_validation">[docs]</a>    <span class="k">def</span> <span class="nf">delete_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Delete Snap validation</span>
<span class="sd">            Args :</span>
<span class="sd">                jobid : snap backup jobid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapop_validation</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;delete validation was successful&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.unmount_validation"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.unmount_validation">[docs]</a>    <span class="k">def</span> <span class="nf">unmount_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; UnMount Snap validation</span>
<span class="sd">            Args :</span>
<span class="sd">                jobid : snap backup jobid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapop_validation</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">unmount</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;unmount validation was successful&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.check_mountstatus"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.check_mountstatus">[docs]</a>    <span class="k">def</span> <span class="nf">check_mountstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">unmount</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Common function to check mount status</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : snap backup jobid</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">unmount</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;79&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mount_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mount_status</span><span class="p">,</span> <span class="n">jobid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;mount status of jobid :</span><span class="si">{0}</span><span class="s2"> is :</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount_status</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;snapshot is not unmounted yet, checking after 1min&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;snapshot of jobid </span><span class="si">{0}</span><span class="s2"> is unmounted successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount_status</span></div>

<div class="viewcode-block" id="SNAPHelper.unmount_status"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.unmount_status">[docs]</a>    <span class="k">def</span> <span class="nf">unmount_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check Unmount status</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : snap backup jobid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_mountstatus</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">unmount</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.backup_copy"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.backup_copy">[docs]</a>    <span class="k">def</span> <span class="nf">backup_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs Offline backup copy for the given storage policy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">run_backup_copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backup copy workflow job id is : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run  Workflow job </span><span class="si">{0}</span><span class="s2"> for backup copy with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished backup copy workflow Job :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;job: </span><span class="si">{0}</span><span class="s2"> for Backup copy operation is completed with errors, Reason: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snapshot_cataloging"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.snapshot_cataloging">[docs]</a>    <span class="k">def</span> <span class="nf">snapshot_cataloging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs Offline snapshot cataloging for the given storage policy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">run_snapshot_cataloging</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deferred Catalog workflow job id is : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run  Workflow job </span><span class="si">{0}</span><span class="s2"> for Deferred Catalog with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully completed deferred catalog job: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;job: </span><span class="si">{0}</span><span class="s2"> for Snapshot catalog operation is completed with errors&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.aux_copy"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.aux_copy">[docs]</a>    <span class="k">def</span> <span class="nf">aux_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs Auxilliary copy for the given storage policy and copy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">run_aux_copy</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aux_copy_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started Aux copy job with job id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to run aux copy job with error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished Aux copy job: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.run_data_aging"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.run_data_aging">[docs]</a>    <span class="k">def</span> <span class="nf">run_data_aging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs data aging for the given storage policy and copy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">copy_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_snap_copy_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snap copy name is: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>

        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">,</span>
                                           <span class="n">is_granular</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">include_all_clients</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">select_copies</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">prune_selected_copies</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;data aging job id is : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run  data aging job </span><span class="si">{0}</span><span class="s2"> for data aging with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished data aging Job :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.get_jobid_list"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.get_jobid_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_jobid_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches job id list from the snap copy &quot;&quot;&quot;</span>

        <span class="n">sp_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span>

        <span class="n">snapbda</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query_all_rows</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_job_ids</span><span class="p">,</span> <span class="n">sp_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">snapbda</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unable to fetch the smvolumeID from DB&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">volume_id_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">snapbda</span><span class="p">)):</span>
                <span class="n">volume_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snapbda</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">volume_id_list</span></div>

<div class="viewcode-block" id="SNAPHelper.data_aging_validation"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.data_aging_validation">[docs]</a>    <span class="k">def</span> <span class="nf">data_aging_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validates if the jobs are pruned after running the data aging&quot;&quot;&quot;</span>

        <span class="n">job_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jobid_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job IDs before running data aging </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">job_id_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;setting retention to spool on primary snap copy to verify aging&quot;</span><span class="p">)</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="n">StoragePolicyCopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">)</span>
        <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_retention</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">job_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jobid_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job IDs after running data aging </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">job_id_list</span><span class="p">))</span>

        <span class="n">jobtracker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_tracker</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobtracker</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobtracker</span><span class="p">):</span>
                <span class="n">volumeid</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_volumeid_da</span><span class="p">,</span> <span class="n">job</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">volumeid</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">volumeid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Snapshot of jobid: </span><span class="si">{0}</span><span class="s2"> is not yet deleted,&quot;</span>
                        <span class="s2">&quot;please check the CVMA logs&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snapshot for job </span><span class="si">{0}</span><span class="s2"> still exists after DA&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="p">))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snapshot for job </span><span class="si">{0}</span><span class="s2"> deleted successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All the snapshots are deleted&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.execute_query_all_rows"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.execute_query_all_rows">[docs]</a>    <span class="k">def</span> <span class="nf">execute_query_all_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">option1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Executes SQL Queries</span>
<span class="sd">            Return:</span>
<span class="sd">                    list : all column of the sql output</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">option1</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span></div>

<div class="viewcode-block" id="SNAPHelper.clean_snap_environment"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.clean_snap_environment">[docs]</a>    <span class="k">def</span> <span class="nf">clean_snap_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; includes disable Intellisnap at subclient, delete subclient, delete backupset,</span>
<span class="sd">            delete aux and snap copy, delete storage policy, delete library,</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Disable Intellisnap on Subclient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disabling Intellisnap on subclient: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">)</span>
                     <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">disable_intelli_snap</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Disabled Intellisnap on subclient: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">)</span>
                     <span class="p">)</span>

        <span class="c1">#Delete Snap Copy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocum_server</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storage Policy is created with OCUM, Not deleting Primary Snap Copy&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">)</span>

        <span class="c1">#Cleanup Entities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span></div>

<div class="viewcode-block" id="SNAPHelper.clear_locations"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.clear_locations">[docs]</a>    <span class="k">def</span> <span class="nf">clear_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Remove Subclient content</span>
<span class="sd">            Remove Restore location</span>
<span class="sd">            Remove Mountpath</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully removed Subclient Content&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully removed Restore Location&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mount_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully removed MountPath&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_client</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tape_outplace_restore_location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully remove Tape restore location&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.cleanup"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Cleanup function to clear locations and snap entities &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clean_snap_environment</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_locations</span><span class="p">()</span></div>

         <span class="c1">#Delete array entry</span>
<div class="viewcode-block" id="SNAPHelper.delete_array"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.delete_array">[docs]</a>    <span class="k">def</span> <span class="nf">delete_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes the array management entry</span>
<span class="sd">        Args:</span>
<span class="sd">            arrayname       (str)           -- Snap engine at the array management level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; Deleting the array management entry&quot;</span><span class="p">)</span>
            <span class="n">control_host_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_controlhost_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrayname</span><span class="p">)</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">delete_array</span><span class="p">(</span><span class="n">control_host_array</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">SDKException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">exception_id</span> <span class="o">==</span> <span class="s1">&#39;103&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Array delete failed&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_template1"><a class="viewcode-back" href="../../../../Automation.FileSystem.SNAPUtils.html#Automation.FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_template1">[docs]</a>    <span class="k">def</span> <span class="nf">snap_template1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Snap Template1 to Perform Snap backup and Restore opertaions</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_array</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kill_job</span><span class="p">()</span>
        <span class="n">full1_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_backup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_outplace</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_outplace_validation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span> <span class="o">=</span> <span class="s1">&#39;INCREMENTAL&#39;</span>
        <span class="n">inc1_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_backup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_inplace</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_inplace_validation</span><span class="p">(</span><span class="n">inc1_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mount_snap</span><span class="p">(</span><span class="n">inc1_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mount_validation</span><span class="p">(</span><span class="n">inc1_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unmount_snap</span><span class="p">(</span><span class="n">inc1_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unmount_validation</span><span class="p">(</span><span class="n">inc1_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tape_outplace</span><span class="p">(</span><span class="n">inc1_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">full1_job</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">inc1_job</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tape_outplace_validation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span> <span class="o">=</span> <span class="s1">&#39;FULL&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inline_bkp_cpy</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">full2_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_backup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_level</span> <span class="o">=</span> <span class="s1">&#39;INCREMENTAL&#39;</span>
        <span class="n">inc2_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_backup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_outplace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">full2_job</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">full2_job</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mount_snap</span><span class="p">(</span><span class="n">full2_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_outplace_restore_location</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;TestData&quot;</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mount_path</span><span class="p">,</span> <span class="n">full2_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">TestData&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unmount_snap</span><span class="p">(</span><span class="n">full2_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unmount_validation</span><span class="p">(</span><span class="n">full2_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tape_outplace</span><span class="p">(</span><span class="n">inc2_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">inc2_job</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">inc2_job</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tape_outplace_restore_location</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;TestData&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">windows_restore_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data_folder</span><span class="p">,</span> <span class="n">temp1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_support</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;************* REVERT IS NOT SUPPORTED FOR ENGINE: </span><span class="si">{0}</span><span class="s2">,</span>
<span class="s2">                          skipping this operation *********&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">snap_engine_at_subclient</span><span class="p">)</span>
                         <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revert_snap</span><span class="p">(</span><span class="n">full2_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revert_validation</span><span class="p">(</span><span class="n">full2_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconcile_snap</span><span class="p">(</span><span class="n">inc2_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_snap</span><span class="p">(</span><span class="n">inc2_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_validation</span><span class="p">(</span><span class="n">inc2_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_aging_validation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_array</span><span class="p">()</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Commvault Systems Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>