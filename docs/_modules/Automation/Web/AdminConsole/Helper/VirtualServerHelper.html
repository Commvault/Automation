
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Automation.Web.AdminConsole.Helper.VirtualServerHelper &#8212; Commvault Automation 11.14 documentation</title>
    <link rel="stylesheet" href="../../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for Automation.Web.AdminConsole.Helper.VirtualServerHelper</h1><div class="highlight"><pre>
<span></span><span class="c1"># FIXME: https://engweb.commvault.com/engtools/defect/214066</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provides the function or operations that can be used to run VSA</span>
<span class="sd">AdminConsole Automation test cases.</span>

<span class="sd">Class:</span>

<span class="sd">    AdminConsoleVirtualServer() -&gt; loginMain() -&gt; object()</span>

<span class="sd">    VMWareAdminConsole() -&gt; AdminConsoleVirtualServer() -&gt; loginMain() -&gt; object()</span>

<span class="sd">    HyperVAdminConsole() -&gt; AdminConsoleVirtualServer() -&gt; loginMain() -&gt; object()</span>

<span class="sd">    OracleCloudAdminConsole() -&gt; AdminConsoleVirtualServer() -&gt; loginMain() -&gt; object()</span>

<span class="sd">    AliCloudAdminConsole() -&gt; AdminConsoleVirtualServer() -&gt; loginMain() -&gt; object()</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span> <span class="nn">ast</span>

<span class="kn">from</span> <span class="nn">past.builtins</span> <span class="k">import</span> <span class="n">basestring</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="k">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="k">import</span> <span class="n">cvhelper</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="k">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="k">import</span> <span class="n">machine</span>
<span class="kn">from</span> <span class="nn">Web.Common</span> <span class="k">import</span> <span class="n">handlers</span>
<span class="kn">from</span> <span class="nn">VirtualServer.VSAUtils</span> <span class="k">import</span> <span class="n">VirtualServerUtils</span>
<span class="kn">from</span> <span class="nn">VirtualServer.VSAUtils.HypervisorHelper</span> <span class="k">import</span> <span class="n">Hypervisor</span>
<span class="kn">from</span> <span class="nn">VirtualServer.VSAUtils</span> <span class="k">import</span> <span class="n">VirtualServerConstants</span>
<span class="kn">from</span> <span class="nn">.LoadModule</span> <span class="k">import</span> <span class="n">load_module</span>


<div class="viewcode-block" id="AdminConsoleVirtualServer"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer">[docs]</a><span class="k">class</span> <span class="nc">AdminConsoleVirtualServer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adminconsole helper for VSA agent &quot;&quot;&quot;</span>

    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the object based in instance_type</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object)   --  object of the instance class</span>

<span class="sd">            driver      (object)   --  the browser object</span>

<span class="sd">            commcell    (object)   --  an instance of the commcell class</span>

<span class="sd">            csdb        (object)   --  the cs DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hv_type</span> <span class="o">=</span> <span class="n">VirtualServerConstants</span><span class="o">.</span><span class="n">hypervisor_type</span>
        <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">MS_VIRTUAL_SERVER</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">HyperVAdminConsole</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">VIRTUAL_CENTER</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">VMwareAdminConsole</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">Oracle_Cloud_Classic</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">OracleCloudAdminConsole</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">hv_type</span><span class="o">.</span><span class="n">Alibaba_Cloud</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">AlibabaCloudAdminConsole</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The given hypervisor has not been automated yet&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A class that represents the VSA functions that can be performed for AdminConsole</span>
<span class="sd">            Automation</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object)   --  the instance object</span>

<span class="sd">            driver      (object)   --  the browser object</span>

<span class="sd">            commcell    (object)   --  the commcell object</span>

<span class="sd">            csdb        (object)   --  the commcell database object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">driver</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Driver&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">driver</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span> <span class="o">=</span> <span class="n">csdb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_login_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_obj</span> <span class="o">=</span> <span class="n">instance</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span> <span class="o">=</span> <span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subclient</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hypervisor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_vm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_inplace_overwrite</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_power_on_vm_after_restore</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overwrite_vm</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vm_restore_prefix</span> <span class="o">=</span> <span class="s2">&quot;DeleteMe_AC_&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pid</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;Jobs&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">AdminConsolePages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">Jobs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="n">content_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;manage_content&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span> <span class="o">=</span> <span class="n">content_module</span><span class="o">.</span><span class="n">ManageContent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="n">vol_restore_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;guest_files_restore_select_volume&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span> <span class="o">=</span> <span class="n">vol_restore_module</span><span class="o">.</span><span class="n">GuestFilesRestoreSelectVolume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="n">restore_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;guest_files_restore_select_folder&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restore_files_obj</span> <span class="o">=</span> <span class="n">restore_module</span><span class="o">.</span><span class="n">GuestFilesRestoreSelectFolder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="n">vm_files_restore_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;virtual_machine_files_restore&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vm_files_restore_obj</span> <span class="o">=</span> <span class="n">vm_files_restore_module</span><span class="o">.</span><span class="n">VirtualMachineFilesRestore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="n">full_vm_restore_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;full_vm_restore&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span> <span class="o">=</span> <span class="n">full_vm_restore_module</span><span class="o">.</span><span class="n">FullVMRestore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="n">hypervisor_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;hypervisors&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span> <span class="o">=</span> <span class="n">hypervisor_module</span><span class="o">.</span><span class="n">Hypervisors</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="n">vsa_sc_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;vsa_subclient_details&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span> <span class="o">=</span> <span class="n">vsa_sc_module</span><span class="o">.</span><span class="n">VsaSubclientDetails</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>


        <span class="n">hypervisor_details_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;hypervisor_details&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span> <span class="o">=</span> <span class="n">hypervisor_details_module</span><span class="o">.</span><span class="n">HypervisorDetails</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span>
            <span class="s1">&#39;select_restore&#39;</span><span class="p">,</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">AUTOMATION_DIRECTORY</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Web</span><span class="se">\\</span><span class="s1">AdminConsole</span><span class="se">\\</span><span class="s1">VSAPages&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_restore</span><span class="o">.</span><span class="n">SelectRestore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>


        <span class="c1"># backup options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backup_type</span> <span class="o">=</span> <span class="s2">&quot;FULL&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">granular_recovery</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_testdata_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span> <span class="n">commcell</span><span class="p">)</span>

<div class="viewcode-block" id="AdminConsoleVirtualServer.VmValidation"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.VmValidation">[docs]</a>    <span class="k">class</span> <span class="nc">VmValidation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vmobj</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vm</span> <span class="o">=</span> <span class="n">vmobj</span>

        <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;compares the source vm and restored vm&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">NoofCPU</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">NoofCPU</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">Diskcount</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">Diskcount</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">Memory</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">Memory</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">backup_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the backup type</span>

<span class="sd">        Returns:</span>
<span class="sd">            _backup_type    (basestring)   --  the backup level</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backup_type</span>

    <span class="nd">@backup_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">backup_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the backup level of the subclient</span>

<span class="sd">        Args:</span>
<span class="sd">            value    (basestring)   --  the level of backup to be run on the subclient</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backup_type</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">collect_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the metadata collection property</span>

<span class="sd">        Returns:</span>
<span class="sd">            granular_recovery   (bool)   --   true / false for collecting metadata</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">granular_recovery</span>

    <span class="nd">@collect_metadata</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">collect_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the metadata collection property</span>

<span class="sd">        Args:</span>
<span class="sd">            value    (bool)  --  True / False for collecting metadata during backup</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">granular_recovery</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">testdata_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the testdata path</span>

<span class="sd">        Returns:</span>
<span class="sd">            testdata_path  (basestring)   --  the location where testdata needs to be copied</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testdata_path</span>

    <span class="nd">@testdata_path</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">testdata_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the testdata path where files needs to be copied before backup</span>

<span class="sd">        Args:</span>
<span class="sd">            value    (basestring)   --  the location for copying test data</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_testdata_path</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subclient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the subclient name</span>

<span class="sd">        Returns:</span>
<span class="sd">            subclient  (basestring)   --  the name of the subclient to be backed up or restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subclient</span>

    <span class="nd">@subclient</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">subclient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the subclient name</span>

<span class="sd">        Args:</span>
<span class="sd">            value    (basestring)   --  the name of the subclient to be backed up or restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subclient</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the hypervisor name</span>

<span class="sd">        Returns:</span>
<span class="sd">            hypervisor  (basestring)   --  the name of the hypervisor</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hypervisor</span>

    <span class="nd">@hypervisor</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the hypervisor name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  the name of the hypervisor</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hypervisor</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restore_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the restore proxy name</span>

<span class="sd">        Returns:</span>
<span class="sd">            restore_proxy  (basestring)   --  the name of the restore proxy</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">machine_name</span>

    <span class="nd">@restore_proxy</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">restore_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the restore proxy value</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring / obj / tuple)  -- the restore proxy value to be set</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please pass the correct type for the restore proxy value&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">os_info</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">:</span>
            <span class="n">_storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">get_storage_details</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">drive</span> <span class="ow">in</span> <span class="n">_storage</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_storage</span><span class="p">[</span><span class="n">drive</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span> <span class="o">=</span> <span class="n">drive</span> <span class="o">+</span> <span class="s2">&quot;:</span><span class="se">\\</span><span class="s2">&quot;</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span> <span class="o">=</span> <span class="s1">&#39;/tmp&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restore_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the restore client name</span>

<span class="sd">        Returns:</span>
<span class="sd">            restore_client  (basestring)   --  the name of the restore client</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_client</span>

    <span class="nd">@restore_client</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">restore_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the restore client value</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --   the name of the restore client</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_client</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restore_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the restore path location</span>

<span class="sd">        Returns:</span>
<span class="sd">            restore_path  (basestring)   --  the location to restore to</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_path</span>

    <span class="nd">@restore_path</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">restore_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the restore path</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --   the path where files are to be restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_path</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">agentless_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the agentless name</span>

<span class="sd">        Returns:</span>
<span class="sd">            agentless_vm  (basestring)   --  the name of the agentless VM where files needs to be</span>
<span class="sd">                                           restored to</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_vm</span>

    <span class="nd">@agentless_vm</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">agentless_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the agentless VM where the backed up files are to be restored during agentless restore</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  the name of the agentless VM</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the type of the input variable is not a basestring</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_vm</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please pass the correct type for the agentless vm variable&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the instance name</span>

<span class="sd">        Returns:</span>
<span class="sd">            instance  (basestring)   --  the name of the instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span>

    <span class="nd">@instance</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the instance name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   -- the name of the instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">co_ordinator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the coordinator name</span>

<span class="sd">        Returns:</span>
<span class="sd">            co_ordinator  (basestring)   --  the name of the first proxy in the instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span><span class="o">.</span><span class="n">machine_name</span>

    <span class="nd">@co_ordinator</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">co_ordinator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the co-ordinator of the client</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --   the name of the co-ordinator proxy client</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the server name</span>

<span class="sd">        Returns:</span>
<span class="sd">            server  (basestring)   --  the name of the server where commands will be executed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span>

    <span class="nd">@server</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the server name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  sets the name of the server</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the content</span>

<span class="sd">        Returns:</span>
<span class="sd">            VMs  (basestring)   --  the list of VMs to be backed up and restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span>

    <span class="nd">@content</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the content of the subclient</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)   --  like    [VM]=startswith=test*,test1</span>
<span class="sd">                                        [VM] - represent type</span>
<span class="sd">                                                        like [DNS],[HN]</span>
<span class="sd">                                        startswith  represent equality in admin console</span>
<span class="sd">                                                like endswith,equals</span>
<span class="sd">                                        test* - include all VM starts with test</span>
<span class="sd">                                               adding dynamic content in admin console</span>
<span class="sd">                                        , - to include multiple content</span>
<span class="sd">                                        test1 -  non-dynamic content</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_subclient_content</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">power_on_after_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the power on after restore variable</span>

<span class="sd">        Returns:</span>
<span class="sd">            power_on_vm_after_restore  (bool)   --  True / False to power on the VM</span>
<span class="sd">                                                          after restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_on_vm_after_restore</span>

    <span class="nd">@power_on_after_restore</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">power_on_after_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the power on after restore variable</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  -- True / False to power on the VM after restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_power_on_vm_after_restore</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unconditional_overwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the unconditional overwrite variable</span>

<span class="sd">        Returns:</span>
<span class="sd">            overwrite_vm  (bool)   --  True / False to overwrite the VM during restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overwrite_vm</span>

    <span class="nd">@unconditional_overwrite</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">unconditional_overwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the unconditional overwrite variable</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  --  True / False to overwrite the VM during restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overwrite_vm</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vm_restore_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the prefix to be attached to the restore VM name</span>

<span class="sd">        Returns:</span>
<span class="sd">            vm_restore_prefix  (basestring)   --  the prefix to tbe attached to the restore VM name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vm_restore_prefix</span>

    <span class="nd">@vm_restore_prefix</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vm_restore_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the prefix to be attached to the restore VM name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the prefix to be attached to the restore VM name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vm_restore_prefix</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">full_vm_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the full VM in place variable</span>

<span class="sd">        Returns:</span>
<span class="sd">            inplace_overwrite  (bool)   --  True / False to do an inplace restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inplace_overwrite</span>

    <span class="nd">@full_vm_in_place</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">full_vm_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the full VM inplace variable</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  --  True / False to do an inplace restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inplace_overwrite</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        over ride deepcopy method to copy every attribute of an object to other</span>

<span class="sd">        Args:</span>
<span class="sd">            temp_obj    (object)   --  the object to be copied</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if deep copy fails to set the object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">temp_obj</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">temp_obj</span><span class="p">,</span> <span class="n">temp_obj</span><span class="o">.</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">temp_obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Failed to deepcopy Exception: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span>

    <span class="k">def</span> <span class="nf">_create_hypervisor_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create Hypervisor Object</span>

<span class="sd">        Args:</span>
<span class="sd">            client_name  (basestring)   --  the name of the client to create the hypervisor</span>
<span class="sd">                                                object for</span>
<span class="sd">                    default :   None</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if initialization fails in creating object</span>

<span class="sd">        Returns:</span>
<span class="sd">            hvobj   (object)   --  the object of the hypervisor class of the corresponding instance</span>

<span class="sd">            instance_name   (basestring)    --  the instance name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">client_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_obj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
                <span class="n">agent</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Virtual Server&#39;</span><span class="p">)</span>
                <span class="n">instance_keys</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">_instances</span><span class="p">))</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instance_keys</span><span class="p">)</span>

            <span class="n">host_machine</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">co_ordinator</span>
            <span class="n">server_host_name</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">server_host_name</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_compute_credentials</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
            <span class="n">hvobj</span> <span class="o">=</span> <span class="n">Hypervisor</span><span class="p">(</span><span class="n">server_host_name</span><span class="p">,</span> <span class="n">host_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">hvobj</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_name</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An Exception occurred in creating the Hypervisor object  </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span>

    <span class="k">def</span> <span class="nf">_compute_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the credentials required to call the server</span>

<span class="sd">        Args:</span>
<span class="sd">            client_name (basestring)   --   the name of the client whose credentials are</span>
<span class="sd">                                            to be obtained</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if compute credentials fails to get the credentials from the database</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;Select attrval from APP_InstanceProp where attrname IN&quot;</span> \
                     <span class="s2">&quot;(&#39;Virtual Server Password&#39;,&#39;Virtual Server User&#39;) and componentNameId = (&quot;</span> \
                     <span class="s2">&quot;select TOP 1 instance  from APP_Application where clientId= (&quot;</span> \
                     <span class="s2">&quot;Select TOP 1 id from App_Client where name = &#39;</span><span class="si">{0}</span><span class="s2">&#39;) and appTypeId = 106)&quot;</span><span class="o">.</span> \
                <span class="nb">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_results</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;An exception occurred getting server details&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span> <span class="o">=</span> <span class="n">_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">_password</span> <span class="o">=</span> <span class="n">_results</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">cvhelper</span><span class="o">.</span><span class="n">format_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">_password</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An Exception occurred in getting credentials&quot;</span>
                <span class="s2">&quot; for Compute Credentials  </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span>

    <span class="k">def</span> <span class="nf">_get_disk_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disk_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the names of the disks to be restored</span>

<span class="sd">        Args:</span>
<span class="sd">            disk_list    (list)  --  the list containing all the disks to be restored</span>

<span class="sd">        Returns:</span>
<span class="sd">            final_disk_list     (list)  --  the list of disk names to be restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">final_disk_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">disk_list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The disk list is empty. Please check the logs.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">disk_list</span><span class="p">:</span>
                <span class="n">final_disk_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">final_disk_list</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exp</span>

<div class="viewcode-block" id="AdminConsoleVirtualServer.get_all_vms"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.get_all_vms">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_vms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of all VMs from the subclient content</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if it fails to get the list of all VMs in the subclient from adminconsole</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>

            <span class="n">proxy_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">proxy_info</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">proxy_list</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_obj</span><span class="o">.</span><span class="n">associated_clients</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The proxy list does not match.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">co_ordinator</span> <span class="o">=</span> <span class="n">proxy_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">manage_content</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">preview</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception while getting all the VMs &quot;</span>
                               <span class="s2">&quot;in the subclient content: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.set_subclient_content"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.set_subclient_content">[docs]</a>    <span class="k">def</span> <span class="nf">set_subclient_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the content for the given subclient</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if it fails to set the subclient content via admin console</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting the subclient content&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">manage_content</span><span class="p">()</span>

            <span class="n">content</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;vm&quot;</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">add_vm</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s2">&quot;vm&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;rule&quot;</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">rules_list</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules_list</span><span class="p">:</span>
                    <span class="n">rule_type</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">content_obj</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">rule_type</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception while setting subclient content: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.vsa_discovery"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.vsa_discovery">[docs]</a>    <span class="k">def</span> <span class="nf">vsa_discovery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        VSA discovery to copy all test data</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the discovery fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating Hypervisor and VM objects&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">get_all_vms</span><span class="p">()</span>
            <span class="c1"># self.server = [&quot;adminconsolecb&quot;]</span>
            <span class="c1"># self.co_ordinator = self.server[0]</span>
            <span class="c1"># self._vms = [&quot;SdkBkp1&quot;]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">each_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">,</span> <span class="n">each_vm</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">each_vm</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span> <span class="o">=</span> <span class="n">VirtualServerUtils</span><span class="o">.</span><span class="n">get_testdata_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">machine</span><span class="p">)</span>

            <span class="n">generate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">generate</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">generate</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">_drive</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying Testdata to Drive </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">_drive</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">copy_test_data_to_each_volume</span><span class="p">(</span>
                        <span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception while copying test data: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.backup"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.backup">[docs]</a>    <span class="k">def</span> <span class="nf">backup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run backup for the given subclient from admin console</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">               If backup job does not complete successfully</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vsa_discovery</span><span class="p">()</span>

            <span class="n">backup_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">backup_now</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">)</span>
            <span class="c1"># _backup_job = &quot;113578&quot;</span>
            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">backup_job</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Completed&quot;</span><span class="p">,</span> <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Backup job failed. Please check the logs&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span> <span class="o">==</span> <span class="s2">&quot;SYNTH&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verify_synth_full_backup</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception while submitting backup: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.get_job_status"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.get_job_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the status of the given job ID</span>

<span class="sd">        Args:</span>
<span class="sd">            job_id   (basestring)   --  the job id whose status should be collected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting the status for the job </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_obj</span><span class="o">.</span><span class="n">job_completion</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred in getting the job status: </span><span class="si">{0}</span><span class="s2">&quot;</span>
                               <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.verify_synth_full_backup"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.verify_synth_full_backup">[docs]</a>    <span class="k">def</span> <span class="nf">verify_synth_full_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify whether synth full job is triggered after incremental backup</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if it fails to obtain the synth full job ID</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting the synth full job ID&quot;</span><span class="p">)</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;Select jobId from JMBkpJobInfo where bkpLevel=64 and applicationId=(&quot;</span> \
                     <span class="s2">&quot;select id from App_Application where subclientName=&#39;</span><span class="si">{0}</span><span class="s2">&#39; and clientId=(&quot;</span> \
                     <span class="s2">&quot;select id from App_Client where displayName=&#39;</span><span class="si">{1}</span><span class="s2">&#39;))&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span>
                                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">job_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;Completed w/ one or more errors&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during synth full job.&quot;</span>
                                <span class="s2">&quot;Please check the logs for more details.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred while getting the synth full job ID:&quot;</span>
                               <span class="s2">&quot; </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.fs_testdata_validation"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.fs_testdata_validation">[docs]</a>    <span class="k">def</span> <span class="nf">fs_testdata_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest_client</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the testdata restored</span>

<span class="sd">        Args:</span>
<span class="sd">            dest_client      (object)   --  the machine class object of the client where</span>
<span class="sd">                                            the testdata was restored to</span>

<span class="sd">            dest_path        (basestring)   --  the path in the destination client where the</span>
<span class="sd">                                                testdata was restored to</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if test data validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validating the testdata&quot;</span><span class="p">)</span>

            <span class="n">difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">compare_folders</span><span class="p">(</span><span class="n">dest_client</span><span class="p">,</span>
                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">,</span>
                                                                 <span class="n">dest_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">difference</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Checksum mismatch failed for source and destination. </span><span class="si">{0}</span><span class="s2">&quot;</span>
                                   <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">difference</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Folder comparison failed for source </span><span class="si">{0}</span><span class="s2"> and destination </span><span class="si">{1}</span><span class="s2">&quot;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validation completed successfully&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during testdata validation. </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.file_level_restore"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.file_level_restore">[docs]</a>    <span class="k">def</span> <span class="nf">file_level_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        File level restore to guest agent in the commcell</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the file level restore fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Performing file level restore to guest agent&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_drive</span><span class="p">,</span> <span class="n">_folder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span><span class="p">,</span> <span class="s2">&quot;AdminConsole&quot;</span><span class="p">,</span> <span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>
                    <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                        <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">GuestOS</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;windows&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                            <span class="n">_folder</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                        <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">)</span>
                        <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">restore_path</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">restore_path</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_guest_files</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span><span class="o">.</span><span class="n">select_volume</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>
                        <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_files_obj</span><span class="o">.</span><span class="n">submit_guest_agent_restore</span><span class="p">(</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">],</span> <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">pprint_handler_errors</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

                    <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                                     <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="p">,</span> <span class="n">validate_path</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during file level restore. </span><span class="si">{0}</span><span class="s2">&quot;</span>
                               <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.guest_files_restore"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.guest_files_restore">[docs]</a>    <span class="k">def</span> <span class="nf">guest_files_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        File level restore to source VM</span>

<span class="sd">        Args:</span>
<span class="sd">            in_place    (bool):     if the files should be restored to the source path</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the file level restore fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span> <span class="o">=</span> <span class="n">_vm</span>

                <span class="k">for</span> <span class="n">_drive</span><span class="p">,</span> <span class="n">_folder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                        <span class="n">restore_path</span> <span class="o">=</span> <span class="n">_folder</span>
                        <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">_folder</span><span class="p">,</span> <span class="s2">&quot;AdminConsole&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>
                        <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">GuestOS</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;windows&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">_folder</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                        <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">)</span>
                        <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">restore_path</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">restore_path</span> <span class="o">!=</span> <span class="n">_folder</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">restore_path</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_guest_files</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span><span class="o">.</span><span class="n">select_volume</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>

                        <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_files_obj</span><span class="o">.</span><span class="n">submit_this_vm_restore</span><span class="p">(</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                            <span class="n">restore_path</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">pprint_handler_errors</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

                    <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;Completed w/ one or more errors&#39;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Agentless restore job failed. Please check &quot;</span>
                                        <span class="s2">&quot;the logs&quot;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">validate_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during agentless restore. </span><span class="si">{0}</span><span class="s2">&quot;</span>
                               <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.agentless_restore"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.agentless_restore">[docs]</a>    <span class="k">def</span> <span class="nf">agentless_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        File level restore to VM in server which does not have Content Store installed</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the restore to a VM without content store fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_vm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;A different VM for agentless restore has not been specified&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span>
                <span class="n">destination_drive</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">destination_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">drive_list</span><span class="p">[</span><span class="n">destination_drive</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">_drive</span><span class="p">,</span> <span class="n">_folder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                        <span class="n">destination_folder</span><span class="p">,</span> <span class="s2">&quot;AdminConsole&quot;</span><span class="p">,</span> <span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>

                    <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                        <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">GuestOS</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;windows&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                            <span class="n">_folder</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                        <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">)</span>
                        <span class="n">validate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span>
                            <span class="n">restore_path</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">restore_path</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_guest_files</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_vol_obj</span><span class="o">.</span><span class="n">select_volume</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">)</span>

                        <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_files_obj</span><span class="o">.</span><span class="n">submit_other_vm_restore</span><span class="p">(</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                            <span class="n">restore_path</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">pprint_handler_errors</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

                    <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;Completed w/ one or more errors&#39;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Agentless restore job failed. Please check &quot;</span>
                                        <span class="s2">&quot;the logs&quot;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_destination_vm_object</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">validate_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during agentless restore. </span><span class="si">{0}</span><span class="s2">&quot;</span>
                               <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.disk_validation"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.disk_validation">[docs]</a>    <span class="k">def</span> <span class="nf">disk_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_obj</span><span class="p">,</span> <span class="n">disk_restore_destination</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs Disk Validation by mounting the restored disk on the Host</span>

<span class="sd">        Args:</span>

<span class="sd">            vm_obj                      (object)       --  instance of the VM class</span>

<span class="sd">            disk_restore_destination    (basestring)   --   restore path of all the disk</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing disk validation&quot;</span><span class="p">)</span>
            <span class="n">_drive_letter</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="c1"># dest_client_hypervisor = self._create_hypervisor_object(</span>
            <span class="c1">#     destination_client_name)[0]</span>

            <span class="n">_list_of_disks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">get_disk_in_the_path</span><span class="p">(</span>
                <span class="n">disk_restore_destination</span><span class="p">)</span>

            <span class="n">_vm_disk_list</span> <span class="o">=</span> <span class="n">vm_obj</span><span class="o">.</span><span class="n">disk_list</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_vm_disk_list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot validate the Disk as we cannot find the disk attached to the VM&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">_list_of_disks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_list_of_disks</span> <span class="o">==</span> <span class="p">[])):</span>
                <span class="n">_final_mount_disk_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">each_disk</span> <span class="ow">in</span> <span class="n">_vm_disk_list</span><span class="p">:</span>
                    <span class="n">each_disk_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">each_disk</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">disk_path</span> <span class="ow">in</span> <span class="n">_list_of_disks</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">each_disk_name</span> <span class="ow">in</span> <span class="n">disk_path</span><span class="p">:</span>
                            <span class="n">_final_mount_disk_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;The Disk cannot be validated as we cannot find disk with Hypervisor&quot;</span>
                    <span class="s2">&quot; extension, could be converted disk&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">_final_mount_disk_list</span><span class="p">:</span>
                <span class="n">_final_mount_disk_list</span> <span class="o">=</span> <span class="n">_list_of_disks</span>

            <span class="k">for</span> <span class="n">_file</span> <span class="ow">in</span> <span class="n">_final_mount_disk_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validation Started For Disk :[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">_file</span><span class="p">)</span>
                <span class="n">_file</span> <span class="o">=</span> <span class="n">disk_restore_destination</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">_file</span>
                <span class="n">_drive_letter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">mount_disk</span><span class="p">(</span><span class="n">vm_obj</span><span class="p">,</span> <span class="n">_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_drive_letter</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">each_drive</span> <span class="ow">in</span> <span class="n">_drive_letter</span><span class="p">:</span>
                        <span class="n">dest_folder_path</span> <span class="o">=</span> <span class="n">VirtualServerConstants</span><span class="o">.</span><span class="n">get_folder_to_be_compared</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">,</span> <span class="n">each_drive</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Folder comparison started...&quot;</span><span class="p">)</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">dest_folder_path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR - Error mounting VMDK &quot;</span> <span class="o">+</span> <span class="n">_file</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception at Mounting Disk &quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">un_mount_disk</span><span class="p">(</span><span class="n">vm_obj</span><span class="p">,</span> <span class="n">_file</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_drive_letter</span> <span class="ow">and</span> <span class="n">_drive_letter</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">un_mount_disk</span><span class="p">(</span><span class="n">vm_obj</span><span class="p">,</span> <span class="n">_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during disk validation. Please check the logs.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.disk_level_restore"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.disk_level_restore">[docs]</a>    <span class="k">def</span> <span class="nf">disk_level_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disk level restore to another VM in the server</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the disk level restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Performing disk level restore&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_disk_restore</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">pprint_handler_errors</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Attach disk restore. </span><span class="si">{0}</span><span class="s2">&quot;</span>
                               <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.virtual_machine_files_restore"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.virtual_machine_files_restore">[docs]</a>    <span class="k">def</span> <span class="nf">virtual_machine_files_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disks restores to a client in the commcell</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if the virtual machine files restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Performing virtual machine files restore&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span><span class="p">,</span> <span class="s2">&quot;AdminConsole&quot;</span><span class="p">,</span> <span class="n">_vm</span><span class="p">)</span>

                <span class="c1"># Clearing the restore path</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">restore_path</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">restore_path</span><span class="p">)</span>

                <span class="n">disks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_disk_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">disk_list</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_vm_files</span><span class="p">()</span>

                    <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_files_restore_obj</span><span class="o">.</span><span class="n">vm_files_restore</span><span class="p">(</span>
                        <span class="n">_vm</span><span class="p">,</span>
                        <span class="n">disks</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                        <span class="n">restore_path</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">pprint_handler_errors</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

                <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                                 <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">disk_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">],</span> <span class="n">restore_path</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Virtual Machine Files restore.&quot;</span>
                               <span class="s2">&quot; </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.full_vm_restore"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.full_vm_restore">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs Full VM restore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing full VM restore&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.vm_restore_validation"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.vm_restore_validation">[docs]</a>    <span class="k">def</span> <span class="nf">vm_restore_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the full VM restore job</span>

<span class="sd">        Args:</span>
<span class="sd">            vm_name          (basestring)   --  the name of the source VM that was backed up</span>

<span class="sd">            restore_vm       (basestring)   --  the name of the restored VM</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if full VM / instance restore validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validating full VM restore&quot;</span><span class="p">)</span>

            <span class="n">on_premise</span> <span class="o">=</span> <span class="n">VirtualServerConstants</span><span class="o">.</span><span class="n">on_premise_hypervisor</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;It is Inplace restore&quot;</span><span class="p">)</span>
                <span class="n">source_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__deepcopy__</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">restore_vm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">restore_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span>

            <span class="n">_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VmValidation</span><span class="p">(</span><span class="n">source_obj</span><span class="p">)</span>
            <span class="n">_dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VmValidation</span><span class="p">(</span><span class="n">restore_obj</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_source</span> <span class="o">==</span> <span class="n">_dest</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Config validation is successful&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error while validating configuration&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span><span class="o">.</span><span class="n">GuestOS</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">)</span> <span class="ow">and</span> <span class="n">on_premise</span><span class="p">):</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">instance_type</span> <span class="o">==</span> <span class="s2">&quot;hyper-v&quot;</span><span class="p">:</span>
                        <span class="n">dest_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">,</span>
                                                     <span class="s2">&quot;Virtual Hard Disks&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">disk_validation</span><span class="p">(</span><span class="n">restore_obj</span><span class="p">,</span> <span class="n">dest_location</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping disk validation for powered off restore VM.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span> <span class="ow">and</span> <span class="n">on_premise</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">GUID</span> <span class="o">==</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">GUID</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;The GUID id of the in place restored VM does not match the source VM&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">VirtualServerConstants</span><span class="o">.</span><span class="n">Ip_regex</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">restore_obj</span><span class="o">.</span><span class="n">IP</span><span class="p">))</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="p">(</span><span class="n">restore_obj</span><span class="o">.</span><span class="n">IP</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">each_drive</span> <span class="ow">in</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">drive_list</span><span class="p">:</span>
                    <span class="n">dest_location</span> <span class="o">=</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                        <span class="n">source_obj</span><span class="o">.</span><span class="n">drive_list</span><span class="p">[</span><span class="n">each_drive</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span><span class="p">,</span> <span class="s2">&quot;TestData&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span>
                        <span class="n">restore_obj</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">dest_location</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;This is Linux VM and the destination Ip is not proper ,&quot;</span>
                    <span class="s2">&quot;so no Data Validation cannot be performed&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during full VM restore validation. </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
            <span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AdminConsoleVirtualServer.cleanup_testdata"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AdminConsoleVirtualServer.cleanup_testdata">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup_testdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleans up testdata that is copied from each vm in the subclient</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if clean up of testdata from the backup VMs fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Testdata cleanup from subclient started&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_type</span>
            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;VM selected is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">_vm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_drive</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">_testdata_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_drive</span><span class="p">,</span>
                                                  <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_folder_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">_testdata_path</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">_testdata_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning testdata in the controller&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception while doing cleaning up test data directory  :&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>


<div class="viewcode-block" id="VMwareAdminConsole"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">VMwareAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    VMware class to perform VMware related adminconsole tasks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize any VMware related variables</span>

<span class="sd">        Args:</span>
<span class="sd">            instance        (object)    --  the instance class object</span>

<span class="sd">            driver          (object)    --  the browser driver object</span>

<span class="sd">            commcell        (object)    --  the commcell object</span>

<span class="sd">            csdb            (object)    --  the commserve DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">VMwareAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest_client_vm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disk_provisioning</span> <span class="o">=</span> <span class="s2">&quot;Thin&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport_mode</span> <span class="o">=</span> <span class="s2">&quot;Auto&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_datastore</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">live_recovery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the live recovery enable/disable option</span>

<span class="sd">        Returns:</span>
<span class="sd">            _live_recovery     (bool)  --  True / False to enable or disable live recovery</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery</span>

    <span class="nd">@live_recovery</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">live_recovery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the live recovery option during restore</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  --  True / False to enable or disable live recovery during restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">live_recovery_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the dict containing the live recovery options</span>

<span class="sd">        Returns:</span>
<span class="sd">            _live_recovery_options     (dict)  --  dict containing the live recovery options</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">redirect_datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the redirect datatore option</span>

<span class="sd">        Returns:</span>
<span class="sd">            _live_recovery_options[&#39;redirect_datastore&#39;]   (str)   --  the name of the</span>
<span class="sd">                                                                        datastore where writes</span>
<span class="sd">                                                                        will be redirected</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span><span class="p">[</span><span class="s1">&#39;redirect_datastore&#39;</span><span class="p">]</span>

    <span class="nd">@redirect_datastore</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">redirect_datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the redirect datastore option for live recovery</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the name of the datastore to redirect writes during live</span>
<span class="sd">                                            recovery restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span><span class="p">[</span><span class="s1">&#39;redirect_datastore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">delay_migration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the delay migration value</span>

<span class="sd">        Returns:</span>
<span class="sd">            _live_recovery_options[&#39;delay_migration&#39;]  (int)   --  the amount of time in hrs</span>
<span class="sd">                                                                    the migration has to be</span>
<span class="sd">                                                                    delayed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span><span class="p">[</span><span class="s1">&#39;delay_migration&#39;</span><span class="p">]</span>

    <span class="nd">@delay_migration</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">delay_migration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the delay migration hours</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring / int)    --    the no of hours the migration has to be delayed</span>
<span class="sd">                                                during live recovery</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_recovery_options</span><span class="p">[</span><span class="s1">&#39;delay_migration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transport_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the transport mode to be used for restore</span>

<span class="sd">        Returns:</span>
<span class="sd">            _transport_mode    (basestring)   --  the transport mode to be used for restore</span>
<span class="sd">                    default:    Auto</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport_mode</span>

    <span class="nd">@transport_mode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">transport_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the transport mode to be used for restore</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the transport mode to be used</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport_mode</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">disk_provisioning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the disk provisioning option to be used during restore</span>

<span class="sd">        Returns:</span>
<span class="sd">            _disk_provisioning     (basestring)   --  the type of disk provisioning to be used</span>
<span class="sd">                                                      during restore</span>
<span class="sd">                        default :   Thin</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disk_provisioning</span>

    <span class="nd">@disk_provisioning</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">disk_provisioning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the disk provisioning option</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the disk provisioning to be used for the disks in the</span>
<span class="sd">                                        restore VM</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disk_provisioning</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">different_vcenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the option to restore to a different vcenter or not</span>

<span class="sd">        Returns:</span>
<span class="sd">            full_vm_restore_options[&#39;different_vCenter&#39;]   (bool)  --  restore to a different</span>
<span class="sd">                                                                        new vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter</span>

    <span class="nd">@different_vcenter</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">different_vcenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the different vcenter flag</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  if a different vcenter has to be used during restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">different_vcenter_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the information about the new vcenter client to create during restore</span>

<span class="sd">        Returns:</span>
<span class="sd">            _different_vcenter_info (dict)   --  different vcenter username and password</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">different_vcenter_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the name of the new vcenter to restore to</span>

<span class="sd">        Returns:</span>
<span class="sd">            _different_vcenter_info[&#39;vcenter_hostname&#39;]   (basestring)  --  name of the new vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_hostname&#39;</span><span class="p">]</span>

    <span class="nd">@different_vcenter_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">different_vcenter_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the name of the different vcenter</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the name of the different vcenter to be used during restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_hostname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">different_vcenter_username</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the username of the new vcenter to restore to</span>

<span class="sd">        Returns:</span>
<span class="sd">            _different_vcenter_info[&#39;vcenter_username&#39;] (basestring)  --  username of the</span>
<span class="sd">                                                                            new vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_username&#39;</span><span class="p">]</span>

    <span class="nd">@different_vcenter_username</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">different_vcenter_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the different vcenter user name</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the username for the different vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">different_vcenter_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the password of the new vcenter to restore to</span>

<span class="sd">        Returns:</span>
<span class="sd">            _different_vcenter_info[&#39;vcenter_password&#39;]   (basestring)  --  password of the</span>
<span class="sd">                                                                            new vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_password&#39;</span><span class="p">]</span>

    <span class="nd">@different_vcenter_password</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">different_vcenter_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the password for the different vcenter</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the password of the different vcenter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_different_vcenter_info</span><span class="p">[</span><span class="s1">&#39;vcenter_password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_get_nfs_datastore_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the NFS datastore name in the given ESX</span>

<span class="sd">        Args:</span>
<span class="sd">            restore_vm   (basestring)   --  the name of the restored VM</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if it fails to get the name of the NFS datastore that are mounted</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting the name of the 3DFS datastore where VM is mounted&quot;</span><span class="p">)</span>
            <span class="n">datastore_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">Datastore</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">datastore</span> <span class="ow">in</span> <span class="n">datastore_list</span><span class="p">:</span>
                <span class="n">datastore</span> <span class="o">=</span> <span class="n">datastore</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="s1">&#39;3DFS_GX_BACKUP_0&#39;</span> <span class="ow">in</span> <span class="n">datastore</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_datastore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datastore</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The 3DFS datastore is </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_datastore</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exp</span>

<div class="viewcode-block" id="VMwareAdminConsole.live_recovery_validation"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.live_recovery_validation">[docs]</a>    <span class="k">def</span> <span class="nf">live_recovery_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the live VM recovery job</span>

<span class="sd">        Args:</span>
<span class="sd">            restore_vm  (str)   :   the name of the restored VM</span>

<span class="sd">            vm_name     (str)   :   the name of the backed up VM</span>

<span class="sd">        Raises:</span>
<span class="sd">             Exception:</span>
<span class="sd">                if validation failed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting live VM recovery validation&quot;</span><span class="p">)</span>
            <span class="n">ds_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">live_browse_ds_exists</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_datastore</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ds_exists</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The datastore is not unmounted yet. Cleanup failed&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">Datastore</span> <span class="o">!=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span><span class="o">.</span><span class="n">Datastore</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Something went wrong during migration. The destination&quot;</span>
                                <span class="s2">&quot; datastore is wrong.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Live VM recovery validation completed successfully&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Live VM recovery validation failed. </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div>

    <span class="k">def</span> <span class="nf">_set_vm_restore_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the VM restore options for each VM to be restored</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if there is any exception in setting the restore options</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dest_client_vm</span> <span class="o">=</span> <span class="n">_vm</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The restore destination client and/or agentless VM is None.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentless_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dest_client_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentless_vm</span>

            <span class="n">datastore_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dest_client_vm</span>
                                                                <span class="p">]</span><span class="o">.</span><span class="n">Datastore</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">ds_selected</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datastore_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;network&#39;</span><span class="p">][</span><span class="s1">&#39;destination&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dest_client_vm</span><span class="p">]</span><span class="o">.</span><span class="n">NetworkName</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dest_client_vm</span><span class="p">]</span><span class="o">.</span><span class="n">ESXHost</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;datastore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_selected</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;respool&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dest_client_vm</span><span class="p">]</span><span class="o">.</span><span class="n">ResourcePool</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;prefix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span>

<div class="viewcode-block" id="VMwareAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.VMwareAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs full VM restore for a VMware subclient</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if full VM restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Performing full VM restore&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">has_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">different_vcenter</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">different_vcenter_username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">user_name</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">different_vcenter_password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">password</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_vm_restore_options</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">full_vm_restore</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">,</span>
                        <span class="n">proxy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                        <span class="n">destination_server</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                        <span class="n">vm_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">,</span>
                        <span class="n">disk_prov</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">disk_provisioning</span><span class="p">,</span>
                        <span class="n">transport_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport_mode</span><span class="p">,</span>
                        <span class="n">power_on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                        <span class="n">over_write</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">,</span>
                        <span class="n">live_recovery</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">live_recovery</span><span class="p">,</span>
                        <span class="n">live_recovery_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_options</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">full_vm_restore</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">,</span>
                        <span class="n">proxy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                        <span class="n">destination_server</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                        <span class="n">vm_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">,</span>
                        <span class="n">different_vcenter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">different_vcenter</span><span class="p">,</span>
                        <span class="n">different_vcenter_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">different_vcenter_info</span><span class="p">,</span>
                        <span class="n">disk_prov</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">disk_provisioning</span><span class="p">,</span>
                        <span class="n">transport_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport_mode</span><span class="p">,</span>
                        <span class="n">power_on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                        <span class="n">over_write</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">,</span>
                        <span class="n">live_recovery</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">live_recovery</span><span class="p">,</span>
                        <span class="n">live_recovery_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_options</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">pprint_handler_errors</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
                <span class="c1"># Copy testdata when the VM is migrating</span>
                <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                        <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">_vm</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span> <span class="o">=</span> <span class="n">restore_vm</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">_drive</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">drive_list</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying TDFS data to Drive </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">_drive</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">copy_test_data_to_each_volume</span><span class="p">(</span>
                            <span class="n">restore_vm</span><span class="p">,</span> <span class="n">_drive</span><span class="p">,</span> <span class="s2">&quot;TDFSDataToTestWrite&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testdata_path</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Done copying TDFS data&quot;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_nfs_datastore_name</span><span class="p">(</span><span class="n">restore_vm</span><span class="p">)</span>

            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                             <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

            <span class="c1"># Sleep is added to give time for the restored VM to boot up. SP14 MR 214066</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">_vm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery</span><span class="p">:</span>
                    <span class="n">source_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">each_drive</span> <span class="ow">in</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">drive_list</span><span class="p">:</span>
                        <span class="n">dest_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_machine</span><span class="o">.</span><span class="n">join_path</span><span class="p">(</span>
                            <span class="n">source_obj</span><span class="o">.</span><span class="n">drive_list</span><span class="p">[</span><span class="n">each_drive</span><span class="p">],</span>
                            <span class="s2">&quot;TDFSDataToTestWrite&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;TestData&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fs_testdata_validation</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">restore_vm</span><span class="p">]</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="n">dest_location</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">live_recovery_validation</span><span class="p">(</span><span class="n">restore_vm</span><span class="p">,</span> <span class="n">_vm</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during full VM restore. </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
            <span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>


<div class="viewcode-block" id="HyperVAdminConsole"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.HyperVAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">HyperVAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hyper-V class to perform Hyper-V related adminconsole tasks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize any Hyper-V related variables</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object)   --  object of the instance class</span>

<span class="sd">            driver      (object)   --  the browser object</span>

<span class="sd">            commcell    (object)   --  an instance of the commcell class</span>

<span class="sd">            csdb        (object)   --  the cs DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HyperVAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_register_to_failover</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_location</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">register_to_failover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the register to failover option</span>

<span class="sd">        Returns:</span>
<span class="sd">            register_to_failover   (bool)  --  True / False to register to failover cluster</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_to_failover</span>

    <span class="nd">@register_to_failover</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">register_to_failover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the register to failover option</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (bool)  --  True / False to register the VM to failover after restore</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_register_to_failover</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restore_location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the restore location, hyper-v default folder or new folder or original location</span>

<span class="sd">        Returns:</span>
<span class="sd">            restore_location   (basestring)   --  the location to restore the VM to</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_location</span>

    <span class="nd">@restore_location</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">restore_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the location to restore the VM to</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the location where the VM should be restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_location</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="HyperVAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.HyperVAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform full VM restore for hyper-V</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if full VM restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_location</span> <span class="o">=</span> <span class="s2">&quot;Original folder&quot;</span>
                    <span class="n">restore_path</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_location</span> <span class="o">=</span> <span class="s2">&quot;Hyper-V default folder&quot;</span>
                    <span class="n">restore_path</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_location</span> <span class="o">==</span> <span class="s2">&quot;Select a folder&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The restore path was not provided&quot;</span><span class="p">)</span>
                    <span class="n">restore_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_path</span>

                <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">hv_full_vm_restore</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_location</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">,</span>
                    <span class="n">restore_path</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">register_to_failover</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">pprint_handler_errors</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                             <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

            <span class="c1"># Sleep is added to give time for the restored VM to boot up. SP14 MR 214066</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">_vm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Hyper-v Full VM restore. </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
            <span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>


<div class="viewcode-block" id="OracleCloudAdminConsole"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">OracleCloudAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This module is for performing Oracle Cloud related actions from AdminConsole</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the Oracle Cloud related inputs</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object)   --  object of the instance class</span>

<span class="sd">            driver      (object)   --  the browser object</span>

<span class="sd">            commcell    (object)   --  an instance of the commcell class</span>

<span class="sd">            csdb        (object)   --  the cs DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">OracleCloudAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_account</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_security_groups</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh_keys</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_shape</span> <span class="o">=</span> <span class="s2">&quot;Auto&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instance_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the instance shape option</span>

<span class="sd">        Returns:</span>
<span class="sd">            _instance_shape     (basestring)    --  the shape to be used for the restore instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance_shape</span>

    <span class="nd">@instance_shape</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">instance_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the instance shape option</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the instance shape to be used for the restore VMs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The instance shape should be a string&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_shape</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user_account</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the user account name</span>

<span class="sd">        Returns:</span>
<span class="sd">            _user_account   (basestring)    --  the name of the user account to restore to</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_account</span>

    <span class="nd">@user_account</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">user_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the user account</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (basestring)    --  the user account where the instances are to be restored</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The user account name should be a string&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_account</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">security_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the security groups</span>

<span class="sd">        Returns:</span>
<span class="sd">            _security_groups    (list)  --  list of all security groups to be associated with</span>
<span class="sd">                                            the restored instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_security_groups</span>

    <span class="nd">@security_groups</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">security_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the security groups</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (list)  --  list of all security groups to be associated with the</span>
<span class="sd">                                restored instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_security_groups</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_security_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The security group should either be a list or string.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ssh_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the ssh keys</span>

<span class="sd">        Returns:</span>
<span class="sd">            _ssh_keys   (list)  --  list of all ssh keys to be associated with instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssh_keys</span>

    <span class="nd">@ssh_keys</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ssh_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the ssh keys</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (list)  --  list of all ssh keys to be associated with the restored instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh_keys</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The ssh keys should either be a list or string.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">networks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the networks list</span>

<span class="sd">        Returns:</span>
<span class="sd">            _networks   (list)  --  list of all networks to be attached to instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span>

    <span class="nd">@networks</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">networks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the networks list</span>

<span class="sd">        Args:</span>
<span class="sd">            value   (list)  --  list of all networks to be attached to the restored instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The networks should either be a list or string.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_restore_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the restore options for full VM restore</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if there is any error in setting the restore options</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting the restore options&quot;</span><span class="p">)</span>
            <span class="n">dest_vm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_account</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">_get_instance_user_name</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">security_groups</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">security_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">_get_security_list_of_instance</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssh_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ssh_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">_get_ssh_keys_of_instance</span><span class="p">(</span><span class="n">dest_vm</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;An error occurred while setting the restore options. &quot;</span>
                            <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>

<div class="viewcode-block" id="OracleCloudAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.OracleCloudAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Full instance restore of Oracle Cloud instances</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if full instance restore or validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restoring the Oracle Cloud Instance&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_set_restore_options</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>

                <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">opc_full_vm_restore</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">user_account</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">instance_shape</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">security_groups</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ssh_keys</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">pprint_handler_errors</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                             <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

            <span class="c1"># Sleep is added to give time for the restored VM to boot up. SP14 MR 214066</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during Oracle Cloud Full VM restore.&quot;</span>
                               <span class="s2">&quot; </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>


<div class="viewcode-block" id="AlibabaCloudAdminConsole"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AlibabaCloudAdminConsole">[docs]</a><span class="k">class</span> <span class="nc">AlibabaCloudAdminConsole</span><span class="p">(</span><span class="n">AdminConsoleVirtualServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for Ali Cloud related operations to be done in admin console</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the Oracle Cloud related inputs</span>

<span class="sd">        Args:</span>
<span class="sd">            instance    (object)   --  object of the instance class</span>

<span class="sd">            driver      (object)   --  the browser object</span>

<span class="sd">            commcell    (object)   --  an instance of the commcell class</span>

<span class="sd">            csdb        (object)   --  the cs DB object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AlibabaCloudAdminConsole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_set_instance_restore_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the restore options for each instance to be restored</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if there is any exception in setting the restore options</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">availability_zone</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="n">security_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">compute_free_resources</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
            <span class="c1"># instance_type will always come from the backup VM</span>
            <span class="c1"># availability_zone, network and security_groups will be obtained from proxy</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;availability_zone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">availability_zone</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;instance_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">VMs</span><span class="p">[</span><span class="n">_vm</span><span class="p">]</span><span class="o">.</span><span class="n">instance_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">network</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span><span class="p">[</span><span class="n">_vm</span><span class="p">][</span><span class="s1">&#39;security_groups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">security_groups</span>

<div class="viewcode-block" id="AlibabaCloudAdminConsole.full_vm_restore"><a class="viewcode-back" href="../../../../../Automation.Web.AdminConsole.Helper.html#Automation.Web.AdminConsole.Helper.VirtualServerHelper.AlibabaCloudAdminConsole.full_vm_restore">[docs]</a>    <span class="k">def</span> <span class="nf">full_vm_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs a full instance restore of Alibaba cloud instances</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_co_ordinator</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restore_destination_client</span><span class="p">,</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restore_instance_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_hypervisor_object</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_instance_restore_options</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">navigate_to_hypervisors</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_ac_obj</span><span class="o">.</span><span class="n">select_hypervisor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hypervisor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hypervisor_details_obj</span><span class="o">.</span><span class="n">open_subclient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vsa_sc_obj</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_restore_obj</span><span class="o">.</span><span class="n">select_full_vm_restore</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">ali_cloud_full_vm_restore</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                        <span class="n">destination_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                        <span class="n">destination_proxy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                        <span class="n">power_on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                        <span class="n">overwrite_instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">,</span>
                        <span class="n">in_place</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_restore_obj</span><span class="o">.</span><span class="n">ali_cloud_full_vm_restore</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">,</span>
                        <span class="n">destination_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_client</span><span class="p">,</span>
                        <span class="n">destination_proxy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restore_proxy</span><span class="p">,</span>
                        <span class="n">power_on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_on_after_restore</span><span class="p">,</span>
                        <span class="n">overwrite_instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unconditional_overwrite</span><span class="p">,</span>
                        <span class="n">in_place</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">,</span>
                        <span class="n">restore_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span><span class="p">,</span>
                        <span class="n">instance_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_vm_restore_options</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">pprint_handler_errors</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">restore_job</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Completed&#39;</span><span class="p">,</span>
                                             <span class="s2">&quot;Completed w/ one or more errors&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Restore job failed. Please check the logs&quot;</span><span class="p">)</span>

            <span class="c1"># Sleep is added to give time for the restored VM to boot up. SP14 MR 214066</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_vm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_vm_in_place</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="n">_vm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">restore_vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_prefix</span> <span class="o">+</span> <span class="n">_vm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_validation</span><span class="p">(</span><span class="n">_vm</span><span class="p">,</span> <span class="n">restore_vm</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred during full VM restore. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Commvault Systems Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>