
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Server.DisasterRecovery.drhelper &#8212; Commvault Automation 11.13 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for Server.DisasterRecovery.drhelper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot;Helper file for performing DR operations</span>

<span class="sd">DRHelper is the only class defined in this file</span>

<span class="sd">DRHelper: Helper class to perform DR operations</span>

<span class="sd">DRHelper:</span>

<span class="sd">    __init__()                      --  initializes DR helper object</span>

<span class="sd">    killrunningdrjobs               --  Kills already running DR jobs</span>

<span class="sd">    drbackupwithjson                --  Run DR backup with JSON request</span>

<span class="sd">    restore_db_with_cvmigrationtool --  RUN DR restore on CS with</span>
<span class="sd">                                        CSRecoveryassitant.exe</span>

<span class="sd">    validateset_folder              --  Validate SET_Folder files</span>

<span class="sd">    changedrsettings                --  Change DRSettings with specified values</span>

<span class="sd">    executequery                    --  Runs specified query on CS DB</span>

<span class="sd">    executecvquery                  --  Runs Commvault specific queries with SQL object</span>

<span class="sd">    changedrpath                    --  Change the DRDumpLocation specified in DR backup settings.</span>

<span class="sd">    startServices                   --  Start Services on Commserv</span>

<span class="sd">    cleanup_entities                --  Method to cleanup commcell entities</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">cvpysdk</span> <span class="k">import</span> <span class="n">storage</span>
<span class="kn">from</span> <span class="nn">cvpysdk.job</span> <span class="k">import</span> <span class="n">Job</span>
<span class="kn">from</span> <span class="nn">cvpysdk.client</span> <span class="k">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">cvpysdk.exception</span> <span class="k">import</span> <span class="n">SDKException</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="k">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.database_helper</span> <span class="k">import</span> <span class="n">MSSQL</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.database_helper</span> <span class="k">import</span> <span class="n">get_csdb</span>


<div class="viewcode-block" id="DRHelper"><a class="viewcode-back" href="../../../Server.DisasterRecovery.html#Server.DisasterRecovery.drhelper.DRHelper">[docs]</a><span class="k">class</span> <span class="nc">DRHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class to perform DR operations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">log</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">tcinputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">csdb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">killdrjobs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes drhelper object and gets the commserv database object</span>
<span class="sd">        if not specified</span>
<span class="sd">            Args:</span>
<span class="sd">                commcell(object)    --  commcell object</span>
<span class="sd">                log     (object)    --  log object used for logging.</span>
<span class="sd">                tcinputs(object)    --  testcase inputs object</span>
<span class="sd">                csdb    (object)    --  commserv database object using which</span>
<span class="sd">                                        we can query commserv db</span>
<span class="sd">                killdrjobs(boolean) --  flag to kill already running DR jobs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">log</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span> <span class="o">=</span> <span class="n">commcell</span>
        <span class="k">if</span> <span class="n">csdb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span> <span class="o">=</span> <span class="n">csdb</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span> <span class="o">=</span> <span class="n">get_csdb</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">tcinputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csclient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">commcell</span><span class="p">,</span> <span class="n">commcell</span><span class="o">.</span><span class="n">commserv_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csclient</span><span class="o">.</span><span class="n">install_directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wildcards</span> <span class="o">=</span> <span class="s1">&#39;cvd;SIDBPrune;SIDBEngine;CVMA;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setfolder</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drjob</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numberofversions</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drpath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changesp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uploadtocloud</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runscripts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbdumplocation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbfilelocation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">licensepath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tononcluster</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tocluster</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skipdump</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="s2">&quot;recovery&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="s1">&#39;EXECUTE_QCOMMAND&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">killdrjobs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill_running_drjobs</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">db_dumplocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Treats the db_dumplocation as a read-only attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbdumplocation</span>

    <span class="nd">@db_dumplocation</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">db_dumplocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the dbdumplocation attribute value &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbdumplocation</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">set_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Treats the set_Folder as a read-only attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setfolder</span>

    <span class="nd">@set_folder</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">set_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the setfolder attribute value &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setfolder</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">client_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Treats the client_list as a read-only attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client_list</span>

    <span class="nd">@client_list</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">client_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the _client_list attribute value &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client_list</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="DRHelper.executequery"><a class="viewcode-back" href="../../../Server.DisasterRecovery.html#Server.DisasterRecovery.drhelper.DRHelper.executequery">[docs]</a>    <span class="k">def</span> <span class="nf">executequery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs specified query on CS DB&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span></div>

<div class="viewcode-block" id="DRHelper.kill_running_drjobs"><a class="viewcode-back" href="../../../Server.DisasterRecovery.html#Server.DisasterRecovery.drhelper.DRHelper.kill_running_drjobs">[docs]</a>    <span class="k">def</span> <span class="nf">kill_running_drjobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Kill already running DR jobs&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select value from GXGlobalParam where name =&#39;DRDumpLocation&#39;&quot;</span>
            <span class="n">drlocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executequery</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drlocation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Current DR setting is </span><span class="si">{0}</span><span class="s2">&quot;</span>
                              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">drlocation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drpath</span> <span class="o">=</span> <span class="n">drlocation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select jobId from JMAdminJobInfoTable where opType = 11&quot;</span>
                <span class="n">jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executequery</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">job</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;DR job </span><span class="si">{}</span><span class="s2"> is already running, kill and </span><span class="se">\</span>
<span class="s2">                        continue automation&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">runningjob</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">job</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to create job object for job </span><span class="si">{}</span><span class="s2"> and exception</span><span class="se">\</span>
<span class="s2">                             is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">err</span><span class="p">))</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">runningjob</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                <span class="s2">&quot;Failed to kill the job </span><span class="si">{}</span><span class="s2"> and exception is </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">job</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">err</span><span class="p">))</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to kill the job </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRHelper.executecvquery"><a class="viewcode-back" href="../../../Server.DisasterRecovery.html#Server.DisasterRecovery.drhelper.DRHelper.executecvquery">[docs]</a>    <span class="k">def</span> <span class="nf">executecvquery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Execute Commvault specific queries with SQL object</span>
<span class="sd">        Args:</span>
<span class="sd">                query      (str)   --  specify the query to execute on CS db.</span>
<span class="sd">        Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to execute DB query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;SqlSaPassword&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
                <span class="n">dbpassword</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;SqlSaPassword&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Sql Sa password is not provided&quot;</span><span class="p">)</span>

            <span class="n">dbobject</span> <span class="o">=</span> <span class="n">MSSQL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">commserv_name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">commvault&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;sa&quot;</span><span class="p">,</span> <span class="n">dbpassword</span><span class="p">,</span> <span class="s2">&quot;CommServ&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">dbobject</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">_rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;failed to execute query </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>

<div class="viewcode-block" id="DRHelper.validateset_folder"><a class="viewcode-back" href="../../../Server.DisasterRecovery.html#Server.DisasterRecovery.drhelper.DRHelper.validateset_folder">[docs]</a>    <span class="k">def</span> <span class="nf">validateset_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validates SET_Folder for DR backup</span>
<span class="sd">        Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to validate set_folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">set_query</span> <span class="o">=</span> <span class="s2">&quot;select dirName from GXDRFull where jobId = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;query to get set_ folder </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">set_query</span><span class="p">))</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executequery</span><span class="p">(</span><span class="n">set_query</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_folder</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to get set_ folder for Job id </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">drjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">:</span>
                <span class="n">filelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">_get_folder_hash</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_folder</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drjob</span><span class="o">.</span><span class="n">backup_level</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;full&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">actualfilelist</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="s2">&quot;sendlogfiles&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;version.txt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;cmdfile.txt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;commserv_full.dmp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;fwconfiglocal.txt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;dm2_full.dmp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;cmdfile.log&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;historydb_full.dmp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;wfengine_full.dmp&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">actualfilelist</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="s2">&quot;sendlogfiles&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;version.txt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;cmdfile.txt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;commserv_full.dmp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;commserv_diff.dmp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;fwconfiglocal.txt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;cmdfile.log&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;dm2_full.dmp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;historydb_full.dmp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;wfengine_full.dmp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;dm2_diff.dmp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;historydb_diff.dmp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;wfengine_diff.dmp&quot;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">((</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                            <span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">actualfilelist</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_list</span><span class="p">:</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;File </span><span class="si">{}</span><span class="s2"> also available in ignore list. History DB, </span><span class="se">\</span>
<span class="s2">                             WorkFlow DB dumps should not be created.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;File is in actual list, file name is  </span><span class="si">{}</span><span class="s2">&quot;</span>
                                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File is not available in actual list, file name is  </span><span class="si">{}</span><span class="s2">&quot;</span>
                                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRHelper.changedrsettings"><a class="viewcode-back" href="../../../Server.DisasterRecovery.html#Server.DisasterRecovery.drhelper.DRHelper.changedrsettings">[docs]</a>    <span class="k">def</span> <span class="nf">changedrsettings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        method to update the DR CS settings including storagepolicy, DR paths, cloud user.</span>
<span class="sd">        Raises:</span>
<span class="sd">                SDKException:</span>
<span class="sd">                    if failed to change DR settings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;UncPath&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drpath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;UncPath&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s2">&quot;UncUser&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
                <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;UncUser&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="s2">&quot;UncPassword&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
                <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;UncPassword&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">networkaccount</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">password</span><span class="p">,</span>
                <span class="s2">&quot;userName&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">username</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Remove data from UNC path&quot;</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">mount_network_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">drpath</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">drive</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;The local device name has a remembered connection</span><span class="se">\</span>
<span class="s2">                 to another network resource&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="s2">&quot;Unable to map network path to local drive </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">drive</span><span class="p">))</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;failed to delete content from drive </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">drive</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">unmount_drive</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">networkaccount</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drpath</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;failed to delete content from DR path </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">drpath</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uploadtocloud</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uploadtocloud</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>

            <span class="k">if</span> <span class="s2">&quot;CloudUser&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
                <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;CloudUser&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="s2">&quot;CloudUserPsw&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
                <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;CloudUserPsw&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cloudcredentials</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">password</span><span class="p">,</span>
                <span class="s2">&quot;userName&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">username</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uploadtocloud</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cloudcredentials</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">changesp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storagepolicy</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;storagePolicyName&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changesp</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">,</span>
                <span class="s2">&quot;storagePolicyId&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changesp</span><span class="o">.</span><span class="n">storage_policy_id</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storagepolicy</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;storagePolicyName&quot;</span><span class="p">:</span> <span class="s2">&quot;CommServeDR&quot;</span><span class="p">,</span>
                <span class="s2">&quot;storagePolicyId&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runscripts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prescripts</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;useImpersonateUser&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;preScanProcess&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">runscripts</span><span class="p">,</span>
                <span class="s2">&quot;postBackupProcess&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">runscripts</span><span class="p">,</span>
                <span class="s2">&quot;postScanProcess&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">runscripts</span><span class="p">,</span>
                <span class="s2">&quot;runPostScanProcess&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;preBackupProcess&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">runscripts</span><span class="p">,</span>
                <span class="s2">&quot;runPostBackupProcess&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;impersonateUser&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;userName&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prescripts</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;useImpersonateUser&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;preScanProcess&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                <span class="s2">&quot;postBackupProcess&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                <span class="s2">&quot;postScanProcess&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                <span class="s2">&quot;runPostScanProcess&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;preBackupProcess&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                <span class="s2">&quot;runPostBackupProcess&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exportsettings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;wildCardSetting&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wildcards</span><span class="p">,</span>
            <span class="s2">&quot;backupMetadataFolder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">drpath</span><span class="p">,</span>
            <span class="s2">&quot;isUseVSS&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;numberOfMetadata&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberofversions</span><span class="p">,</span>
            <span class="s2">&quot;uploadBackupMetadataToCloud&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uploadtocloud</span><span class="p">,</span>
            <span class="s2">&quot;cloudCredentials&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudcredentials</span><span class="p">,</span>
            <span class="s2">&quot;networkUserAccount&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">networkaccount</span><span class="p">,</span>
            <span class="s2">&quot;storagePolicy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">storagepolicy</span><span class="p">}</span>

        <span class="n">request_json</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;App_SetDRBackupInfoRequest&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;processinginstructioninfo&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;locale&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;localeId&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                    <span class="s2">&quot;formatFlags&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;ignoreUnknownTags&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s2">&quot;elementBased&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;skipIdToNameConversion&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s2">&quot;formatted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;filterUnInitializedFields&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;skipNameToIdConversion&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;continueOnError&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
                    <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;userName&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;userId&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
                <span class="s2">&quot;drBackupInfo&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;prePostProcessSettings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prescripts</span><span class="p">,</span>
                    <span class="s2">&quot;exportSettings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exportsettings</span><span class="p">}}}</span>

        <span class="n">flag</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">_cvpysdk_object</span><span class="o">.</span><span class="n">make_request</span><span class="p">(</span>
            <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">,</span> <span class="n">request_json</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">():</span>

                <span class="k">if</span> <span class="s2">&quot;response&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">():</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;response&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="s2">&quot;errorCode&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                        <span class="n">error_code</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errorCode&#39;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="s2">&quot;errorString&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                        <span class="n">error_string</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errorString&#39;</span><span class="p">]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to update the DR settings. error code is </span><span class="si">{}</span><span class="s2">,</span><span class="se">\</span>
<span class="s2">                         error message is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error_code</span><span class="p">,</span> <span class="n">error_string</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span>
                        <span class="s1">&#39;Response&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;102&#39;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">error_code</span><span class="p">)</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">error_string</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">response_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">_update_response_</span><span class="p">(</span>
                        <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to update the DR settings&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">,</span> <span class="s1">&#39;102&#39;</span><span class="p">,</span> <span class="n">response_string</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">response_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">_update_response_</span><span class="p">(</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;updated DR settings successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">_update_response_</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">,</span> <span class="s1">&#39;101&#39;</span><span class="p">,</span> <span class="n">response_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRHelper.changedrpath"><a class="viewcode-back" href="../../../Server.DisasterRecovery.html#Server.DisasterRecovery.drhelper.DRHelper.changedrpath">[docs]</a>    <span class="k">def</span> <span class="nf">changedrpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will change the DRDumpLocation specified in DR backup settings.</span>
<span class="sd">        Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to change drpath</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">firstquery</span> <span class="o">=</span> <span class="s2">&quot;update GXGlobalParam SET value=&#39;</span><span class="si">%s</span><span class="s2">&#39; where name</span><span class="se">\</span>
<span class="s2">             like &#39;DRDumpLocation&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">drpath</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Query to update the DR backup location DR  DUMPLoacation </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                <span class="n">firstquery</span><span class="p">)</span>
            <span class="n">retcode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executecvquery</span><span class="p">(</span><span class="n">firstquery</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">retcode</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Updated DR path with update query&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed in setting DR backup location setting&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception raised while setting DR path:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">err</span><span class="p">))</span></div>

<div class="viewcode-block" id="DRHelper.restore_db_with_cvmigrationtool"><a class="viewcode-back" href="../../../Server.DisasterRecovery.html#Server.DisasterRecovery.drhelper.DRHelper.restore_db_with_cvmigrationtool">[docs]</a>    <span class="k">def</span> <span class="nf">restore_db_with_cvmigrationtool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This Function will restore the DB from restored path of DR restore.</span>
<span class="sd">        Raises:</span>
<span class="sd">                SDKException:</span>
<span class="sd">                    if failed to restore db withcvmigrationtool</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Commserver installed path is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s2">&quot; &quot;</span><span class="p">,</span>
                <span class="s2">&quot;&#39; &#39;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">Base</span><span class="se">\\</span><span class="s2">CSRecoveryAssistant.exe&quot;</span> <span class="o">+</span> <span class="s1">&#39; -operation </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipdump</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s1">&#39;-skipdump &#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbdumplocation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot;-dbdumplocation </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">dbdumplocation</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&#39; &#39;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbfilelocation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot;-dbfilelocation </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">dbfilelocation</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&#39; &#39;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">licensepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot;-license &#39;</span><span class="si">%s</span><span class="s2">&#39; &quot;</span> <span class="o">%</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">licensepath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&#39; &#39;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tononcluster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot;-tononcluster &quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tocluster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot;-tocluster &quot;</span>

            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Command used for DB restore </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;fail&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">output</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Error while restoring DataBases, error </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfuly Restored DB Files on CS&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">,</span> <span class="s1">&#39;101&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRHelper.startservices"><a class="viewcode-back" href="../../../Server.DisasterRecovery.html#Server.DisasterRecovery.drhelper.DRHelper.startservices">[docs]</a>    <span class="k">def</span> <span class="nf">startservices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start commvault services on Commserv</span>
<span class="sd">        Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to start services</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">startcmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&#39; &#39;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">Base</span><span class="se">\\</span><span class="s2">DRRestore.exe a b StartServices c&quot;</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">startcmd</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;fail&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">output</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;Failed to start services on CS </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfuly started  services on CS&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;Failed to start services on CS </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRHelper.cleanup_entities"><a class="viewcode-back" href="../../../Server.DisasterRecovery.html#Server.DisasterRecovery.drhelper.DRHelper.cleanup_entities">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_config</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Method to cleanup commcell entities</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_config (dict)   -- Dictionary containing the entity(s) as key,</span>
<span class="sd">                                        and value(s) as a list of the entities to delete.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dictonary with failed entities</span>

<span class="sd">        Raises Exception:</span>
<span class="sd">            - If failed to delete any entity</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Start deleting entities configured&quot;</span><span class="p">)</span>
            <span class="n">failed_entities</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;storagepolicy&quot;</span><span class="p">:</span> <span class="p">[]}</span>

            <span class="k">if</span> <span class="s1">&#39;storagepolicy&#39;</span> <span class="ow">in</span> <span class="n">entity_config</span><span class="p">:</span>
                <span class="n">storageobj</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">StoragePolicies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
                <span class="n">storagepolies</span> <span class="o">=</span> <span class="n">entity_config</span><span class="p">[</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">policy</span> <span class="ow">in</span> <span class="n">storagepolies</span><span class="p">:</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">storageobj</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">policy</span><span class="p">):</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;Failed to delete SP </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                        <span class="n">failed_entities</span><span class="p">[</span><span class="s2">&quot;storagepolicy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;successfully deleted SP </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">policy</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">failed_entities</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed in cleanup_enties function with error </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Commvault Systems Inc. All Rights Reserved.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>