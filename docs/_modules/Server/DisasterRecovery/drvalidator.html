

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Server.DisasterRecovery.drvalidator &mdash; Commvault Automation 11.23 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>Server.DisasterRecovery.drvalidator</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Server.DisasterRecovery.drvalidator</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># pylint: disable=W1202</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main file for performing disaster recovery validations.</span>

<span class="sd">DRValidator is the only class defined in this file</span>

<span class="sd">DRValidator:</span>

<span class="sd">    __init__(test_object)                                       --  initialize instance of the DRValidator class.</span>

<span class="sd">    validate()                                                  --  entry point for validation</span>

<span class="sd">    trigger_dr_full_or_diff_job()                               --  Triggers full or differential dr jobs</span>

<span class="sd">    full_dr_job_hash_comparison()                               --  compares hash values of source and destination</span>
<span class="sd">                                                                    full dumps</span>

<span class="sd">    diff_dr_job_hash_comparison()                               --  compares hash values of source and destination</span>
<span class="sd">                                                                    diff dumps</span>

<span class="sd">    set_destination_path_based_on_tcinputs()                    --  sets destination path based on tcinputs</span>

<span class="sd">    validate_job_type()                                         --  validates job type.</span>

<span class="sd">    hexadecimal_id_of_the_commcell()                              --  gets the hexadecimal id of the commcell</span>

<span class="sd">    validate_dr_backup_metadata()                               --  Validates full and differential set folders by</span>
<span class="sd">                                                                    comparing the hash values of set folder with</span>
<span class="sd">                                                                    staging folder.</span>

<span class="sd">    validate_commserve_recovery()                               --  validates cs recovery with full and</span>
<span class="sd">                                                                    differential dumps.</span>


<span class="sd">    validate_dr_metadata_restore()                              --  validates dr restore jobs by comparing the hash</span>
<span class="sd">                                                                    values of restored folders with set folder</span>

<span class="sd">    validate_set_folder_pruning()                               --  validates set folder pruning scenario.</span>

<span class="sd">    validate_db_compress()                                      --  validates db compress scenario</span>

<span class="sd">    _get_folder_or_file_names()                                 --  gets the file names in a folder</span>

<span class="sd">    validate_client_logs()                                      --  checks the existence of log files</span>

<span class="sd">    _wait_for_job_completion()                                  --  waits for the completion of the job.</span>

<span class="sd">    validate_drbackup_qcommands()                               --  validates dr backup qcommands</span>

<span class="sd">    validate_multiple_dr_jobs_initiation()                      --  validates multiple dr jobs initiation sceanrios.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">cvpysdk.commcell</span> <span class="kn">import</span> <span class="n">Commcell</span>
<span class="kn">from</span> <span class="nn">cvpysdk.job</span> <span class="kn">import</span> <span class="n">Job</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">logger</span><span class="p">,</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="kn">import</span> <span class="n">OptionsSelector</span>
<span class="kn">from</span> <span class="nn">Server.DisasterRecovery.drhelper</span> <span class="kn">import</span> <span class="n">DRHelper</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="kn">import</span> <span class="n">CVEntities</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.wrapper7z</span> <span class="kn">import</span> <span class="n">Wrapper7Z</span>


<div class="viewcode-block" id="DRValidator"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator">[docs]</a><span class="k">class</span> <span class="nc">DRValidator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;DRValidator helper class to perform DR validations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_object</span><span class="p">,</span> <span class="n">cvcloud_cs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cvcloud_username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cvcloud_password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize instance of the DRValidator class.</span>

<span class="sd">            Args:</span>
<span class="sd">                test_object     (object)            --      instance of testcase.</span>

<span class="sd">                cvcloud_cs          (str)           --      hostname of the cloudcs</span>

<span class="sd">                cvcloud_username    (str)           --      username of the cloudcs</span>

<span class="sd">                cvcloud_password     (str)          --      password of the cloudcs</span>

<span class="sd">            Note: cvcloud_cs, cvcloud_username and cvcloud_password are required for downloading dumps from cvcloud.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_object</span> <span class="o">=</span> <span class="n">test_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">test_object</span><span class="o">.</span><span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span> <span class="o">=</span> <span class="n">test_object</span><span class="o">.</span><span class="n">csdb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tcinputs</span> <span class="o">=</span> <span class="n">test_object</span><span class="o">.</span><span class="n">tcinputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utility</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span> <span class="o">=</span> <span class="n">DRHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cvcloud_cs</span> <span class="ow">and</span> <span class="n">cvcloud_username</span> <span class="ow">and</span> <span class="n">cvcloud_password</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_cloud_helper</span> <span class="o">=</span> <span class="n">DRHelper</span><span class="p">(</span><span class="n">Commcell</span><span class="p">(</span><span class="n">webconsole_hostname</span><span class="o">=</span><span class="n">cvcloud_cs</span><span class="p">,</span>
                                                     <span class="n">commcell_username</span><span class="o">=</span><span class="n">cvcloud_username</span><span class="p">,</span>
                                                     <span class="n">commcell_password</span><span class="o">=</span><span class="n">cvcloud_password</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">management</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">management</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span> <span class="o">=</span> <span class="n">CVEntities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffdrjob</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="DRValidator.validate"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Entry point for feature validations</span>

<span class="sd">            Args:</span>
<span class="sd">                feature        (list)      --      list of features to be validated.</span>

<span class="sd">                parameters      (kwargs)   --       required parameters for the corresponding validate method.</span>

<span class="sd">        Returns :</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dr_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">dr_prerequisites</span><span class="p">()</span>
            <span class="n">existing_dr_policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">dr_storage_policy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">dr_storage_policy</span> <span class="o">=</span> <span class="n">dr_entities</span><span class="p">[</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">kill_running_drjobs</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">feature</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;dr_backup_metadata&#39;</span><span class="p">,</span> <span class="s1">&#39;commserve_recovery&#39;</span><span class="p">,</span> <span class="s1">&#39;dr_metadata_restore&#39;</span><span class="p">,</span> <span class="s1">&#39;set_folder_pruning&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;db_compress&#39;</span><span class="p">,</span> <span class="s1">&#39;drbackup_qcommands&#39;</span><span class="p">,</span> <span class="s1">&#39;multiple_dr_jobs_initiation&#39;</span><span class="p">):</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;validate_&#39;</span> <span class="o">+</span> <span class="n">feature</span><span class="p">)(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;please pass the validate feature name&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Failed with error:</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_object</span><span class="o">.</span><span class="n">result_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_object</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">FAILED</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">kill_running_drjobs</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">dr_storage_policy</span> <span class="o">=</span> <span class="n">existing_dr_policy</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">dr_prerequisites_cleanup</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;soft failure </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span></div>

<div class="viewcode-block" id="DRValidator.trigger_dr_full_or_diff_job"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.trigger_dr_full_or_diff_job">[docs]</a>    <span class="k">def</span> <span class="nf">trigger_dr_full_or_diff_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">client_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Triggers a one full dr job if backup_type = &#39;full&#39; or</span>
<span class="sd">        Triggers one full dr job followed by one differential dr job if backup_type = &#39;differential&#39;</span>

<span class="sd">            Args:</span>
<span class="sd">                 backup_type        (str)       --      type of backup</span>

<span class="sd">                client_list         (list)      --      list of client names.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">backup_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="s1">&#39;differential&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Triggering a Full dr backup with </span><span class="si">{0}</span><span class="s1">&#39;</span>
                          <span class="s1">&#39; as a destination path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">backup_metadata_folder</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">(</span><span class="n">backup_type</span><span class="o">=</span><span class="s1">&#39;differential&#39;</span><span class="p">,</span> <span class="n">client_list</span><span class="o">=</span><span class="n">client_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_job_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">backup_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;differential&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Triggering a differential dr backup with </span><span class="si">{0}</span><span class="s1">&#39;</span>
                              <span class="s1">&#39; as a destination path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">backup_metadata_folder</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">diffdrjob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">(</span><span class="n">backup_type</span><span class="o">=</span><span class="n">backup_type</span><span class="p">,</span> <span class="n">client_list</span><span class="o">=</span><span class="n">client_list</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_job_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diffdrjob</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="n">backup_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;please pass valid backup type&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRValidator.full_dr_job_hash_comparison"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.full_dr_job_hash_comparison">[docs]</a>    <span class="k">def</span> <span class="nf">full_dr_job_hash_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compares hash values of dr full dumps</span>

<span class="sd">            Args:</span>
<span class="sd">                source_path         (str)       --      source path of full dumps</span>

<span class="sd">                destination_path    (str)       --      destination path of full dumps</span>

<span class="sd">            Note:   paths can be staging path or set folder path or restored dumps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Performing full dumps comparsion &#39;</span>
                      <span class="s1">&#39;Source = </span><span class="si">{0}</span><span class="s1">, destination = </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">compare_folders</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span>
            <span class="n">source_path</span><span class="p">,</span>
            <span class="n">destination_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRValidator.diff_dr_job_hash_comparison"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.diff_dr_job_hash_comparison">[docs]</a>    <span class="k">def</span> <span class="nf">diff_dr_job_hash_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_dump_source_path</span><span class="p">,</span> <span class="n">diff_dump_source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compares hash values of dr differential dumps</span>

<span class="sd">            Args:</span>
<span class="sd">                full_dump_source_path         (str)       --      source path of full dumps</span>

<span class="sd">                diff_dump_source_path         (str)       --      source path of differential dumps</span>

<span class="sd">                destination_path              (str)       --      destination path of full and differential dumps</span>

<span class="sd">            Note:   destination path should have both full and diff dumps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Performing full and diff dumps comparsion&#39;</span>
                      <span class="s1">&#39; full_dump_source_path = </span><span class="si">{0}</span><span class="s1">, diff_dump_source_path = </span><span class="si">{1}</span><span class="s1">,&#39;</span>
                      <span class="s1">&#39; destination_path = </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">full_dump_source_path</span><span class="p">,</span> <span class="n">diff_dump_source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">))</span>
        <span class="n">full_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">get_folder_hash</span><span class="p">(</span><span class="n">full_dump_source_path</span><span class="p">)</span>
        <span class="n">diff_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">get_folder_hash</span><span class="p">(</span><span class="n">diff_dump_source_path</span><span class="p">)</span>
        <span class="n">set_folder_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">get_folder_hash</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>
        <span class="n">diff_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">full_hash</span> <span class="o">|</span> <span class="n">diff_hash</span><span class="p">)</span> <span class="o">-</span> <span class="n">set_folder_hash</span>
        <span class="k">return</span> <span class="n">diff_list</span></div>

<div class="viewcode-block" id="DRValidator.set_destination_path"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.set_destination_path">[docs]</a>    <span class="k">def</span> <span class="nf">set_destination_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clean_up</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sets the destination path based on tcinputs</span>

<span class="sd">            Args:</span>
<span class="sd">                clean_up        (bool)      --          deletes the content present in UNC directory.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">            Raise:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to clean up the directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H-%M-%S&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UncPath&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UncUser&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UncPassword&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">clean_up</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Cleaning up the directory </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UncPath&#39;</span><span class="p">)))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UncPath&#39;</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ignore : </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">set_network_dr_path</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UncPath&#39;</span><span class="p">),</span>
                                                                  <span class="s1">&#39;DR_Dumps_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_time</span><span class="p">)),</span>
                                                <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UncUser&#39;</span><span class="p">),</span>
                                                <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UncPassword&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">custom_set_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">get_drive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="p">),</span>
                                           <span class="s2">&quot;local_path_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_time</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">set_local_dr_path</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">custom_set_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRValidator.hexadecimal_id_of_the_commcell"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.hexadecimal_id_of_the_commcell">[docs]</a>    <span class="k">def</span> <span class="nf">hexadecimal_id_of_the_commcell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets the hexadecimal id of the commcell.</span>

<span class="sd">            Returns:</span>
<span class="sd">                (str)           --      hexadecimal id of the commcell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="s1">&#39;SELECT dbo.ConvertBigIntToHexStr(CC.NUMBER) &#39;</span>
                                                  <span class="s1">&#39;FROM APP_COMMCELL CC WHERE clientId=2&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="DRValidator.validate_job_type"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.validate_job_type">[docs]</a>    <span class="k">def</span> <span class="nf">validate_job_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_object</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">hardcheck</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        validates job type(full/differential)</span>

<span class="sd">            Args:</span>
<span class="sd">                job_object      (object)        --         job object</span>

<span class="sd">                expected_type   (str)           --          expected type of the job</span>

<span class="sd">                    values:</span>
<span class="sd">                    &#39;full&#39;</span>
<span class="sd">                    &#39;differential&#39;</span>

<span class="sd">                hardcheck       (bool)          --          True/False</span>

<span class="sd">                    if job type doesn&#39;t match with expected type and hardcheck is true</span>
<span class="sd">                        raises exception</span>
<span class="sd">                    if job type doesn&#39;t match with expected type and hardcheck is false</span>
<span class="sd">                        returns false</span>
<span class="sd">            Returns:</span>
<span class="sd">                bool</span>
<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    when job type doesn&#39;t match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">expected_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="s1">&#39;differential&#39;</span><span class="p">):</span>
            <span class="n">backuplevel</span> <span class="o">=</span> <span class="n">job_object</span><span class="o">.</span><span class="n">backup_level</span>
            <span class="k">if</span> <span class="n">backuplevel</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">expected_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">hardcheck</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;DR backup job type is not </span><span class="si">{0}</span><span class="s2"> ,&quot;</span> \
                            <span class="s2">&quot; please check the type job id </span><span class="si">{1}</span><span class="s2">,&quot;</span> \
                            <span class="s2">&quot; current job type is </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job_object</span><span class="p">),</span> <span class="n">backuplevel</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Validated dr job type = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected_type</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Please pass the valid job type&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRValidator.validate_dr_backup_metadata"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.validate_dr_backup_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">validate_dr_backup_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">client_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">upload_to_cvcloud</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upload_to_third_party_cloud</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">er_staging_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates full and differential set folders by comparing the hash values of set folder with staging folder.</span>

<span class="sd">        Below scenarios are handled:</span>
<span class="sd">            Set folder with full dumps compared with staging folder.</span>
<span class="sd">            Set folder with full and differential dumps compared with staging folder.</span>

<span class="sd">        Note:  Based on the tcinputs, set folder destination path will be set.</span>

<span class="sd">            Args:</span>

<span class="sd">                backup_type (str)   -      type of backup to be triggered.</span>

<span class="sd">                    values:</span>

<span class="sd">                    &quot;full&quot;</span>
<span class="sd">                    &quot;differential&quot;</span>

<span class="sd">                client_list     (list)  -   list of clients to be set.</span>

<span class="sd">                log_names       (list)  -   list of log names to be set</span>

<span class="sd">                upload_to_cvcloud   (dict)  -   credentials to enable upload to cvcloud option.</span>

<span class="sd">                    {</span>
<span class="sd">                        &quot;CloudUserName&quot;: &quot;&quot;,</span>
<span class="sd">                        &quot;CloudPassword&quot;: &quot;&quot;,</span>
<span class="sd">                        &quot;CompanyName&quot;: &quot;&quot;</span>
<span class="sd">                    }</span>

<span class="sd">                upload_to_third_party_cloud     (dict)   -   required key/value pairs to enable the option</span>
<span class="sd">                                                             upload to third party cloud and to download dumps fom that</span>
<span class="sd">                                                             cloud.</span>

<span class="sd">                    {</span>
<span class="sd">                        &quot;VendorName&quot;: &quot;&quot;,</span>
<span class="sd">                        &quot;CloudLibraryName&quot;: &quot;&quot;,</span>
<span class="sd">                        &quot;LoginName&quot;: &quot;&quot;,</span>
<span class="sd">                        &quot;Password&quot;: &quot;&quot;,</span>
<span class="sd">                        &quot;MountPath&quot;: &quot;&quot;</span>
<span class="sd">                    }</span>

<span class="sd">                er_staging_directory            (str)   -   path of ERStaging directory</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_destination_path</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Validating scenario backup type = </span><span class="si">{0}</span><span class="s1">&#39;</span>
                      <span class="s1">&#39; and path = </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">backup_metadata_folder</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">er_staging_directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting the additional setting </span><span class="si">{0}</span><span class="s1"> = </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERStagingDirectory&#39;</span><span class="p">,</span>
                                                                            <span class="n">er_staging_directory</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">add_additional_setting</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;CommServe&#39;</span><span class="p">,</span> <span class="n">key_name</span><span class="o">=</span><span class="s1">&#39;ERStagingDirectory&#39;</span><span class="p">,</span>
                                                  <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">er_staging_directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">wild_card_settings</span> <span class="o">=</span> <span class="n">log_names</span>
        <span class="k">if</span> <span class="n">upload_to_cvcloud</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">upload_metdata_to_commvault_cloud</span><span class="p">(</span>
                <span class="n">flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">upload_to_cvcloud</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CloudUserName&#39;</span><span class="p">),</span>
                <span class="n">password</span><span class="o">=</span><span class="n">upload_to_cvcloud</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CloudPassword&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">upload_to_third_party_cloud</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">check_entity_existence</span><span class="p">(</span>
                <span class="n">entity_type</span><span class="o">=</span><span class="s1">&#39;library&#39;</span><span class="p">,</span>
                <span class="n">entity_object</span><span class="o">=</span><span class="n">upload_to_third_party_cloud</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CloudLibraryName&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">upload_metdata_to_cloud_library</span><span class="p">(</span>
                <span class="n">flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">libraryname</span><span class="o">=</span><span class="n">upload_to_third_party_cloud</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CloudLibraryName&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_dr_full_or_diff_job</span><span class="p">(</span><span class="n">backup_type</span><span class="o">=</span><span class="n">backup_type</span><span class="p">,</span> <span class="n">client_list</span><span class="o">=</span><span class="n">client_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="s2">&quot;select dirName, fileName_srm from </span><span class="si">{0}</span><span class="s2"> where jobid = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;GXDRFULL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>  <span class="c1"># pull it out</span>
        <span class="n">destination_path</span><span class="p">,</span> <span class="n">staging_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">set_folder_name</span> <span class="o">=</span> <span class="n">destination_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">client_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Validating logs </span><span class="si">{0}</span><span class="s1"> for clients </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_names</span><span class="p">,</span> <span class="n">client_list</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_client_logs</span><span class="p">(</span><span class="n">staging_path</span><span class="p">,</span> <span class="n">client_list</span><span class="p">,</span> <span class="n">log_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">upload_to_cvcloud</span><span class="p">:</span>
            <span class="n">destination_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="n">dirstring</span><span class="o">=</span><span class="n">set_folder_name</span><span class="p">)</span>
            <span class="n">commcell_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hexadecimal_id_of_the_commcell</span><span class="p">()</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_cloud_helper</span><span class="o">.</span><span class="n">client_machine</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_cloud_helper</span><span class="o">.</span><span class="n">client_machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_cloud_helper</span><span class="o">.</span><span class="n">download_from_cvcloud</span><span class="p">(</span><span class="n">company_name</span><span class="o">=</span><span class="n">upload_to_cvcloud</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CompanyName&#39;</span><span class="p">),</span>
                                                       <span class="n">set_folder_name</span><span class="o">=</span><span class="n">set_folder_name</span><span class="p">,</span>
                                                       <span class="n">destination_path</span><span class="o">=</span><span class="n">destination_path</span><span class="p">,</span>
                                                       <span class="n">commcell_id</span><span class="o">=</span><span class="n">commcell_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_cloud_helper</span><span class="o">.</span><span class="n">client_machine</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> folder downloaded successfully&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">set_folder_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">upload_to_third_party_cloud</span><span class="p">:</span>
            <span class="n">destination_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="n">dirstring</span><span class="o">=</span><span class="n">set_folder_name</span><span class="p">)</span>
            <span class="n">source_path</span> <span class="o">=</span> <span class="s1">&#39;DR/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">commserv_name</span><span class="p">,</span> <span class="n">set_folder_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">download_from_third_party_cloud</span><span class="p">(</span>
                <span class="n">upload_to_third_party_cloud</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VendorName&#39;</span><span class="p">),</span>
                <span class="n">upload_to_third_party_cloud</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LoginName&#39;</span><span class="p">),</span>
                <span class="n">upload_to_third_party_cloud</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Password&#39;</span><span class="p">),</span>
                <span class="n">upload_to_third_party_cloud</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MountPath&#39;</span><span class="p">),</span>
                <span class="n">source_path</span><span class="p">,</span>
                <span class="n">destination_path</span><span class="p">)</span>
            <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_path</span><span class="p">,</span> <span class="n">upload_to_third_party_cloud</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MountPath&#39;</span><span class="p">),</span>
                                            <span class="s1">&#39;DR&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">commserv_name</span><span class="p">,</span> <span class="n">set_folder_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Comparing hash values...&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">backup_type</span> <span class="o">==</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span>
            <span class="n">diff_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dr_job_hash_comparison</span><span class="p">(</span><span class="n">staging_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">diff_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_dr_job_hash_comparison</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">install_path</span><span class="p">,</span> <span class="s1">&#39;CommserveDR&#39;</span><span class="p">,</span> <span class="s1">&#39;DR_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">)),</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">install_path</span><span class="p">,</span> <span class="s1">&#39;CommserveDR&#39;</span><span class="p">,</span> <span class="s1">&#39;DR_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diffdrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">)),</span>
                <span class="n">destination_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Hash values difference list = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff_list</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">diff_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.dmp&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Hash values of staging folder and set folder are not equal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Hash values have been compared successfully, diff list = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully validated scenario backup type = </span><span class="si">{0}</span><span class="s1">&#39;</span>
                      <span class="s1">&#39; and path = </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">backup_metadata_folder</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">upload_to_cvcloud</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">upload_metdata_to_commvault_cloud</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">upload_to_third_party_cloud</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">upload_metdata_to_cloud_library</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">er_staging_directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Deleting the additional setting </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERStagingDirectory&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">delete_additional_setting</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;CommServe&#39;</span><span class="p">,</span> <span class="n">key_name</span><span class="o">=</span><span class="s1">&#39;ERStagingDirectory&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRValidator.validate_commserve_recovery"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.validate_commserve_recovery">[docs]</a>    <span class="k">def</span> <span class="nf">validate_commserve_recovery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_type</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        validates cs recovery with full and differential dumps.</span>

<span class="sd">        Below scenarios are handled:</span>
<span class="sd">            CSRecovery with Full dumps.</span>
<span class="sd">            CSRecovery with Full and differential dumps.</span>

<span class="sd">            Args:</span>
<span class="sd">                backup_type (str)   -      type of backup to be triggered.</span>

<span class="sd">                    values:</span>

<span class="sd">                    &quot;full&quot;</span>
<span class="sd">                    &quot;differential&quot;</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_destination_path</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Validating the scenario, CSRecovery with </span><span class="si">{0}</span><span class="s1"> dumps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_type</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">backup_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="s1">&#39;differential&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">backup_type</span> <span class="o">==</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span>
                <span class="n">entity_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">input_entities</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;disklibrary&#39;</span><span class="p">,</span> <span class="s1">&#39;storagepolicy&#39;</span><span class="p">])</span>
                <span class="n">fulldrjob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_job_type</span><span class="p">(</span><span class="n">fulldrjob</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fulldrjob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_job_type</span><span class="p">(</span><span class="n">fulldrjob</span><span class="p">)</span>
                <span class="n">entity_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">input_entities</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;disklibrary&#39;</span><span class="p">,</span> <span class="s1">&#39;storagepolicy&#39;</span><span class="p">])</span>
                <span class="n">diffdrjob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">(</span><span class="n">backup_type</span><span class="o">=</span><span class="n">backup_type</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_job_type</span><span class="p">(</span><span class="n">diffdrjob</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="n">backup_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Cleaning up the created entities </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity_properties</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="s2">&quot;select dirName, fileName_srm from </span><span class="si">{0}</span><span class="s2"> where jobid = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;GXDRFULL&quot;</span><span class="p">,</span> <span class="n">fulldrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
            <span class="n">destination_path</span><span class="p">,</span> <span class="n">staging_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Launching CSRecoveryAssistant with dbdump location </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">destination_path</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">restore_db_with_csrecovery_assistant</span><span class="p">(</span><span class="n">dbdumplocation</span><span class="o">=</span><span class="n">destination_path</span><span class="p">,</span>
                                                                <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;recovery&#39;</span><span class="p">,</span>
                                                                <span class="n">start_services_after_recovery</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Executing iisreset cmd on cs...&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s1">&#39;iisreset&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;iisreset cmd output </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;checking the existence of entities on th commcell </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity_properties</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">check_entity_existence</span><span class="p">(</span><span class="s1">&#39;policy&#39;</span><span class="p">,</span> <span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">check_entity_existence</span><span class="p">(</span><span class="s1">&#39;library&#39;</span><span class="p">,</span> <span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;disklibrary&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Recovery of CS is completed successfully&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;please pass valid backup type&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRValidator.validate_dr_metadata_restore"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.validate_dr_metadata_restore">[docs]</a>    <span class="k">def</span> <span class="nf">validate_dr_metadata_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        validates dr restore jobs by comparing the hash values of restored folders with set folder</span>

<span class="sd">        Below scenarios are handled:</span>
<span class="sd">            Restore of full dr backup by jobid and hash validation</span>
<span class="sd">            Restore of full and differential dr backups by jobid and hash validation</span>

<span class="sd">            Args:</span>
<span class="sd">                backup_type (str)   -      type of backup to be triggered.</span>

<span class="sd">                    values:</span>

<span class="sd">                    &quot;full&quot;</span>
<span class="sd">                    &quot;differential&quot;</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H-%M-%S&#39;</span><span class="p">)</span>
        <span class="n">drive_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">get_drive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="p">)</span>
        <span class="n">custom_restore_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drive_name</span><span class="p">,</span> <span class="s2">&quot;restore_path_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_time</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Validating restore by job id, Restoring dumps = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_type</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_destination_path</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_dr_full_or_diff_job</span><span class="p">(</span><span class="n">backup_type</span><span class="o">=</span><span class="n">backup_type</span><span class="p">)</span>
        <span class="n">restore_jobs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">backup_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;differential&#39;</span><span class="p">:</span>
            <span class="n">restore_jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diffdrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Restoring dr jobs = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">restore_jobs</span><span class="p">))</span>
        <span class="n">restorejob_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">restore_out_of_place</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">csclient</span><span class="p">,</span>
                                                                <span class="n">custom_restore_path</span><span class="p">,</span>
                                                                <span class="n">fs_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index_free_restore&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                                                                <span class="n">restore_jobs</span><span class="o">=</span><span class="n">restore_jobs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">restorejob_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Comparing hash values...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="s2">&quot;select dirName, fileName_srm from </span><span class="si">{0}</span><span class="s2"> where jobid = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;GXDRFULL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="n">destination_path</span><span class="p">,</span> <span class="n">staging_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">backup_type</span> <span class="o">==</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span>
            <span class="n">diff_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dr_job_hash_comparison</span><span class="p">(</span>
                <span class="n">destination_path</span><span class="p">,</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">custom_restore_path</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">install_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;CommserveDR&#39;</span><span class="p">,</span> <span class="s1">&#39;DR_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">diff_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_dr_job_hash_comparison</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">custom_restore_path</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">install_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;CommserveDR&#39;</span><span class="p">,</span> <span class="s1">&#39;DR_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">)),</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">custom_restore_path</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">install_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;CommserveDR&#39;</span><span class="p">,</span> <span class="s1">&#39;DR_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diffdrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">)),</span>
                <span class="n">destination_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Hash values difference list = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff_list</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">diff_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.dmp&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Hash values of restore folder and set folder are not equal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Hash values have been compared successfully, diff list = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;successfully validated dr restore scenario&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRValidator.validate_set_folder_pruning"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.validate_set_folder_pruning">[docs]</a>    <span class="k">def</span> <span class="nf">validate_set_folder_pruning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        validates set folder pruning scenario.</span>

<span class="sd">        Below scenarios are handled:</span>
<span class="sd">            validates pruning for local path and unc path</span>

<span class="sd">        Note:  Based on the tcinputs, set folder destination path will be set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_destination_path</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Validating set folder pruning with path = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">backup_metadata_folder</span><span class="p">))</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">number_of_metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">number_of_metadata</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">fulljob1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_job_type</span><span class="p">(</span><span class="n">fulljob1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="s2">&quot;select dirName, fileName_srm from </span><span class="si">{0}</span><span class="s2"> where jobid = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;GXDRFULL&quot;</span><span class="p">,</span> <span class="n">fulljob1</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="n">destination_path</span><span class="p">,</span> <span class="n">staging_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">fulljob2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_job_type</span><span class="p">(</span><span class="n">fulljob2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">destination_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Set folder didn&#39;t pruned successfully&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Set folder pruned successfully&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Applying default settings..&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">number_of_metadata</span> <span class="o">=</span> <span class="n">default_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully validated set folder pruning&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRValidator.validate_db_compress"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.validate_db_compress">[docs]</a>    <span class="k">def</span> <span class="nf">validate_db_compress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates db compress scenario.</span>

<span class="sd">            triggers full and differential dr jobs with compression disabled.</span>

<span class="sd">            triggers full and differential dr jobs with compression enabled.</span>

<span class="sd">            Compares sizes of above set folders to validate the scenario.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_destination_path</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validating db compress setting, destination path = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">backup_metadata_folder</span><span class="p">))</span>
        <span class="n">fulljob_uncompressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">(</span><span class="n">backup_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">(</span><span class="n">backup_type</span><span class="o">=</span><span class="s1">&#39;differential&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="s2">&quot;select dirName, fileName_srm from </span><span class="si">{0}</span><span class="s2"> where jobid = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;GXDRFULL&quot;</span><span class="p">,</span> <span class="n">fulljob_uncompressed</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="n">uncompressed_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fulljob_compressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">(</span><span class="n">backup_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">(</span><span class="n">backup_type</span><span class="o">=</span><span class="s1">&#39;differential&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="s2">&quot;select dirName, fileName_srm from </span><span class="si">{0}</span><span class="s2"> where jobid = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;GXDRFULL&quot;</span><span class="p">,</span> <span class="n">fulljob_compressed</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="n">compressed_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">compressed_folder_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">get_folder_size</span><span class="p">(</span><span class="n">compressed_folder_path</span><span class="p">)</span>
        <span class="n">uncompressed_folder_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">get_folder_size</span><span class="p">(</span><span class="n">uncompressed_folder_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">compressed_folder_size</span> <span class="o">&gt;=</span> <span class="n">uncompressed_folder_size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Compressed folder size </span><span class="si">{0}</span><span class="s1"> is greater than uncompressed folder size </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">compressed_folder_size</span><span class="p">,</span> <span class="n">uncompressed_folder_size</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Compressed folder size = </span><span class="si">{0}</span><span class="s1"> and uncompressed folder size = </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">compressed_folder_size</span><span class="p">,</span> <span class="n">uncompressed_folder_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully validated db compress scenario&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully validated set folder pruning&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_folder_or_file_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets the file names in given directory</span>

<span class="sd">            Args:</span>
<span class="sd">                 path   (str)   -   directory path</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    -       list of file names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;getting the file names from directory </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">get_folder_or_file_names</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s2">&quot;&#39; &#39;&quot;</span><span class="p">),</span> <span class="n">filesonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>

<div class="viewcode-block" id="DRValidator.validate_client_logs"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.validate_client_logs">[docs]</a>    <span class="k">def</span> <span class="nf">validate_client_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">,</span> <span class="n">client_list</span><span class="p">,</span> <span class="n">log_file_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the existence of the log files in destination path.</span>

<span class="sd">            Args:</span>

<span class="sd">                destination_path    (str)   -   path of the archive folder</span>

<span class="sd">                client_list         (list)  -   list of client names</span>

<span class="sd">                log_file_names      (list)  -   list of log names to be checked.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if logs are not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Checking the existence of log files </span><span class="si">{0}</span><span class="s1">  for clients </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_file_names</span><span class="p">,</span> <span class="n">client_list</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">log_file_names</span><span class="p">:</span>
            <span class="n">log_file_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">wild_card_settings</span>
        <span class="n">set_folder_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_folder_or_file_names</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>
        <span class="n">found_7z</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">set_folder_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.7z&#39;</span><span class="p">):</span>
                <span class="n">found_7z</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">zipobject</span> <span class="o">=</span> <span class="n">Wrapper7Z</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">csclient</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">zipfilepath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_path</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
                <span class="n">temp_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">client_machine</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Extracting archive </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
                <span class="n">zipobject</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="n">temp_path</span><span class="p">)</span>
                <span class="n">sendlog_folder_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_folder_or_file_names</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">client_name</span> <span class="ow">in</span> <span class="n">client_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">client_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.7z&#39;</span> <span class="ow">in</span> <span class="n">sendlog_folder_list</span><span class="p">:</span>
                        <span class="n">client_zip_object</span> <span class="o">=</span> <span class="n">Wrapper7Z</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">csclient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                            <span class="n">zipfilepath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_path</span><span class="p">,</span> <span class="n">client_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.7z&#39;</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Extracting archive </span><span class="si">{0}</span><span class="s1">.7z&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
                        <span class="n">client_zip_object</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
                        <span class="n">clientlog_folder_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_folder_or_file_names</span><span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_path</span><span class="p">,</span> <span class="n">client_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
                        <span class="n">clientlog_folder_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clientlog_folder_list</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">log_name</span> <span class="ow">in</span> <span class="n">log_file_names</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">log_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">clientlog_folder_list</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Log </span><span class="si">{0}</span><span class="s2"> not found in zip folder for client </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">log_name</span><span class="p">,</span> <span class="n">client_name</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;for client </span><span class="si">{1}</span><span class="s1">, </span><span class="si">{0}</span><span class="s1"> log found in archive&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_name</span><span class="p">,</span> <span class="n">client_name</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;client = </span><span class="si">{0}</span><span class="s1">, 7z is not found in archive&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_7z</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;sendlogs_xxxx not found in staging folder&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully validated client logs...&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_wait_for_job_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">time_limit</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        waits for the completion of the job</span>

<span class="sd">        Args:</span>
<span class="sd">            job_id      (int/str)   --      job id</span>

<span class="sd">            time_limit      (int)   --      wait time for the completion of job(minutes)</span>

<span class="sd">        Returns:</span>
<span class="sd">            job object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dr_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">,</span> <span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Dr job is triggered with id = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dr_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">dr_job</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="n">expected_state</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;completed&#39;</span><span class="p">],</span>
                                                  <span class="n">retry_interval</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">time_limit</span><span class="o">=</span><span class="n">time_limit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dr_job</span>

<div class="viewcode-block" id="DRValidator.validate_drbackup_qcommands"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.validate_drbackup_qcommands">[docs]</a>    <span class="k">def</span> <span class="nf">validate_drbackup_qcommands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        validates dr backup full and differential qcommands.</span>

<span class="sd">            Args:</span>
<span class="sd">                backup_type         (full)  --     type of backup job to be triggered.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if invalid backup_type is passed.</span>
<span class="sd">                    if hash values are not same.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_destination_path</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">backup_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="s1">&#39;differential&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;validating dr backup qcommand scenario </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_type</span><span class="p">))</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">execute_qcommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s1">&#39;qoperation drbackup -t Q_FULL&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_job_completion</span><span class="p">(</span><span class="n">job_id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="n">time_limit</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_job_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">backup_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;differential&#39;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">execute_qcommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s1">&#39;qoperation drbackup -t Q_DIFF&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">diffdrjob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_job_completion</span><span class="p">(</span><span class="n">job_id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="n">time_limit</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_job_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diffdrjob</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="s1">&#39;differential&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="s2">&quot;select dirName, fileName_srm from </span><span class="si">{0}</span><span class="s2"> where jobid = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;GXDRFULL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>  <span class="c1"># pull it out</span>
            <span class="n">destination_path</span><span class="p">,</span> <span class="n">staging_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Comparing hash values...&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">backup_type</span> <span class="o">==</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span>
                <span class="n">diff_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dr_job_hash_comparison</span><span class="p">(</span><span class="n">staging_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diff_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff_dr_job_hash_comparison</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">install_path</span><span class="p">,</span> <span class="s1">&#39;CommserveDR&#39;</span><span class="p">,</span> <span class="s1">&#39;DR_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fulldrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">)),</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">install_path</span><span class="p">,</span> <span class="s1">&#39;CommserveDR&#39;</span><span class="p">,</span> <span class="s1">&#39;DR_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diffdrjob</span><span class="o">.</span><span class="n">job_id</span><span class="p">)),</span>
                    <span class="n">destination_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Hash values difference list = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff_list</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">diff_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.dmp&#39;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Hash values of staging folder and set folder are not equal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Hash values have been compared successfully, diff list = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff_list</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;please pass valid backup type&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DRValidator.validate_multiple_dr_jobs_initiation"><a class="viewcode-back" href="../../../source/Server.DisasterRecovery.html#Server.DisasterRecovery.drvalidator.DRValidator.validate_multiple_dr_jobs_initiation">[docs]</a>    <span class="k">def</span> <span class="nf">validate_multiple_dr_jobs_initiation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_types</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        validates multiple job initiation.</span>

<span class="sd">            Args:</span>
<span class="sd">                backup_types            (list)  --  list of job types need to be triggered.</span>

<span class="sd">                NOTE: as of now two major combinations are handled as follows.</span>

<span class="sd">                    [&#39;full&#39;, &#39;full&#39;, &#39;full&#39;, &#39;differential&#39;, &#39;full&#39;, &#39;differential&#39;]</span>

<span class="sd">                    [&#39;differential, &#39;differential&#39;, &#39;differential&#39;, &#39;full&#39;, &#39;full&#39;, &#39;differential&#39;]</span>

<span class="sd">                scenario                (str)   --  type of scenario to be validated.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raise:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if status of job is not matched</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_destination_path</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;validating scenario </span><span class="si">{0}</span><span class="s1">, sequence of jobs need to triggered </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">backup_types</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="s1">&#39;differential&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">()</span>
        <span class="n">job_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">backup_types</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">backup_type</span> <span class="ow">in</span> <span class="n">backup_types</span><span class="p">:</span>
                <span class="n">job_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_helper</span><span class="o">.</span><span class="n">trigger_dr_backup</span><span class="p">(</span><span class="n">backup_type</span><span class="o">=</span><span class="n">backup_type</span><span class="p">,</span> <span class="n">wait_for_completion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">job_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">job_objects</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">job_obj</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;failed to start&#39;</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> job is not in expected state </span><span class="si">{1}</span><span class="s1">,&#39;</span>
                                        <span class="s1">&#39; it is in </span><span class="si">{2}</span><span class="s1"> state&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_obj</span><span class="p">,</span> <span class="s1">&#39;failed to start&#39;</span><span class="p">,</span> <span class="n">job_obj</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
            <span class="k">while</span> <span class="n">job_objects</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;completed w/ one or more errors&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;failed&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Status of jobs </span><span class="si">{0}</span><span class="s1"> = </span><span class="si">{1}</span><span class="s1">, </span><span class="si">{2}</span><span class="s1"> = </span><span class="si">{3}</span><span class="s1">, </span><span class="si">{4}</span><span class="s1"> = </span><span class="si">{5}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job_objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job_objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                    <span class="n">job_objects</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job_objects</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                    <span class="n">job_objects</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job_objects</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Multiple dr jobs initiation is validated successfully&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;please pass the valid parameter type&#39;</span><span class="p">)</span></div></div>




</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>