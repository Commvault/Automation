

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Server.Alerts.alert_helper &mdash; Commvault Automation 11.20 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>Server.Alerts.alert_helper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Server.Alerts.alert_helper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main file for performing alert related operations for creation, mail parsing, cleanup of alerts.</span>

<span class="sd">AlertHelper and AlertSituations are 2 classes defined in this file</span>

<span class="sd">AlertHelper : Class containing utilities for various Alert Generation, Parsing Capabilities</span>
<span class="sd">AlertSituations : Class containing functions to trigger various alert situations</span>

<span class="sd">AlertHelper :</span>
<span class="sd">    __init__() : Initializes the logger object</span>

<span class="sd">    initialize_mailbox() : Initializes the mailbox object that will be used for parsing the mail and</span>
<span class="sd">    checking for alert notification</span>

<span class="sd">    get_alert_details() : Returns the alert dictionary format required by get_alert_json() in Alerts class</span>

<span class="sd">    create_alert() : Creates the alert from the given alert data</span>

<span class="sd">    check_if_alert_mail_received() : Parses through the mail to check if the Alert notification mail has been received</span>

<span class="sd">    check_if_rss_feed_received() : Reads through RSS Folder to check if alert notification was received</span>

<span class="sd">    get_sender() : Yields the name of the Alert notification sender</span>

<span class="sd">    get_notif_html() : Gets the notification HTML body required in the Alert XML</span>

<span class="sd">    get_token_id() : Fetches the token ID for given token rule group</span>

<span class="sd">    get_token_type_format() : Fetches the token type and token format for given token ID</span>

<span class="sd">    populate_token_rule_xml() : Populates the token rule part of Alert XML body</span>

<span class="sd">    populate_entities_xml() : Populates the Associations part of Alert XML body</span>

<span class="sd">    populate_criterias_xml() : Populates the Criterias part of Alert XML body</span>

<span class="sd">    populate_notification_xml() : Populates the Notification part of Alert XML body</span>

<span class="sd">    get_alert_xml() : Gets the alert XML body required for creating an Alert through QCommand Execute</span>

<span class="sd">    create_alert_from_xml() : Creates an Alert using QCommand Execute</span>

<span class="sd">    create_criteria_mapping() : Create a list of Criteria Name mappings from a list of criteria IDs</span>

<span class="sd">    delete_alert() : Deletes the alert created using Alert Helper</span>

<span class="sd">    cleanup() : Performs cleanup for all the objects defined in this class</span>

<span class="sd">AlertSituations:</span>
<span class="sd">    __init__() : Initializes the logger object</span>

<span class="sd">    backup_job() : Runs a backup job on a given subclient</span>

<span class="sd">    backup_generated_data() : Generates test data and runs a backup job on generated data</span>

<span class="sd">    low_disk_space_settings() : Adds additional settings to trigger low disk space situation</span>

<span class="sd">    cleanup_low_disk_space_settings() : Cleans up additional settings added for low disk space situation</span>

<span class="sd">    auxiliary_copy_job() : Runs an auxiliary copy job</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">html</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">cvpysdk.exception</span> <span class="kn">import</span> <span class="n">SDKException</span>
<span class="kn">from</span> <span class="nn">cvpysdk.policies.storage_policies</span> <span class="kn">import</span> <span class="n">StoragePolicy</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.machine</span> <span class="kn">import</span> <span class="n">Machine</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.mail_box</span> <span class="kn">import</span> <span class="n">MailBox</span><span class="p">,</span> <span class="n">EmailSearchFilter</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">logger</span><span class="p">,</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="kn">import</span> <span class="n">OptionsSelector</span>


<div class="viewcode-block" id="AlertHelper"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper">[docs]</a><span class="k">class</span> <span class="nc">AlertHelper</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for Alert Creation and other operations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alert_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alert_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize object of the AlertHelper class.</span>

<span class="sd">            Args:</span>
<span class="sd">                commcell_object (object)  --  instance of the Commcell class</span>
<span class="sd">                category (string) - Category of the alert to be created</span>
<span class="sd">                alert_type (string) - Type of the alert to be created</span>
<span class="sd">                alert_obj(obj) - existing alert&#39;s object for using existing alert.</span>

<span class="sd">            Returns:</span>
<span class="sd">                object - instance of the AlertHelper class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span> <span class="o">=</span> <span class="n">commcell_object</span><span class="o">.</span><span class="n">alerts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span> <span class="o">=</span> <span class="n">commcell_object</span>
        <span class="k">if</span> <span class="n">alert_obj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alert_category</span> <span class="o">=</span> <span class="n">alert_obj</span><span class="o">.</span><span class="n">alert_category</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alert_type</span> <span class="o">=</span> <span class="n">alert_obj</span><span class="o">.</span><span class="n">alert_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alert_name</span> <span class="o">=</span> <span class="n">alert_obj</span><span class="o">.</span><span class="n">alert_name</span>
        <span class="k">elif</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">alert_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ALERT_CATEGORY_TYPE</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">alert_type</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ALERT_CATEGORY_TYPE</span><span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span><span class="n">category</span><span class="p">)]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alert_category</span> <span class="o">=</span> <span class="n">category</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alert_type</span> <span class="o">=</span> <span class="n">alert_type</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Alert&#39;</span><span class="p">,</span> <span class="s1">&#39;102&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Alert Type not found in category </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Alert&#39;</span><span class="p">,</span> <span class="s1">&#39;102&#39;</span><span class="p">,</span> <span class="s1">&#39;Alert Category not found&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alert_type</span> <span class="o">=</span> <span class="n">alert_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alert_category</span> <span class="o">=</span> <span class="n">category</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alert_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_situations</span> <span class="o">=</span> <span class="n">AlertSituations</span><span class="p">(</span><span class="n">commcell_object</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> <span class="n">alert_type</span><span class="o">=</span><span class="n">alert_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mailbox</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="n">commcell_object</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">,</span> <span class="s1">&#39;16&#39;</span><span class="p">,</span> <span class="s1">&#39;17&#39;</span><span class="p">,</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span> <span class="s1">&#39;19&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;21&#39;</span><span class="p">,</span> <span class="s1">&#39;22&#39;</span><span class="p">,</span> <span class="s1">&#39;26&#39;</span><span class="p">,</span> <span class="s1">&#39;27&#39;</span><span class="p">,</span> <span class="s1">&#39;28&#39;</span><span class="p">,</span> <span class="s1">&#39;29&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;31&#39;</span><span class="p">,</span> <span class="s1">&#39;32&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;38&#39;</span><span class="p">,</span> <span class="s1">&#39;39&#39;</span><span class="p">,</span> <span class="s1">&#39;46&#39;</span><span class="p">,</span> <span class="s1">&#39;47&#39;</span><span class="p">,</span> <span class="s1">&#39;51&#39;</span><span class="p">,</span> <span class="s1">&#39;52&#39;</span><span class="p">,</span> <span class="s1">&#39;53&#39;</span><span class="p">,</span> <span class="s1">&#39;54&#39;</span><span class="p">,</span> <span class="s1">&#39;55&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;57&#39;</span><span class="p">,</span> <span class="s1">&#39;58&#39;</span><span class="p">,</span> <span class="s1">&#39;60&#39;</span><span class="p">,</span> <span class="s1">&#39;63&#39;</span><span class="p">,</span> <span class="s1">&#39;65&#39;</span><span class="p">,</span> <span class="s1">&#39;66&#39;</span><span class="p">,</span> <span class="s1">&#39;67&#39;</span><span class="p">,</span> <span class="s1">&#39;68&#39;</span><span class="p">,</span> <span class="s1">&#39;69&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;70&#39;</span><span class="p">,</span> <span class="s1">&#39;71&#39;</span><span class="p">,</span> <span class="s1">&#39;72&#39;</span><span class="p">,</span> <span class="s1">&#39;73&#39;</span><span class="p">,</span> <span class="s1">&#39;74&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_type</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;string_without_separator&#39;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="s1">&#39;DD_MM_YYYYDATE&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_details</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_xml</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_xml_dict</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="AlertHelper.initialize_mailbox"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.initialize_mailbox">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_mailbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize mailbox object.</span>
<span class="sd">           Initializes mailbox object with search parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">additional_settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Initializing Mailbox Object&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mailbox</span> <span class="o">=</span> <span class="n">MailBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mailbox</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
            <span class="c1"># Creating a search filter for the given subject</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;Alert: </span><span class="si">{0}</span><span class="s1"> Type: </span><span class="si">{1}</span><span class="s1"> - </span><span class="si">{2}</span><span class="s1">   &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_name</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">alert_category</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">alert_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_filter</span> <span class="o">=</span> <span class="n">EmailSearchFilter</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;set_unread_only&#39;</span> <span class="ow">in</span> <span class="n">additional_settings</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">search_filter</span><span class="o">.</span><span class="n">set_unread_only</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_filter</span><span class="o">.</span><span class="n">set_mail_sent_on</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_filter</span><span class="o">.</span><span class="n">set_sender_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sender</span><span class="p">())</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Mailbox Initialization Failed&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlertHelper.get_alert_details"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.get_alert_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_alert_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">notif_type</span><span class="p">,</span> <span class="n">entities</span><span class="p">,</span> <span class="n">users</span><span class="p">,</span> <span class="n">criteria</span><span class="p">,</span> <span class="n">mail_recipent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates dictionary of given alert details</span>

<span class="sd">            Args:</span>
<span class="sd">                name (string)  --  Name of the alert</span>
<span class="sd">                notif_type (list) - List of notification types to keep for the alert</span>
<span class="sd">                entities (dict) - Entities associated with the alert</span>

<span class="sd">                example dictionary :</span>
<span class="sd">                    entities={&#39;clients&#39;: self.tcinputs[&#39;ClientName&#39;]}</span>

<span class="sd">                users (list) - Users associated with the alert</span>
<span class="sd">                criteria (int) - Criteria for the alert</span>
<span class="sd">                mail_recipent (string) - Extra mail recipents to receive the alert notification</span>
<span class="sd">                params_list (list) - Extra params list if required by the given criteria</span>

<span class="sd">            Returns:</span>
<span class="sd">                dictionary - Alert data required to create an alert</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alert_details</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;alert_type&quot;</span><span class="p">:</span> <span class="n">constants</span><span class="o">.</span><span class="n">ALERT_CATEGORY_TYPE</span><span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_category</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alert_type</span><span class="p">),</span>
            <span class="s2">&quot;notif_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">ALERT_NOTIFICATIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">notif_type</span><span class="p">],</span>
            <span class="s2">&quot;notifTypeListOperationType&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;alert_severity&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;nonGalaxyUserOperationType&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;criteria&quot;</span><span class="p">:</span> <span class="n">criteria</span><span class="p">,</span>
            <span class="s2">&quot;associationOperationType&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;entities&quot;</span><span class="p">:</span> <span class="n">entities</span><span class="p">,</span>
            <span class="s2">&quot;userListOperationType&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;users&quot;</span><span class="p">:</span> <span class="n">users</span><span class="p">,</span>
            <span class="s2">&quot;alert_name&quot;</span><span class="p">:</span> <span class="n">name</span>
        <span class="p">}</span>
        <span class="c1"># Params list may be needed for some criteria types</span>
        <span class="c1"># Check if the criteria being passed requires a params List</span>

        <span class="k">if</span> <span class="n">params_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_list</span><span class="p">:</span>
            <span class="n">alert_details</span><span class="p">[</span><span class="s2">&quot;paramsList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_list</span>

        <span class="k">if</span> <span class="n">mail_recipent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">alert_details</span><span class="p">[</span><span class="s2">&quot;nonGalaxyList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nonGalaxyUserList&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;nonGalaxyUser&quot;</span><span class="p">:</span> <span class="n">mail_recipent</span><span class="p">}]}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alert_details</span> <span class="o">=</span> <span class="n">alert_details</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="n">alert_details</span></div>

<div class="viewcode-block" id="AlertHelper.create_alert"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.create_alert">[docs]</a>    <span class="k">def</span> <span class="nf">create_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an alert from given alert data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span><span class="o">.</span><span class="n">create_alert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_details</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Alert Creation Successful&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Alert Could not be created!&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlertHelper.check_if_alert_mail_received"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.check_if_alert_mail_received">[docs]</a>    <span class="k">def</span> <span class="nf">check_if_alert_mail_received</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short_interval</span><span class="p">,</span> <span class="n">patterns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads through mailbox to check if notification was received</span>

<span class="sd">            Args:</span>
<span class="sd">                short_interval (int)  -  Short time interval to wait for alert notification (in seconds)</span>
<span class="sd">                patterns (list) - List containing of patterns to search for in the mail</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool - If alert mail was received or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">got_alert_email</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Use this variable to keep track of Switch cases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wait till Alert Notification is received&#39;</span><span class="p">)</span>

        <span class="c1"># Check if Unread only is set to True or False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_filter</span><span class="o">.</span><span class="n">get_unread_only</span><span class="p">():</span>  <span class="c1"># Only Unread Mails</span>
            <span class="c1"># Check if there is a Single Criteria or Multiple Criterias to check</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_details</span><span class="p">[</span><span class="s1">&#39;criteria&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>  <span class="c1"># Only one alert criteria</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;==========================================================&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Checking Mail for Single Alert Criteria with Unread = True&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;==========================================================&#39;</span><span class="p">)</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># All mails, Read and Unread</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;===========================================================&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Checking Mail for Single Alert Criteria with Unread = False&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;===========================================================&#39;</span><span class="p">)</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="n">attempt</span> <span class="o">&lt;=</span> <span class="n">max_attempts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">got_alert_email</span><span class="p">:</span>
            <span class="c1"># Get Latest Mail UID, which is the last one in the list of UIDs</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_get_mail_uid_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_filter</span><span class="p">,</span> <span class="n">mail_folder</span><span class="o">=</span><span class="s1">&#39;INBOX&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Attempt [</span><span class="si">%s</span><span class="s1">] Searching for mail &#39;</span><span class="p">,</span> <span class="n">attempt</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;No Alert mail was found. List contains 0 matching mails&#39;</span><span class="p">)</span>
                <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">short_interval</span><span class="p">)</span>  <span class="c1"># Wait for the mail to come in the inbox</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;filtered&#39; has some mails for us to check</span>
                <span class="k">if</span> <span class="n">condition</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">uid_generated</span> <span class="o">=</span> <span class="n">filtered</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># The latest mail is the last one in the UIDs list</span>
                <span class="k">elif</span> <span class="n">condition</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">uid_generated</span> <span class="o">=</span> <span class="n">filtered</span>  <span class="c1"># Take the whole list, iterate through each UID and check mail body</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">condition</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Only check the latest mail</span>
                        <span class="n">got_alert_email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mailbox</span><span class="o">.</span><span class="n">check_if_mail_body_contains</span><span class="p">(</span><span class="n">mail_uid</span><span class="o">=</span><span class="n">uid_generated</span><span class="p">,</span>
                                                                                   <span class="n">pattern_list</span><span class="o">=</span><span class="n">patterns</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">condition</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Iterate through each UID in the filtered list and check if criteria matches</span>
                        <span class="c1"># Each iteration of going through all mail UIDS is contributing to 1 attempt only</span>
                        <span class="k">for</span> <span class="n">mail_uid</span> <span class="ow">in</span> <span class="n">filtered</span><span class="p">:</span>
                            <span class="n">got_alert_email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mailbox</span><span class="o">.</span><span class="n">check_if_mail_body_contains</span><span class="p">(</span><span class="n">mail_uid</span><span class="o">=</span><span class="n">mail_uid</span><span class="p">,</span>
                                                                                       <span class="n">pattern_list</span><span class="o">=</span><span class="n">patterns</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">got_alert_email</span><span class="p">:</span>  <span class="c1"># If Mail found is match break out of the loop</span>
                                <span class="k">break</span>

                    <span class="k">if</span> <span class="n">got_alert_email</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received Alert notification&quot;</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">short_interval</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">email_err</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Encountered an error while fetching alert : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">email_err</span><span class="p">)))</span>

        <span class="c1"># Check if Alert notification was received or not</span>
        <span class="k">if</span> <span class="n">got_alert_email</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No alert mail was received&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Didn&#39;t receive Alert notification&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlertHelper.check_if_rss_feed_received"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.check_if_rss_feed_received">[docs]</a>    <span class="k">def</span> <span class="nf">check_if_rss_feed_received</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short_interval</span><span class="p">,</span> <span class="n">patterns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads through RSS Folder to check if alert notification was received</span>

<span class="sd">            Args:</span>
<span class="sd">                short_interval (int)  -  Short time interval to wait for alert notification (in seconds)</span>
<span class="sd">                patterns (list) - List containing of patterns to search for in the RSS Html Body</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool - If alert RSS feed was received or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">got_rss_feed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wait till Alert Notification RSS Feed is Received&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cs_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">machine_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">commserv_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="p">)</span>
            <span class="n">base_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">commserv_client</span><span class="o">.</span><span class="n">install_directory</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">rss</span><span class="se">\\</span><span class="s2">alertDetail&quot;</span>
            <span class="k">while</span> <span class="n">attempt</span> <span class="o">&lt;=</span> <span class="n">max_attempts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">got_rss_feed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Attempt [</span><span class="si">%s</span><span class="s1">] Searching for RSS Feed &#39;</span><span class="p">,</span> <span class="n">attempt</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">short_interval</span><span class="p">)</span>
                <span class="n">latest_folder</span> <span class="o">=</span> <span class="n">cs_machine</span><span class="o">.</span><span class="n">get_latest_timestamp_file_or_folder</span><span class="p">(</span><span class="n">folder_path</span><span class="o">=</span><span class="n">base_folder</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">latest_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>

                <span class="n">alert_notif_file</span> <span class="o">=</span> <span class="n">cs_machine</span><span class="o">.</span><span class="n">get_files_in_path</span><span class="p">(</span><span class="n">latest_folder</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alert_notif_file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>
                    <span class="c1"># Two cases One file or More than One file</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alert_notif_file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">html_body</span> <span class="o">=</span> <span class="n">cs_machine</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">alert_notif_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># Check if Given patterns are present in HTML body or not</span>
                    <span class="n">got_rss_feed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mailbox</span><span class="o">.</span><span class="n">check_if_html_body_contains</span><span class="p">(</span><span class="n">html_body</span><span class="p">,</span> <span class="n">patterns</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">got_rss_feed</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Received RSS Feed Notification&#39;</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Encountered Exception while connecting to machine : </span><span class="si">{</span><span class="n">excp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">got_rss_feed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No alert RSS Feed was received&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Didn&#39;t receive Alert notification&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlertHelper.check_if_alert_saved"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.check_if_alert_saved">[docs]</a>    <span class="k">def</span> <span class="nf">check_if_alert_saved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short_interval</span><span class="p">,</span> <span class="n">patterns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads through Alerts Folder to check if alert notification was saved. Used for save to disk</span>
<span class="sd">           alert notifications</span>

<span class="sd">            Args:</span>
<span class="sd">                short_interval (int)  -  Short time interval to wait for alert notification (in seconds)</span>
<span class="sd">                patterns (list) - List containing of patterns to search for in the Alerts Html</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool - If alert notification was saved or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">got_saved_alert</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wait till Alert Notification is saved&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cs_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">machine_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">commserv_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="p">)</span>
            <span class="n">base_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">commserv_client</span><span class="o">.</span><span class="n">install_directory</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">alerts</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_name</span>
            <span class="k">while</span> <span class="n">attempt</span> <span class="o">&lt;=</span> <span class="n">max_attempts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">got_saved_alert</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Attempt [</span><span class="si">%s</span><span class="s1">] Searching for Saved Alert&#39;</span><span class="p">,</span> <span class="n">attempt</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">short_interval</span><span class="p">)</span>
                <span class="n">latest_folder</span> <span class="o">=</span> <span class="n">cs_machine</span><span class="o">.</span><span class="n">get_latest_timestamp_file_or_folder</span><span class="p">(</span><span class="n">folder_path</span><span class="o">=</span><span class="n">base_folder</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">latest_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>

                <span class="n">alert_notif_file</span> <span class="o">=</span> <span class="n">cs_machine</span><span class="o">.</span><span class="n">get_files_in_path</span><span class="p">(</span><span class="n">latest_folder</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alert_notif_file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>
                    <span class="c1"># Two cases One file or More than One file</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alert_notif_file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">html_body</span> <span class="o">=</span> <span class="n">cs_machine</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">alert_notif_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># Check if Given patterns are present in HTML body or not</span>
                    <span class="n">got_saved_alert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mailbox</span><span class="o">.</span><span class="n">check_if_html_body_contains</span><span class="p">(</span><span class="n">html_body</span><span class="p">,</span> <span class="n">patterns</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">got_saved_alert</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Received Saved Alert Notification&#39;</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Encountered Exception while connecting to machine : </span><span class="si">{</span><span class="n">excp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">got_saved_alert</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No alert RSS Feed was received&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Didn&#39;t receive Alert notification&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlertHelper.check_if_event_logged"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.check_if_event_logged">[docs]</a>    <span class="k">def</span> <span class="nf">check_if_event_logged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short_interval</span><span class="p">,</span> <span class="n">patterns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads through Windows Event Viewer logs to check if alert notification was received. Used for save to disk</span>
<span class="sd">           Event viewer alert notifications</span>

<span class="sd">            Args:</span>
<span class="sd">                short_interval (int)  -  Short time interval to wait for alert notification (in seconds)</span>
<span class="sd">                patterns (list) - List containing of patterns to search for in the Event log body</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool - If alert event viewer notification was received or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cs_machine_obj</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">commserv_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="p">)</span>
        <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">got_saved_alert</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">pattern_match</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wait till Alert Notification is Received&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">attempt</span> <span class="o">&lt;=</span> <span class="n">max_attempts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">got_saved_alert</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Attempt [</span><span class="si">%s</span><span class="s1">] Searching for Alert notification in Event Log&#39;</span><span class="p">,</span> <span class="n">attempt</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">short_interval</span><span class="p">)</span>

            <span class="c1"># Try getting event message</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">message_body</span> <span class="o">=</span> <span class="n">cs_machine_obj</span><span class="o">.</span><span class="n">get_event_viewer_logs_message</span><span class="p">()</span>
                <span class="c1"># Parse output to check for patterns</span>
                <span class="n">pattern_match</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">match_criteria</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">match_criteria</span><span class="p">,</span> <span class="n">message_body</span><span class="p">)):</span>
                        <span class="n">pattern_match</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="n">pattern_match</span><span class="p">:</span>
                    <span class="n">got_saved_alert</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Received Event Viewer Alert Notification&#39;</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">command_execute_excp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Encountered Exception while executing command : </span><span class="si">{</span><span class="n">command_execute_excp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">got_saved_alert</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No alert RSS Feed was received&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Didn&#39;t receive Alert notification&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlertHelper.get_sender"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.get_sender">[docs]</a>    <span class="k">def</span> <span class="nf">get_sender</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize object of the AlertHelper class.</span>

<span class="sd">            Returns:</span>
<span class="sd">                string - Sender name for the alert notification mail</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span><span class="o">.</span><span class="n">get_alert_sender</span><span class="p">()</span></div>

<div class="viewcode-block" id="AlertHelper.get_notif_html"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.get_notif_html">[docs]</a>    <span class="k">def</span> <span class="nf">get_notif_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">notif_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches the notification html required to be put in the XML request for given alert type</span>

<span class="sd">            Args:</span>
<span class="sd">                notif_type (int)  --  Notification ID for which to fetch the notifMessageHtml</span>

<span class="sd">            Returns:</span>
<span class="sd">                (string) - Returns notiication message html, Escaped notification html</span>

<span class="sd">        NOTE : This fetches the notification html where message format Type Email is</span>
<span class="sd">               supported otherwise it gets plain text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message_format_type</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">supported_html</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">8192</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">notif_type</span> <span class="ow">in</span> <span class="n">supported_html</span><span class="p">:</span>
            <span class="n">message_format_type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">alert_type</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">ALERT_CATEGORY_TYPE</span><span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_category</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_type</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;select * from NTnotificationTemplate where ntalerttypeid=</span><span class="si">{</span><span class="n">alert_type</span><span class="si">}</span><span class="s2">&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot; and locale=0 and messageType=</span><span class="si">{</span><span class="n">notif_type</span><span class="si">}</span><span class="s2"> and messageFormatType = </span><span class="si">{</span><span class="n">message_format_type</span><span class="si">}</span><span class="s2">;&quot;</span>
        <span class="n">db_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span><span class="o">.</span><span class="n">update_commserve_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="c1"># Extract The format html from the response</span>
        <span class="n">notif_html</span> <span class="o">=</span> <span class="n">db_response</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;defaultformatString&#39;</span><span class="p">]</span>
        <span class="c1"># Escape this html to make it suitable for XML request body</span>
        <span class="n">escaped_html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span><span class="si">{</span><span class="n">notif_html</span><span class="si">}</span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">notif_html</span><span class="p">,</span> <span class="n">escaped_html</span></div>

<div class="viewcode-block" id="AlertHelper.get_token_id"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.get_token_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_token_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token_rule_group</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches the token ID for given token rule group</span>

<span class="sd">            Args:</span>
<span class="sd">                token_rule_group (string)  --  Token Rule Group name</span>

<span class="sd">            Returns:</span>
<span class="sd">                (int) - Returns Token ID for given rule group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;select MessageID from evlocalemsgs where   localeid=0 and message =&#39;&lt;</span><span class="si">{</span><span class="n">token_rule_group</span><span class="si">}</span><span class="s1">&gt;&#39;;&#39;&#39;&#39;</span>
        <span class="n">db_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span><span class="o">.</span><span class="n">update_commserve_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="c1"># Extract the MessageID value from the response</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">db_response</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Response returned more than 1 rows&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">token_id</span> <span class="o">=</span> <span class="n">db_response</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MessageID&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">token_id</span></div>

<div class="viewcode-block" id="AlertHelper.get_token_type_format"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.get_token_type_format">[docs]</a>    <span class="k">def</span> <span class="nf">get_token_type_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches the token type and token format for given token ID</span>

<span class="sd">            Args:</span>
<span class="sd">                token_id (string)  --  Token ID</span>

<span class="sd">            Returns:</span>
<span class="sd">                (tuple) - Returns Token type and token format values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;select * from NTmessageTokensForAlert where tokenID=</span><span class="si">{</span><span class="n">token_id</span><span class="si">}</span><span class="s1">;&#39;&#39;&#39;</span>
        <span class="n">db_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span><span class="o">.</span><span class="n">update_commserve_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="c1"># Extract data from the first row</span>
        <span class="k">return</span> <span class="n">db_response</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;tokenType&#39;</span><span class="p">],</span> <span class="n">db_response</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;tokenInputFormat&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="AlertHelper.populate_token_rule_xml"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.populate_token_rule_xml">[docs]</a>    <span class="k">def</span> <span class="nf">populate_token_rule_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token_rule</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Populates the token rule part of Alert XML body</span>

<span class="sd">            Args:</span>
<span class="sd">                token_rule (dict)  --  Token Rule dictionary passed in **kwargs in get_alert_xml()</span>

<span class="sd">                example arguments :</span>
<span class="sd">                    token_rule={&#39;rule&#39;: &#39;LEVEL&#39;,&#39;value&#39;: &#39;FULL&#39;,&#39;operator&#39;: 0}</span>
<span class="sd">            Returns:</span>
<span class="sd">                string - Token rule part for alert xml</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">token_rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rule&#39;</span><span class="p">)</span>
        <span class="n">operator</span> <span class="o">=</span> <span class="n">token_rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operator&#39;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">token_rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="c1"># Fetch Token ID for given Token Rule</span>
        <span class="n">token_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_token_id</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="c1"># Fetch token type and format</span>
        <span class="n">token_type</span><span class="p">,</span> <span class="n">token_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_token_type_format</span><span class="p">(</span><span class="n">token_id</span><span class="p">)</span>
        <span class="n">rule_group_xml</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&amp;lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&amp;gt;&amp;lt;CVGui_AlertTokenRuleGroup </span>
<span class="s1">                             groupOperator=&amp;quot;0&amp;quot;&amp;gt;&amp;lt;rules groupOperator=&amp;quot;0&amp;quot;&amp;gt;&amp;lt;rules </span>
<span class="s1">                             groupOperator=&amp;quot;2&amp;quot;&amp;gt;&amp;lt;alertTokenRule tokenMessage=&amp;quot;</span><span class="si">{</span><span class="n">rule</span><span class="si">}</span><span class="s1">&amp;quot; </span>
<span class="s1">                             tokenId=&amp;quot;</span><span class="si">{</span><span class="n">token_id</span><span class="si">}</span><span class="s1">&amp;quot; tokenType=&amp;quot;</span><span class="si">{</span><span class="n">token_type</span><span class="si">}</span><span class="s1">&amp;quot;</span>
<span class="s1">                             tokenFormat=&amp;quot;</span><span class="si">{</span><span class="n">token_format</span><span class="si">}</span><span class="s1">&amp;quot; </span>
<span class="s1">                             value=&amp;quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&amp;quot; tokenOperator=&amp;quot;</span><span class="si">{</span><span class="n">operator</span><span class="si">}</span><span class="s1">&amp;quot;</span>
<span class="s1">                             /&amp;gt;&amp;lt;/rules&amp;gt;&amp;lt;/rules&amp;gt;</span>
<span class="s1">                             &amp;lt;/CVGui_AlertTokenRuleGroup&amp;gt;&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">rule_group_xml</span></div>

<div class="viewcode-block" id="AlertHelper.populate_entities_xml"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.populate_entities_xml">[docs]</a>    <span class="k">def</span> <span class="nf">populate_entities_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_group_xml</span><span class="p">,</span> <span class="n">entities</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Populates the Associations part of Alert XML body</span>

<span class="sd">            Args:</span>
<span class="sd">                rule_group_xml (string)  --  Rule group XML generated through populate_token_rule_xml()</span>

<span class="sd">            Returns:</span>
<span class="sd">                string - Associations part for alert xml</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">associations</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;alertDetail alertSeverity=&quot;0&quot; alertTokenRuleGroupXml=&quot;</span><span class="si">{</span><span class="n">rule_group_xml</span><span class="si">}</span><span class="s1">&quot; </span>
<span class="s1">                            checkForEventParams=&quot;0&quot; </span>
<span class="s1">                            customQueryDetailsXml=&quot;&quot; escalationSeverity=&quot;0&quot; eventCriteriaXML=&quot;&quot; </span>
<span class="s1">        minJobCountForJobAnomaly=&quot;0&quot; periodicNotificationInterval=&quot;0&quot; recipient=&quot;&quot; senderDisplayName=&quot;&quot; senderEmailId=&quot;&quot;</span>
<span class="s1">         xmlEntityList=&quot;&amp;lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&amp;gt;&amp;lt;CVGui_CommCellTreeNode&amp;gt;&amp;lt;&#39;&#39;&#39;</span>
        <span class="n">entities_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span><span class="o">.</span><span class="n">_get_entities</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities_list</span><span class="p">:</span>
            <span class="n">name_attribute</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">id_attribute</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">association_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;associations </span><span class="si">{</span><span class="n">name_attribute</span><span class="si">}</span><span class="s2">=&amp;quot;</span><span class="si">{</span><span class="n">entity</span><span class="p">[</span><span class="n">name_attribute</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;quot; &quot;</span> \
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">id_attribute</span><span class="si">}</span><span class="s2">=&amp;quot;</span><span class="si">{</span><span class="n">entity</span><span class="p">[</span><span class="n">id_attribute</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;quot; _type_=&amp;quot;</span><span class="si">{</span><span class="n">entity</span><span class="p">[</span><span class="s1">&#39;_type_&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> \
                                 <span class="sa">f</span><span class="s2">&quot;&amp;quot;&amp;gt;&amp;lt;flags exclude=&amp;quot;0&amp;quot; /&amp;gt;&amp;lt;/associations&amp;gt;&amp;lt;&quot;</span>
            <span class="n">associations</span> <span class="o">+=</span> <span class="n">association_string</span>
        <span class="n">associations</span> <span class="o">+=</span> <span class="s1">&#39;/CVGui_CommCellTreeNode&amp;gt;&quot;&gt;&#39;</span>
        <span class="k">return</span> <span class="n">associations</span></div>

<div class="viewcode-block" id="AlertHelper.populate_criterias_xml"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.populate_criterias_xml">[docs]</a>    <span class="k">def</span> <span class="nf">populate_criterias_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">additional_settings</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Populates the Criterias part of Alert XML body</span>

<span class="sd">            Args:</span>
<span class="sd">                additional_settings (dict)  --  Additional settings dict generated from **kwargs</span>
<span class="sd">                passed in get_alert_xml()</span>
<span class="sd">                criteria (list)             --  List of Criteria IDs to be selected for the alert</span>

<span class="sd">            Returns:</span>
<span class="sd">                string - Criterias part for alert xml</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Additional settings are used for configuring alert notification</span>
        <span class="c1"># settings like Delay, Notify Only if condition persists, escalate notification criteria</span>
        <span class="n">criterias</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">delay_time_seconds</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">persist_time_seconds</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">reporting_options</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">escalate_criteria</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;notification_criteria&#39;</span> <span class="ow">in</span> <span class="n">additional_settings</span><span class="p">:</span>
            <span class="n">reporting_enum</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">delay_time_seconds</span> <span class="o">=</span> <span class="n">additional_settings</span><span class="p">[</span><span class="s1">&#39;notification_criteria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;notify_if_persists&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">persist_time_seconds</span> <span class="o">=</span> <span class="n">additional_settings</span><span class="p">[</span><span class="s1">&#39;notification_criteria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;repeat_notif&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Either of these conditions could be selected</span>
            <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">additional_settings</span><span class="p">[</span><span class="s1">&#39;notification_criteria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">condition</span> <span class="o">==</span> <span class="s1">&#39;notify_if_persists&#39;</span><span class="p">:</span>
                    <span class="n">reporting_enum</span> <span class="o">+=</span> <span class="mi">256</span>
                <span class="k">elif</span> <span class="n">condition</span> <span class="o">==</span> <span class="s1">&#39;repeat_notif&#39;</span><span class="p">:</span>
                    <span class="n">reporting_enum</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">condition</span> <span class="o">==</span> <span class="s1">&#39;notify_condition_clears&#39;</span><span class="p">:</span>
                    <span class="n">reporting_enum</span> <span class="o">+=</span> <span class="mi">4</span>
            <span class="n">reporting_options</span> <span class="o">=</span> <span class="n">reporting_enum</span>

        <span class="c1"># Check if escalation paramaters are provided</span>
        <span class="k">if</span> <span class="s1">&#39;escalation_criteria&#39;</span> <span class="ow">in</span> <span class="n">additional_settings</span><span class="p">:</span>
            <span class="n">reporting_enum_escalation</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">escalate_criteria</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">delay_time_seconds_escalation</span> <span class="o">=</span> <span class="n">additional_settings</span><span class="p">[</span><span class="s1">&#39;escalation_criteria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;notify_if_persists&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">persist_time_seconds_escalation</span> <span class="o">=</span> <span class="n">additional_settings</span><span class="p">[</span><span class="s1">&#39;escalation_criteria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;repeat_notif&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Either of these conditions could be selected</span>
            <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">additional_settings</span><span class="p">[</span><span class="s1">&#39;escalation_criteria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">condition</span> <span class="o">==</span> <span class="s1">&#39;notify_if_persists&#39;</span><span class="p">:</span>
                    <span class="n">reporting_enum_escalation</span> <span class="o">+=</span> <span class="mi">8</span>
                <span class="k">elif</span> <span class="n">condition</span> <span class="o">==</span> <span class="s1">&#39;repeat_notif&#39;</span><span class="p">:</span>
                    <span class="n">reporting_enum_escalation</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">condition</span> <span class="o">==</span> <span class="s1">&#39;notify_condition_clears&#39;</span><span class="p">:</span>
                    <span class="n">reporting_enum_escalation</span> <span class="o">+=</span> <span class="mi">4</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">current_criteria</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;criteria criteriaId=&quot;</span><span class="si">{</span><span class="n">criteria</span><span class="si">}</span><span class="s1">&quot; criteriaSeverity=&quot;0&quot; delayTimeSeconds=&quot;</span><span class="si">{</span><span class="n">delay_time_seconds</span><span class="si">}</span><span class="s1">&quot;&#39;</span> \
                               <span class="sa">f</span><span class="s1">&#39; esclationLevel=&quot;1&quot; persistTimeSeconds=&quot;</span><span class="si">{</span><span class="n">persist_time_seconds</span><span class="si">}</span><span class="s1">&quot; reportId=&quot;0&quot;&#39;</span> \
                               <span class="sa">f</span><span class="s1">&#39; reportingOptions=&quot;</span><span class="si">{</span><span class="n">reporting_options</span><span class="si">}</span><span class="s1">&quot; taskId=&quot;0&quot; value=&quot;&quot; /&gt;&#39;</span>
            <span class="k">if</span> <span class="n">escalate_criteria</span><span class="p">:</span>
                <span class="n">current_criteria</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;criteria criteriaId=&quot;</span><span class="si">{</span><span class="n">criteria</span><span class="si">}</span><span class="s1">&quot; criteriaSeverity=&quot;0&quot; &#39;</span> \
                                    <span class="sa">f</span><span class="s1">&#39;delayTimeSeconds=&quot;</span><span class="si">{</span><span class="n">delay_time_seconds_escalation</span><span class="si">}</span><span class="s1">&quot;&#39;</span> \
                                       <span class="sa">f</span><span class="s1">&#39; esclationLevel=&quot;2&quot; &#39;</span> \
                                    <span class="sa">f</span><span class="s1">&#39;persistTimeSeconds=&quot;</span><span class="si">{</span><span class="n">persist_time_seconds_escalation</span><span class="si">}</span><span class="s1">&quot; reportId=&quot;0&quot;&#39;</span> \
                                       <span class="sa">f</span><span class="s1">&#39; reportingOptions=&quot;</span><span class="si">{</span><span class="n">reporting_enum_escalation</span><span class="si">}</span><span class="s1">&quot; taskId=&quot;0&quot; value=&quot;&quot; /&gt;&#39;</span>
            <span class="n">criterias</span> <span class="o">+=</span> <span class="n">current_criteria</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If notification_criteria is in additional settings then set values</span>

            <span class="k">for</span> <span class="n">criteria_id</span> <span class="ow">in</span> <span class="n">criteria</span><span class="p">:</span>
                <span class="n">current_criteria</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;criteria criteriaId=&quot;</span><span class="si">{</span><span class="n">criteria_id</span><span class="si">}</span><span class="s1">&quot; criteriaSeverity=&quot;0&quot; &#39;</span> \
                                   <span class="sa">f</span><span class="s1">&#39;delayTimeSeconds=&quot;</span><span class="si">{</span><span class="n">delay_time_seconds</span><span class="si">}</span><span class="s1">&quot;&#39;</span> \
                                   <span class="sa">f</span><span class="s1">&#39; esclationLevel=&quot;1&quot; persistTimeSeconds=&quot;</span><span class="si">{</span><span class="n">persist_time_seconds</span><span class="si">}</span><span class="s1">&quot; reportId=&quot;0&quot;&#39;</span> \
                                   <span class="sa">f</span><span class="s1">&#39; reportingOptions=&quot;</span><span class="si">{</span><span class="n">reporting_options</span><span class="si">}</span><span class="s1">&quot; taskId=&quot;0&quot; value=&quot;&quot; /&gt;&#39;</span>
                <span class="k">if</span> <span class="n">escalate_criteria</span><span class="p">:</span>
                    <span class="n">current_criteria</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;criteria criteriaId=&quot;</span><span class="si">{</span><span class="n">criteria</span><span class="si">}</span><span class="s1">&quot; criteriaSeverity=&quot;0&quot; &#39;</span> \
                                        <span class="sa">f</span><span class="s1">&#39;delayTimeSeconds=&quot;</span><span class="si">{</span><span class="n">delay_time_seconds_escalation</span><span class="si">}</span><span class="s1">&quot;&#39;</span> \
                                        <span class="sa">f</span><span class="s1">&#39; esclationLevel=&quot;2&quot; persistTimeSeconds=&quot;</span><span class="si">{</span><span class="n">persist_time_seconds_escalation</span><span class="si">}</span><span class="s1">&quot; &#39;</span> \
                                        <span class="sa">f</span><span class="s1">&#39;reportId=&quot;0&quot;&#39;</span> \
                                        <span class="sa">f</span><span class="s1">&#39; reportingOptions=&quot;</span><span class="si">{</span><span class="n">reporting_enum_escalation</span><span class="si">}</span><span class="s1">&quot; taskId=&quot;0&quot; value=&quot;&quot; /&gt;&#39;</span>
                <span class="n">criterias</span> <span class="o">+=</span> <span class="n">current_criteria</span>

        <span class="k">return</span> <span class="n">criterias</span></div>

<div class="viewcode-block" id="AlertHelper.populate_notification_xml"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.populate_notification_xml">[docs]</a>    <span class="k">def</span> <span class="nf">populate_notification_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">notif_type</span><span class="p">,</span> <span class="n">escalate_notification</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Populates the Notification part of Alert XML body</span>

<span class="sd">            Args:</span>
<span class="sd">                notif_type (list) - List of notification types to keep for the alert</span>

<span class="sd">            Returns:</span>
<span class="sd">                string - Notifications part for alert xml</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">notifs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">notification</span> <span class="ow">in</span> <span class="n">notif_type</span><span class="p">:</span>
            <span class="c1"># Get notification html for current notification type</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">notif_html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_notif_html</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
            <span class="c1"># Only if alert has escalation criteria inject escalation notification message</span>
            <span class="c1"># For RSS Feed, Save Alert to Disk some additional metadeta is needed</span>
            <span class="k">if</span> <span class="n">notification</span> <span class="o">==</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># RSS Feed</span>
                <span class="n">base_location</span> <span class="o">=</span> <span class="s1">&#39;http://&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">commserv_hostname</span> <span class="o">+</span> <span class="s1">&#39;:81/rss&#39;</span>
                <span class="n">selected_channel</span> <span class="o">=</span> <span class="s1">&#39;alerts.rss&#39;</span>
                <span class="n">current</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;notifMsgs esclationLevel=&quot;1&quot; localeId=&quot;0&quot; messageFormat=&quot;0&quot; </span>
<span class="s1">                               notifMessage=&quot;</span><span class="si">{</span><span class="n">notif_html</span><span class="si">}</span><span class="s1">&quot; notifMessageHtml=&quot;&quot;</span>
<span class="s1">                               notifOptions=&quot;0&quot; notifType=&quot;</span><span class="si">{</span><span class="n">notification</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;saveAlertToDisk alertLocation=&quot;&quot;</span>
<span class="s1">                               cvpassword=&quot;&quot; impersonateUser=&quot;0&quot; loginName=&quot;&quot; password=&quot;&quot; useNetworkShare=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;feeds baseLocation=&quot;</span><span class="si">{</span><span class="n">base_location</span><span class="si">}</span><span class="s1">&quot; rssFeedLocation=&quot;&quot; </span>
<span class="s1">                               selectedChannel=&quot;</span><span class="si">{</span><span class="n">selected_channel</span><span class="si">}</span><span class="s1">&quot; seperateIndex=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;entity _type_=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;/notifMsgs&gt;&#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="n">escalate_notification</span><span class="p">:</span>
                    <span class="n">current</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;notifMsgs esclationLevel=&quot;2&quot; localeId=&quot;0&quot; messageFormat=&quot;0&quot; </span>
<span class="s1">                                    notifMessage=&quot;</span><span class="si">{</span><span class="n">notif_html</span><span class="si">}</span><span class="s1">&quot; notifMessageHtml=&quot;&quot;</span>
<span class="s1">                                    notifOptions=&quot;0&quot; notifType=&quot;</span><span class="si">{</span><span class="n">notification</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;saveAlertToDisk alertLocation=&quot;&quot;</span>
<span class="s1">                                    cvpassword=&quot;&quot; impersonateUser=&quot;0&quot; loginName=&quot;&quot; password=&quot;&quot; useNetworkShare=&quot;0&quot; /&gt;</span>
<span class="s1">                                    &lt;feeds baseLocation=&quot;&quot; rssFeedLocation=&quot;&quot; selectedChannel=&quot;&quot; seperateIndex=&quot;0&quot; /&gt;</span>
<span class="s1">                                    &lt;entity _type_=&quot;0&quot; /&gt;</span>
<span class="s1">                                    &lt;/notifMsgs&gt;&#39;&#39;&#39;</span>

            <span class="k">elif</span> <span class="n">notification</span> <span class="o">==</span> <span class="mi">512</span><span class="p">:</span>  <span class="c1"># Save to Disk</span>
                <span class="n">base_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">commserv_client</span><span class="o">.</span><span class="n">install_directory</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">alerts&#39;</span>
                <span class="n">current</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;notifMsgs esclationLevel=&quot;1&quot; localeId=&quot;0&quot; messageFormat=&quot;1&quot; </span>
<span class="s1">                               notifMessageHtml=&quot;</span><span class="si">{</span><span class="n">notif_html</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                               notifOptions=&quot;0&quot; notifType=&quot;</span><span class="si">{</span><span class="n">notification</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;saveAlertToDisk </span>
<span class="s1">                               alertLocation=&quot;</span><span class="si">{</span><span class="n">base_location</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                               cvpassword=&quot;&quot; impersonateUser=&quot;0&quot; loginName=&quot;&quot; password=&quot;&quot; useNetworkShare=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;feeds baseLocation=&quot;&quot; rssFeedLocation=&quot;&quot; selectedChannel=&quot;&quot; seperateIndex=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;entity _type_=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;/notifMsgs&gt;&#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="n">escalate_notification</span><span class="p">:</span>
                    <span class="n">current</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;notifMsgs esclationLevel=&quot;2&quot; localeId=&quot;0&quot; messageFormat=&quot;1&quot; </span>
<span class="s1">                                   notifMessageHtml=&quot;</span><span class="si">{</span><span class="n">notif_html</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                                   notifOptions=&quot;0&quot; notifType=&quot;</span><span class="si">{</span><span class="n">notification</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;saveAlertToDisk alertLocation=&quot;&quot;</span>
<span class="s1">                                   cvpassword=&quot;&quot; impersonateUser=&quot;0&quot; loginName=&quot;&quot; password=&quot;&quot; useNetworkShare=&quot;0&quot; /&gt;</span>
<span class="s1">                                   &lt;feeds baseLocation=&quot;&quot; rssFeedLocation=&quot;&quot; selectedChannel=&quot;&quot; seperateIndex=&quot;0&quot; /&gt;</span>
<span class="s1">                                   &lt;entity _type_=&quot;0&quot; /&gt;</span>
<span class="s1">                                   &lt;/notifMsgs&gt;&#39;&#39;&#39;</span>
            <span class="k">elif</span> <span class="n">notification</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># Event Viewer</span>
                <span class="n">current</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;notifMsgs esclationLevel=&quot;1&quot; localeId=&quot;0&quot; messageFormat=&quot;0&quot; notifMessage=&quot;</span><span class="si">{</span><span class="n">notif_html</span><span class="si">}</span><span class="s1">&quot; </span>
<span class="s1">                               notifMessageHtml=&quot;&amp;lt;p&amp;gt; &amp;lt;/p&amp;gt;&quot;</span>
<span class="s1">                               notifOptions=&quot;0&quot; notifType=&quot;</span><span class="si">{</span><span class="n">notification</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;saveAlertToDisk alertLocation=&quot;&quot;</span>
<span class="s1">                               cvpassword=&quot;&quot; impersonateUser=&quot;0&quot; loginName=&quot;&quot; password=&quot;&quot; useNetworkShare=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;feeds baseLocation=&quot;&quot; rssFeedLocation=&quot;&quot; selectedChannel=&quot;&quot; seperateIndex=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;entity _type_=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;/notifMsgs&gt;&#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="n">escalate_notification</span><span class="p">:</span>
                    <span class="n">current</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;notifMsgs esclationLevel=&quot;2&quot; localeId=&quot;0&quot; messageFormat=&quot;0&quot; notifMessage=&quot;</span><span class="si">{</span><span class="n">notif_html</span><span class="si">}</span><span class="s1">&quot; </span>
<span class="s1">                                    notifMessageHtml=&quot;&amp;lt;p&amp;gt; &amp;lt;/p&amp;gt;&quot;</span>
<span class="s1">                                    notifOptions=&quot;0&quot; notifType=&quot;</span><span class="si">{</span><span class="n">notification</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;saveAlertToDisk alertLocation=&quot;&quot;</span>
<span class="s1">                                    cvpassword=&quot;&quot; impersonateUser=&quot;0&quot; loginName=&quot;&quot; password=&quot;&quot; useNetworkShare=&quot;0&quot; /&gt;</span>
<span class="s1">                                    &lt;feeds baseLocation=&quot;&quot; rssFeedLocation=&quot;&quot; selectedChannel=&quot;&quot; seperateIndex=&quot;0&quot; /&gt;</span>
<span class="s1">                                    &lt;entity _type_=&quot;0&quot; /&gt;</span>
<span class="s1">                                    &lt;/notifMsgs&gt;&#39;&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;notifMsgs esclationLevel=&quot;1&quot; localeId=&quot;0&quot; messageFormat=&quot;1&quot; notifMessageHtml=&quot;</span><span class="si">{</span><span class="n">notif_html</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                               notifOptions=&quot;0&quot; notifType=&quot;</span><span class="si">{</span><span class="n">notification</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;saveAlertToDisk alertLocation=&quot;&quot;</span>
<span class="s1">                               cvpassword=&quot;&quot; impersonateUser=&quot;0&quot; loginName=&quot;&quot; password=&quot;&quot; useNetworkShare=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;feeds baseLocation=&quot;&quot; rssFeedLocation=&quot;&quot; selectedChannel=&quot;&quot; seperateIndex=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;entity _type_=&quot;0&quot; /&gt;</span>
<span class="s1">                               &lt;/notifMsgs&gt;&#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="n">escalate_notification</span><span class="p">:</span>
                    <span class="n">current</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;notifMsgs esclationLevel=&quot;2&quot; localeId=&quot;0&quot; messageFormat=&quot;1&quot; notifMessageHtml=&quot;</span><span class="si">{</span><span class="n">notif_html</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                                    notifOptions=&quot;0&quot; notifType=&quot;</span><span class="si">{</span><span class="n">notification</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;saveAlertToDisk alertLocation=&quot;&quot;</span>
<span class="s1">                                    cvpassword=&quot;&quot; impersonateUser=&quot;0&quot; loginName=&quot;&quot; password=&quot;&quot; useNetworkShare=&quot;0&quot; /&gt;</span>
<span class="s1">                                    &lt;feeds baseLocation=&quot;&quot; rssFeedLocation=&quot;&quot; selectedChannel=&quot;&quot; seperateIndex=&quot;0&quot; /&gt;</span>
<span class="s1">                                    &lt;entity _type_=&quot;0&quot; /&gt;</span>
<span class="s1">                                    &lt;/notifMsgs&gt;&#39;&#39;&#39;</span>
            <span class="n">notifs</span> <span class="o">+=</span> <span class="n">current</span>
        <span class="k">return</span> <span class="n">notifs</span></div>

<div class="viewcode-block" id="AlertHelper.get_alert_xml"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.get_alert_xml">[docs]</a>    <span class="k">def</span> <span class="nf">get_alert_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">notif_type</span><span class="p">,</span> <span class="n">entities</span><span class="p">,</span> <span class="n">criteria</span><span class="p">,</span> <span class="n">mail_recipent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates Request XML of given alert details. Calls subfunctions for populating subsections of the XML.</span>
<span class="sd">           Compiles all subsection XMLs into a final one, which is used for creating the Alert.</span>

<span class="sd">            Args:</span>
<span class="sd">                name (string)  --  Name of the alert</span>
<span class="sd">                notif_type (list) - List of notification types to keep for the alert</span>
<span class="sd">                entities (dict) - Entities associated with the alert</span>

<span class="sd">                example dictionary :</span>
<span class="sd">                    entities={&#39;clients&#39;: self.tcinputs[&#39;ClientName&#39;]}</span>

<span class="sd">                criteria (list) - List of Criteria IDs to be selected for the alert</span>
<span class="sd">                mail_recipent (list) - List of extra mail recipents to receive the alert notification</span>
<span class="sd">                **kwargs (dict) - Additional arguments which the user may want for his alert</span>

<span class="sd">            Returns:</span>
<span class="sd">                string - Alert XML string required for QEXECUTE COMMAND</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">additional_settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">notif_type</span> <span class="o">=</span> <span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">ALERT_NOTIFICATIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">notif_type</span><span class="p">]</span>
        <span class="c1"># The Request XML is divided into parts, certain parts are populated as required based on the inputs</span>
        <span class="c1"># HEADER FOR THE REQUEST</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="s1">                    &lt;CVGui_AlertCreateReq ownerId=&quot;1&quot;&gt;</span>
<span class="s1">                       &lt;processinginstructioninfo&gt;</span>
<span class="s1">                          &lt;user _type_=&quot;13&quot; userId=&quot;1&quot; userName=&quot;admin&quot; /&gt;</span>
<span class="s1">                          &lt;locale _type_=&quot;66&quot; localeId=&quot;0&quot; /&gt;</span>
<span class="s1">                          &lt;formatFlags continueOnError=&quot;0&quot; elementBased=&quot;0&quot; filterUnInitializedFields=&quot;0&quot; </span>
<span class="s1">                          formatted=&quot;0&quot; ignoreUnknownTags=&quot;1&quot; skipIdToNameConversion=&quot;1&quot; skipNameToIdConversion=&quot;0&quot; /&gt;</span>
<span class="s1">                    &lt;/processinginstructioninfo&gt;&#39;&#39;&#39;</span>

        <span class="c1"># TOKEN RULE FILTERS</span>
        <span class="n">rule_group_xml</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;token_rule&#39;</span> <span class="ow">in</span> <span class="n">additional_settings</span><span class="p">:</span>
            <span class="c1"># Only supports one token Rule at present</span>
            <span class="n">token_rule</span> <span class="o">=</span> <span class="n">additional_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token_rule&#39;</span><span class="p">)</span>
            <span class="n">rule_group_xml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_token_rule_xml</span><span class="p">(</span><span class="n">token_rule</span><span class="o">=</span><span class="n">token_rule</span><span class="p">)</span>

        <span class="c1"># ENTITY ASSOCIATIONS</span>
        <span class="n">associations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_entities_xml</span><span class="p">(</span><span class="n">rule_group_xml</span><span class="p">,</span> <span class="n">entities</span><span class="p">)</span>

        <span class="c1"># SOME ADDITIONAL OPTIONS ARE SET HERE AS WELL AS BASIC ALERT DETAILS</span>
        <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Default value for not having send individual notifications for this alert</span>
        <span class="k">if</span> <span class="s1">&#39;send_individual_notif&#39;</span> <span class="ow">in</span> <span class="n">additional_settings</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
        <span class="n">alert_options</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;alert GUID=&quot;&quot; createdTime=&quot;</span><span class="si">{</span><span class="n">current_time</span><span class="si">}</span><span class="s1">&quot; description=&quot;&quot; escNotifType=&quot;0&quot; </span>
<span class="s1">                             notifType=&quot;</span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">notif_type</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; organizationId=&quot;0&quot; origCCId=&quot;0&quot; status=&quot;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s1">&quot;&gt;</span>
<span class="s1">                             &lt;alert id=&quot;0&quot; name=&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot; /&gt;</span>
<span class="s1">                             &lt;alertCategory id=&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">CATEGORY_ID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_category</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot; name=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_category</span><span class="si">}</span><span class="s1">&quot; /&gt;</span>
<span class="s1">                             &lt;alertType id=&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">ALERT_CATEGORY_TYPE</span><span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_category</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">alert_type</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; name=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_type</span><span class="si">}</span><span class="s1">&quot; /&gt;</span>
<span class="s1">                             &lt;creator id=&quot;1&quot; name=&quot;admin&quot; /&gt;</span>
<span class="s1">                             &lt;/alert&gt;</span>
<span class="s1">                             &lt;userList id1=&quot;1&quot; id2=&quot;1&quot; name=&quot;admin&quot; /&gt;&#39;&#39;&#39;</span>

        <span class="c1"># ESCALATION RECIPENTS</span>
        <span class="k">if</span> <span class="s1">&#39;escalation_recipent&#39;</span> <span class="ow">in</span> <span class="n">additional_settings</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">additional_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;escalation_recipent&#39;</span><span class="p">),</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">alert_options</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;nonGalaxyUserList id1=&quot;0&quot; id2=&quot;2&quot; </span>
<span class="s1">                                     name=&quot;</span><span class="si">{</span><span class="n">additional_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;escalation_recipent&#39;</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; /&gt;&#39;&#39;&#39;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">additional_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;escalation_recipent&#39;</span><span class="p">),</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">to_recipent</span> <span class="ow">in</span> <span class="n">additional_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;escalation_recipent&#39;</span><span class="p">):</span>
                    <span class="n">alert_options</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;nonGalaxyUserList id1=&quot;0&quot; id2=&quot;2&quot; name=&quot;</span><span class="si">{</span><span class="n">to_recipent</span><span class="si">}</span><span class="s1">&quot; /&gt;&#39;&#39;&#39;</span>

        <span class="c1"># ALERT CRITERIAS</span>
        <span class="n">criterias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_criterias_xml</span><span class="p">(</span><span class="n">additional_settings</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span>

        <span class="c1"># NOTIFICATION MESSAGE BODY</span>
        <span class="n">escalate_notification</span> <span class="o">=</span> <span class="s1">&#39;escalation_criteria&#39;</span> <span class="ow">in</span> <span class="n">additional_settings</span>
        <span class="n">notifs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_notification_xml</span><span class="p">(</span><span class="n">notif_type</span><span class="p">,</span> <span class="n">escalate_notification</span><span class="p">)</span>

        <span class="c1"># GENERAL ALERT INFO</span>
        <span class="n">general_info</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;locale localeID=&quot;0&quot; localeName=&quot;&quot; /&gt;</span>
<span class="s1">                          &lt;reportingParams delayTimeSeconds=&quot;0&quot; persistTimeSeconds=&quot;0&quot; reportingOptions=&quot;0&quot; /&gt;</span>
<span class="s1">                          &lt;appTypeFilters /&gt;</span>
<span class="s1">                          &lt;securityAssociations processHiddenPermission=&quot;0&quot; /&gt;</span>
<span class="s1">                          &lt;alertProperties /&gt;&#39;&#39;&#39;</span>

        <span class="c1"># EXTRA MAIL NOTIFICATION RECIPENTS</span>
        <span class="n">recipents</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># These are mail recipents in the cc</span>
        <span class="k">for</span> <span class="n">cc_recipent</span> <span class="ow">in</span> <span class="n">mail_recipent</span><span class="p">:</span>
            <span class="n">recipent_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;nonGalaxyUserListCc id1=&quot;0&quot; id2=&quot;1&quot; name=&quot;</span><span class="si">{</span><span class="n">cc_recipent</span><span class="si">}</span><span class="s1">&quot; /&gt;&#39;&#39;&#39;</span>
            <span class="n">recipents</span> <span class="o">+=</span> <span class="n">recipent_string</span>

        <span class="c1"># FOOTER</span>
        <span class="n">footer</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;/alertDetail&gt;</span>
<span class="s1">                    &lt;/CVGui_AlertCreateReq&gt;&#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alert_xml</span> <span class="o">=</span> <span class="n">header</span> <span class="o">+</span> <span class="n">associations</span> <span class="o">+</span> <span class="n">alert_options</span> <span class="o">+</span> <span class="n">criterias</span> <span class="o">+</span> <span class="n">notifs</span> <span class="o">+</span> <span class="n">general_info</span> <span class="o">+</span> <span class="n">recipents</span> <span class="o">+</span> <span class="n">footer</span>
        <span class="c1"># We create a dictionary as this will be needed when creating the alert and for error checking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_xml_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alert_name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;alert_xml&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_xml</span><span class="p">,</span> <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="n">criteria</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_xml_dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_xml_dict</span></div>

<div class="viewcode-block" id="AlertHelper.create_alert_from_xml"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.create_alert_from_xml">[docs]</a>    <span class="k">def</span> <span class="nf">create_alert_from_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a new Alert for CommCell using QCommand Execute</span>

<span class="sd">        Returns:</span>
<span class="sd">            object  -  instance of the Alert class for this new alert</span>

<span class="sd">        Raises:</span>
<span class="sd">            SDKException:</span>
<span class="sd">                if input argument is not an instance of dict</span>

<span class="sd">                if alert with given name already exists</span>

<span class="sd">                if failed to create an alert</span>

<span class="sd">                if response is not success</span>

<span class="sd">                if response is empty</span>

<span class="sd">        NOTE : This function assumes that get_alert_xml() has been called earlier to populate the alert_xml_dict,</span>
<span class="sd">               otherwise by default alert_xml_dict is initialized to None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_xml_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Alert&#39;</span><span class="p">,</span> <span class="s1">&#39;101&#39;</span><span class="p">)</span>

        <span class="c1"># required alert json</span>
        <span class="n">alert_xml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_xml_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alert_xml&#39;</span><span class="p">)</span>
        <span class="n">alert_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_xml_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alert_name&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span><span class="o">.</span><span class="n">has_alert</span><span class="p">(</span><span class="n">alert_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Alert&#39;</span><span class="p">,</span> <span class="s1">&#39;102&#39;</span><span class="p">,</span> <span class="s1">&#39;Alert &quot;</span><span class="si">{0}</span><span class="s1">&quot; already exists.&#39;</span><span class="o">.</span>
                               <span class="nb">format</span><span class="p">(</span><span class="n">alert_name</span><span class="p">))</span>

        <span class="n">post_alert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="s1">&#39;EXECUTE_QCOMMAND&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating Alert </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_name</span><span class="p">))</span>
        <span class="n">flag</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span><span class="o">.</span><span class="n">_cvpysdk_object</span><span class="o">.</span><span class="n">make_request</span><span class="p">(</span>
            <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">post_alert</span><span class="p">,</span> <span class="n">alert_xml</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">():</span>
                <span class="n">alert_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;alertId&quot;</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">alert_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Alert Creation Successful&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alert_name</span><span class="p">)</span>

                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">error_dict</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;errorResp&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;errorMessage&#39;</span> <span class="ow">in</span> <span class="n">error_dict</span><span class="p">:</span>
                    <span class="n">error_message</span> <span class="o">=</span> <span class="n">error_dict</span><span class="p">[</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">error_message</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span>
                        <span class="s1">&#39;Alert&#39;</span><span class="p">,</span> <span class="s1">&#39;102&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed to create Alert</span><span class="se">\n</span><span class="s1">Error: &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error_message</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Alert&#39;</span><span class="p">,</span> <span class="s1">&#39;102&#39;</span><span class="p">,</span> <span class="s2">&quot;Failed to create Alert&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">,</span> <span class="s1">&#39;102&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span><span class="o">.</span><span class="n">_update_response_</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SDKException</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">,</span> <span class="s1">&#39;101&#39;</span><span class="p">,</span> <span class="n">response_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlertHelper.create_criteria_mapping"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.create_criteria_mapping">[docs]</a>    <span class="k">def</span> <span class="nf">create_criteria_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria_id_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a list of Criteria Name mappings from a list of criteria IDs</span>

<span class="sd">            Args:</span>
<span class="sd">                criteria_id_list (list)  --  List of criteria IDs for which criteria names are to be returned</span>

<span class="sd">            Returns:</span>
<span class="sd">                (list) - Returns Criteria Names list corresponding to criteria IDs list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">criteria_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">criteria_id</span> <span class="ow">in</span> <span class="n">criteria_id_list</span><span class="p">:</span>
            <span class="n">criteria_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">CRITERIA_ID</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">criteria_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">criteria_names</span></div>

<div class="viewcode-block" id="AlertHelper.delete_alert"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.delete_alert">[docs]</a>    <span class="k">def</span> <span class="nf">delete_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alert_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to delete the alert</span>
<span class="sd">        Exception:</span>
<span class="sd">            if alert deletion failed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Attempting to delete alert : </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alert_name</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">alert_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Alert Deletion Successful&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Alert Deletion encountered an exception </span><span class="si">{</span><span class="n">excp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlertHelper.cleanup"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertHelper.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs cleanup specific to alerts, notification parsing objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Alert Cleanup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting the Alert&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alerts_commcell</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;alert_name&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Alert deleted successfully&quot;</span><span class="p">)</span>
        <span class="c1"># Mailbox Cleanup</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mailbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disconnecting Mailbox&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mailbox</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="AlertSituations"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertSituations">[docs]</a><span class="k">class</span> <span class="nc">AlertSituations</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class  which contains all Alert triggering situation functions</span>

<span class="sd">    Define different functions corresponding to different situations that may be required</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alert_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize object of the AlertHelper class.</span>

<span class="sd">            Args:</span>
<span class="sd">                commcell_object (object)  --  instance of the Commcell class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span> <span class="o">=</span> <span class="n">commcell_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_category</span> <span class="o">=</span> <span class="n">category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_type</span> <span class="o">=</span> <span class="n">alert_type</span>

<div class="viewcode-block" id="AlertSituations.backup_job"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertSituations.backup_job">[docs]</a>    <span class="k">def</span> <span class="nf">backup_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">subclient</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize object of the AlertHelper class.</span>

<span class="sd">            Args:</span>
<span class="sd">                client (object)  - Client object</span>
<span class="sd">                subclient (object) - Subclient object</span>
<span class="sd">                backup_type (string) - backuptype</span>

<span class="sd">            Returns:</span>
<span class="sd">                Runs a backup job on the given subclient, returns the Cache</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Backup Phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting Backup Phase&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Create Machine Class object&#39;</span><span class="p">)</span>

        <span class="n">client_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">machine_name</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span>
                                 <span class="n">commcell_object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Read subclient content&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Subclient Content : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting Subclient </span><span class="si">{0}</span><span class="s1"> Backup&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_type</span><span class="p">)</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">))</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">subclient</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">backup_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Started </span><span class="si">%s</span><span class="s1"> backup with Job ID : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Failed to run </span><span class="si">{0}</span><span class="s1"> backup job with error </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_type</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;job_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;client_machine&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">client_machine</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully finished </span><span class="si">%s</span><span class="s1"> backup job&#39;</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cache</span></div>

<div class="viewcode-block" id="AlertSituations.backup_generated_data"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertSituations.backup_generated_data">[docs]</a>    <span class="k">def</span> <span class="nf">backup_generated_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">subclient</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize object of the AlertHelper class.</span>

<span class="sd">            Args:</span>
<span class="sd">                client (object)  - Client object</span>
<span class="sd">                subclient (object) - Subclient object</span>
<span class="sd">                backup_type (string) - backup-type</span>
<span class="sd">                size (int) - Size of backup data to generate</span>

<span class="sd">            Returns:</span>
<span class="sd">                Generates test data, runs a backup job on the generated data, returns the Cache</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">options_selector</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="p">)</span>
        <span class="n">client_machine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">test_data_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Backup Phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting Backup Phase&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Read subclient content&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Subclient Content : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span><span class="n">backup_type</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Full&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating Machine Class Object&#39;</span><span class="p">)</span>
            <span class="n">client_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="n">machine_name</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span>
                                     <span class="n">commcell_object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="p">)</span>

            <span class="n">drive</span> <span class="o">=</span> <span class="n">options_selector</span><span class="o">.</span><span class="n">get_drive</span><span class="p">(</span><span class="n">client_machine</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">drive</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No free space to genereate test data&quot;</span><span class="p">)</span>
            <span class="n">test_data_path</span> <span class="o">=</span> <span class="n">drive</span> <span class="o">+</span> <span class="s1">&#39;TestData&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Add test data path to subclient content&#39;</span><span class="p">)</span>
            <span class="n">subclient</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">test_data_path</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Generating test data at </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">test_data_path</span><span class="p">)</span>
            <span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span><span class="n">test_data_path</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s1">&#39;Starting Subclient </span><span class="si">{0}</span><span class="s1"> Backup&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">subclient</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">backup_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Started </span><span class="si">%s</span><span class="s1"> backup with Job ID : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Failed to run </span><span class="si">{0}</span><span class="s1"> backup job with error </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_type</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;job_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;client_machine&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">client_machine</span>
        <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;test_data_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_data_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully finished </span><span class="si">%s</span><span class="s1"> backup job&#39;</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cache</span></div>

<div class="viewcode-block" id="AlertSituations.low_disk_space_settings"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertSituations.low_disk_space_settings">[docs]</a>    <span class="k">def</span> <span class="nf">low_disk_space_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Used for adding additional settings to trigger low space criteria. Works for triggering this criteria</span>
<span class="sd">            in both Clients and MediaAgents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add Additional Settings to the commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Adding setting for Running System directory space check thread at given minutes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">add_additional_setting</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;QMachineMaint&#39;</span><span class="p">,</span>
                                                    <span class="n">key_name</span><span class="o">=</span><span class="s1">&#39;nTimer_SystemDirSpaceCheck&#39;</span><span class="p">,</span>
                                                    <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;INTEGER&#39;</span><span class="p">,</span>
                                                    <span class="n">value</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">add_additional_setting</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;QMachineMaint&#39;</span><span class="p">,</span>
                                                    <span class="n">key_name</span><span class="o">=</span><span class="s1">&#39;nTimer_DirSpaceCheck&#39;</span><span class="p">,</span>
                                                    <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;INTEGER&#39;</span><span class="p">,</span>
                                                    <span class="n">value</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting added successfully&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Adding Additional setting for Min Free Space Percentage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">add_additional_setting</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;QMachineMaint&#39;</span><span class="p">,</span>
                                                    <span class="n">key_name</span><span class="o">=</span><span class="s1">&#39;nMinFreeSpacePercentage&#39;</span><span class="p">,</span>
                                                    <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;INTEGER&#39;</span><span class="p">,</span>
                                                    <span class="n">value</span><span class="o">=</span><span class="s1">&#39;99&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting added successfully&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlertSituations.cleanup_low_disk_space_settings"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertSituations.cleanup_low_disk_space_settings">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup_low_disk_space_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Used for cleaning up additional settings added for low disk space criteria situation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Remove Additional Settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Removing Additional Setting&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">delete_additional_setting</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;QMachineMaint&#39;</span><span class="p">,</span>
                                                       <span class="n">key_name</span><span class="o">=</span><span class="s1">&#39;nTimer_SystemDirSpaceCheck&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">delete_additional_setting</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;QMachineMaint&#39;</span><span class="p">,</span>
                                                       <span class="n">key_name</span><span class="o">=</span><span class="s1">&#39;nTimer_DirSpaceCheck&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="o">.</span><span class="n">delete_additional_setting</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;QMachineMaint&#39;</span><span class="p">,</span>
                                                       <span class="n">key_name</span><span class="o">=</span><span class="s1">&#39;nMinFreeSpacePercentage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Settings Removed successfully&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlertSituations.auxiliary_copy_job"><a class="viewcode-back" href="../../../source/Server.Alerts.html#Server.Alerts.alert_helper.AlertSituations.auxiliary_copy_job">[docs]</a>    <span class="k">def</span> <span class="nf">auxiliary_copy_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_policy_name</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs an Auxillary Copy Job for Given Storage Policy&quot;&quot;&quot;</span>
        <span class="n">storage_policy</span> <span class="o">=</span> <span class="n">StoragePolicy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_object</span><span class="p">,</span> <span class="n">storage_policy_name</span><span class="o">=</span><span class="n">storage_policy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s1">&#39;Starting Auxillary Copy Backup for Storage Policy </span><span class="si">{0}</span><span class="s1"> Copy </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">storage_policy_name</span><span class="p">,</span>
                                                                                               <span class="n">copy_name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">storage_policy</span><span class="o">.</span><span class="n">run_aux_copy</span><span class="p">(</span><span class="n">storage_policy_copy_name</span><span class="o">=</span><span class="n">copy_name</span><span class="p">,</span> <span class="n">all_copies</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Started Auxillary Copy Job with ID : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Failed to run Auxillary Copy Job with error </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;job_id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)}</span>
        <span class="k">return</span> <span class="n">cache</span></div></div>


</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>