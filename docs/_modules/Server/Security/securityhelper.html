

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Server.Security.securityhelper &mdash; Commvault Automation 11.24 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>Server.Security.securityhelper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Server.Security.securityhelper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;Main file for performing Organization related operations on Commcell</span>

<span class="sd">OrganizationHelper:</span>
<span class="sd">    __init__()                  --  Initialize instance of the OrganizationHelper class</span>

<span class="sd">    create()                    -- Create Company</span>

<span class="sd">    add_domain()                -- Associate a domain to the Company</span>

<span class="sd">    modify_auth_code()          --  Modifies the &quot;Requires authcode for installation&quot; property</span>
<span class="sd">                                        for an organization.</span>

<span class="sd">    validate_client()           --  Validates on boarded client for the organization or the Commcell</span>

<span class="sd">    validate_usercentric_client()</span>
<span class="sd">                                --  Validates on boarded user centric client for the organization</span>

<span class="sd">    validate_no_of_devices()    --  Validate number of devices activated for the organization</span>

<span class="sd">    validate_clientgroup_assoc()</span>
<span class="sd">                                --  Validates if on boarded client gets associated to</span>
<span class="sd">                                        Organization&#39;s default plan &amp;OR Commcell default plan &amp;OR</span>
<span class="sd">                                        organization</span>

<span class="sd">    validate_client_owners()    --  Validate owners for the client are as expected</span>

<span class="sd">    disable_msp()               --  Disable MSP on the commcell if it is not already disabled.</span>

<span class="sd">    create_blacklisted_group()  --  Creates blacklisted user group</span>

<span class="sd">    delete_blacklisted_group()  --  Delete blacklisted user group</span>

<span class="sd">    add_user_to_blacklisted_group()</span>
<span class="sd">                                --  Adds a user to a blacklister user group</span>

<span class="sd">    remove_user_from_blacklisted_group()</span>
<span class="sd">                                --  Removes a user from a blacklister user group</span>

<span class="sd">    set_tenant_property()       -- Sets a tenant property for a tenant or Commcell</span>

<span class="sd">    is_msp()                    --  Checks if commcell is MSP</span>

<span class="sd">    is_client_activated()       --  Check if client is activated and associated to plan&#39;s client group</span>

<span class="sd">    is_device_associated()      --  Wait for device to be associated to company</span>

<span class="sd">    is_domain_user()            --  Checks if a user name is a domain user or local user</span>

<span class="sd">    delete_domain()             --  Deletes a domain from the commcell</span>

<span class="sd">    cleanup()                   --  Cleans up the environment modified on commcell by the helper class</span>

<span class="sd">    @Property</span>
<span class="sd">        default_plan                    --  Sets/Gets default plan for an organization</span>

<span class="sd">        company                         --  Sets/Gets the company object based on given company name</span>

<span class="sd">        commcell_default_plan           --  Sets/Gets commcell&#39;s default plan at Commcell Level</span>

<span class="sd">        tenant_client_group             --  Sets/Gets a Tenant company&#39;s client group name based on</span>
<span class="sd">                                            Default plan</span>

<span class="sd">        machine_count                   --  Gets the client count associated for the given company</span>


<span class="sd">RoleHelper:</span>
<span class="sd">    __init__()                          --  Initialize RoleHelper object</span>

<span class="sd">    create_role()                       --  Creates new role on the CommCell</span>

<span class="sd">    random_permissions()                --  Generates and returns 5 random permissions</span>

<span class="sd">    random_category()                   --  Generates and returns 3 random categories</span>

<span class="sd">    generate_permissions_categories()   --  Returns 5 random permissions and 3 random categories</span>

<span class="sd">    delete_role()                       --  Deletes the specified role on CommCell</span>

<span class="sd">    update_role_properties()            --  Update, Overwrite, deletes capabilities the passed</span>

<span class="sd">    _validate_role_permissions()        --  validates capabilities present on the role with db</span>
<span class="sd">                                            values</span>

<span class="sd">    _update_role_status()               --  Updates role status</span>

<span class="sd">    _update_role_description()          --  Updates role description</span>

<span class="sd">    _update_role_name()                 --  Updates role name</span>

<span class="sd">    _fetch_role_property()              --  Gets role property values from db</span>

<span class="sd">    @property</span>
<span class="sd">        role()                          --  Returns the role object of this CommCell role</span>

<span class="sd">SecurityHelper:</span>

<span class="sd">    __init__                            --  Initializes RoleHelper object</span>

<span class="sd">    gen_random_entity_types_dict        --  Generate dictionary consisting of randomly selected dictionary types, roles</span>

<span class="sd">    generate_random_entity_dict         --  Generate dictionary consisting of randomly selected dictionary types, roles</span>

<span class="sd">    gen_entity_role_dict                --  Generates and returns entity and role association not association dictionary</span>

<span class="sd">    validate_security_associations      --  Validates security Associations on user and userggroup</span>

<span class="sd">    return_association_details          --  Returns list of lists containing entityType, entityName and permissionName</span>

<span class="sd">    calculate_capability_bitmask        --  Returns list of lists containing entityType, entityName and permissionName</span>

<span class="sd">    valid_operations_for_user           --  Generates Intended Operations for User</span>

<span class="sd">    can_perform_operations              --  Inserts valid and intended operations list to DB.</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">cvpysdk.security.role</span> <span class="kn">import</span> <span class="n">Roles</span>
<span class="kn">from</span> <span class="nn">cvpysdk.security.usergroup</span> <span class="kn">import</span> <span class="n">UserGroup</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.idautils</span> <span class="kn">import</span> <span class="n">CommonUtils</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">database_helper</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">options_selector</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="kn">import</span> <span class="n">OptionsSelector</span>
<span class="kn">from</span> <span class="nn">Server.Security</span> <span class="kn">import</span> <span class="n">securityconstants</span>


<div class="viewcode-block" id="OrganizationHelper"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper">[docs]</a><span class="k">class</span> <span class="nc">OrganizationHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Helper class to provide Organization related operations on Commcell&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">company</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; initialize instance of the OrganizationHelper class</span>

<span class="sd">        Args:</span>
<span class="sd">            commcell (obj)    -- Commcell object</span>

<span class="sd">            company  (str)    -- Organization name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span> <span class="o">=</span> <span class="n">company</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_company</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_commcell_default_plan</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tenant_client_group</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">company</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span> <span class="o">=</span> <span class="n">company</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">company</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">machine_count</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tenant_client_group</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">default_plan</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tenant_client_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">default_plan</span> <span class="o">+</span> <span class="s1">&#39; clients&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_map</span> <span class="o">=</span> <span class="n">securityconstants</span><span class="o">.</span><span class="n">AUTH_MAP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span> <span class="o">=</span> <span class="n">database_helper</span><span class="o">.</span><span class="n">CommServDatabase</span><span class="p">(</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="n">commcell</span><span class="p">)</span>

<div class="viewcode-block" id="OrganizationHelper.create"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">name</span><span class="p">,</span>
               <span class="n">email</span><span class="p">,</span>
               <span class="n">contact_name</span><span class="p">,</span>
               <span class="n">company_alias</span><span class="p">,</span>
               <span class="n">email_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">primary_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">default_plans</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a Tenant company</span>
<span class="sd">            Args:</span>

<span class="sd">                name            (str)    - Company name to create</span>

<span class="sd">                email           (str)    - Email associated to the company owner</span>

<span class="sd">                contact_name    (str)    - Contact name for the Company owner</span>

<span class="sd">                company_alias   (str)    - Company alias</span>

<span class="sd">                email_domain    (str)    - Email Domain</span>

<span class="sd">                primary_domain  (str)    - Primary domain associated to the company</span>

<span class="sd">                default_plans   (str)    - Default plan associated to the company</span>

<span class="sd">            Returns:    (obj)    - Company object</span>

<span class="sd">            Raises</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - in case failed in any step to create company</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">contact_name</span><span class="p">,</span> <span class="n">company_alias</span><span class="p">,</span> <span class="n">email_domain</span><span class="p">,</span> <span class="n">primary_domain</span><span class="p">,</span> <span class="n">default_plans</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">has_organization</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Company [</span><span class="si">{0}</span><span class="s2">] already exists on commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Creating organization [</span><span class="si">{0}</span><span class="s2">], with email [</span><span class="si">{1}</span><span class="s2">], contact name [</span><span class="si">{2}</span><span class="s2">], company alias[</span><span class="si">{3}</span><span class="s2">],</span>
<span class="s2">                                 email domain [</span><span class="si">{4}</span><span class="s2">], primary domain [</span><span class="si">{5}</span><span class="s2">], default plans [</span><span class="si">{6}</span><span class="s2">]&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">machine_count</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.add_domain"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.add_domain">[docs]</a>    <span class="k">def</span> <span class="nf">add_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">netbios</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">company_id</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ad_proxy_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enable_sso</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a domain for the company and associate with it</span>

<span class="sd">            Args:</span>
<span class="sd">                domain        (str)    - Domain name</span>

<span class="sd">                netbios       (str)    - Netbios name for the domain</span>

<span class="sd">                user          (str)    - Domain User</span>

<span class="sd">                password      (str)    - Domain user password</span>

<span class="sd">                company_id    (str)    - Associated company id</span>

<span class="sd">                ad_proxy_list (list)   - Active Domain proxy list</span>

<span class="sd">                enable_sso    (bool)   - Enablle SSO? (True/False)</span>

<span class="sd">            Returns:</span>
<span class="sd">                domain object for created domain (obj)</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - In case failed at any step to create domain</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">domain</span><span class="p">,</span> <span class="n">netbios</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">company_id</span><span class="p">,</span> <span class="n">ad_proxy_list</span><span class="p">,</span> <span class="n">enable_sso</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">has_domain</span><span class="p">(</span><span class="n">netbios</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Domain [</span><span class="si">{0}</span><span class="s2">] already exists on commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">domain</span><span class="p">))</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">netbios</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Creating domain [</span><span class="si">{0}</span><span class="s2">], with netbios [</span><span class="si">{1}</span><span class="s2">], user [</span><span class="si">{2}</span><span class="s2">], pass [</span><span class="si">{3}</span><span class="s2">], company_id [</span><span class="si">{4}</span><span class="s2">],</span>
<span class="s2">                                 ad_proxy_list [</span><span class="si">{5}</span><span class="s2">], enable_sso option as [</span><span class="si">{6}</span><span class="s2">]&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">domain</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.modify_auth_code"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.modify_auth_code">[docs]</a>    <span class="k">def</span> <span class="nf">modify_auth_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hardcheck</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Modifies the &quot;Requires authcode for installation&quot; property for an organization.</span>

<span class="sd">            Args:</span>

<span class="sd">                operation    (str)    -- enable/disable auth code for the organization.</span>
<span class="sd">                                            Supported : enable/disable</span>

<span class="sd">                hardcheck     (bool)   -- True/False based on whether the to throw exception in</span>
<span class="sd">                                            case of any error or to return falsy value.</span>

<span class="sd">            Returns:</span>
<span class="sd">                AuthCode    (str)      -- Modified auth code for the organization.</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>

<span class="sd">                    - if Unsupported operation type passed to modify_auth_code</span>

<span class="sd">                    - if failed to enable/disable auth code</span>

<span class="sd">                    - if failed during any step while enabling/disabling the auth code</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">company_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span>
            <span class="k">if</span> <span class="n">operation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_map</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported operation type passed to modify_auth_code&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> auth code for company: [</span><span class="si">{1}</span><span class="s2">]. Current authcode [</span><span class="si">{2}</span><span class="s2">]&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_auth_map</span><span class="p">[</span><span class="n">operation</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="n">company_name</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">auth_code</span><span class="p">))</span>

            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_map</span><span class="p">[</span><span class="n">operation</span><span class="p">][</span><span class="s1">&#39;module&#39;</span><span class="p">])()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully [</span><span class="si">{0}</span><span class="s2">] auth code for company:  [</span><span class="si">{1}</span><span class="s2">]. Current authcode [</span><span class="si">{2}</span><span class="s2">]&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_auth_map</span><span class="p">[</span><span class="n">operation</span><span class="p">][</span><span class="s1">&#39;post_message&#39;</span><span class="p">],</span> <span class="n">company_name</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">auth_code</span><span class="p">))</span>

            <span class="n">auth_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">auth_code</span>

            <span class="c1"># Validation</span>
            <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;enable&#39;</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">auth_code</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">&quot;Failed to enable auth code&quot;</span>
            <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;disable&#39;</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">auth_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Failed to disable auth code&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Auth code validation succeeded.&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">auth_code</span>

        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">aserror</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hardcheck</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">aserror</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.validate_client"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.validate_client">[docs]</a>    <span class="k">def</span> <span class="nf">validate_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clientobj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validates on boarded client for the organization</span>

<span class="sd">            Args:</span>

<span class="sd">                clientobj    (obj)         -- Client object for which validation needs to be performed.</span>

<span class="sd">                Supported Keywords arguments:</span>
<span class="sd">                -----------------------------</span>

<span class="sd">                clients_joined    (bool)   -- Validate number of new clients on boarded the</span>
<span class="sd">                                                organization (True/False)</span>
<span class="sd">                                                Default: True</span>
<span class="sd">                increment_client_count_by</span>
<span class="sd">                                  (int)    -- Validate number of clients on boarded the organization</span>
<span class="sd">                                                Default: 1</span>

<span class="sd">                chatter_flag (int)         -- Expected value for nChatter registry flag. (0/1)</span>
<span class="sd">                                                Default: 0</span>

<span class="sd">                nLaptopAgent (int)         -- Expected value for nLaptopAgent registry flag. (0/1)</span>
<span class="sd">                                                Default: 1</span>

<span class="sd">                fail              (bool)   -- If true, will throw exception in case of failed</span>
<span class="sd">                                              client validation. If false,</span>
<span class="sd">                                              will return False if validation fails</span>

<span class="sd">                client_groups (list)       -- List of user specified client groups to validate.</span>
<span class="sd">                                              Default is None In case of None</span>
<span class="sd">                                              validate_clientgroup_assoc() will assume defaults</span>
<span class="sd">                                              for the plan and organization.</span>

<span class="sd">                expected_owners (list)     -- Expected owners list for the client</span>
<span class="sd">                                                Default: []</span>

<span class="sd">                client_name    (str)       -- Client name could be different for User Centric clients.</span>

<span class="sd">            Returns:</span>
<span class="sd">                (bool)                     -- Based on validation failed/pass</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - if validation failed</span>
<span class="sd">                    - if module failed to execute due to some error</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_name&#39;</span><span class="p">,</span> <span class="n">clientobj</span><span class="o">.</span><span class="n">machine_name</span><span class="p">)</span>

            <span class="c1"># Check if clients are ready.</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">wait_until_client_ready</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

            <span class="c1"># Check if the clients got associated to Plan/Organization client groups/Commcell Plan</span>
            <span class="c1"># whichever applicable based on input types passed to the modules.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_clientgroup_assoc</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">client_groups</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_groups&#39;</span><span class="p">),</span> <span class="n">time_limit</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

            <span class="c1"># Validate nChatter flag registry key value</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">check_reg_key</span><span class="p">(</span><span class="n">clientobj</span><span class="p">,</span> <span class="s1">&#39;Session&#39;</span><span class="p">,</span> <span class="s1">&#39;nChatterFlag&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;chatter_flag&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="c1"># Validate laptopAgent flag registry key value</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">check_reg_key</span><span class="p">(</span><span class="n">clientobj</span><span class="p">,</span> <span class="s1">&#39;FileSystemAgent&#39;</span><span class="p">,</span> <span class="s1">&#39;nLaptopAgent&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nLaptopAgent&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="c1"># Validate client owners</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expected_owners&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_client_owners</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expected_owners&#39;</span><span class="p">,</span> <span class="p">[]))</span>

            <span class="c1"># Validate number of clients joined in the organization</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;clients_joined&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">client_count</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;increment_client_count_by&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_no_of_devices</span><span class="p">(</span><span class="n">client_count</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">aserror</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fail&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Client validation failed&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">aserror</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Client validation failed&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.validate_usercentric_client"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.validate_usercentric_client">[docs]</a>    <span class="k">def</span> <span class="nf">validate_usercentric_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="p">,</span> <span class="n">user_centric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Validates on boarded user centric client for the organization</span>

<span class="sd">            Args:</span>

<span class="sd">                client_name    (String)         -- Client name for which validation needs to be performed.</span>

<span class="sd">                user_centric    (bool)     -- If this flag is set, It will check if User Centric</span>
<span class="sd">                                              flag is set in App_client prop table</span>
<span class="sd">                                              default:True</span>

<span class="sd">                Supported Keywords arguments:</span>
<span class="sd">                -----------------------------</span>
<span class="sd">                fail              (bool)   -- If true, will throw exception in case of failed</span>
<span class="sd">                                              client validation. If false,</span>
<span class="sd">                                              will return False if validation fails</span>

<span class="sd">                client_groups (list)       -- List of user specified client groups to validate.</span>
<span class="sd">                                              Default is None In case of None</span>
<span class="sd">                                              validate_clientgroup_assoc() will assume defaults</span>
<span class="sd">                                              for the plan and organization.</span>

<span class="sd">                expected_owners (list)     -- Expected owners list for the client</span>
<span class="sd">                                                Default: []</span>


<span class="sd">            Returns:</span>
<span class="sd">                (bool)                     -- Based on validation failed/pass</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - if validation failed</span>
<span class="sd">                    - if module failed to execute due to some error</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if clients are ready.</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">wait_until_client_ready</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>

            <span class="c1"># Check if the clients got associated to Plan/Organization client groups/Commcell Plan</span>
            <span class="c1"># whichever applicable based on input types passed to the modules.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_clientgroup_assoc</span><span class="p">(</span><span class="n">client_name</span><span class="p">,</span> <span class="n">client_groups</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_groups&#39;</span><span class="p">),</span> <span class="n">time_limit</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

            <span class="c1"># Validate client owners</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expected_owners&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_client_owners</span><span class="p">(</span><span class="n">client_name</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expected_owners&#39;</span><span class="p">,</span> <span class="p">[]))</span>

            <span class="c1"># Validate user centric flag</span>
            <span class="k">if</span> <span class="n">user_centric</span><span class="p">:</span>
                <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select attrVal from APP_ClientProp where</span>
<span class="s2">                componentNameId=(select id from app_client where name=&#39;</span><span class="si">{0}</span><span class="s2">&#39;)</span>
<span class="s2">                and attrName=&#39;User Centric Client&#39;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;User centric flag is not set for client [</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">] in Database&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;User centric flag is set to 1 for client [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>

            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">aserror</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fail&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Client validation failed&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">aserror</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Client validation failed&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.validate_deactivation"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.validate_deactivation">[docs]</a>    <span class="k">def</span> <span class="nf">validate_deactivation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clientobj</span><span class="p">,</span> <span class="n">reg_key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validates deactivated client for the organization</span>

<span class="sd">            Args:</span>

<span class="sd">                clientobj    (obj)         -- Client object for which validation needs to be performed.</span>


<span class="sd">                reg_key (int)         --   path for bDeactivate registry key.</span>


<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - if validation failed</span>
<span class="sd">                    - if module failed to execute due to some error</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">expected_value</span> <span class="o">=</span> <span class="s1">&#39;34afabe997158009d445a6d82a3dabcd6&#39;</span>

            <span class="n">client</span> <span class="o">=</span> <span class="n">clientobj</span><span class="o">.</span><span class="n">client_name</span>

            <span class="c1"># Check if the clients got associated to Plan/Organization client groups/Commcell Plan</span>
            <span class="c1"># whichever applicable based on input types passed to the modules.</span>
            <span class="n">return_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">is_client_in_client_group</span><span class="p">(</span>
                <span class="n">client</span><span class="p">,</span>
                <span class="n">client_groups</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_tenant_client_group</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">return_flag</span><span class="p">:</span>

                <span class="n">exp</span> <span class="o">=</span> <span class="s2">&quot;Laptop </span><span class="si">{0}</span><span class="s2"> associated to plan&#39;s client group </span><span class="si">{1}</span><span class="s2">&quot;</span>\
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clientobj</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tenant_client_group</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client [</span><span class="si">{0}</span><span class="s2">] is not associated to client group: [</span><span class="si">{1}</span><span class="s2">]&quot;</span>\
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tenant_client_group</span><span class="p">))</span>

            <span class="c1"># Validate bDeactivate flag registry key value</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">check_reg_key</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">reg_key</span><span class="p">,</span> <span class="s1">&#39;bDeactivate&#39;</span><span class="p">,</span> <span class="n">expected_value</span><span class="p">)</span>

            <span class="c1"># validate associated plan value in app_clientprop table</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;select attrval from APP_ClientProp where &quot;</span> \
                        <span class="sa">f</span><span class="s2">&quot;componentNameId=</span><span class="si">{</span><span class="n">clientobj</span><span class="o">.</span><span class="n">client_id</span><span class="si">}</span><span class="s2"> and attrName = &#39;Associated plan&#39;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Associated plan value of the client </span><span class="si">{</span><span class="n">clientobj</span><span class="o">.</span><span class="n">client_name</span><span class="si">}</span><span class="s1"> is not 0 &#39;</span>\
                                <span class="s1">&#39;upon Deactivation&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Laptop deactivation updated with correct value in database&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Client deactivation failed&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.validate_no_of_devices"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.validate_no_of_devices">[docs]</a>    <span class="k">def</span> <span class="nf">validate_no_of_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">increment_client_count_by</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validate number of devices activated for the organization &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Number of clients in company [</span><span class="si">{1}</span><span class="s2">] *before client activation: [</span><span class="si">{0}</span><span class="s2">]&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">machine_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">))</span>
        <span class="n">pre_machine_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">machine_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">post_machine_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">machine_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Number of clients post client activation: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">post_machine_count</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">post_machine_count</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pre_machine_count</span> <span class="o">+</span> <span class="n">increment_client_count_by</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Number of clients in company should have increased by: [</span><span class="si">{0}</span><span class="s2">]&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">increment_client_count_by</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Validation failed for number of devices in the organization.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validation succeeded for number of devices joining the organization.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OrganizationHelper.validate_clientgroup_assoc"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.validate_clientgroup_assoc">[docs]</a>    <span class="k">def</span> <span class="nf">validate_clientgroup_assoc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">fail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">time_limit</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">retry_interval</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">client_groups</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validates if on boarded client gets associated to Organization&#39;s default plan</span>

<span class="sd">            Args:</span>
<span class="sd">                client    (str)            -- Client to check in defaults plan&#39;s/organization&#39;s</span>
<span class="sd">                                              client group.</span>

<span class="sd">                fail       (bool)          -- If true, will throw exception in case of failed</span>
<span class="sd">                                              client validation. If false, will return False if validation fails</span>

<span class="sd">                retry_interval    (int)    -- Interval (in seconds) after which job state</span>
<span class="sd">                                                    will be checked in a loop. Default = 10</span>

<span class="sd">                time_limit        (int)    -- Time limit after which job status check shall be</span>
<span class="sd">                                                aborted if the job does not reach the desired</span>
<span class="sd">                                                 state. Default (in minutes) = 15</span>

<span class="sd">                client_groups (list)       -- List of client groups to validate</span>

<span class="sd">            Returns:</span>
<span class="sd">                (bool)                     -- Based on validation failed/pass</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - if validation failed</span>
<span class="sd">                    - if module failed to execute due to some error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">client_groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client_groups</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Laptop Clients&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tenant_client_group</span><span class="p">:</span>
                    <span class="n">client_groups</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tenant_client_group</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validating if client [</span><span class="si">{0}</span><span class="s2">] is part of client groups [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">client_groups</span><span class="p">))</span>

            <span class="n">time_limit</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">+</span><span class="n">time_limit</span><span class="o">*</span><span class="mi">60</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Validate clients are part of tenant&#39;s / company&#39;s / default plan client group</span>
                <span class="c1"># flag should be set to false if the validation failed for any client group.</span>
                <span class="c1"># Do not exit loop until succeeds for all client groups.</span>
                <span class="k">for</span> <span class="n">_source</span> <span class="ow">in</span> <span class="n">client_groups</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">client</span><span class="p">,</span> <span class="n">_source</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">is_client_in_client_group</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="p">[</span><span class="n">_source</span><span class="p">]):</span>
                        <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">time_limit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Timed out after [</span><span class="si">{0}</span><span class="s2">min] waiting for client association&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_limit</span><span class="p">))</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for [</span><span class="si">{0}</span><span class="s2">] seconds &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retry_interval</span><span class="p">))</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_interval</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Client(s) [</span><span class="si">{0}</span><span class="s2">] did not get associated to client group [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client(s) [</span><span class="si">{0}</span><span class="s2">] associated successfully to client group [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">aserror</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fail</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">aserror</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.validate_client_owners"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.validate_client_owners">[docs]</a>    <span class="k">def</span> <span class="nf">validate_client_owners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">expected_owners</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validate owners for the client are as expected</span>
<span class="sd">        Args:</span>
<span class="sd">            clients    (str):        Client name</span>

<span class="sd">            expected_owners (list):  List of expected owners</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">expected_owners</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expected_owners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">client_obj</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">owners</span> <span class="o">=</span> <span class="n">client_obj</span><span class="o">.</span><span class="n">owners</span>
        <span class="k">assert</span> <span class="n">owners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">owners</span><span class="p">,</span> <span class="s2">&quot;No owners set for client [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">client_owners</span> <span class="o">=</span> <span class="p">[</span><span class="n">owner</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">owner</span> <span class="ow">in</span> <span class="n">owners</span><span class="p">]</span>
        <span class="n">expected_owners</span> <span class="o">=</span> <span class="p">[</span><span class="n">exp_owner</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">exp_owner</span> <span class="ow">in</span> <span class="n">expected_owners</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client&#39;s [</span><span class="si">{0}</span><span class="s2">] owners: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">owners</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client&#39;s [</span><span class="si">{0}</span><span class="s2">] expected owners: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">expected_owners</span><span class="p">)))</span>

        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">client_owners</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">expected_owners</span><span class="p">),</span> <span class="s2">&quot;[Client ownership validation failed]&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client ownership validation succeeded.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OrganizationHelper.disable_msp"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.disable_msp">[docs]</a>    <span class="k">def</span> <span class="nf">disable_msp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Disable MSP on the commcell if it is not already disabled.</span>

<span class="sd">            Args:</span>
<span class="sd">                None</span>

<span class="sd">            Returns:</span>
<span class="sd">                True    (bool)    - If the MSP is disabled on commcell</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - if Failed to disable MSP on commcell</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_msp</span><span class="p">():</span>
                <span class="c1"># If it is enabled, disable it and restart tomcat service</span>
                <span class="n">CommonUtils</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span><span class="o">.</span><span class="n">modify_additional_settings</span><span class="p">(</span><span class="s1">&#39;IsMSPCommcell&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restarting Tomcat service for the setting to take effect.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">commserv_client</span><span class="o">.</span><span class="n">restart_service</span><span class="p">(</span><span class="s2">&quot;GxTomcatInstance001&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_msp</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Failed to disable MSP on commcell&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successfully disabled MSP on commcell.&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.create_blacklisted_group"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.create_blacklisted_group">[docs]</a>    <span class="k">def</span> <span class="nf">create_blacklisted_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blacklist_group</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates blacklisted user group</span>
<span class="sd">            Args:</span>
<span class="sd">                blacklisted_group   (str):        Blacklisted user group name.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    None</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        - If module fail to execute at any step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">blacklist_group</span> <span class="o">=</span> <span class="n">securityconstants</span><span class="o">.</span><span class="n">BLACKLIST_USER_GROUP</span> <span class="k">if</span> <span class="n">blacklist_group</span> <span class="ow">is</span> <span class="kc">None</span> \
                <span class="k">else</span> <span class="n">blacklist_group</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">user_groups</span><span class="o">.</span><span class="n">has_user_group</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating blacklisted usergroup [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">user_groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Blacklisted usergroup [</span><span class="si">{0}</span><span class="s2">] already exists&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">)</span>

            <span class="c1"># Set blacklisted flag on the user group</span>
            <span class="n">qscript</span> <span class="o">=</span> <span class="s2">&quot;-sn &#39;BlacklistUserGroup&#39; -si &#39;&quot;</span> <span class="o">+</span> <span class="n">blacklist_group</span> <span class="o">+</span><span class="s2">&quot;&#39; -si 1&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executing qscript [</span><span class="si">{0}</span><span class="s2">] to set user group as blacklisted&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qscript</span><span class="p">))</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">_qoperation_execscript</span><span class="p">(</span><span class="n">qscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;qscript response: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Qscript Execution Succeeded&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]))):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to set user group [</span><span class="si">{0}</span><span class="s2">] as blacklisted&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">blacklist_group</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.delete_blacklisted_group"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.delete_blacklisted_group">[docs]</a>    <span class="k">def</span> <span class="nf">delete_blacklisted_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blacklist_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes blacklisted user group</span>
<span class="sd">            Args:</span>
<span class="sd">                blacklisted_group   (str):        Blacklisted user group name.</span>

<span class="sd">                new_user (str):                   User to which ownership shall be transferred</span>
<span class="sd">                                                    Default: admin</span>

<span class="sd">                Returns:</span>
<span class="sd">                    None</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        - If module fail to execute at any step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">blacklist_group</span> <span class="o">=</span> <span class="n">securityconstants</span><span class="o">.</span><span class="n">BLACKLIST_USER_GROUP</span> <span class="k">if</span> <span class="n">blacklist_group</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">blacklist_group</span>
            <span class="k">if</span> <span class="n">new_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_user</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">user_groups</span><span class="o">.</span><span class="n">has_user_group</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting blacklisted usergroup [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">user_groups</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">,</span> <span class="n">new_user</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Blacklisted usergroup [</span><span class="si">{0}</span><span class="s2">] does not exists&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">blacklist_group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_groups</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_groups</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.add_user_to_blacklisted_group"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.add_user_to_blacklisted_group">[docs]</a>    <span class="k">def</span> <span class="nf">add_user_to_blacklisted_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">blacklist_group</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a user to a blacklister user group</span>
<span class="sd">            Args:</span>
<span class="sd">                user                (str):        User name</span>

<span class="sd">                blacklisted_group   (str):        User group to add the user</span>

<span class="sd">                Returns:</span>
<span class="sd">                    None</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        - If module fail to execute at any step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">blacklist_group</span> <span class="o">=</span> <span class="n">securityconstants</span><span class="o">.</span><span class="n">BLACKLIST_USER_GROUP</span> <span class="k">if</span> <span class="n">blacklist_group</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">blacklist_group</span>
            <span class="n">ug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">user_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">)</span>
            <span class="n">ug</span><span class="o">.</span><span class="n">update_usergroup_members</span><span class="p">(</span><span class="n">request_type</span><span class="o">=</span><span class="s1">&#39;UPDATE&#39;</span><span class="p">,</span> <span class="n">users_list</span><span class="o">=</span><span class="p">[</span><span class="n">user</span><span class="p">],</span> <span class="n">local_usergroups</span><span class="o">=</span><span class="p">[</span>
                <span class="n">blacklist_group</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Added user [</span><span class="si">{0}</span><span class="s2">] to blacklisted user group [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user</span><span class="p">,</span>
                                                                                    <span class="n">blacklist_group</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Users in blacklisted usergroup [</span><span class="si">{0}</span><span class="s2">]: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">,</span>
                                                                               <span class="n">ug</span><span class="o">.</span><span class="n">users</span><span class="p">))</span>

            <span class="n">user_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">user_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_map</span><span class="p">[</span><span class="n">blacklist_group</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.remove_user_from_blacklisted_group"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.remove_user_from_blacklisted_group">[docs]</a>    <span class="k">def</span> <span class="nf">remove_user_from_blacklisted_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">blacklist_group</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes a user from a blacklister user group</span>
<span class="sd">            Args:</span>
<span class="sd">                user                (str):        User name</span>

<span class="sd">                blacklisted_group   (str):        User group to add the user</span>

<span class="sd">                Returns:</span>
<span class="sd">                    True: If no user group exists with the specified name</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        - If module fail to execute at any step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">blacklist_group</span> <span class="o">=</span> <span class="n">securityconstants</span><span class="o">.</span><span class="n">BLACKLIST_USER_GROUP</span> <span class="k">if</span> <span class="n">blacklist_group</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">blacklist_group</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">user_groups</span><span class="o">.</span><span class="n">has_user_group</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No user group exists with name [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="n">ug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">user_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">)</span>
            <span class="n">ug</span><span class="o">.</span><span class="n">update_usergroup_members</span><span class="p">(</span><span class="n">request_type</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="n">users_list</span><span class="o">=</span><span class="p">[</span><span class="n">user</span><span class="p">],</span> <span class="n">local_usergroups</span><span class="o">=</span><span class="p">[</span>
                <span class="n">blacklist_group</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removed user [</span><span class="si">{0}</span><span class="s2">] from blacklisted user group [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">blacklist_group</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Users in blacklisted usergroup [</span><span class="si">{0}</span><span class="s2">]: [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">,</span> <span class="n">ug</span><span class="o">.</span><span class="n">users</span><span class="p">))</span>

            <span class="n">user_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">blacklist_group</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_list</span><span class="p">:</span>
                <span class="n">user_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_map</span><span class="p">[</span><span class="n">blacklist_group</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.set_tenant_property"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.set_tenant_property">[docs]</a>    <span class="k">def</span> <span class="nf">set_tenant_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_name</span><span class="p">,</span> <span class="n">prop_value</span><span class="p">,</span> <span class="n">provider</span><span class="o">=</span><span class="s1">&#39;Commcell&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets a tenant property for a tenant or Commcell</span>
<span class="sd">            Args:</span>
<span class="sd">                provider   (str):          Provider name</span>
<span class="sd">                                                Default: &#39;Commcell&#39;  [Commcell]</span>

<span class="sd">                prop_name    (str):        Property name to set for the provider</span>

<span class="sd">                prop_value   (str):        Property valule to set for the property name</span>

<span class="sd">                Returns:</span>
<span class="sd">                    None</span>

<span class="sd">                Raises:</span>
<span class="sd">                    Exception:</span>
<span class="sd">                        - If module fail to execute at any step</span>
<span class="sd">                        - If failed to set Tenant/Commcell property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Setting property [</span><span class="si">{0}</span><span class="s2">] value [</span><span class="si">{1}</span><span class="s2">] for provider [</span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prop_name</span><span class="p">,</span> <span class="n">prop_value</span><span class="p">,</span> <span class="n">provider</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">qscript</span> <span class="o">=</span> <span class="s2">&quot;-sn SetCompanySetting.sql&quot;</span> <span class="o">+</span> <span class="s2">&quot; -si &#39;&quot;</span> <span class="o">+</span><span class="n">provider</span><span class="o">+</span><span class="s2">&quot;&#39; -si &#39;&quot;</span> <span class="o">+</span><span class="n">prop_name</span><span class="o">+</span><span class="s2">&quot;&#39; -si &#39;&quot;</span> <span class="o">+</span><span class="n">prop_value</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executing qscript [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qscript</span><span class="p">))</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">_qoperation_execscript</span><span class="p">(</span><span class="n">qscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Command output : [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Qscript Execution Succeeded&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">])):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to set property [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prop_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Execution of qscript succeeded.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.is_msp"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.is_msp">[docs]</a>    <span class="k">def</span> <span class="nf">is_msp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks if commcell is MSP</span>

<span class="sd">            Args:</span>
<span class="sd">                None</span>

<span class="sd">            Returns:</span>
<span class="sd">                True/False    (bool)    - If the MSP is enabled/disabled on commcell</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - if Failed to get the MSP details from commcell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># check if commcell is MSP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Getting current value for IsMSPCommcell from GXGlobalParam&#39;</span><span class="p">)</span>

            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">get_gxglobalparam_val</span><span class="p">(</span><span class="s1">&#39;IsMSPCommcell&#39;</span><span class="p">))</span>
            <span class="n">commserve_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">commserv_name</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Commcell [</span><span class="si">{0}</span><span class="s1">] is not an MSP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commserve_name</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Commcell [</span><span class="si">{0}</span><span class="s1">] is a MSP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commserve_name</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.is_domain_user"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.is_domain_user">[docs]</a>    <span class="k">def</span> <span class="nf">is_domain_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks if a user name is a domain user or local user</span>

<span class="sd">            Args:</span>
<span class="sd">                user_name (str):     Username</span>
<span class="sd">                                        e.g testuser1</span>

<span class="sd">            Returns:</span>
<span class="sd">                True/False    (bool)    - True if user is a domain user. False if it is local.</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    - if Failed at any point during execution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">user_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;User [</span><span class="si">{0}</span><span class="s2">] is a domain user&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user_name</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;User [</span><span class="si">{0}</span><span class="s2">] is a local user&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user_name</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.is_client_activated"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.is_client_activated">[docs]</a>    <span class="k">def</span> <span class="nf">is_client_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">plan</span><span class="p">,</span> <span class="n">retry_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_limit</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">hardcheck</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if client is activated and associated to plan</span>

<span class="sd">            Args:</span>
<span class="sd">                client            (str)    -- Client name</span>

<span class="sd">                plan              (str)    -- Plan for which the client needs to be checked for</span>
<span class="sd">                                              association</span>

<span class="sd">                retry_interval    (int)    -- Interval (in seconds), checked in a loop. Default = 10</span>

<span class="sd">                time_limit        (int)    -- Time limit to check for. Default (in minutes) = 12</span>

<span class="sd">                hardcheck         (bool)   -- If True, function will exception out in case client is</span>
<span class="sd">                                              not activated. If False, function will return with</span>
<span class="sd">                                              non-truthy value</span>

<span class="sd">            Returns:</span>
<span class="sd">                True/False        (bool)   -- In case client gets activated/or not</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception if :</span>

<span class="sd">                    - failed during execution of module</span>
<span class="sd">                    - client is not ready</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client_group</span> <span class="o">=</span> <span class="n">plan</span> <span class="o">+</span> <span class="s1">&#39; clients&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;Waiting for client [{0}] association with Plan&#39;s client group [{1}]&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">client</span><span class="p">,</span> <span class="n">client_group</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">clientgroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">client_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client_group</span><span class="p">)</span>
            <span class="n">assoc_clients</span> <span class="o">=</span> <span class="n">clientgroup</span><span class="o">.</span><span class="n">associated_clients</span>
            <span class="n">assoc_clients</span> <span class="o">=</span>  <span class="p">[</span><span class="n">each_client</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">each_client</span> <span class="ow">in</span> <span class="n">assoc_clients</span><span class="p">]</span>
            <span class="n">time_limit</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">+</span><span class="n">time_limit</span><span class="o">*</span><span class="mi">60</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">assoc_clients</span> <span class="ow">and</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">assoc_clients</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">time_limit</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for [</span><span class="si">{0}</span><span class="s2">] seconds. Client not activated.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retry_interval</span><span class="p">))</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_interval</span><span class="p">)</span>
                    <span class="n">clientgroup</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
                    <span class="n">assoc_clients</span> <span class="o">=</span> <span class="n">clientgroup</span><span class="o">.</span><span class="n">associated_clients</span>
                    <span class="n">assoc_clients</span> <span class="o">=</span>  <span class="p">[</span><span class="n">each_client</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">each_client</span> <span class="ow">in</span> <span class="n">assoc_clients</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">assoc_clients</span> <span class="ow">and</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">assoc_clients</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">hardcheck</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to activate. Client [</span><span class="si">{0}</span><span class="s2">] did not get associated to plan.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client [</span><span class="si">{0}</span><span class="s2">] is activated and associated to plan [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">plan</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.is_device_associated"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.is_device_associated">[docs]</a>    <span class="k">def</span> <span class="nf">is_device_associated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_machine_count</span><span class="p">,</span> <span class="n">retry_interval</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">time_limit</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">hardcheck</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if new device got associated to company. Before calling the module, make sure installation has</span>
<span class="sd">            completed on client and user is waiting for the device to get associated to company post client</span>
<span class="sd">            activation</span>

<span class="sd">            Args:</span>

<span class="sd">                pre_machine_count (int)    -- Machine count for company pre client installation.</span>

<span class="sd">                retry_interval    (int)    -- Interval (in seconds), checked in a loop. Default = 20</span>

<span class="sd">                time_limit        (int)    -- Time limit to check for. Default (in minutes) = 7</span>

<span class="sd">                hardcheck         (bool)   -- If True, function will exception out in case device is not associated</span>
<span class="sd">                                              If False, function will return with non-truthy value</span>

<span class="sd">            Returns:</span>
<span class="sd">                True/False        (bool)   -- In case device is/(is not) associated to company</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception if :</span>

<span class="sd">                    - failed during execution of module</span>
<span class="sd">                    - device is not associated</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pre_machine_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">machine_count</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Number of devices in company [</span><span class="si">{1}</span><span class="s2">] *before client activation: [</span><span class="si">{0}</span><span class="s2">]&quot;&quot;&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pre_machine_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">))</span>
            <span class="n">company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">)</span>
            <span class="n">company</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="n">post_machine_count</span> <span class="o">=</span> <span class="n">company</span><span class="o">.</span><span class="n">machine_count</span>

            <span class="n">time_limit</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">+</span><span class="n">time_limit</span><span class="o">*</span><span class="mi">60</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">post_machine_count</span> <span class="o">&gt;</span> <span class="n">pre_machine_count</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">time_limit</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for [</span><span class="si">{0}</span><span class="s2">] seconds. New device not associated yet.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retry_interval</span><span class="p">))</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_interval</span><span class="p">)</span>
                    <span class="n">company</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
                    <span class="n">post_machine_count</span> <span class="o">=</span> <span class="n">company</span><span class="o">.</span><span class="n">machine_count</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">post_machine_count</span> <span class="o">&gt;</span> <span class="n">pre_machine_count</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">hardcheck</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to associate new device to company [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;New device is associated to company [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Number of devices in company [</span><span class="si">{1}</span><span class="s2">] *after association: [</span><span class="si">{0}</span><span class="s2">]&quot;&quot;&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">company</span><span class="o">.</span><span class="n">machine_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.get_company_clients"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.get_company_clients">[docs]</a>    <span class="k">def</span> <span class="nf">get_company_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;http&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of clients of the company</span>

<span class="sd">        Args:</span>
<span class="sd">            port        : port used by webconsole tomcat</span>
<span class="sd">            protocol    : http or https</span>

<span class="sd">        Raises:</span>
<span class="sd">                        Exception:</span>
<span class="sd">                            - if failed to update data in DB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">company_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">organization_id</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;DECLARE @inClientId INT = 0/*GetAllClients*/;</span>
<span class="s1">                    DECLARE @inSCGId INT = 0/*SCGProcessing*/;</span>
<span class="s1">                    select name from app_client where id in ((</span>
<span class="s1">                     SELECT clientId FROM dbo.scgV2CompanyClientAssociations(&#39;=&#39;, </span><span class="si">{</span><span class="n">company_id</span><span class="si">}</span><span class="s1">  , @inClientId, @inSCGId )</span>
<span class="s1">                    )  UNION  (</span>
<span class="s1">                     SELECT clientId FROM dbo.scgV2CompanyClientInstallAssociations(&#39;=&#39;, </span><span class="si">{</span><span class="n">company_id</span><span class="si">}</span><span class="s1">  , @inClientId, @inSCGId )</span>
<span class="s1">                    ));&#39;&#39;&#39;</span>

        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span><span class="o">.</span><span class="n">update_commserve_db_via_cre</span><span class="p">(</span><span class="n">sql</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
            <span class="n">clients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">client</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">clients</span></div>

<div class="viewcode-block" id="OrganizationHelper.checkfor_company_secondplan"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.checkfor_company_secondplan">[docs]</a>    <span class="k">def</span> <span class="nf">checkfor_company_secondplan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plan_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verify Second plan associated with company or not&quot;&quot;&quot;</span>
        <span class="n">plans_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">plans</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">plans_list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Second plan [</span><span class="si">{0}</span><span class="s2">] is not associated with Company [</span><span class="si">{1}</span><span class="s2">].Please associate it &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">plan_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Second Plan [</span><span class="si">{0}</span><span class="s2">] is associated to company [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plan_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="OrganizationHelper.delete_domain"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.delete_domain">[docs]</a>    <span class="k">def</span> <span class="nf">delete_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes a domain from the commcell</span>

<span class="sd">            Args:</span>

<span class="sd">                domain_name (str)    -- Domain name</span>

<span class="sd">            Returns:</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception if :</span>
<span class="sd">                    - failed during execution of module</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">has_domain</span><span class="p">(</span><span class="n">domain_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting domain [</span><span class="si">{0}</span><span class="s2">] from commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">domain_name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">domain_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Domain [</span><span class="si">{0}</span><span class="s2">] does not exist on commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">domain_name</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">has_domain</span><span class="p">(</span><span class="n">domain_name</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to delete domain [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">domain_name</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OrganizationHelper.cleanup"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.OrganizationHelper.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Cleans up the environment modified on commcell by the helper class &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;***Cleaning up environmental changes for organization class***&quot;</span><span class="p">)</span>

        <span class="c1"># Remove the users added to blacklisted user groups as part of testcases.</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_map</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">user_group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_map</span><span class="p">:</span>
                <span class="n">users</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_map</span><span class="p">[</span><span class="n">user_group</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">_user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_user_from_blacklisted_group</span><span class="p">(</span><span class="n">_user</span><span class="p">,</span> <span class="n">user_group</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_groups</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">user_group</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blacklist_user_groups</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_blacklisted_group</span><span class="p">(</span><span class="n">user_group</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">commcell_default_plan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read only property for commcell_default_plan &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell_default_plan</span>

    <span class="nd">@commcell_default_plan</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">commcell_default_plan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plan_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            plan_name (str)    - Plan name</span>

<span class="sd">            Sets default plan at Commcell level</span>
<span class="sd">            This is independent of the Organization as this sets the default plan with</span>
<span class="sd">            organization id as 0</span>
<span class="sd">            AC-&gt;Administration-&gt;Commcell</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting default plan [</span><span class="si">%s</span><span class="s2">] for Commcell, with organization id = 0&quot;</span><span class="p">,</span> <span class="n">plan_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">set_default_plan</span><span class="p">(</span><span class="n">plan_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_commcell_default_plan</span> <span class="o">=</span> <span class="n">plan_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_plan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the Default Plans associated to this Organization.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">default_plan</span>

    <span class="nd">@default_plan</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">default_plan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the default plan associated with the Organization.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Company&#39;s [</span><span class="si">{0}</span><span class="s2">] default plan:[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">default_plan</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">default_plan</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Skipped setting company&#39;s default plan, as it is already set to this plan [</span><span class="si">{0}</span><span class="s2">]&quot;&quot;&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting default plan [</span><span class="si">{0}</span><span class="s2">] for Company [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                                                <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">default_plan</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">default_plan</span> <span class="o">==</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Failed to set company&#39;s default plan.&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully validated and assigned default plan [</span><span class="si">{0}</span><span class="s2">] for company [</span><span class="si">{1}</span><span class="s2">]&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">company_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the company name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">company</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the company object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span>

    <span class="nd">@company</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">company</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates company object based on given company name: (value)&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_company_name</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Failed to get company object </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                                                             <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tenant_client_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the tenant_client_group for the given company &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tenant_client_group</span>

    <span class="nd">@tenant_client_group</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tenant_client_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plan_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the Company&#39;s tenant client group for the given plan_name&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tenant_client_group</span> <span class="o">=</span> <span class="n">plan_name</span> <span class="o">+</span> <span class="s1">&#39; clients&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the client count associated for the given company &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_count</span>

    <span class="nd">@machine_count</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">machine_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set&#39;s the Tenant company&#39;s machine count &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_count</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shared_laptop_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Shared Laptop mode for the given company &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enabling shared laptop at commcell&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">enable_shared_laptop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Shared Laptop Usage is enabled for commcell&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">shared_laptop</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Shared Laptop Usage is enabled for Organization [</span><span class="si">{0}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Shared Laptop Usage is NOT enabled for Organization [</span><span class="si">{0}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">shared_laptop</span>

    <span class="nd">@shared_laptop_usage</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">shared_laptop_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set&#39;s the shared laptop usage for the organization</span>

<span class="sd">        Args:</span>

<span class="sd">        value (bool): True/False</span>
<span class="sd">            False: Enable Shared Laptop usage</span>
<span class="sd">            True: Disable Shared Laptop usage</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="s2">&quot;Disabling&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;Enabling&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> Shared Laptop Usage for Organization [</span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_company</span><span class="o">.</span><span class="n">shared_laptop</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="RoleHelper"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.RoleHelper">[docs]</a><span class="k">class</span> <span class="nc">RoleHelper</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Helper class to perform Roles REST API operations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes RoleHelper object</span>

<span class="sd">            Args:</span>
<span class="sd">                commcell    (obj)   -- Commcell object</span>

<span class="sd">                role        (str)   -- Role name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_role</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">role</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_role</span> <span class="o">=</span> <span class="n">role</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span> <span class="o">=</span> <span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roles_obj</span> <span class="o">=</span> <span class="n">Roles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span> <span class="o">=</span> <span class="n">database_helper</span><span class="o">.</span><span class="n">CommServDatabase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span> <span class="o">=</span> <span class="n">options_selector</span><span class="o">.</span><span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="p">)</span>

<div class="viewcode-block" id="RoleHelper.create_role"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.RoleHelper.create_role">[docs]</a>    <span class="k">def</span> <span class="nf">create_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role_name</span><span class="p">,</span> <span class="n">permission_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">random_permission</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;creates new role</span>

<span class="sd">             Args:</span>
<span class="sd">                 role_name          (str)   --  Name of the role to be created</span>

<span class="sd">                 category_list      (list)  --  role will be created with all the permissions</span>
<span class="sd">                                                associated with this category</span>

<span class="sd">                    e.g.: category Name=Client :role will have all permisisons from</span>
<span class="sd">                                        this category.</span>
<span class="sd">                    e.g.: category Name=Client Group :role will have all permissions</span>
<span class="sd">                                        from this category</span>
<span class="sd">                    e.g.: category Name=commcell :role will have all permissions from</span>
<span class="sd">                                        this category</span>

<span class="sd">                 validate         (boolean) -- Specifies whether to validate the role permissions/categories</span>

<span class="sd">                 permission_list (list)     --  permission array which is to be updated</span>
<span class="sd">                     e.g.: permisison_list=[&quot;View&quot;, &quot;Agent Management&quot;, &quot;Browse&quot;]</span>

<span class="sd">                 random_permission   (bool) --  generates random permissions and categories if value</span>
<span class="sd">                                                is set to True</span>
<span class="sd">             Returns:</span>
<span class="sd">                 Role Object</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;creating role </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">role_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random_permission</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;User preferred to generate random capabilities &quot;</span><span class="p">)</span>
            <span class="n">permission_list</span><span class="p">,</span> <span class="n">category_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_permissions_categories</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;creating role with randomly generated permission list and categoryName &quot;</span>
                          <span class="s2">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles_obj</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rolename</span><span class="o">=</span><span class="n">role_name</span><span class="p">,</span> <span class="n">permission_list</span><span class="o">=</span><span class="n">permission_list</span><span class="p">,</span>
                                        <span class="n">categoryname_list</span><span class="o">=</span><span class="n">category_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_role_permissions</span><span class="p">(</span><span class="n">request_type</span><span class="o">=</span><span class="s1">&#39;Update&#39;</span><span class="p">,</span> <span class="n">permission_list</span><span class="o">=</span><span class="n">permission_list</span><span class="p">,</span>
                                            <span class="n">category_list</span><span class="o">=</span><span class="n">category_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;created role successfully </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_role</span></div>

<div class="viewcode-block" id="RoleHelper.random_permissions"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.RoleHelper.random_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">random_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates 5 Random Permissions</span>

<span class="sd">             Returns:</span>
<span class="sd">                 list of 5 randomly selected permissions from DB</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating random permissions&quot;</span><span class="p">)</span>
        <span class="n">permission_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;select permissionName from UMPermissions where categoryId in &quot;</span>
                  <span class="s2">&quot;(select id from UMCategories where flags=0 and hierarchyLevel=2)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="n">permission_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="c1"># fetching total count of permissions from UMPermissions</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">permission_names</span><span class="p">)</span>
        <span class="c1">#generating random numbers to pick up 5 permissions from the permission list</span>
        <span class="n">permission_ids</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">permission_id</span> <span class="ow">in</span> <span class="n">permission_ids</span><span class="p">:</span>
            <span class="n">permission_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">permission_names</span><span class="p">[</span><span class="n">permission_id</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generated Random List of permissions :</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">permission_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">permission_list</span></div>

<div class="viewcode-block" id="RoleHelper.random_category"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.RoleHelper.random_category">[docs]</a>    <span class="k">def</span> <span class="nf">random_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="c1">#change the name of the function</span>
        <span class="sd">&quot;&quot;&quot;Generates 3 Random Category</span>

<span class="sd">             Returns:</span>
<span class="sd">                 list of 3 randomly selected categories from DB</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating random Category Names&quot;</span><span class="p">)</span>
        <span class="n">category_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># storing all categories in the lists</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select categoryName from UMCategories where flags = 0 and hierarchyLevel =2&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="n">categorynames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="c1"># fetching total count of category names from UMCatagories</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">categorynames</span><span class="p">)</span>
        <span class="c1"># generating random numbers to pick up 3 category names from the category list</span>
        <span class="n">category_ids</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">category_id</span> <span class="ow">in</span> <span class="n">category_ids</span><span class="p">:</span>
            <span class="n">category_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">categorynames</span><span class="p">[</span><span class="n">category_id</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generated Random List of Category Names :</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">category_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">category_list</span></div>

<div class="viewcode-block" id="RoleHelper.generate_permissions_categories"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.RoleHelper.generate_permissions_categories">[docs]</a>    <span class="k">def</span> <span class="nf">generate_permissions_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates 5 Random permissions and 3 Random Category</span>

<span class="sd">             Returns:</span>
<span class="sd">                 list of 5 randomly selected permissions from DB</span>
<span class="sd">                 list of 3 randomly selected categories from DB</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="n">_permissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_permissions</span><span class="p">()</span>
        <span class="n">_categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_category</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_permissions</span><span class="p">,</span> <span class="n">_categories</span></div>

<div class="viewcode-block" id="RoleHelper.delete_role"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.RoleHelper.delete_role">[docs]</a>    <span class="k">def</span> <span class="nf">delete_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes the role passed</span>
<span class="sd">        Args:</span>
<span class="sd">            role_name        (str)  -- object of role to be deleted</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if role deletion is unsuccessful</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;performing Delete Operation on role: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">role_name</span><span class="p">)</span>
        <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles_obj</span><span class="o">.</span><span class="n">has_role</span><span class="p">(</span><span class="n">role_name</span><span class="o">=</span><span class="n">role_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">role</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">roles_obj</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">role_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;role deletion is Successful&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Specified role is not present on the CommCell </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">role_name</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the role object of this commcell role&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_role</span>

    <span class="nd">@role</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;initialize role object&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_role</span> <span class="o">=</span> <span class="n">role_object</span>

<div class="viewcode-block" id="RoleHelper.update_role_properties"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.RoleHelper.update_role_properties">[docs]</a>    <span class="k">def</span> <span class="nf">update_role_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modification_request</span><span class="p">,</span> <span class="n">random_flag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">permissions_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update, Overwrite, deletes capabilities of the passed role</span>
<span class="sd">        Args:</span>
<span class="sd">            modification_request    (str)   --  Update, Overwrite, Delete operation for roles</span>

<span class="sd">            random_flag             (bool)  --  no permission list or category is required when</span>
<span class="sd">                                                this flag is set to True</span>

<span class="sd">            permission_list         (list)  --  new set of permissions assigned to role</span>

<span class="sd">            category_list           (list)  --  new set of category permissions assigned on role</span>

<span class="sd">            kwargs:</span>

<span class="sd">                name                (str)   --  New name to assigned to role</span>

<span class="sd">                description         (str)   --  New description to be assigned to role</span>

<span class="sd">                status              (bool)  --  Status flag for role</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_update_role_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">random_flag</span><span class="p">:</span> <span class="c1">#club both and add new function and call it here</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;User preferred to generate random capabilities&quot;</span><span class="p">)</span>
            <span class="n">permissions_list</span><span class="p">,</span> <span class="n">category_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_permissions_categories</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;updating role with randomly generated permissions and categories&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">permissions_list</span> <span class="ow">or</span> <span class="n">category_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">modify_capability</span><span class="p">(</span>
                <span class="n">request_type</span><span class="o">=</span><span class="n">modification_request</span><span class="p">,</span> <span class="n">permission_list</span><span class="o">=</span><span class="n">permissions_list</span><span class="p">,</span>
                <span class="n">categoryname_list</span><span class="o">=</span><span class="n">category_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_role_permissions</span><span class="p">(</span><span class="n">request_type</span><span class="o">=</span><span class="n">modification_request</span><span class="p">,</span>
                                            <span class="n">permission_list</span><span class="o">=</span><span class="n">permissions_list</span><span class="p">,</span>
                                            <span class="n">category_list</span><span class="o">=</span><span class="n">category_list</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_validate_role_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">permission_list</span><span class="p">,</span> <span class="n">category_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;validates capabilities present on the role with db values</span>
<span class="sd">        Args:</span>
<span class="sd">            request_type        (str)   --  Update, Overwrite, Delete operation for roles</span>

<span class="sd">            permission_list     (list)  --  set of permissions needed to be verified</span>

<span class="sd">            category_list       (list)  --  set of category permissions needed to be validated</span>

<span class="sd">            returns:</span>
<span class="sd">                True    :   if role capability validation is successful</span>
<span class="sd">            raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if Capability validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Exceptional permissions</span>

        <span class="n">permission_mappings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Data Protection Operations&quot;</span><span class="p">:</span> <span class="s2">&quot;Data Protection/Management Operations&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Delete CVApp&quot;</span><span class="p">:</span> <span class="s2">&quot;DBOnly&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DLP&quot;</span><span class="p">:</span> <span class="s2">&quot;DBOnly&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Operations on Storage Policy\Copy&quot;</span><span class="p">:</span> <span class="s2">&quot;Operations on Storage Policy \  Copy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Edit Storage Policy\Copy&quot;</span><span class="p">:</span> <span class="s2">&quot;Edit Storage Policy \ Copy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EndUser Access&quot;</span><span class="p">:</span> <span class="s2">&quot;End User Access&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Install client&quot;</span><span class="p">:</span> <span class="s2">&quot;Install Client&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Install Package/Update&quot;</span><span class="p">:</span> <span class="s2">&quot;Install Package / Update&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Data Cube View&quot;</span><span class="p">:</span> <span class="s2">&quot;DBOnly&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Execute CVApp&quot;</span><span class="p">:</span> <span class="s2">&quot;DBOnly&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Create CVApp&quot;</span><span class="p">:</span> <span class="s2">&quot;DBOnly&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Full Machine Recovery&quot;</span><span class="p">:</span> <span class="s2">&quot;In Place Full Machine Recovery&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Out of Place Recover&quot;</span><span class="p">:</span> <span class="s2">&quot;Out - of - Place Recover&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Credential Policy Creator&quot;</span><span class="p">:</span> <span class="s2">&quot;DBOnly&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Delete Storage Policy\Copy&quot;</span><span class="p">:</span> <span class="s2">&quot;Delete Storage Policy \ Copy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Data Cube Edit&quot;</span><span class="p">:</span> <span class="s2">&quot;DBOnly&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Edit CVApp&quot;</span><span class="p">:</span> <span class="s2">&quot;DBOnly&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Data Cube Execute&quot;</span><span class="p">:</span> <span class="s2">&quot;DBOnly&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">category_mappings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Report&quot;</span><span class="p">:</span> <span class="s2">&quot;Reports&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DataSource&quot;</span><span class="p">:</span> <span class="s2">&quot;Datasource&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Data Cube&quot;</span><span class="p">:</span> <span class="s2">&quot;DBOnly&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CVApp&quot;</span><span class="p">:</span> <span class="s2">&quot;DBOnly&quot;</span>
        <span class="p">}</span>

        <span class="n">temp_permission_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">temp_category_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;validating permissions and categories&#39;</span><span class="p">)</span>
        <span class="n">list_of_permissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">_role_permissions</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="n">list_of_permissions</span><span class="p">[</span><span class="s1">&#39;permission_list&#39;</span><span class="p">]</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="n">list_of_permissions</span><span class="p">[</span><span class="s1">&#39;category_list&#39;</span><span class="p">]</span>
        <span class="n">permission_arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;permission validation started&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">permission_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">permission_arr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">permission_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">permissions</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">permission_arr</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">permission_arr</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">permission_mappings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">permission_mappings</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="ow">in</span> <span class="n">permissions</span> <span class="ow">or</span> <span class="s1">&#39;DBOnly&#39;</span><span class="p">:</span>
                            <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp_permission_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp_permission_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: these permissions could be part of categories&quot;</span>
                          <span class="o">%</span> <span class="n">temp_permission_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating the category list for such permissions to &quot;</span>
                          <span class="s2">&quot;validate whether category is present on the role&quot;</span><span class="p">)</span>
            <span class="n">permission_set</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp_permission_list</span><span class="p">)</span>
            <span class="n">permission_set</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">permission_set</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">permission_set</span> <span class="o">=</span> <span class="n">permission_set</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span>
            <span class="n">permission_set</span> <span class="o">=</span> <span class="n">permission_set</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
            <span class="n">query_1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;select categoryName from UMCategories where id in &quot;</span>
                       <span class="s2">&quot;(select categoryId from UMPermissions where permissionName in </span><span class="si">%s</span><span class="s2">)&quot;</span>
                       <span class="o">%</span> <span class="n">permission_set</span><span class="p">)</span>
            <span class="n">cat</span><span class="p">,</span> <span class="n">cat1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="n">query_1</span><span class="p">)</span>
            <span class="n">category_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">categories</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">category_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;new set of categories for validation: </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span><span class="n">category_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;categories list present on the role: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">categories</span><span class="p">)</span>
            <span class="n">diff_categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">category_list</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">categories</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">diff_categories</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">diff_categories</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">category_mappings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">category_mappings</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="ow">in</span> <span class="n">category_list</span> <span class="ow">or</span> <span class="s1">&#39;DBOnly&#39;</span><span class="p">:</span>
                            <span class="k">continue</span>
                    <span class="n">temp_category_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">request_type</span> <span class="o">!=</span> <span class="s1">&#39;Delete&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;These categories are missing on role: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">temp_category_list</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not all categories present on the role&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;sucessfully deleted role permissions&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Capability Validation is successful on the role&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_update_role_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;updates the role status</span>
<span class="sd">        Args:</span>
<span class="sd">            status        (str)  -- True -Enable role, False -Disable role</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if role status update fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">role_status</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span><span class="kc">True</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;setting up role status&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_role_property</span><span class="p">(</span><span class="n">dbvalue</span><span class="o">=</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;UMRoles&#39;</span><span class="p">,</span>
                                         <span class="n">search_value</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">comp_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">role_name</span><span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">role_status</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">stat</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;failed to modify role status&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;successfully modified the role status&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_role_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;updates the role description</span>
<span class="sd">        Args:</span>
<span class="sd">            description        (str)  -- Description of the role</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if role description update fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;setting up description for role&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">role_description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_role_property</span><span class="p">(</span><span class="n">dbvalue</span><span class="o">=</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;UMRoles&#39;</span><span class="p">,</span>
                                         <span class="n">search_value</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">comp_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">role_name</span><span class="p">)</span>
        <span class="n">description1</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;role description from json: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;role description from db: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">description1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">description</span> <span class="o">!=</span> <span class="n">description1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;failed to modify role description&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;description for role is successfully updated&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_role_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;updates the role name</span>
<span class="sd">        Args:</span>
<span class="sd">            new_name        (str)  -- Name of the role</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if role name update fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;updating role with new name:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">new_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">role_name</span> <span class="o">=</span> <span class="n">new_name</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_role_property</span><span class="p">(</span><span class="n">dbvalue</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;UMroles&#39;</span><span class="p">,</span>
                                          <span class="n">search_value</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">comp_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">role_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;role name from json: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">role_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;role name from db: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">name1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_role</span><span class="o">.</span><span class="n">role_name</span> <span class="o">!=</span> <span class="n">name1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;failed to modify role name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;role name modification is successful&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_role_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbvalue</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">search_value</span><span class="p">,</span> <span class="n">comp_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets role proerties from db for validation</span>
<span class="sd">        Args:</span>
<span class="sd">            dbvalue         (str)   --  expected column value from db</span>

<span class="sd">            table_name      (str)   --  name of the table to query data</span>

<span class="sd">            search_value    (str)   --  column condition value</span>

<span class="sd">            comp_value      (str)   --  comparison value</span>

<span class="sd">            returns:</span>
<span class="sd">                DB result set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query_1</span> <span class="o">=</span> <span class="s2">&quot;select </span><span class="si">{0}</span><span class="s2"> from </span><span class="si">{1}</span><span class="s2"> where </span><span class="si">{2}</span><span class="s2">=&#39;</span><span class="si">{3}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbvalue</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span>
                                                               <span class="n">search_value</span><span class="p">,</span> <span class="n">comp_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query_1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="n">result1</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result1</span>

<div class="viewcode-block" id="RoleHelper.select_random_role"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.RoleHelper.select_random_role">[docs]</a>    <span class="k">def</span> <span class="nf">select_random_role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper class to perform Roles REST API operations</span>
<span class="sd">        Returns:</span>
<span class="sd">            Randomly selected role.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">role_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">all_roles</span>
        <span class="n">new_role</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">role_names</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Random role selected for association dictionary:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">new_role</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_role</span></div></div>


<div class="viewcode-block" id="SecurityHelper"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.SecurityHelper">[docs]</a><span class="k">class</span> <span class="nc">SecurityHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class to perform Roles REST API operations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes SecurityHelper object</span>

<span class="sd">            Args:</span>
<span class="sd">                commcell    (obj)   -- Commcell object</span>

<span class="sd">                role        (str)   -- Role name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_role</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">role</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_role</span> <span class="o">=</span> <span class="n">role</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span> <span class="o">=</span> <span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">role_helper</span> <span class="o">=</span> <span class="n">RoleHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csdb</span> <span class="o">=</span> <span class="n">database_helper</span><span class="o">.</span><span class="n">CommServDatabase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sqlite</span> <span class="o">=</span> <span class="n">database_helper</span><span class="o">.</span><span class="n">SQLite</span><span class="p">(</span><span class="n">database_file_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="n">securityconstants</span><span class="o">.</span><span class="n">SQLiteDB</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span> <span class="o">=</span> <span class="n">options_selector</span><span class="o">.</span><span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usergroup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">permissions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Administrative Management&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;Agent Management&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;Data Protection/Management Operations&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;In Place Recover&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;MediaAgent Management&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;Report Management&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
            <span class="s1">&#39;Agent Scheduling&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;Create Storage Policy Copy&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="s1">&#39;Job Management&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
            <span class="s1">&#39;Change security settings&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;User Management&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
            <span class="s1">&#39;Create Client Group&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
            <span class="s1">&#39;Change Client Associations&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="s1">&#39;Browse&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
            <span class="s1">&#39;Operations on Storage Policy </span><span class="se">\\</span><span class="s1">  Copy&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
            <span class="s1">&#39;Add, delete and modify a user&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
            <span class="s1">&#39;Add, delete and modify a user group&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
            <span class="s1">&#39;Create Schedule Policy&#39;</span><span class="p">:</span> <span class="mi">18</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entity_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;commCellName&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;clientGroupName&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;clientName&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;mediaAgentName&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;storagePolicyName&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;userName&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
            <span class="s1">&#39;userGroupName&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;providerDomainName&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="s1">&#39;entityAssociated1&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
            <span class="s1">&#39;entityAssociated2&#39;</span><span class="p">:</span> <span class="mi">10</span>
        <span class="p">}</span>

<div class="viewcode-block" id="SecurityHelper.gen_random_entity_types_dict"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.SecurityHelper.gen_random_entity_types_dict">[docs]</a>    <span class="k">def</span> <span class="nf">gen_random_entity_types_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">no_of_entity_types</span><span class="p">,</span> <span class="n">no_of_assoc</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate dictionary consisting of randomly selected dictionary types and roles</span>

<span class="sd">        no_of_entity_types  (Int)   -   no entity types to be generated</span>

<span class="sd">        no_of_assoc         (Int)   -   no. of associations that you want to generate randomly</span>
<span class="sd">                                        Basically no. of roles</span>

<span class="sd">        Returns:</span>
<span class="sd">            dictionary consisting of different roles and entity types</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">entity_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_of_assoc</span><span class="p">):</span>
            <span class="n">assoc1</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">entity_type</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_of_entity_types</span><span class="p">):</span>
                <span class="n">assoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_entity_role_dict</span><span class="p">(</span><span class="n">no_of_entities</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">assoc1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">assoc</span><span class="p">)</span>
            <span class="n">role_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">role_helper</span><span class="o">.</span><span class="n">select_random_role</span><span class="p">()</span>
            <span class="n">assoc1</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">role_name</span><span class="p">]</span>
            <span class="n">entity_dict</span><span class="p">[</span><span class="s2">&quot;assoc&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="n">assoc1</span>
        <span class="k">return</span> <span class="n">entity_dict</span></div>

<div class="viewcode-block" id="SecurityHelper.generate_random_entity_dict"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.SecurityHelper.generate_random_entity_dict">[docs]</a>    <span class="k">def</span> <span class="nf">generate_random_entity_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">no_of_assoc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">entities_count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates and returns random entity and role</span>

<span class="sd">        entity_type         (Str)   -   entity name used in xml</span>
<span class="sd">                                        example: &#39;clientName&#39;, &#39;workflowName&#39;.. etc</span>

<span class="sd">        no_of_assoc         (Int)   -   no. of associations that you want to generate randomly</span>

<span class="sd">        entities_count      (Int)   -   no. of entities you want to select for each association</span>

<span class="sd">        Returns:</span>
<span class="sd">            dictionary consisting of different roles and entity types and entities</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entity_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_of_assoc</span><span class="p">):</span>
            <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">role_helper</span><span class="o">.</span><span class="n">select_random_role</span><span class="p">()</span>
            <span class="n">assoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_entity_role_dict</span><span class="p">(</span><span class="n">entity_type</span><span class="o">=</span><span class="n">entity_type</span><span class="p">,</span>
                                              <span class="n">no_of_entities</span><span class="o">=</span><span class="n">entities_count</span><span class="p">,</span>
                                              <span class="n">role_name</span><span class="o">=</span><span class="n">role</span><span class="p">)</span>
            <span class="n">entity_dict</span><span class="p">[</span><span class="s2">&quot;assoc&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="n">assoc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;entity_dict: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">entity_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Enity-Role-Dictionary&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entity_dict</span></div>

<div class="viewcode-block" id="SecurityHelper.gen_entity_role_dict"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.SecurityHelper.gen_entity_role_dict">[docs]</a>    <span class="k">def</span> <span class="nf">gen_entity_role_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">entities</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">no_of_entities</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">role_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates and returns entity and role association not association dictionary</span>
<span class="sd">        Args:</span>
<span class="sd">            entity_type     (str)   : entity name used in xml</span>

<span class="sd">            entities        (list)  : list of entities belonging to entity type</span>

<span class="sd">            no_of_entities  (int)   : No. of entities to be selected of same entity_type</span>

<span class="sd">            role_name       (str)   : role name for association</span>

<span class="sd">        Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if entities for specified entity_type are not present on the commcell</span>

<span class="sd">        Returns:</span>
<span class="sd">            single association blob consisting of entities and role</span>
<span class="sd">            example:</span>
<span class="sd">            1) {&#39;schedulePolicyName&#39;: [&#39;system created for ddb subclients&#39;,</span>
<span class="sd">                &#39;system created ddb verification schedule policy&#39;]} if role is not passed.</span>
<span class="sd">                This can be used to form multiple entities with single role with help of function</span>
<span class="sd">                gen_random_entity_types_dict()</span>
<span class="sd">                example:</span>
<span class="sd">                {&#39;assoc0&#39;: {&#39;workflowName&#39;: [&#39;create collaborative shares&#39;, &#39;rdsmigration&#39;],</span>
<span class="sd">                &#39;schedulePolicyName&#39;: [&#39;system created autocopy schedule&#39;, &#39;server plan&#39;],</span>
<span class="sd">                &#39;role&#39;: [&#39;all users laptops&#39;]},</span>
<span class="sd">                &#39;assoc1&#39;: {&#39;clientName&#39;: [&#39;aprabhu_serv&#39;, &#39;client-point1_2&#39;],</span>
<span class="sd">                &#39;storagePolicyName&#39;: [&#39;test_pool1&#39;, &#39;commservedr&#39;], &#39;role&#39;: [&#39;client admins&#39;]}}</span>

<span class="sd">            2) if role is password:</span>
<span class="sd">                Single Association will be generated and returned with role</span>
<span class="sd">                {&#39;schedulePolicyName&#39;: [&#39;system created for ddb subclients&#39;,</span>
<span class="sd">                                        &#39;system created ddb verification schedule policy&#39;],</span>
<span class="sd">                &#39;role&#39;: [&#39;client group creator&#39;]}}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entity_type_dict1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;clientName&#39;</span><span class="p">:</span> <span class="s1">&#39;clients&#39;</span><span class="p">,</span>
                             <span class="c1"># &#39;mediaAgentName&#39;:self.commcell_obj.media_agents.all_media_agents,</span>
                             <span class="s1">&#39;workflowName&#39;</span><span class="p">:</span><span class="s1">&#39;workflows&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;alertName&#39;</span><span class="p">:</span> <span class="s1">&#39;alerts&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;libraryName&#39;</span><span class="p">:</span> <span class="s1">&#39;disk_libraries&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;storagePolicyName&#39;</span><span class="p">:</span> <span class="s1">&#39;storage_policies&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;schedulePolicyName&#39;</span><span class="p">:</span> <span class="s1">&#39;schedule_policies&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;userGroupName&#39;</span><span class="p">:</span> <span class="s1">&#39;user_groups&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;providerDomainName&#39;</span><span class="p">:</span> <span class="s1">&#39;domains&#39;</span><span class="p">,</span>
                             <span class="c1">#&#39;clientGroupName&#39;: self.commcell_obj.client_groups.all_clientgroups,</span>
                             <span class="s1">&#39;userName&#39;</span><span class="p">:</span><span class="s1">&#39;users&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;roleName&#39;</span><span class="p">:</span> <span class="s1">&#39;roles&#39;</span><span class="p">,</span>
                             <span class="c1">#&#39;policyName&#39;: self.commcell_obj.monitoring_policies.</span>
                             <span class="c1"># all_monitoring_policies,</span>
                             <span class="s1">&#39;commCellName&#39;</span><span class="p">:</span> <span class="s1">&#39;commCellName&#39;</span>
                            <span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*********Randomly selecting entity_type***********&quot;</span><span class="p">)</span>
            <span class="n">entity_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">entity_type_dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;selected entity_type:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;User passed entity_type:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">random_entities</span> <span class="o">=</span> <span class="n">entities</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entity_type</span> <span class="ow">is</span> <span class="s1">&#39;commCellName&#39;</span><span class="p">:</span>
                <span class="n">random_entities</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="o">.</span><span class="n">commserv_name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;commcell name is selected:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">random_entities</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attribute</span> <span class="o">=</span> <span class="s1">&#39;all_&#39;</span><span class="o">+</span><span class="n">entity_type_dict1</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span>
                <span class="n">colletion</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="p">,</span> <span class="n">entity_type_dict1</span><span class="p">[</span>
                    <span class="n">entity_type</span><span class="p">]),</span> <span class="n">attribute</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">colletion</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">no_of_entities</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;very less entities present on the commcell for </span><span class="si">{0}</span><span class="s2"> !!!&quot;</span>
                                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity_type</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">random_entities</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">colletion</span><span class="p">),</span> <span class="n">no_of_entities</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">random_entities</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Selected entities for associations:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">random_entities</span><span class="p">)</span>
            <span class="n">assoc1</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">entity_type</span><span class="p">:</span><span class="n">random_entities</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">role_name</span><span class="p">:</span>
                <span class="n">assoc1</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">role_name</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;designed entity-role association: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">assoc1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">assoc1</span></div>

<div class="viewcode-block" id="SecurityHelper.validate_security_associations"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.SecurityHelper.validate_security_associations">[docs]</a>    <span class="k">def</span> <span class="nf">validate_security_associations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_dict</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">isuser</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validates security Associations on user and userggroup</span>
<span class="sd">        Args:</span>
<span class="sd">            entity_dict         (Dict)  :   entity-role association dict</span>

<span class="sd">            name                (Str)   :   could be user name or usergroup name</span>

<span class="sd">            isuser              (Bool)  :   1= if name is of user, 0= if name is of usergroup</span>

<span class="sd">        Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any of the association doesn&#39;t present on the user or usergroup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_list1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">isuser</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">security_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">user_security_associations</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usergroup</span> <span class="o">=</span> <span class="n">UserGroup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">security_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usergroup</span><span class="o">.</span><span class="n">associations</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">security_dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;There is No Role-Entity-Association present on the </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entities</span> <span class="ow">in</span> <span class="n">security_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">entities</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">each_value</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;invalid&#39;</span> <span class="ow">in</span> <span class="n">each_value</span><span class="p">:</span>
                    <span class="n">keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entity_type</span><span class="p">))</span>
                    <span class="k">break</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">security_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>

        <span class="n">formatted_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">security_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dict1</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">security_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">security_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">security_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">security_dict</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">list1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">list1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">security_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="n">dict1</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">list1</span><span class="p">)</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">list1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">list1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">security_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="n">dict1</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">list1</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">security_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">security_list</span><span class="p">:</span>
                <span class="n">security_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">security_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">formatted_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">security_list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entity_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">entity</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">entity_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
                <span class="n">valid_list1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entity_list</span><span class="p">)</span>
            <span class="n">valid_list1</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">dictionary</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">valid_list1</span><span class="p">)</span>
            <span class="n">valid_list1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Association dictionary present on entity:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">entity_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Formatted Associations fetched from entity properties:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">security_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Formatted dictionary used for validation:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Security Validation started!!&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entities1</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">entity_type2</span><span class="p">,</span> <span class="n">entities2</span> <span class="ow">in</span> <span class="n">dict1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">entities1</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">entities2</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;validated:</span><span class="si">%s</span><span class="s2"> is present in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">entities1</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">entities2</span><span class="p">))</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">entity_type2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Security Validation failed!!: </span><span class="si">{0}</span><span class="s2"> is not present on </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">entities1</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">entities2</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span></div>

<div class="viewcode-block" id="SecurityHelper.return_association_details"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.SecurityHelper.return_association_details">[docs]</a>    <span class="k">def</span> <span class="nf">return_association_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns list of lists containing entityType, entityName and permissionName</span>

<span class="sd">            Args:</span>
<span class="sd">                user      (str)   -- user name</span>

<span class="sd">            Returns:</span>
<span class="sd">                list consisting of list of entityName, entityType, permissionName</span>
<span class="sd">            example:</span>
<span class="sd">                    [</span>
<span class="sd">                    [&#39;clientName&#39;, &#39;ClientEntityName&#39;, &#39;Agent Management&#39;],</span>
<span class="sd">                    [&#39;clientName&#39;, &#39;ClientEntityName&#39;, &#39;Browse&#39;],</span>
<span class="sd">                    [&#39;clientName&#39;, &#39;ClientEntityName&#39;, &#39;In Place Recover&#39;],</span>
<span class="sd">                    [&#39;commCellName&#39;, &#39;CommCellEntityName&#39;, &#39;Administrative Management&#39;],</span>
<span class="sd">                    [&#39;commCellName&#39;, &#39;CommCellEntityName&#39;, &#39;Add, delete and modify a user&#39;],</span>
<span class="sd">                    [&#39;commCellName&#39;, &#39;CommCellEntityName&#39;, &#39;Add, delete and modify a user group&#39;]</span>
<span class="sd">                    ]</span>



<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">user_associations</span> <span class="o">=</span> <span class="n">user1</span><span class="o">.</span><span class="n">user_security_associations</span>
        <span class="n">associations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">each_asso</span> <span class="ow">in</span> <span class="n">user_associations</span><span class="p">:</span>
            <span class="n">asso1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">user_associations</span><span class="p">[</span><span class="n">each_asso</span><span class="p">])</span>
            <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell_obj</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_associations</span><span class="p">[</span><span class="n">each_asso</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">capabilities</span> <span class="o">=</span> <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="p">[</span><span class="s1">&#39;permission_list&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">each_permission</span> <span class="ow">in</span> <span class="n">capabilities</span><span class="p">:</span>
                <span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="n">asso1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">asso1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">each_permission</span><span class="p">]</span>
                <span class="n">associations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Entity-Permission list is fetched from user associations: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">associations</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">associations</span></div>

<div class="viewcode-block" id="SecurityHelper.calculate_capability_bitmask"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.SecurityHelper.calculate_capability_bitmask">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_capability_bitmask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_permission_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns list of lists containing entityType, entityName and permissionName</span>

<span class="sd">            Args:</span>
<span class="sd">                entity_permission_list      (str)   --  list consisting of entityType and</span>
<span class="sd">                                                        permissionName</span>
<span class="sd">                                                        example- [&#39;clientName&#39;, &#39;Agent Management&#39;],</span>
<span class="sd">                                                                [&#39;clientName&#39;, &#39;In Place Recover&#39;]</span>


<span class="sd">            Returns:</span>
<span class="sd">                Integer value: CapabilityBitMask</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Code required to Generate Capability Bit Mask for each operations</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        entity_permission_list = [[[&#39;commCellName&#39;, &#39;Administrative Management&#39;]],</span>
<span class="sd">                                  [[&#39;commCellName&#39;, &#39;Administrative Management&#39;]],</span>
<span class="sd">                                  [[&#39;clientGroupName&#39;,&#39;Administrative Management&#39;]],</span>
<span class="sd">                                  [[&#39;clientName&#39;,&#39;Agent Management&#39;]],</span>
<span class="sd">                                  [[&#39;clientName&#39;,&#39;Agent Management&#39;]],</span>
<span class="sd">                                  [[&#39;clientName&#39;,&#39;Data Protection/Management Operations&#39;],</span>
<span class="sd">                                  [&#39;storagePolicyName&#39;,&#39;Operations on Storage Policy \\  Copy&#39;]],</span>
<span class="sd">                                  [[&#39;clientName&#39;,&#39;In Place Recover&#39;],[&#39;clientName&#39;,&#39;Browse&#39;]],</span>
<span class="sd">                                  [[&#39;clientGroupName&#39;,&#39;Agent Management&#39;]],</span>
<span class="sd">                                  [[&#39;commCellName&#39;, &#39;Administrative Management&#39;]],</span>
<span class="sd">                                  [[&#39;commCellName&#39;, &#39;Administrative Management&#39;]],</span>
<span class="sd">                                  [[&#39;mediaAgentName&#39;,&#39;MediaAgent Management&#39;]],</span>
<span class="sd">                                  [[&#39;commCellName&#39;,&#39;Report Management&#39;]],</span>
<span class="sd">                                  [[&#39;clientName&#39;, &#39;Agent Scheduling&#39;],[&#39;clientName&#39;,</span>
<span class="sd">                                  &#39;Data Protection/Management Operations&#39;]],</span>
<span class="sd">                                  [[&#39;clientName&#39;, &#39;Agent Scheduling&#39;],[&#39;clientName&#39;,</span>
<span class="sd">                                  &#39;In Place Recover&#39;]],</span>
<span class="sd">                                  [[&#39;commCellName&#39;, &#39;Administrative Management&#39;]],</span>
<span class="sd">                                  [[&#39;clientName&#39;, &#39;Agent Scheduling&#39;],[&#39;clientName&#39;,</span>
<span class="sd">                                  &#39;Data Protection/Management Operations&#39;]],</span>
<span class="sd">                                  [[&#39;commCellName&#39;, &#39;Create Storage Policy\Copy&#39;]],</span>
<span class="sd">                                  [[&#39;clientName&#39;, &#39;Job Management&#39;]],</span>
<span class="sd">                                  [[&#39;entityAssociated1&#39;, &#39;Add, delete and modify a user&#39;]],</span>
<span class="sd">                                  [[&#39;entityAssociated2&#39;, &#39;Add, delete and modify a user group&#39;]],</span>
<span class="sd">                                  [[&#39;commCellName&#39;, &#39;Create Client Group&#39;]]</span>
<span class="sd">                                  ]</span>
<span class="sd">        entity_types = {</span>
<span class="sd">            &#39;commCellName&#39;: 1,</span>
<span class="sd">            &#39;clientGroupName&#39;: 2,</span>
<span class="sd">            &#39;clientName&#39;: 3,</span>
<span class="sd">            &#39;mediaAgentName&#39;: 4,</span>
<span class="sd">            &#39;storagePolicyName&#39;: 5,</span>
<span class="sd">            &#39;userName&#39;: 6,</span>
<span class="sd">            &#39;userGroupName&#39;: 7,</span>
<span class="sd">            &#39;providerDomainName&#39;: 8,</span>
<span class="sd">            &#39;entityAssociated1&#39;: 9,</span>
<span class="sd">            &#39;entityAssociated2&#39;: 10</span>
<span class="sd">        }</span>

<span class="sd">        for each_entry in entity_permission_list:</span>
<span class="sd">            total = 0</span>
<span class="sd">            for row in each_entry:</span>
<span class="sd">                #print(&quot;row:&quot;, row[0], row[1])</span>
<span class="sd">                mask = ((entity_types[row[0]]-1)*len(permissions))+(permissions[row[1]])</span>
<span class="sd">                value = pow(2, mask-1)</span>
<span class="sd">                total = total+value</span>
<span class="sd">            print(&#39;operation and mask:&#39;, each_entry, total)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">entity_types</span><span class="p">[</span><span class="n">entity_permission_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permissions</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">permissions</span><span class="p">[</span><span class="n">entity_permission_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>  <span class="c1"># set zeroes for other permissions</span>
        <span class="c1"># in other entityType (-1:</span>
        <span class="c1"># is to exclude current entityType and set zero for other entityTypes)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">mask</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calculated mask for </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="n">entity_permission_list</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="SecurityHelper.valid_operations_for_user"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.SecurityHelper.valid_operations_for_user">[docs]</a>    <span class="k">def</span> <span class="nf">valid_operations_for_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates Intended Operations for User</span>

<span class="sd">            Args:</span>

<span class="sd">                user_name      (str)   -- Name of the User</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">entity_mask_value</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">associations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_association_details</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">each_asso</span> <span class="ow">in</span> <span class="n">associations</span><span class="p">:</span>
            <span class="n">user_associations</span> <span class="o">=</span> <span class="p">[</span><span class="n">each_asso</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">each_asso</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>  <span class="c1"># entityType and permission</span>
            <span class="k">if</span> <span class="n">user_associations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Add, delete and modify a user&quot;</span><span class="p">:</span>  <span class="c1"># this is special case to</span>
                <span class="c1"># handle user and user group operations</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;User permissions are present, so appending entities list with &#39;</span>
                              <span class="s1">&#39;&quot;entityAssociated&quot;&#39;</span><span class="p">)</span>
                <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">each_asso</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;entityAssociated1&#39;</span>  <span class="c1"># entityType defined in sqlite DB</span>
            <span class="k">elif</span> <span class="n">user_associations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Add, delete and modify a user group&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;User permissions are present, so appending entities list with &#39;</span>
                              <span class="s1">&#39;&quot;entityAssociated&quot;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">each_asso</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
                    <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">each_asso</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;entityAssociated2&#39;</span>
            <span class="k">if</span> <span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>  <span class="c1"># collecting unique entityTypes</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Adding &quot;</span><span class="si">%s</span><span class="s1">&quot; to entities list&#39;</span><span class="p">,</span> <span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># collect all entity types</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;entity &quot;</span><span class="si">%s</span><span class="s1">&quot; already present in the list&#39;</span><span class="p">,</span> <span class="n">entities</span><span class="p">)</span>
                <span class="c1"># Ignore entityType if it is already present in the list</span>

            <span class="n">entity_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_capability_bitmask</span><span class="p">(</span><span class="n">entity_permission_list</span><span class="o">=</span>
                                                            <span class="n">user_associations</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entity_mask_value</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># if &#39;Add, delete and modify a user&#39; in user_associations[1]:</span>
                <span class="c1">#     entity_mask_value[user_associations[0]] = entity_mask</span>
                <span class="c1">#  this condition is to reduce redundant entries to table</span>
                <span class="n">entity_mask_value</span><span class="p">[</span><span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">entity_mask</span>
                <span class="n">sql_cmd1</span> <span class="o">=</span> <span class="s2">&quot;Insert into EntityCapabilityBitMask values(&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">each_asso</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">entity_mask_value</span><span class="p">[</span><span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sqlite</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_cmd1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#  if entry is already present then update the mask value</span>
                <span class="n">entity_mask_value</span><span class="p">[</span><span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">entity_mask_value</span><span class="p">[</span><span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> \
                                                          <span class="o">+</span> <span class="n">entity_mask</span>
                <span class="n">sql_cmd1</span> <span class="o">=</span> <span class="s2">&quot;update EntityCapabilityBitMask set EntityBitMask = </span><span class="si">%s</span><span class="s2"> where&quot;</span> \
                           <span class="s2">&quot; entityType = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity_mask_value</span><span class="p">[</span><span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                                   <span class="n">user_associations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sqlite</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_cmd1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Total Entities collected from user associations: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">entities</span><span class="p">)</span>

        <span class="n">sql_cmd2</span> <span class="o">=</span> <span class="s2">&quot;Select Operation, OperationBitMask, RequiredEntityType, AdditionalEntityType &quot;</span>\
                   <span class="s2">&quot;from OperationCapabilities where RequiredEntityType in(&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">sql_cmd2</span> <span class="o">+=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">item</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
            <span class="k">if</span> <span class="n">entities</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">sql_cmd2</span> <span class="o">+=</span> <span class="s2">&quot;,&quot;</span>
        <span class="n">sql_cmd2</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlite</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_cmd2</span><span class="p">)</span><span class="o">.</span><span class="n">rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Total operations collected from Operations capabilities table: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
        <span class="n">sql_cmd3</span> <span class="o">=</span> <span class="s2">&quot;select * from EntityCapabilityBitMask&quot;</span>
        <span class="n">entity_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlite</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_cmd3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;EntityCapabilityBit Mask generated for each entity present on user&quot;</span>
                      <span class="s2">&quot; associations:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">entity_res</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>

        <span class="n">entity_dict2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">each_entity</span> <span class="ow">in</span> <span class="n">entity_res</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">each_entity</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;entityAssociated&#39;</span> <span class="ow">in</span> <span class="n">entity</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">each_entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;entityAssociated&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">each_entity</span><span class="p">:</span>
                        <span class="n">entity_dict2</span><span class="p">[</span><span class="n">each_entity</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">entity</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
            <span class="n">entity_dict2</span><span class="p">[</span><span class="n">entity</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">entity</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>  <span class="c1"># entityType as key and</span>
            <span class="c1"># entityName and mask as values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;converting EntityCapabilityBit Mask to dictionary with entityType as&#39;</span>
                      <span class="s1">&#39; key and entityName and mask as values:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">entity_dict2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">each_op</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
            <span class="n">operation1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">each_op</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">can_perform_operations</span><span class="p">(</span><span class="n">operation1</span><span class="p">,</span> <span class="n">entity_dict2</span><span class="p">,</span> <span class="n">user_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SecurityHelper.can_perform_operations"><a class="viewcode-back" href="../../../source/Server.Security.html#Server.Security.securityhelper.SecurityHelper.can_perform_operations">[docs]</a>    <span class="k">def</span> <span class="nf">can_perform_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">entity_dict</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inserts valid and intended operations list to DB.</span>

<span class="sd">            Args:</span>

<span class="sd">                operation       (str)   --  Each Operation that is being checked</span>

<span class="sd">                entity_dict     (dict)  --  Dict containing entityType as key and entityName</span>
<span class="sd">                                            and mask as values</span>
<span class="sd">                username        (str)   --  Name of the User</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">entity_dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operation</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">entity_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">required_entity_mask</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entity_dict</span><span class="p">[</span><span class="n">operation</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">additional_entity_mask</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">operation</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span><span class="p">[</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">operation</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="ow">and</span> <span class="n">operation</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="n">entity_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">additional_entity_mask</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entity_dict</span><span class="p">[</span><span class="n">operation</span><span class="p">[</span><span class="mi">3</span><span class="p">]][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">total_entity_mask</span> <span class="o">=</span> <span class="n">required_entity_mask</span> <span class="o">+</span> <span class="n">additional_entity_mask</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">operation</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">total_entity_mask</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">operation</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Successful Operation:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">operation</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">sql_cmd1</span> <span class="o">=</span> <span class="s2">&quot;Insert into IntendedResulttable values(&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, 1, &#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">operation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">operation</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">entity_dict</span><span class="p">[</span><span class="n">operation</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="n">username</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sqlite</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_cmd1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;expected failure Operation:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">operation</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">sql_cmd3</span> <span class="o">=</span> <span class="s2">&quot;Insert into IntendedResulttable values(&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, 0, &#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">operation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">operation</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">entity_dict</span><span class="p">[</span><span class="n">operation</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="n">username</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sqlite</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_cmd3</span><span class="p">)</span></div></div>

    <span class="c1"># def update_operaion_capabilities(self):</span>
    <span class="c1">#</span>
    <span class="c1">#     # Code required to Generate Capability Bit Mask for each operations</span>
    <span class="c1">#</span>
    <span class="c1">#     entity_permission_list = [[[&#39;commCellName&#39;, &#39;Administrative Management&#39;]],</span>
    <span class="c1">#                               [[&#39;commCellName&#39;, &#39;Administrative Management&#39;]],</span>
    <span class="c1">#                               [[&#39;clientGroupName&#39;,&#39;Administrative Management&#39;]],</span>
    <span class="c1">#                               [[&#39;clientName&#39;,&#39;Agent Management&#39;]],</span>
    <span class="c1">#                               [[&#39;clientName&#39;,&#39;Agent Management&#39;]],</span>
    <span class="c1">#                               [[&#39;clientName&#39;,&#39;Data Protection/Management Operations&#39;],</span>
    <span class="c1">#                               [&#39;storagePolicyName&#39;,&#39;Operations on Storage Policy \\  Copy&#39;]],</span>
    <span class="c1">#                               [[&#39;clientName&#39;,&#39;In Place Recover&#39;],[&#39;clientName&#39;,&#39;Browse&#39;]],</span>
    <span class="c1">#                               [[&#39;clientGroupName&#39;,&#39;Agent Management&#39;]],</span>
    <span class="c1">#                               [[&#39;commCellName&#39;, &#39;Administrative Management&#39;]],</span>
    <span class="c1">#                               [[&#39;commCellName&#39;, &#39;Administrative Management&#39;]],</span>
    <span class="c1">#                               [[&#39;mediaAgentName&#39;,&#39;MediaAgent Management&#39;]],</span>
    <span class="c1">#                               [[&#39;commCellName&#39;,&#39;Report Management&#39;]],</span>
    <span class="c1">#                               [[&#39;clientName&#39;, &#39;Agent Scheduling&#39;],[&#39;clientName&#39;,</span>
    <span class="c1">#                               &#39;Data Protection/Management Operations&#39;]],</span>
    <span class="c1">#                               [[&#39;clientName&#39;, &#39;Agent Scheduling&#39;],[&#39;clientName&#39;,</span>
    <span class="c1">#                               &#39;In Place Recover&#39;]],</span>
    <span class="c1">#                               [[&#39;commCellName&#39;, &#39;Administrative Management&#39;]],</span>
    <span class="c1">#                               [[&#39;clientName&#39;, &#39;Agent Scheduling&#39;],[&#39;clientName&#39;,</span>
    <span class="c1">#                               &#39;Data Protection/Management Operations&#39;]],</span>
    <span class="c1">#                               [[&#39;commCellName&#39;, &#39;Create Storage Policy\Copy&#39;]],</span>
    <span class="c1">#                               [[&#39;clientName&#39;, &#39;Job Management&#39;]],</span>
    <span class="c1">#                               [[&#39;entityAssociated1&#39;, &#39;Add, delete and modify a user&#39;]],</span>
    <span class="c1">#                               [[&#39;entityAssociated2&#39;, &#39;Add, delete and modify a user group&#39;]],</span>
    <span class="c1">#                               [[&#39;commCellName&#39;, &#39;Create Client Group&#39;]]</span>
    <span class="c1">#                               ]</span>
    <span class="c1">#     entity_types = {</span>
    <span class="c1">#         &#39;commCellName&#39;: 1,</span>
    <span class="c1">#         &#39;clientGroupName&#39;: 2,</span>
    <span class="c1">#         &#39;clientName&#39;: 3,</span>
    <span class="c1">#         &#39;mediaAgentName&#39;: 4,</span>
    <span class="c1">#         &#39;storagePolicyName&#39;: 5,</span>
    <span class="c1">#         &#39;userName&#39;: 6,</span>
    <span class="c1">#         &#39;userGroupName&#39;: 7,</span>
    <span class="c1">#         &#39;providerDomainName&#39;: 8,</span>
    <span class="c1">#         &#39;entityAssociated1&#39;: 9,</span>
    <span class="c1">#         &#39;entityAssociated2&#39;: 10</span>
    <span class="c1">#     }</span>
    <span class="c1">#</span>
    <span class="c1">#     for each_entry in entity_permission_list:</span>
    <span class="c1">#         total = 0</span>
    <span class="c1">#         for row in each_entry:</span>
    <span class="c1">#             # print(&quot;row:&quot;, row[0], row[1])</span>
    <span class="c1">#             mask = ((entity_types[row[0]]-1)*len(self.permissions))+(self.permissions[row[1]])</span>
    <span class="c1">#             value = pow(2, mask-1)</span>
    <span class="c1">#             total = total+value</span>
    <span class="c1">#         print(&#39;operation and mask:&#39;, each_entry, total)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>