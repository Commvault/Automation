

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Server.Workflow.workflowhelper &mdash; Commvault Automation 11.23 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>Server.Workflow.workflowhelper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Server.Workflow.workflowhelper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;Main file for performing workflow operations on Commcell</span>

<span class="sd">WorkflowHelper is the only class defined in this file</span>

<span class="sd">WorkflowHelper:    Provides functionality to deploy and execute workflows on</span>
<span class="sd">                    WorkflowEngine.</span>

<span class="sd">WorkflowHelper:</span>
<span class="sd">    __init__()                  --  initialize instance of the WorkflowHelper class</span>

<span class="sd">    __repr__()                  --  Representation string for the instance of the</span>
<span class="sd">                                    WorkflowHelper class</span>

<span class="sd">    has_workflow()              -- Checks if a workflow exists in the commcell with the input workflow name</span>

<span class="sd">    download_workflow_from_store()</span>
<span class="sd">                                -- Downloads workflow from Software Store</span>

<span class="sd">    execute()                   --  Deploy and execute the workflow on the WorkflowEngine</span>
<span class="sd">                                    and wait for the workjflow job completion.</span>
<span class="sd">                                    If workflow is not deployed or imported, it imports/deploys</span>
<span class="sd">                                    the workflow.</span>
<span class="sd">                                    Also deploys any dependent custom created activities</span>

<span class="sd">    deploy()                    -- Imports and deploys workflow and dependent(embedded)</span>
<span class="sd">                                    workflows on WFEngine.</span>
<span class="sd">                                    Also deploys custom activities which the workflow requires.</span>

<span class="sd">    deploy_workflow()           -- Deploy a workflow</span>

<span class="sd">    import_workflow()           -- Import a workflow</span>

<span class="sd">    delete()                    -- Deletes a workflow from the Commcell</span>

<span class="sd">    user_interactions()         -- Returns all the pending interactions from a specific user as a list</span>

<span class="sd">    submit_interaction()        -- Submit user interaction for user input activity</span>

<span class="sd">    modify_workflow_configuration()</span>
<span class="sd">                                -- Modify workflow configuration [ Under properties tab ]</span>

<span class="sd">    process_user_requests()     -- Approves user requests and wait for workflow job to complete.</span>

<span class="sd">    bl_workflows_setup()        -- Pre setup steps for Business logic workflow related test cases for softwarestore</span>

<span class="sd">    is_deployed()               -- Returns True if workflow is deployed</span>

<span class="sd">    workflow_job_status()       -- Validates the status of jobId for the workflow executed</span>

<span class="sd">    get_client_name_and_hostname_based_on_configuration()</span>
<span class="sd">                                -- To get clientname and hostname based on the workflow configuration</span>

<span class="sd">    export_workflow()           -- Export the workflow xml</span>

<span class="sd">    execute_api()               -- Executes the workflow which is in API Mode using a given API</span>

<span class="sd">    clone()                     -- Clones the workflow</span>

<span class="sd">    enable_workflow()           -- Enables the workflow</span>

<span class="sd">    disable_workflow()          -- Disables the workflow</span>

<span class="sd">    hidden_workflow()           -- Get Workflow object for specific workflows</span>

<span class="sd">    schedule_workflow():        -- Creates a schedule for a workflow</span>

<span class="sd">    set_auto_deploy_property()</span>
<span class="sd">                                -- Sets the auto deploy property of the workflow</span>

<span class="sd">    cleanup()                   -- Cleanup the testcase workflows</span>

<span class="sd">    get_db_bl_workflow()        -- Gets the App_messagehandler table data for the given message name and workflow name</span>
<span class="sd">    </span>
<span class="sd">Attributes:</span>

<span class="sd">    **workflow_name**   -- Returns the name of the workflow</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Python standard library imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">xmltodict</span>

<span class="c1"># Test suite imports</span>
<span class="kn">from</span> <span class="nn">Server.Workflow</span> <span class="kn">import</span> <span class="n">workflowconstants</span> <span class="k">as</span> <span class="n">WC</span>
<span class="kn">from</span> <span class="nn">Server.serverhelper</span> <span class="kn">import</span> <span class="n">ServerTestCases</span>
<span class="kn">from</span> <span class="nn">Server.JobManager.jobmanager_helper</span> <span class="kn">import</span> <span class="n">JobManager</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="kn">import</span> <span class="n">OptionsSelector</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.database_helper</span> <span class="kn">import</span> <span class="n">CommServDatabase</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.config</span> <span class="kn">import</span> <span class="n">get_config</span>


<div class="viewcode-block" id="WorkflowHelper"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper">[docs]</a><span class="k">class</span> <span class="nc">WorkflowHelper</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Workflow helper class to perform workflow related operations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testcase</span><span class="p">,</span> <span class="n">wf_name</span><span class="p">,</span> <span class="n">wf_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deploy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">commcell</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize instance of the WorkflowHelper class.</span>
<span class="sd">            Args:</span>
<span class="sd">                testcase  (TestCase instance) -- Instance of TestCase class</span>

<span class="sd">                wf_name   (str)               -- Workflow name</span>

<span class="sd">                wf_dict   (dict)              -- Workflow dictionary containing</span>
<span class="sd">                                                 workflow and/or activity xml locations,</span>
<span class="sd">                                                 embedded workflows/activities map and</span>
<span class="sd">                                                 workflow engine where workflow need to</span>
<span class="sd">                                                 be deployed</span>
<span class="sd">                                         e.g</span>
<span class="sd">                                         {</span>
<span class="sd">                                             &#39;wf_engine&#39;: &#39;WorkflowEngineServer&#39;,</span>
<span class="sd">                                             &#39;workflow_xml_path&#39;: &#39;C:/Workflows&#39;,</span>
<span class="sd">                                             &#39;workflow_activities_path&#39;: &#39;C:/Activities&#39;</span>
<span class="sd">                                             &#39;workflow_map&#39;:{</span>
<span class="sd">                                                &#39;common_workflows&#39;:[&quot;wf_email&quot;, &quot;wf_pause&quot;],</span>
<span class="sd">                                                &#39;wf_acquire_lock_parent&#39;: {</span>
<span class="sd">                                                    &#39;Child&#39;: [&quot;wf_acquire_lock_child&quot;],</span>
<span class="sd">                                                            },</span>
<span class="sd">                                         }</span>

<span class="sd">                deploy ( bool)                -- If deploy is set to True workflow would be deployed if not already</span>
<span class="sd">                                                    deployed.</span>

<span class="sd">                commcell (object)             -- Commcell object predefined for a specific user.</span>
<span class="sd">                                                    Default: Test Framework commcell object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="o">=</span> <span class="n">testcase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span> <span class="o">=</span> <span class="n">wf_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_email</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">email_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workflow_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">Workflow</span>

        <span class="c1"># in case the commcell object is defined for specific user</span>
        <span class="k">if</span> <span class="n">commcell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">commcell</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">workflows</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">ServerTestCases</span><span class="p">(</span><span class="n">testcase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span> <span class="o">=</span> <span class="n">CommServDatabase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="n">wf_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">wf_dict</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">wf_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_engine</span> <span class="o">=</span> <span class="n">wf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wf_engine&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">commserv_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_xml_path</span> <span class="o">=</span> <span class="n">wf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;workflow_xml_path&#39;</span><span class="p">,</span> <span class="n">WC</span><span class="o">.</span><span class="n">WORKFLOWS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_activities_path</span> <span class="o">=</span> <span class="n">wf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;workflow_xml_path&#39;</span><span class="p">,</span> <span class="n">WC</span><span class="o">.</span><span class="n">ACTIVITIES</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_map</span> <span class="o">=</span> <span class="n">wf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;workflow_xml_path&#39;</span><span class="p">,</span> <span class="n">WC</span><span class="o">.</span><span class="n">WORKFLOW_DEPENDENCY_MAP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_job</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sch_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_services</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">_services</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_EXECUTE_WORKFLOW_API</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="s1">&#39;EXECUTE_WORKFLOW_API&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_EXECUTE_WORKFLOW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="s1">&#39;EXECUTE_WORKFLOW&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">deploy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deploy</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">has_workflow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Representation string for the instance of the WorkflowHelper class.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;WorkflowHelper class instance for testcase: &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">workflow_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Returns the name of the workflow</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">            Returns the emailid from the config</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_email</span>

    <span class="nd">@workflow_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">workflow_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setter method for workflow_name</span>

<span class="sd">        Args:</span>
<span class="sd">             workflow_name  (str)   -- Name of the workflow</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span> <span class="o">=</span> <span class="n">workflow_name</span>

<div class="viewcode-block" id="WorkflowHelper.has_workflow"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.has_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">has_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if a workflow exists in the commcell with the input workflow name</span>

<span class="sd">        Args:</span>
<span class="sd">            workflow_name   (str)   --  name of the workflow</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool    -   boolean output whether the workflow exists in the</span>
<span class="sd">                        commcell or not</span>

<span class="sd">        Raises:</span>
<span class="sd">            SDKException:</span>
<span class="sd">                if type of the workflow name argument is not string</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">has_workflow</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Workflow: </span><span class="si">%s</span><span class="s1"> exists&#39;</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No workflow exists with the name &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="WorkflowHelper.download_workflow_from_store"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.download_workflow_from_store">[docs]</a>    <span class="k">def</span> <span class="nf">download_workflow_from_store</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">workflow_name</span><span class="p">,</span>
            <span class="n">download_location</span><span class="p">,</span>
            <span class="n">cloud_username</span><span class="p">,</span>
            <span class="n">cloud_password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads workflow from Software Store</span>

<span class="sd">        Args:</span>
<span class="sd">            workflow_name       (str)   --  name of the workflow to download</span>

<span class="sd">            download_location   (str)   --  location to download the workflow at</span>

<span class="sd">            cloud_username      (str)   --  username for the cloud account</span>

<span class="sd">            cloud_password      (str)   --  password for the above username</span>

<span class="sd">        Returns:</span>
<span class="sd">            str     -   full path of the workflow XML</span>

<span class="sd">        Raises:</span>
<span class="sd">            SDKException:</span>
<span class="sd">                if type of the workflow name argument is not string</span>

<span class="sd">                if HTTP Status Code is not SUCCESS / download workflow failed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># To download a workflow from the cloud</span>
        <span class="n">workflow_xml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">download_workflow_from_store</span><span class="p">(</span>
            <span class="n">workflow_name</span><span class="o">=</span><span class="n">workflow_name</span><span class="p">,</span>
            <span class="n">download_location</span><span class="o">=</span><span class="n">download_location</span><span class="p">,</span>
            <span class="n">cloud_username</span><span class="o">=</span><span class="n">cloud_username</span><span class="p">,</span>
            <span class="n">cloud_password</span><span class="o">=</span><span class="n">cloud_password</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Successfully downloaded workflow: &quot;</span><span class="si">%s</span><span class="s1">&quot; from the cloud to the location: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">workflow_name</span><span class="p">,</span> <span class="n">workflow_xml</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_xml</span></div>

<div class="viewcode-block" id="WorkflowHelper.execute"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_json_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait_for_job</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Executes workflow on workflow engine.</span>

<span class="sd">        If workflow is not deployed already, an attempt is made to deploy the</span>
<span class="sd">        workflow.</span>

<span class="sd">        Workflow is executed and waits for the job to complete</span>

<span class="sd">        Args:</span>

<span class="sd">            workflow_json_input    (dict)  --  dictionary consisting of inputs for the workflow</span>

<span class="sd">            wait_for_job           (bool)  --  If user has to wait for job to complete</span>
<span class="sd">                                                    default: True</span>
<span class="sd">            inputs dict format:</span>

<span class="sd">                {</span>
<span class="sd">                    &#39;input1_name&#39;: &#39;input1_value&#39;,</span>
<span class="sd">                    &#39;input2_name&#39;: &#39;input2_value&#39;</span>
<span class="sd">                }</span>

<span class="sd">                e.g.:</span>
<span class="sd">                for executing the Demo_CheckReadiness workflow, inputs dict would be:</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;ClientGroupName&quot;: &quot;client_group_value&quot;</span>
<span class="sd">                }</span>

<span class="sd">            hidden (bool) -- Is workflow hidden True/False?</span>

<span class="sd">        Returns:</span>
<span class="sd">            job object    (SDK Job class job object for the workflow job)</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception - If workflow job fails to execute</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">workflow_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>
            <span class="k">if</span> <span class="n">workflow_json_input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow_json_input</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;workflowEngine&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_engine</span>
                <span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Workflow JSON inputs [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow_json_input</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hidden</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">has_workflow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span><span class="p">)</span>

                <span class="c1"># Deploy workflow if not already deployed on WorkflowEngine</span>
                <span class="k">if</span> <span class="s1">&#39;client&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">all_workflows</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">,</span> <span class="p">{}):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">deploy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_workflow</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">)</span>

            <span class="c1"># Execute workflow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executing workflow [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">))</span>
            <span class="n">__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span><span class="o">.</span><span class="n">execute_workflow</span><span class="p">(</span><span class="n">workflow_json_input</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="n">hidden</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">wait_for_job</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job</span>

            <span class="c1"># Wait for workflow job to complete</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting on workflow jobid [</span><span class="si">{}</span><span class="s2">] to complete&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Workflow job execution </span><span class="si">{}</span><span class="s2"> with error </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="o">.</span><span class="n">delay_reason</span>
                <span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to execute workflow </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.execute_api"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.execute_api">[docs]</a>    <span class="k">def</span> <span class="nf">execute_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_json_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">api</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Executes workflow on workflow engine.</span>

<span class="sd">        If workflow is not deployed already, an attempt is made to deploy the</span>
<span class="sd">        workflow.</span>

<span class="sd">        Workflow is executed and waits for the job to complete</span>

<span class="sd">        Args:</span>

<span class="sd">            workflow_json_input    (dict)  --  dictionary consisting of inputs for the workflow</span>

<span class="sd">            inputs dict format:</span>

<span class="sd">                {</span>
<span class="sd">                    &#39;input1_name&#39;: &#39;input1_value&#39;,</span>
<span class="sd">                    &#39;input2_name&#39;: &#39;input2_value&#39;</span>
<span class="sd">                }</span>

<span class="sd">                e.g.:</span>
<span class="sd">                for executing the Demo_CheckReadiness workflow, inputs dict would be:</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;ClientGroupName&quot;: &quot;client_group_value&quot;</span>
<span class="sd">                }</span>

<span class="sd">            hidden (bool) -- Is workflow hidden True/False?</span>

<span class="sd">            method_type :  method type to be used for the API call</span>
<span class="sd">                            POST/GET</span>

<span class="sd">            api:         API name that needs to be executed</span>


<span class="sd">        Raises:</span>
<span class="sd">            Exception - If workflow job fails to execute</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">workflow_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>
            <span class="k">if</span> <span class="n">workflow_json_input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow_json_input</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;workflowEngine&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_engine</span>
                <span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Workflow JSON inputs [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow_json_input</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="c1"># Execute workflow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executing workflow in API mode[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">api</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">api</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_EXECUTE_WORKFLOW</span>
            <span class="k">elif</span> <span class="n">api</span> <span class="o">==</span> <span class="s1">&#39;EXECUTE_WORKFLOW_API&#39;</span> <span class="p">:</span>
                <span class="n">api</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_EXECUTE_WORKFLOW_API</span>

            <span class="kn">import</span> <span class="nn">urllib.parse</span>
            <span class="n">flag</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">_cvpysdk_object</span><span class="o">.</span><span class="n">make_request</span><span class="p">(</span>
            <span class="n">method_type</span><span class="p">,</span> <span class="n">api</span> <span class="o">%</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">),</span> <span class="n">workflow_json_input</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">():</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">,</span> <span class="p">{})</span>

                    <span class="k">if</span> <span class="s2">&quot;jobId&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;jobId&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="s1">&#39;Workflow Execution in API Mode Finished Successfully&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Job Id is returned when running in API mode&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s2">&quot;errorCode&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;errorCode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="s1">&#39;Workflow Execution Finished Successfully&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">error_message</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">]</span>
                            <span class="n">o_str</span> <span class="o">=</span> <span class="s1">&#39;Executing Workflow failed</span><span class="se">\n</span><span class="s1">Error: &quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Workflow&#39;</span><span class="p">,</span> <span class="s1">&#39;102&#39;</span><span class="p">,</span> <span class="n">o_str</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">,</span> <span class="s1">&#39;102&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">response_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span><span class="o">.</span><span class="n">_update_response_</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">,</span> <span class="s1">&#39;101&#39;</span><span class="p">,</span> <span class="n">response_string</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to execute workflow </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.deploy"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.deploy">[docs]</a>    <span class="k">def</span> <span class="nf">deploy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Imports and deploys workflow and dependent(embedded) workflows on WFEngine.</span>

<span class="sd">            Also deploys custom activities which the workflow requires.</span>

<span class="sd">            Dependent workflows and activities are fetched from the pre populated</span>

<span class="sd">            workflow map defined in the WorkflowConstants module unless otherwise</span>

<span class="sd">            provided by the user in the module arguments</span>

<span class="sd">        Args:</span>
<span class="sd">        None</span>

<span class="sd">        Returns:</span>
<span class="sd">        None</span>

<span class="sd">        Raises:</span>
<span class="sd">        Exception - If module execution fails during any step.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">workflow_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>
            <span class="n">activity_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">workflow_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">workflow_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_map</span><span class="p">:</span>

                <span class="c1"># If workflow is dependent on custom activities, deploy</span>
                <span class="c1"># activities</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_map</span><span class="p">[</span><span class="n">workflow_name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Activities&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="c1"># Deploy custom activity if not already deployed</span>
                        <span class="n">activity_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                        <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">all_activities</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Custom activity [</span><span class="si">{}</span><span class="s2">] is already deployed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">activity</span><span class="p">))</span>
                            <span class="k">continue</span>
                        <span class="n">activity_xml</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_workflow_activities_path</span><span class="p">,</span> <span class="n">activity</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">activity_xml</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Custom activity XML not found at [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">activity_xml</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Custom activity path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">activity_xml</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Importing custom activity [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">activity</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">import_activity</span><span class="p">(</span><span class="n">activity_xml</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dependent custom activities list </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">activity_list</span><span class="p">))</span>

                <span class="c1"># Generate a list of dependent(embedded) workflows</span>
                <span class="k">for</span> <span class="n">workflow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;common_workflows&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">workflow_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">workflow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_map</span><span class="p">[</span><span class="n">workflow_name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Child&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="n">workflow_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

            <span class="n">workflow_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Following workflows will be deployed [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow_list</span><span class="p">))</span>

            <span class="c1"># For each of the dependent and parent workflow make an attempt to</span>
            <span class="c1"># import and deploy the workflow if not already imported/deployed</span>
            <span class="c1"># on the WorkflowEngine</span>
            <span class="k">for</span> <span class="n">workflow</span> <span class="ow">in</span> <span class="n">workflow_list</span><span class="p">:</span>
                <span class="c1"># Import and deploy workflow if not already imported</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">import_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deploy_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Deployment failed with exception </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.deploy_workflow"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.deploy_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">deploy_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_engine</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">workflow_xml</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">workflow</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deploys workflow on the Commcell if not already Deployed</span>
<span class="sd">            Args:</span>
<span class="sd">                workflow_engine (str)     : WorkflowEngine where workflow will be deployed</span>

<span class="sd">                workflow_xml (str)        : Workflow xml path with complete path location</span>

<span class="sd">                workflow (str)            : Workflow name</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if module fails at any step during execution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">workflow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>
            <span class="k">if</span> <span class="n">workflow_engine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_engine</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">has_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">workflow_xml</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">workflow_xml</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_workflow_xml_path</span><span class="p">,</span> <span class="n">workflow</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;client&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">all_workflows</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow</span><span class="p">,</span> <span class="p">{}):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Workflow [</span><span class="si">{}</span><span class="s2">] already deployed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">workflow_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deploying workflow </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
                <span class="n">workflow_obj</span><span class="o">.</span><span class="n">deploy_workflow</span><span class="p">(</span><span class="n">workflow_engine</span><span class="p">,</span> <span class="n">workflow_xml</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Workflow [</span><span class="si">{}</span><span class="s2">] deployed successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.import_workflow"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.import_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">import_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_xml</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">workflow</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Imports workflow on the Commcell.</span>
<span class="sd">            Args:</span>
<span class="sd">                workflow_xml (str)    : Workflow xml path with complete path location</span>

<span class="sd">                workflow (str)   : Workflow name</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if module fails at any step during execution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">workflow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>

            <span class="k">if</span> <span class="n">workflow_xml</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow_xml</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_workflow_xml_path</span><span class="p">,</span> <span class="n">workflow</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

            <span class="c1"># Import workflow if not already imported</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">has_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">workflow_xml</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Workflow not found at [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow_xml</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Importing workflow [</span><span class="si">{0}</span><span class="s2">] from [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">,</span> <span class="n">workflow_xml</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">import_workflow</span><span class="p">(</span><span class="n">workflow_xml</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Imported workflow [</span><span class="si">{0}</span><span class="s2">] successfully.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Workflow [</span><span class="si">{0}</span><span class="s2">] is already imported on Commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.delete"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes a workflow from the Commcell.</span>

<span class="sd">            Args:</span>
<span class="sd">                workflow_name   (str/list)   --  Workflow(s) to delete from commcell</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if module fails at any step during execution</span>

<span class="sd">            Returns:</span>
<span class="sd">                True if workflow is successfully deleted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">workflow_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>

            <span class="n">workflow_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">workflow_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">workflow_list</span> <span class="o">=</span> <span class="n">workflow_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported argument passed to delete() [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">workflow</span> <span class="ow">in</span> <span class="n">workflow_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">has_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] doesn&#39;t exist on Commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
                    <span class="k">return</span> <span class="kc">True</span>

                <span class="c1"># Delete workflow</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting workflow [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">delete_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.user_interactions"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.user_interactions">[docs]</a>    <span class="k">def</span> <span class="nf">user_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns all the pending interactions from a specific user as a list</span>

<span class="sd">            Args:</span>
<span class="sd">                username   (str)   --  User name</span>

<span class="sd">            Returns:</span>
<span class="sd">                (list)    - Pending interactions for a specific user</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if module fails at any step during execution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pending_interactions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Seen issues with getting user interactions immediately after BL workflow execution.</span>
            <span class="c1"># Adding sleep here to wait for interactions to populate.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">interactions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">all_interactions</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">interaction</span> <span class="ow">in</span> <span class="n">interactions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">interaction</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;userName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">username</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">interaction_id</span> <span class="o">=</span> <span class="n">interaction</span><span class="p">[</span><span class="s1">&#39;interactionId&#39;</span><span class="p">]</span>
                    <span class="n">pending_interactions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">get_interaction_properties</span><span class="p">(</span><span class="n">interaction_id</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pending user interactions: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pending_interactions</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">pending_interactions</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.submit_interaction"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.submit_interaction">[docs]</a>    <span class="k">def</span> <span class="nf">submit_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interaction</span><span class="p">,</span> <span class="n">input_xml</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Submits a given interaction with specified action</span>

<span class="sd">            Args:</span>
<span class="sd">                interaction (dict)    --  Interaction dictionary</span>
<span class="sd">                e.g:</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;interactionId&quot;: 3871,</span>
<span class="sd">                        &quot;created&quot;: 1547524940,</span>
<span class="sd">                        &quot;subject&quot;: &quot;Delete Backupset [  -&gt;  -&gt;  ] requested by [ 11111_Automation_45_651 ]&quot;,</span>
<span class="sd">                        &quot;activityName&quot;: &quot;Get Authorization&quot;,</span>
<span class="sd">                        &quot;flags&quot;: 1,</span>
<span class="sd">                        &quot;description&quot;: &quot;&quot;,</span>
<span class="sd">                        &quot;sessionId&quot;: &quot;a38b32dc-f505-45c5-9d61-3eaee226b50c&quot;,</span>
<span class="sd">                        &quot;processStepId&quot;: 648993,</span>
<span class="sd">                        &quot;jobId&quot;: 2804488,</span>
<span class="sd">                        &quot;status&quot;: 0,</span>
<span class="sd">                        &quot;workflow&quot;: {</span>
<span class="sd">                            &quot;workflowName&quot;: &quot;GetAndProcessAuthorization&quot;,</span>
<span class="sd">                            &quot;workflowId&quot;: 2095</span>
<span class="sd">                        },</span>
<span class="sd">                        &quot;commCell&quot;: {</span>
<span class="sd">                            &quot;commCellName&quot;: &quot;WIN-K2DCEJR56MG&quot;,</span>
<span class="sd">                            &quot;commCellId&quot;: 2</span>
<span class="sd">                        },</span>
<span class="sd">                        &quot;client&quot;: {</span>
<span class="sd">                            &quot;clientId&quot;: 2,</span>
<span class="sd">                            &quot;clientName&quot;: &quot;WIN-K2DCEJR56MG&quot;</span>
<span class="sd">                        },</span>
<span class="sd">                        &quot;user&quot;: {</span>
<span class="sd">                            &quot;userName&quot;: &quot;11111_Automation_01-14-2019_23_01_45_651&quot;,</span>
<span class="sd">                            &quot;userId&quot;: 1418</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>

<span class="sd">                input_xml (str)       --  Input XML string for completing the interaction.</span>
<span class="sd">                                            e.g : This is very specific to the user input interaction.</span>
<span class="sd">                                                    Construct the input XML based on workflow being executed and send</span>
<span class="sd">                                                    to this module.</span>

<span class="sd">                action   (str)        --  Interaction action</span>
<span class="sd">                                            This is very specific to workflow being executed and the expected options</span>
<span class="sd">                                                for the given interaction</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if module fails at any step during execution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">interaction_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">interaction</span><span class="p">[</span><span class="s1">&#39;interactionId&#39;</span><span class="p">])</span>
            <span class="n">job_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">interaction</span><span class="p">[</span><span class="s1">&#39;jobId&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Submitting interaction request [</span><span class="si">{0}</span><span class="s2">] for job id [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interaction_id</span><span class="p">,</span> <span class="n">job_id</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">submit_interaction</span><span class="p">(</span><span class="n">interaction</span><span class="p">,</span> <span class="n">input_xml</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.modify_workflow_configuration"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.modify_workflow_configuration">[docs]</a>    <span class="k">def</span> <span class="nf">modify_workflow_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_xml</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Modify workflow configuration</span>

<span class="sd">            Args:</span>
<span class="sd">                config_xml    (xml)    : Corresponding workflow configuration tags and their values</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if module fails at any step during execution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Modifying workflow [</span><span class="si">{0}</span><span class="s2">] configuration with following configuration tags</span>
<span class="s2">                                [</span><span class="si">{1}</span><span class="s2">]&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span><span class="p">,</span> <span class="n">config_xml</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span><span class="o">.</span><span class="n">set_workflow_configuration</span><span class="p">(</span><span class="n">config_xml</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.process_user_requests"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.process_user_requests">[docs]</a>    <span class="k">def</span> <span class="nf">process_user_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;Accept&#39;</span><span class="p">,</span> <span class="n">input_xml</span><span class="o">=</span><span class="s2">&quot;&lt;inputs&gt;&lt;/inputs&gt;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Common module mainly to proccess the interactive requests and wait for workflow job to complete</span>
<span class="sd">            This module is mainly written for modularization and common code handling for multiple testcases.</span>

<span class="sd">            Args:</span>
<span class="sd">                username    (str)    : Unique username for which to approve the interaction request</span>

<span class="sd">                action      (str)    : Action to take while taking user approval</span>
<span class="sd">                                            Default: Accept</span>

<span class="sd">                input_xml    (str)    : Input xml for the worklow&#39;s user interactive request.</span>
<span class="sd">                                            Default: &lt;inputs&gt;&lt;/inputs&gt; (No user inputs to UserInput activity)</span>
<span class="sd">                                        e.g</span>
<span class="sd">                                        &lt;inputs&gt;&lt;requestedBy&gt;a&lt;/requestedBy&gt;&lt;objectName/&gt;&lt;CustomMessage/&gt;&lt;/inputs&gt;</span>
<span class="sd">            Raises</span>
<span class="sd">                Exception:</span>
<span class="sd">                    If failed at any given step in the module.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># It takes some time for user input activity to execute and job to go in Waiting state</span>
            <span class="n">interaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_interactions</span><span class="p">(</span><span class="n">username</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">workflow_jobid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">interaction</span><span class="p">[</span><span class="s1">&#39;jobId&#39;</span><span class="p">])</span>
            <span class="n">job_manager</span> <span class="o">=</span> <span class="n">JobManager</span><span class="p">(</span><span class="n">workflow_jobid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
            <span class="n">job_manager</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="s1">&#39;waiting&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;waiting on user input&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">job_manager</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job id [</span><span class="si">{0}</span><span class="s2">] failed to reach waiting on user input state&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow_jobid</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">input_xml</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">Server.Workflow.workflowconstants</span> <span class="kn">import</span> <span class="n">WORKFLOW_DEFAULT_USER_INPUTS</span>
                <span class="n">input_xml</span> <span class="o">=</span> <span class="n">WORKFLOW_DEFAULT_USER_INPUTS</span> <span class="o">%</span> <span class="p">(</span><span class="n">interaction</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;userName&#39;</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">submit_interaction</span><span class="p">(</span><span class="n">interaction</span><span class="p">,</span> <span class="n">input_xml</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
            <span class="n">job_manager</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.bl_workflows_setup"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.bl_workflows_setup">[docs]</a>    <span class="k">def</span> <span class="nf">bl_workflows_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflows</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usergroup</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pre setup steps for Business logic workflow related test cases for softwarestore</span>
<span class="sd">            Create a non admin user in master user group</span>
<span class="sd">            Check if the workflow is deployed</span>

<span class="sd">        Args:</span>
<span class="sd">            workflows (list)    : Workflow list which need to be checked if they are deployed. If not throw Exception</span>

<span class="sd">            username  (str)     : Username for the user which will be created</span>

<span class="sd">            password  (str)     : Password for the user</span>

<span class="sd">            usergroup (str)     : User group to associate the user to</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple - Created user name and Commcell object for the created user</span>

<span class="sd">        Raises</span>
<span class="sd">            Exception:</span>
<span class="sd">                - if workflows are not deployed.</span>
<span class="sd">                - if any failiure during Execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">Server.Security.userhelper</span> <span class="kn">import</span> <span class="n">UserHelper</span>
        <span class="kn">from</span> <span class="nn">Server.Security.userconstants</span> <span class="kn">import</span> <span class="n">USERGROUP</span>
        <span class="kn">from</span> <span class="nn">cvpysdk.commcell</span> <span class="kn">import</span> <span class="n">Commcell</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;workflow_&#39;</span> <span class="o">+</span> <span class="n">OptionsSelector</span><span class="o">.</span><span class="n">get_custom_str</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">password</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span><span class="o">.</span><span class="n">Workflow</span><span class="o">.</span><span class="n">ComplexPasswords</span><span class="o">.</span><span class="n">CommonPassword</span>
            <span class="n">user_helper</span> <span class="o">=</span> <span class="n">UserHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">usergroup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">local_usergroups</span> <span class="o">=</span> <span class="p">[</span><span class="n">USERGROUP</span><span class="o">.</span><span class="n">MASTER</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">local_usergroups</span> <span class="o">=</span> <span class="p">[</span><span class="n">usergroup</span><span class="p">]</span>
            <span class="n">user_helper</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">user_name</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">full_name</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">username</span> <span class="o">+</span> <span class="s1">&#39;@commvault.com&#39;</span><span class="p">,</span>
                                    <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">local_usergroups</span><span class="o">=</span><span class="n">local_usergroups</span><span class="p">)</span>
            <span class="n">user_commcell</span> <span class="o">=</span> <span class="n">Commcell</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">commserv_name</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">workflow</span> <span class="ow">in</span> <span class="n">workflows</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_deployed</span><span class="p">(</span><span class="n">workflow</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">user_commcell</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.is_deployed"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.is_deployed">[docs]</a>    <span class="k">def</span> <span class="nf">is_deployed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span> <span class="n">hardcheck</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks if the workflow is deployed on WorkflowEngine or not</span>

<span class="sd">            Args:</span>
<span class="sd">                workflow_name   (str)   --  name of the workflow to check</span>

<span class="sd">                hardcheck       (bool)  --  If set to True exception shall be raised if workflow is not deployed or</span>
<span class="sd">                                                imported on WorkflowEngine.</span>
<span class="sd">                                            If set to False, module will return false.</span>
<span class="sd">                                            default: True</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    Workflow is not imported on Commcell [ hardcheck=True ]</span>
<span class="sd">                    Workflow [{0}] is imported but not deployed/installed. [ hardcheck=True ]</span>
<span class="sd">                    if module fails at any step during execution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

            <span class="c1"># Validate if workflow is imported</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">has_workflow</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">hardcheck</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Workflow [</span><span class="si">{}</span><span class="s2">] is not imported on Commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Validate if the workflows are deployed</span>
            <span class="k">if</span> <span class="s1">&#39;client&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">all_workflows</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow_name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">{}):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Workflow [</span><span class="si">{0}</span><span class="s2">] is deployed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">hardcheck</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Workflow [</span><span class="si">{0}</span><span class="s2">] is imported but not deployed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.workflow_job_status"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.workflow_job_status">[docs]</a>    <span class="k">def</span> <span class="nf">workflow_job_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wf_name</span><span class="p">,</span> <span class="n">wait_for_job</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">expected_state</span><span class="o">=</span><span class="s2">&quot;completed&quot;</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Validate the status of jobId for the workflow executed</span>

<span class="sd">        Args:</span>
<span class="sd">            wf_name (str)       :   Workflow name for which latest job status required</span>

<span class="sd">            expected_state(str) :   Expected state for the workflow job to be validated</span>
<span class="sd">                Default : &quot;Completed&quot;</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                    -If no latest job available for the workflow</span>
<span class="sd">                    -Job status is not completed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Querying CommServ database to retrieve the latest jobId for the workflow</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select  J.JobId from JMAdminJobInfoTable J inner join WF_Definition W &quot;</span> \
                    <span class="s2">&quot;on J.workFlowId=W.WorkflowId where J.opType=90 and &quot;</span> \
                    <span class="s2">&quot;W.name=&#39;</span><span class="si">{0}</span><span class="s2">&#39; order by JobId desc&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wf_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="p">:</span>
                <span class="n">job</span> <span class="o">=</span> <span class="n">JobManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JobId [</span><span class="si">{0}</span><span class="s2">] triggered for the workflow [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="p">,</span> <span class="n">wf_name</span><span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">wait_for_job</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job</span>
                <span class="n">job</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="n">expected_state</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JobId [</span><span class="si">{0}</span><span class="s2">] executed successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No running JobId found for the workflow [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wf_name</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.get_client_name_and_hostname_based_on_configuration"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.get_client_name_and_hostname_based_on_configuration">[docs]</a>    <span class="k">def</span> <span class="nf">get_client_name_and_hostname_based_on_configuration</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">client_hostname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">config_xml</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">organization_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the clientname and hostname based on the configuration of the pre install workflow</span>

<span class="sd">        Args:</span>
<span class="sd">            client_name     (str)   -- Name of the client</span>

<span class="sd">            client_hostname (str)   -- Hostname of the client installed</span>

<span class="sd">            config_xml      (str)   -- dictionary consisting of inputs for the pre install workflow</span>

<span class="sd">                                        Example:</span>
<span class="sd">                                            &lt;Append&gt;2&lt;/Append&gt;</span>
<span class="sd">                                            &lt;Append_custom_string&gt;false&lt;/Append_custom_string&gt;</span>
<span class="sd">                                            &lt;Custom_string&gt;&lt;/Custom_string&gt;</span>
<span class="sd">                                            &lt;Append_username_to_client&gt;false&lt;/Append_username_to_client&gt;</span>

<span class="sd">            organization_name (str) -- Name of the organization</span>

<span class="sd">            username        (str)   -- Commcell username used to install the client</span>
<span class="sd">                                        default: admin</span>

<span class="sd">        Returns:</span>
<span class="sd">            (str,str)   -- Returns tuple of client name and client hostname</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>

<span class="sd">                -- if arguments are missing</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config_xml</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;install&gt;</span><span class="si">{</span><span class="n">config_xml</span><span class="si">}</span><span class="s2">&lt;/install&gt;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">xmltodict</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">config_xml</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">client_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">client_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">organization_name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append_custom_string&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">custom_string</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Custom_string&#39;</span><span class="p">)</span>
            <span class="n">client_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">client_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">custom_string</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append_username_to_client&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">client_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">client_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
            <span class="n">client_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">client_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">organization_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">client_hostname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">client_hostname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">organization_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No configuration setting is set as True for the pre install work flow&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">client_name</span><span class="p">,</span> <span class="n">client_hostname</span></div>

<div class="viewcode-block" id="WorkflowHelper.export_workflow"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.export_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">export_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">export_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">workflow</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exports the workflow to the location specified</span>

<span class="sd">        Args:</span>
<span class="sd">            export_location         (Str)       -- Directory path where the workflow need to be export</span>

<span class="sd">        Returns:</span>
<span class="sd">            str                     --              Absolute path of the exported workflow xml file</span>

<span class="sd">        Raises</span>
<span class="sd">            Exception :</span>
<span class="sd">                --If workflow is not exists</span>
<span class="sd">                --If export location does not exist</span>
<span class="sd">                --If failed to write the export workflow definition in file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">workflow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>

            <span class="c1"># Check if workflow exists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">has_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Workflow [</span><span class="si">{0}</span><span class="s2">] not exists on this Commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exporting workflow [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
            <span class="n">workflow_xml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span><span class="o">.</span><span class="n">export_workflow</span><span class="p">(</span><span class="n">export_location</span><span class="o">=</span><span class="n">export_location</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exported workflow [</span><span class="si">{0}</span><span class="s2">] successfully.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">workflow_xml</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.clone"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clone_workflow_name</span><span class="p">,</span> <span class="n">workflow</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clones the workflow</span>

<span class="sd">            Args:</span>
<span class="sd">                clone_workflow_name (str)   :   name to be set for clone workflow</span>

<span class="sd">                workflow (str)  :   name of workflow to clone</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if module fails at any step during execution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">workflow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>

            <span class="c1"># Check if workflow to be clone exists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">has_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Workflow [</span><span class="si">{0}</span><span class="s2">] to be cloned does not exists&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cloning workflow [</span><span class="si">%s</span><span class="s2">] with workflow name as [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span><span class="p">,</span> <span class="n">clone_workflow_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span><span class="o">.</span><span class="n">clone_workflow</span><span class="p">(</span><span class="n">clone_workflow_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully cloned the workflow&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.enable_workflow"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.enable_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">enable_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enables the workflow</span>
<span class="sd">        Args:</span>
<span class="sd">            workflow            (Str)       -- workflow Name</span>
<span class="sd">        Raises</span>
<span class="sd">            Exception :</span>
<span class="sd">                --If Enable workflow fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">workflow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>

            <span class="c1"># Check if workflow exists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">has_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Workflow [</span><span class="si">{0}</span><span class="s2">] not exists on this Commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enabling the workflow [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully enabled the workflow [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.disable_workflow"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.disable_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">disable_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disables the Workflow</span>
<span class="sd">        Args:</span>
<span class="sd">            workflow            (Str)       -- workflow Name</span>
<span class="sd">        Raises</span>
<span class="sd">            Exception :</span>
<span class="sd">                --If Enable workflow fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">workflow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>

            <span class="c1"># Check if workflow exists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">has_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Workflow [</span><span class="si">{0}</span><span class="s2">] not exists on this Commcell&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disabling the workflow [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully disabled the workflow [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.hidden_workflow"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.hidden_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">hidden_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wf_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get Workflow object for specific workflows</span>
<span class="sd">            e.g: Hidden Workflows [ Fetch id from DB and create object ]</span>

<span class="sd">        Args:</span>
<span class="sd">            wf_name (str)       :   Workflow name</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                    -If failed to create workflow object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">wf_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wf_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>

            <span class="c1"># Querying CommServ database to retrieve the Worfklow id</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select WorkflowId from WF_Definition where Name=&#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wf_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">wf_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">wf_id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Workflow id [</span><span class="si">{0}</span><span class="s2">] for workflow [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf_name</span><span class="p">))</span>
                <span class="kn">from</span> <span class="nn">cvpysdk.workflow</span> <span class="kn">import</span> <span class="n">WorkFlow</span>
                <span class="k">return</span> <span class="n">WorkFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">,</span> <span class="n">wf_name</span><span class="p">,</span> <span class="n">wf_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to fetch workflow id for workflow [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wf_name</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.get_db_bl_workflow"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.get_db_bl_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">get_db_bl_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_name</span><span class="p">,</span> <span class="n">workflow_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the App_messagehandler table data for the given message name and workflow name</span>

<span class="sd">        Args:</span>
<span class="sd">            message_name (str)  : XML Message name</span>

<span class="sd">            workflow_name (str) : Workflow name</span>
<span class="sd">                                    Default: workflow object from Class initialized object</span>

<span class="sd">        Returns:</span>
<span class="sd">            Resultset from the DB execution.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                - If failed to get the data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">workflow_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>

            <span class="c1"># Querying CommServ database to retrieve the latest jobId for the workflow</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select * from App_MessageHandler where messagename=&#39;</span><span class="si">{0}</span><span class="s2">&#39; and workflowname=&#39;</span><span class="si">{1}</span><span class="s2">&#39;</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message_name</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">)</span>
            <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">resultset</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">exec_commserv_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resultset</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="WorkflowHelper.schedule_workflow"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.schedule_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schedule_pattern</span><span class="p">,</span> <span class="n">workflow_json_input</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                     Args:</span>
<span class="sd">                          schedule_pattern : {}, -- Please refer SchedulePattern.create_schedule</span>
<span class="sd">                          in schedules.py for the types of</span>
<span class="sd">                                             pattern to be sent</span>

<span class="sd">                                             eg: {</span>
<span class="sd">                                                    &quot;freq_type&quot;: &#39;daily&#39;,</span>
<span class="sd">                                                    &quot;active_start_time&quot;: time_in_%H/%S (str),</span>
<span class="sd">                                                    &quot;repeat_days&quot;: days_to_repeat (int)</span>
<span class="sd">                                                 }</span>

<span class="sd">                          workflow_json_input(dict) - -  dictionary consisting of inputs for the workflow</span>

<span class="sd">                                if inputs are not given, user will be prompted for inputs on the command line</span>

<span class="sd">                                default: None</span>

<span class="sd">                                inputs dict format:</span>

<span class="sd">                                {</span>
<span class="sd">                                        &#39;input1_name&#39;: &#39;input1_value&#39;,</span>

<span class="sd">                                        &#39;input2_name&#39;: &#39;input2_value&#39;</span>
<span class="sd">                                }</span>

<span class="sd">                          e.g.:</span>

<span class="sd">                            for executing the Demo_CheckReadiness workflow, inputs dict would be:</span>

<span class="sd">                            {</span>
<span class="sd">                                &quot;ClientGroupName&quot;: &quot;client_group_value&quot;</span>
<span class="sd">                            }</span>

<span class="sd">                     Returns:</span>
<span class="sd">                         object : An instance of the Schedule class for the schedule created</span>

<span class="sd">                    &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">workflow_json_input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">workflow_json_input</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;workflowEngine&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_engine</span>
                <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Scheduling workflow&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sch_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span><span class="o">.</span><span class="n">schedule_workflow</span><span class="p">(</span><span class="n">schedule_pattern</span><span class="p">,</span> <span class="n">workflow_json_input</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sch_obj</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span></div>

<div class="viewcode-block" id="WorkflowHelper.set_auto_deploy_property"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.set_auto_deploy_property">[docs]</a>    <span class="k">def</span> <span class="nf">set_auto_deploy_property</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the auto deploy property of the workflow&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workflow_obj</span><span class="o">.</span><span class="n">_set_workflow_properties</span><span class="p">(</span><span class="s2">&quot;flags&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="WorkflowHelper.cleanup"><a class="viewcode-back" href="../../../source/Server.Workflow.html#Server.Workflow.workflowhelper.WorkflowHelper.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cleanup the testcase workflows</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                    -If failed to cleanup(delete) workflow</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">workflow_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_name</span>
            <span class="n">workflow_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">workflow_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_map</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Fetch the child workflows</span>
                    <span class="k">for</span> <span class="n">workflow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_map</span><span class="p">[</span><span class="n">workflow_name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Child&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="n">workflow_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="c1"># Fetch  the dependent(embedded) workflows</span>
                <span class="k">for</span> <span class="n">workflow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;common_workflows&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">workflow_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">workflow_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Following workflows will be deleted [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">workflow_list</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">workflow_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Workflow cleanup is completed&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Workflow cleanup failed with exception </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>