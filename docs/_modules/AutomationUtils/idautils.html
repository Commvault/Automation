

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>AutomationUtils.idautils &mdash; Commvault Automation 11.23 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>AutomationUtils.idautils</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for AutomationUtils.idautils</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CommonUtils:   Provides test common commcell related operations.</span>

<span class="sd">CommonUtils:</span>

<span class="sd">    __init__()                  -- initialize instance of CommonUtils class</span>

<span class="sd">    __repr__()                  --  Representation string for the instance of the</span>
<span class="sd">                                    CommonUtils class for specific test case</span>

<span class="sd">    get_backup_copy_job_id()    -- Method to fetch backup copy job ID given the snap job ID for</span>
<span class="sd">                                   snap subclient</span>

<span class="sd">    backup_validation()         -- Method to validate backup jobs with application size</span>
<span class="sd">                                   and data size</span>

<span class="sd">    check_client_readiness()    -- performs check readiness on the list of clients</span>

<span class="sd">    get_subclient()             -- Gets default subclient object for a given commcell</span>
<span class="sd">                                    client, agent, backupset.</span>

<span class="sd">    get_backupset()             -- Gets default backupset object for a given commcell</span>
<span class="sd">                                    client, agent.</span>

<span class="sd">    restart_services()          -- restarts services on the list of clients</span>

<span class="sd">    subclient_backup()          -- Executes backup on any subclient object and waits for job</span>
<span class="sd">                                    completion.</span>

<span class="sd">    subclient_restore_in_place()</span>
<span class="sd">                                -- Restores the files/folders specified in the input paths list</span>
<span class="sd">                                    to the same location.</span>

<span class="sd">    subclient_restore_out_of_place()</span>
<span class="sd">                                -- Restores the files/folders specified in the input paths list</span>
<span class="sd">                                    to the input client, at the specified destination location.</span>

<span class="sd">    subclient_backup_and_restore()</span>
<span class="sd">                                -- Executes backup on a subclient, and restores data out of place</span>

<span class="sd">    subclient_restore_from_job()</span>
<span class="sd">                                -- Initiates restore for data backed up in a given job</span>
<span class="sd">                                    and performs the applicable verifications.</span>

<span class="sd">    osc_backup_and_restore()    -- Validates backup works fine from osc schedule for incremental</span>
<span class="sd">                                     backup for devices and out of place restore works.</span>

<span class="sd">    aux_copy()                  -- Executes aux copy on a specific storage policy copy and waits</span>
<span class="sd">                                    for job completion.</span>

<span class="sd">    data_aging()                -- Executes data aging for a specific storage policy copy and</span>
<span class="sd">                                    waits for job completion.</span>

<span class="sd">    compare_file_metadata()     -- Compares the meta data of source path with destination path</span>
<span class="sd">                                    and checks if they are same.</span>

<span class="sd">    cleanup_jobs()              -- Kills all the jobs in the job list self.job_list,</span>
<span class="sd">                                    if the jobs are not completed already.</span>

<span class="sd">    cleanup_dir()               -- Removes directories in the temp directories list</span>

<span class="sd">    cleanup()                   -- ida cleanup tasks</span>

<span class="sd">    modify_additional_settings()-- Updates Additional settings key/value for a given client</span>

<span class="sd">    get_synthetic_full_job()    -- Method to fetch synthetic full  job ID given the subclient object</span>
<span class="sd">                                        and backup type</span>

<span class="sd">    delete_additional_settings()-- Deletes Additional settings key/value for a given client</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">ntpath</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">cvpysdk.client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">cvpysdk.commcell</span> <span class="kn">import</span> <span class="n">Commcell</span>
<span class="kn">from</span> <span class="nn">cvpysdk.subclient</span> <span class="kn">import</span> <span class="n">Subclient</span>
<span class="kn">from</span> <span class="nn">cvpysdk.backupset</span> <span class="kn">import</span> <span class="n">Backupset</span>
<span class="kn">from</span> <span class="nn">cvpysdk.policies.storage_policies</span> <span class="kn">import</span> <span class="n">StoragePolicy</span>
<span class="kn">from</span> <span class="nn">cvpysdk.job</span> <span class="kn">import</span> <span class="n">JobController</span>

<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">database_helper</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="kn">import</span> <span class="n">OptionsSelector</span>

<span class="kn">from</span> <span class="nn">Server.JobManager.jobmanager_helper</span> <span class="kn">import</span> <span class="n">JobManager</span>


<div class="viewcode-block" id="CommonUtils"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils">[docs]</a><span class="k">class</span> <span class="nc">CommonUtils</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to perform common commcell operations.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_object</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Initialize instance of CommonUtils class</span>

<span class="sd">        Args:</span>
<span class="sd">        init_object : Should be either the commcell or the testcase object&#39;&#39;&#39;</span>

        <span class="c1"># Pre-initialized attributes applicable for all instances of the class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_object</span> <span class="o">=</span> <span class="n">init_object</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_object</span><span class="p">,</span> <span class="n">Commcell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="n">init_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="o">=</span> <span class="n">init_object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">commcell</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span> <span class="o">=</span> <span class="n">JobManager</span><span class="p">(</span><span class="n">commcell</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_controller</span> <span class="o">=</span> <span class="n">JobController</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_directory_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Representation string for the instance of the CommonUtils class.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;CommonUtils class instance&quot;</span>

<div class="viewcode-block" id="CommonUtils.get_backup_copy_job_id"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.get_backup_copy_job_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_backup_copy_job_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap_job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to fetch inline backup copy job ID given the snap job ID for s nsap subclient</span>

<span class="sd">            Args:</span>
<span class="sd">                snap_job_id         (str)       --  snap backup job ID</span>

<span class="sd">            Returns:</span>
<span class="sd">                str                         -   returns string of backup copy job ID</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">log_message</span> <span class="o">=</span> <span class="s2">&quot;Snap Job ID : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snap_job_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">log_message</span><span class="p">)</span>
        <span class="n">backup_copy_job_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT childJobId FROM JMJobWF WHERE processedJobId = </span><span class="si">{0}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">snap_job_id</span><span class="p">))</span>
        <span class="n">csdb</span> <span class="o">=</span> <span class="n">database_helper</span><span class="o">.</span><span class="n">get_csdb</span><span class="p">()</span>
        <span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">job_list</span> <span class="o">=</span> <span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="n">backup_copy_job_id</span> <span class="o">=</span> <span class="n">job_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">backup_copy_job_id</span></div>

<div class="viewcode-block" id="CommonUtils.get_synthetic_full_job"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.get_synthetic_full_job">[docs]</a>    <span class="k">def</span> <span class="nf">get_synthetic_full_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subclient</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This gets the synthetic full job if after incr or before incr</span>
<span class="sd">        Args:</span>

<span class="sd">            subclient           (object) - subclient object of SDK</span>
<span class="sd">            backup_type         (string) - type of synthetic full job</span>
<span class="sd">                                                AFTER_SYNTH - if synthetic full is</span>
<span class="sd">                                                                triggereged after Incremental</span>
<span class="sd">                                                BEFORE_SYNTH - if synthetic full is</span>
<span class="sd">                                                                triggereged Before Incremental</span>


<span class="sd">        Returns:</span>
<span class="sd">            job - job object of synthetic full/incremental that triggered after synthetic full</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if  failed to fetch synthetic full job id</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">backup_type</span> <span class="o">==</span> <span class="s2">&quot;AFTER_SYNTH&quot;</span><span class="p">:</span>
            <span class="n">backup_type_latest_running</span> <span class="o">=</span> <span class="s2">&quot;Incremental&quot;</span>
            <span class="n">backup_type_latest_finished</span> <span class="o">=</span> <span class="s2">&quot;Synthetic Full&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">backup_type_latest_running</span> <span class="o">=</span> <span class="s2">&quot;Synthetic Full&quot;</span>
            <span class="n">backup_type_latest_finished</span> <span class="o">=</span> <span class="s2">&quot;Incremental&quot;</span>

        <span class="n">latest_running_job</span> <span class="o">=</span> <span class="n">subclient</span><span class="o">.</span><span class="n">find_latest_job</span><span class="p">(</span><span class="n">include_finished</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">latest_completed_job</span> <span class="o">=</span> <span class="n">subclient</span><span class="o">.</span><span class="n">find_latest_job</span><span class="p">(</span><span class="n">include_active</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">latest_running_job</span><span class="o">.</span><span class="n">backup_level</span> <span class="o">==</span> <span class="n">backup_type_latest_running</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">latest_completed_job</span><span class="o">.</span><span class="n">backup_level</span> <span class="o">==</span> <span class="n">backup_type_latest_finished</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">latest_running_job</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Synthfull job did not start : </span><span class="si">{0}</span><span class="s2"> .&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">latest_running_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="CommonUtils.backup_validation"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.backup_validation">[docs]</a>    <span class="k">def</span> <span class="nf">backup_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to validate backup jobs with application size and data size</span>

<span class="sd">           Args:</span>

<span class="sd">                jobid           (str)    --     jobid which needs to be</span>
<span class="sd">                                                validated on backup completion</span>

<span class="sd">                backup_type     (str)    --     expected backup type from calling method</span>

<span class="sd">            Returns:</span>
<span class="sd">                (bool)     -     Returns true if the validation</span>
<span class="sd">                                 of backup type and size check suceeds</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>

<span class="sd">                    if backup validation fails</span>

<span class="sd">                    if response was not success</span>

<span class="sd">                    if response received is empty</span>

<span class="sd">                    if failed to get response</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">type_status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">size_status</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Validating the backup type sent by user</span>
        <span class="n">base_backup_level</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">backup_level</span>
        <span class="k">if</span> <span class="n">base_backup_level</span><span class="p">(</span><span class="n">backup_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_backup_level</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Backup Type sent does not fall under available&quot;</span>
                <span class="s2">&quot;backup levels.check the spelling and case&quot;</span><span class="p">)</span>
        <span class="n">jobobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">job_controller</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job_id</span><span class="o">=</span><span class="n">jobid</span><span class="p">)</span>
        <span class="n">gui_backup_type</span> <span class="o">=</span> <span class="n">jobobj</span><span class="o">.</span><span class="n">backup_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backup Type from GUI :</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">gui_backup_type</span><span class="p">)</span>

        <span class="c1"># Comparing the given backup type with actually ran backup type</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">gui_backup_type</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">backup_type</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Expected Backup Type is [</span><span class="si">%s</span><span class="s2">] </span><span class="se">\n</span><span class="s2">Ran Backup Type:[</span><span class="si">%s</span><span class="s2">] for JobId:[</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
                           <span class="n">backup_type</span><span class="p">,</span>
                           <span class="n">gui_backup_type</span><span class="p">,</span>
                           <span class="n">jobid</span>
                          <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Expected Backup Type is [</span><span class="si">%s</span><span class="s2">] </span><span class="se">\n</span><span class="s2">Ran Backup Type:[</span><span class="si">%s</span><span class="s2">] for JobId:[</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
                          <span class="n">backup_type</span><span class="p">,</span>
                          <span class="n">gui_backup_type</span><span class="p">,</span>
                          <span class="n">jobid</span>
                         <span class="p">)</span>
            <span class="n">type_status</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">jobobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">job_controller</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job_id</span><span class="o">=</span><span class="n">jobid</span><span class="p">)</span>
        <span class="n">full_job_details</span> <span class="o">=</span> <span class="n">jobobj</span><span class="o">.</span><span class="n">details</span>
        <span class="n">sub_dict</span> <span class="o">=</span> <span class="n">full_job_details</span><span class="p">[</span><span class="s1">&#39;jobDetail&#39;</span><span class="p">][</span><span class="s1">&#39;detailInfo&#39;</span><span class="p">]</span>
        <span class="n">data_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sub_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;compressedBytes&#39;</span><span class="p">))</span>
        <span class="n">application_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sub_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sizeOfApplication&#39;</span><span class="p">))</span>

        <span class="c1"># Checking Application and Data size for data size validation during backup</span>
        <span class="k">if</span> <span class="n">application_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Even though job was completed&quot;</span>
                    <span class="s2">&quot;the transferred data_size is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_size</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Application Data size is: [</span><span class="si">%s</span><span class="s2">]. </span><span class="se">\n</span><span class="s2">Data Written Size is: [</span><span class="si">%s</span><span class="s2">] for Job Id: [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
                    <span class="n">application_size</span><span class="p">,</span>
                    <span class="n">data_size</span><span class="p">,</span>
                    <span class="n">jobid</span><span class="p">)</span>
                <span class="n">size_status</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">type_status</span> <span class="ow">and</span> <span class="n">size_status</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log_error</span> <span class="o">=</span> <span class="s2">&quot;Backup Validation for Job Id : </span><span class="si">{0}</span><span class="s2"> failed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobobj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">log_error</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommonUtils.check_client_readiness"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.check_client_readiness">[docs]</a>    <span class="k">def</span> <span class="nf">check_client_readiness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clients</span><span class="p">,</span> <span class="n">hardcheck</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs check readiness on the list of clients</span>


<span class="sd">            Args:</span>
<span class="sd">                clients    (list)  -- list of clients on which check readiness needs to be performed</span>

<span class="sd">                hardcheck  (bool)  -- if set to True, exception shall be raised if client is not ready</span>
<span class="sd">                                        else will return False.</span>

<span class="sd">            Returns:</span>
<span class="sd">                True - If client is ready [ hardchek set to false ]</span>

<span class="sd">                False - If client is not ready [ hardcheck set to false ]</span>

<span class="sd">            Raises</span>
<span class="sd">                Exception</span>
<span class="sd">                    - if client is not ready [ hardcheck set to True ]</span>
<span class="sd">            Example:</span>

<span class="sd">                [&quot;auto&quot;, &quot;v11-restapi&quot;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing check readiness on clients [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clients</span><span class="p">))</span>

            <span class="n">_flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">clients</span><span class="p">:</span>
                <span class="n">_client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">_client_obj</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client </span><span class="si">{0}</span><span class="s2"> is ready&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">hardcheck</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Check readiness failed for client </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
                    <span class="n">_flag</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">hardcheck</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_flag</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.get_subclient"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.get_subclient">[docs]</a>    <span class="k">def</span> <span class="nf">get_subclient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="s1">&#39;File System&#39;</span><span class="p">,</span> <span class="n">backupset</span><span class="o">=</span><span class="s1">&#39;defaultBackupset&#39;</span><span class="p">,</span> <span class="n">subclient_name</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot; Gets subclient object for a given commcell client, agent, backupset</span>

<span class="sd">            Args:</span>
<span class="sd">                client_name    (str)    -- Client name</span>
<span class="sd">                                            default: Testcase initialized client</span>

<span class="sd">                agent          (str)    -- Client data agent name</span>

<span class="sd">                backupset      (str)    -- Agents backupset name</span>

<span class="sd">                subclient_name (str)    -- Subclient name</span>

<span class="sd">            Returns:</span>
<span class="sd">                (object)    -    Subclient object for the given client</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception</span>
<span class="sd">                    -    if failed to get the default subclient</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="p">(</span><span class="n">Client</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Client name expected as argument&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting subclient object for client [</span><span class="si">{0}</span><span class="s2">], agent [</span><span class="si">{1}</span><span class="s2">], backupset&quot;</span>
                          <span class="s2">&quot; [</span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">backupset</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">backupset</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span><span class="o">.</span><span class="n">backupsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">backupset</span><span class="p">)</span>
            <span class="n">subclient</span> <span class="o">=</span> <span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subclient_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Subclient object: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subclient</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">subclient</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.get_backupset"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.get_backupset">[docs]</a>    <span class="k">def</span> <span class="nf">get_backupset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="s1">&#39;File System&#39;</span><span class="p">,</span> <span class="n">backupset</span><span class="o">=</span><span class="s1">&#39;defaultBackupset&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot; Gets backupset object for a given commcell client, agent</span>

<span class="sd">            Args:</span>
<span class="sd">                client_name    (str)    -- Client name</span>
<span class="sd">                                            default: Testcase initialized client</span>

<span class="sd">                agent          (str)    -- Client data agent name</span>

<span class="sd">                backupset      (str)    -- Agents backupset name</span>

<span class="sd">            Returns:</span>
<span class="sd">                (object)    -    Backupset object for the given client</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception</span>
<span class="sd">                    -    if failed to get the default backupset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="p">(</span><span class="n">Client</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Subclient object expected as argument&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting backupset object for client [</span><span class="si">{0}</span><span class="s2">], agent [</span><span class="si">{1}</span><span class="s2">], backupset&quot;</span>
                          <span class="s2">&quot; [</span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">backupset</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">backupset</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span><span class="o">.</span><span class="n">backupsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">backupset</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backupset object: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backupset</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">backupset</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>


<div class="viewcode-block" id="CommonUtils.restart_services"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.restart_services">[docs]</a>    <span class="k">def</span> <span class="nf">restart_services</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clients</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Restarts services on the list of clients</span>

<span class="sd">        Args:</span>
<span class="sd">                clients(list)  -- list of clients on which services needs to be</span>
<span class="sd">                                    restarted</span>

<span class="sd">            Example:</span>

<span class="sd">                [&quot;testproxy&quot;, &quot;v11-restapi&quot;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">clients</span><span class="p">:</span>
                <span class="n">_client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restarting services on client </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>

                <span class="n">_client_obj</span><span class="o">.</span><span class="n">restart_services</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.subclient_backup"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.subclient_backup">[docs]</a>    <span class="k">def</span> <span class="nf">subclient_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">subclient</span><span class="p">,</span>
                         <span class="n">backup_type</span><span class="o">=</span><span class="s2">&quot;Incremental&quot;</span><span class="p">,</span>
                         <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">target_subclient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executes backup on any subclient object and waits for job completion.</span>

<span class="sd">            Args:</span>
<span class="sd">                subclient          (obj)   -- Instance of SDK Subclient class</span>

<span class="sd">                backup_type        (str)   -- Backup type:</span>
<span class="sd">                                                Full / Incremental / Differential / Synthetic_full</span>
<span class="sd">                                                default: Incremental</span>

<span class="sd">                wait               (bool)  -- If True, will wait for backup job to complete.</span>
<span class="sd">                                              If False, will return job object for the backup job</span>
<span class="sd">                                                  without waiting for job to finish.</span>

<span class="sd">                target_subclient   (str)   -- subclient target string where backup shall be</span>
<span class="sd">                                                executed.</span>
<span class="sd">                        e.g:</span>
<span class="sd">                        client1-&gt;file system-&gt;defaultinstancename-&gt;backupset_199-&gt;subclient_199</span>
<span class="sd">                        OR could be any custom string from user.</span>

<span class="sd">                **kwargs           (dict)  -- Key value pair for the various subclients type</span>
<span class="sd">                                                inputs, depending on the subclient iDA.</span>
<span class="sd">                                                scheduling options to be included for the task</span>
<span class="sd">                                                Please refer schedules.schedulePattern.</span>
<span class="sd">                                                createSchedule() doc for the types of Jsons</span>

<span class="sd">            Returns:</span>
<span class="sd">                (object)    - Job class instance for the backup job in case of immediate Job.</span>
<span class="sd">                              Schedule Object will be returned to perform</span>
<span class="sd">                                         tasks on created Schedule</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception if:</span>

<span class="sd">                    - is subclient object is not passed as an argument.</span>

<span class="sd">                    - failed during execution of module</span>

<span class="sd">            Example:</span>
<span class="sd">                - Executes full backup for subclient and **does not wait for job completion</span>

<span class="sd">                    job = subclient_backup(subclient_object, &quot;full&quot;, False)</span>

<span class="sd">                - Executes incremental backup for subclient and waits for job completion</span>

<span class="sd">                    job = subclient_backup(subclient_object, &quot;incremental&quot;)</span>

<span class="sd">                - Runs incremental backup for subclient</span>
<span class="sd">                    job = subclient_backup(subclient_object)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">subclient</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">subclient</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subclient</span><span class="p">,</span> <span class="n">Subclient</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Subclient object expected as argument&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">target_subclient</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">target_subclient</span> <span class="o">=</span> <span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span>

            <span class="k">if</span> <span class="s1">&#39;schedule_pattern&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting [</span><span class="si">{0}</span><span class="s2">] backup for subclient [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_type</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">target_subclient</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating </span><span class="si">{0}</span><span class="s2"> Backup Schedule for subclient </span><span class="si">{1}</span><span class="s2"> with &quot;</span>
                              <span class="s2">&quot;pattern </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_type</span><span class="p">,</span> <span class="n">subclient</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;schedule_pattern&#39;</span><span class="p">]))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">_obj</span> <span class="o">=</span> <span class="n">subclient</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">backup_type</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_obj</span> <span class="o">=</span> <span class="n">subclient</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">backup_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;schedule_pattern&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
                <span class="n">job_type</span> <span class="o">=</span> <span class="n">_obj</span><span class="o">.</span><span class="n">job_type</span> <span class="k">if</span> <span class="n">_obj</span><span class="o">.</span><span class="n">backup_level</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_obj</span><span class="o">.</span><span class="n">backup_level</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executed [</span><span class="si">{0}</span><span class="s2">] backup job id [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_type</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)))</span>

                <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">_obj</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created Backup Schedule with Id </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">schedule_id</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">_obj</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.subclient_restore_in_place"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.subclient_restore_in_place">[docs]</a>    <span class="k">def</span> <span class="nf">subclient_restore_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">subclient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Restores the files/folders specified in the input paths list to the same location.</span>

<span class="sd">            Args:</span>
<span class="sd">                paths                 (list)       --  list of full paths</span>
<span class="sd">                                                        of files/folders to restore</span>

<span class="sd">                subclient             (obj)        --  subclient object of relevant SDK subclient</span>
<span class="sd">                                                        class.</span>

<span class="sd">                wait                  (bool)       -- If True, will wait for backup job to</span>
<span class="sd">                                                        complete.</span>
<span class="sd">                                                      If False, will return job object for the</span>
<span class="sd">                                                        backup job without waiting for job to</span>
<span class="sd">                                                        finish.</span>

<span class="sd">                **kwargs           (dict)  -- Key value pair for the various subclients type</span>
<span class="sd">                                                inputs for underlying restore_in_place module,</span>
<span class="sd">                                                depending on the subclient iDA. Schedule Pattern</span>
<span class="sd">                                                if schedule is needed</span>
<span class="sd">                                                Please refer schedules.schedulePattern.</span>
<span class="sd">                                                createSchedule() doc for the types of Jsons</span>
<span class="sd">            Returns:</span>
<span class="sd">                object - instance of the Job class for this restore job</span>
<span class="sd">                         Schedule Object will be returned to perform</span>
<span class="sd">                                         tasks on created Schedule</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while running restore</span>
<span class="sd">                            or restore didn&#39;t complete successfully.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># Use the current test case client as default</span>
            <span class="k">if</span> <span class="n">subclient</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">subclient</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subclient</span><span class="p">,</span> <span class="n">Subclient</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;subclient object expected as argument&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;schedule_pattern&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Execute in place restore for subclient [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Creating Restore In Place Schedule for subclient &#39;</span><span class="si">{0}</span><span class="s2">&#39; with paths </span><span class="si">{1}</span><span class="s2"> &quot;</span>
                    <span class="s2">&quot;using schedule pattern </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;schedule_pattern&#39;</span><span class="p">]))</span>

            <span class="n">_obj</span> <span class="o">=</span> <span class="n">subclient</span><span class="o">.</span><span class="n">restore_in_place</span><span class="p">(</span><span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;schedule_pattern&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executed in place restore with job id [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)))</span>

                <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">_obj</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created In Place Restore Schedule with Id </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">schedule_id</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">_obj</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.subclient_restore_out_of_place"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.subclient_restore_out_of_place">[docs]</a>    <span class="k">def</span> <span class="nf">subclient_restore_out_of_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subclient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Restores the files/folders specified in the input paths list to the input client,</span>
<span class="sd">            at the specified destination location.</span>

<span class="sd">            Args:</span>
<span class="sd">                client                (str/object) --  either the name or the instance of Client</span>

<span class="sd">                destination_path      (str)        --  full path of the restore location on client</span>

<span class="sd">                paths                 (list)       --  list of full paths of files/folders</span>
<span class="sd">                                                        to restore</span>

<span class="sd">                subclient             (obj)        --  subclient object of relevant SDK subclient</span>
<span class="sd">                                                        class.</span>

<span class="sd">                wait                  (bool)       -- If True, will wait for backup job to</span>
<span class="sd">                                                        complete.</span>
<span class="sd">                                                      If False, will return job object for the</span>
<span class="sd">                                                        backup job without waiting for job to</span>
<span class="sd">                                                        finish.</span>

<span class="sd">                **kwargs           (dict)  -- Key value pair for the various subclients type</span>
<span class="sd">                                                inputs for underlying restore_out_of_place module,</span>
<span class="sd">                                                depending on the subclient iDA.</span>
<span class="sd">                                                Schedule Pattern if schedule is needed</span>
<span class="sd">                                                Please refer schedules.schedulePattern.</span>
<span class="sd">                                                createSchedule() doc for the types of Jsons</span>
<span class="sd">            Returns:</span>
<span class="sd">                object - instance of the Job class for this restore job</span>
<span class="sd">                         Schedule Object will be returned to perform</span>
<span class="sd">                                         tasks on created Schedule</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while running restore or restore didn&#39;t</span>
<span class="sd">                                complete successfully.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># Use the current test case client as default</span>
            <span class="k">if</span> <span class="n">subclient</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">subclient</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subclient</span><span class="p">,</span> <span class="n">Subclient</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;subclient object expected as argument&quot;</span><span class="p">)</span>

            <span class="c1"># Use the current test case subclient as default</span>
            <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">client</span>

            <span class="k">if</span> <span class="s1">&#39;schedule_pattern&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executing out of place restore for subclient [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Creating Restore Out of Place Schedule for subclient &#39;</span><span class="si">{0}</span><span class="s2">&#39; with paths &quot;</span>
                    <span class="s2">&quot;</span><span class="si">{1}</span><span class="s2"> to client &#39;</span><span class="si">{2}</span><span class="s2">&#39; using schedule pattern </span><span class="si">{3}</span><span class="s2">&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;schedule_pattern&#39;</span><span class="p">]))</span>

            <span class="n">_obj</span> <span class="o">=</span> <span class="n">subclient</span><span class="o">.</span><span class="n">restore_out_of_place</span><span class="p">(</span>
                <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">destination_path</span><span class="o">=</span><span class="n">destination_path</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;schedule_pattern&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executed out of place restore with job id [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)))</span>

                <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="c1"># Sleep for 4 seconds for job to start. If running the API to get job details immediately after</span>
                    <span class="c1"># triggering via out of place restore API call, it fails randomly at times</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">_obj</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created Out Of Place Restore Schedule with Id </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">schedule_id</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">_obj</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.subclient_backup_and_restore"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.subclient_backup_and_restore">[docs]</a>    <span class="k">def</span> <span class="nf">subclient_backup_and_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="p">,</span> <span class="n">subclient</span><span class="p">,</span> <span class="n">backup_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executes backup on a subclient, and restores data out of place.</span>
<span class="sd">            Main purpose of this module is to test if backup and restore works on a client</span>
<span class="sd">            for given subclient.</span>

<span class="sd">            Args:</span>
<span class="sd">                client_name          (str)/(Machine object)</span>
<span class="sd">                                                 -- Client name</span>

<span class="sd">                subclient            (object)    -- subclient object</span>
<span class="sd">                                                        Default: default subclient</span>

<span class="sd">                backup_type          (str)       -- Backup type. Various types supported by</span>
<span class="sd">                                                        underlying SDK backup module.</span>

<span class="sd">                validate             (bool)      -- Validate source content and resotred content</span>
<span class="sd">                                                        metadata/contents/acl/xattr</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception if:</span>

<span class="sd">                    - failed during execution of module</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">machine_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
            <span class="n">source_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">machine_obj</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding directory to subclient content: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_dir</span><span class="p">))</span>

            <span class="n">subclient</span><span class="o">.</span><span class="n">content</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">create_test_data</span><span class="p">(</span><span class="n">machine_obj</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">)]</span>
            <span class="n">backup_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient_backup</span><span class="p">(</span><span class="n">subclient</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">)</span>

            <span class="c1"># Execute out of place restore and validate data post restore.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subclient_restore_from_job</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span>
                                            <span class="n">job</span><span class="o">=</span><span class="n">backup_job</span><span class="p">,</span>
                                            <span class="n">subclient</span><span class="o">=</span><span class="n">subclient</span><span class="p">,</span>
                                            <span class="n">client</span><span class="o">=</span><span class="n">machine_obj</span><span class="p">,</span>
                                            <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">machine_obj</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.subclient_restore_from_job"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.subclient_restore_from_job">[docs]</a>    <span class="k">def</span> <span class="nf">subclient_restore_from_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">data_path</span><span class="p">,</span>
                                   <span class="n">tmp_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">job</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">subclient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initiates restore for data backed up in the given job</span>
<span class="sd">            and performs the applicable verifications</span>

<span class="sd">            Args:</span>
<span class="sd">                data_path (str)          -- Source data path</span>

<span class="sd">                tmp_path (str)           -- temporary path for restoring the data</span>
<span class="sd">                                                default: None</span>
<span class="sd">                                                If not provided, directory to restore will be created on client.</span>

<span class="sd">                job (obj)/(id)           -- instance of the job class whose data needs to be restored. Or the job id.</span>
<span class="sd">                                                default : None</span>

<span class="sd">                cleanup (bool)           -- to indicate if restored data should be cleaned up</span>
<span class="sd">                    default : True</span>

<span class="sd">                subclient (object)       -- Subclient object</span>

<span class="sd">                client (str)/(Machine object)</span>
<span class="sd">                                         -- Client name or corresponding machine object</span>

<span class="sd">                validate (bool)          -- If True will validate metadata for restored content</span>
<span class="sd">                                                default: True</span>

<span class="sd">                **kwargs (dict)          -- Key value pairs:</span>
<span class="sd">                                                supported :</span>
<span class="sd">                                                    dirtime (bool) - Whether to validate directory time stamps or not</span>

<span class="sd">                                                    applicable_os (str) - UNIX/WINDOWS</span>

<span class="sd">                                                    acls (bool) - Validate acls for files or not</span>

<span class="sd">                                                    xattr (bool) - Validate attributed for the file or not</span>

<span class="sd">            Returns:</span>
<span class="sd">                job object for the restore job.</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception</span>
<span class="sd">                - if any error occurred while running restore or during verification.</span>
<span class="sd">                - Meta data comparison failed</span>
<span class="sd">                - Checksum comparison failed</span>
<span class="sd">                - ACL comparison failed</span>
<span class="sd">                - XATTR comparison failed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">subclient</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">subclient</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subclient</span><span class="p">,</span> <span class="n">Subclient</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;subclient object expected as argument&quot;</span><span class="p">)</span>

            <span class="c1"># Use the current test case client as default</span>
            <span class="k">if</span> <span class="n">subclient</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">subclient</span>
                <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">client</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subclient</span><span class="p">,</span> <span class="n">Subclient</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;subclient object needs to be passed as argument.&quot;</span><span class="p">)</span>

            <span class="n">machine_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">client_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_name&#39;</span><span class="p">,</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">machine_name</span><span class="p">)</span>

            <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_path</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tmp_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tmp_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">machine_obj</span><span class="p">)</span>
            <span class="n">data_path_leaf</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">data_path_leaf</span> <span class="o">+</span> <span class="s2">&quot;_restore&quot;</span><span class="p">])</span>

            <span class="n">restore_from_time</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">restore_to_time</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">job</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                    <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">job_controller</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
                <span class="n">restore_from_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;jobStartTime&#39;</span><span class="p">]))</span>
                <span class="n">restore_to_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;jobEndTime&#39;</span><span class="p">]))</span>

            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Starting restore with source:{1},</span>
<span class="sd">                destination:[{0}],</span>
<span class="sd">                from_time:[{2}],</span>
<span class="sd">                to_time:[{3}]</span>
<span class="sd">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">dest_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">paths</span><span class="p">),</span> <span class="n">restore_from_time</span><span class="p">,</span> <span class="n">restore_to_time</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Clean up destination directory before starting restore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">machine_obj</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>
            <span class="n">_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclient_restore_out_of_place</span><span class="p">(</span><span class="n">dest_path</span><span class="p">,</span>
                                                       <span class="n">paths</span><span class="p">,</span>
                                                       <span class="n">client_name</span><span class="p">,</span>
                                                       <span class="n">subclient</span><span class="p">,</span>
                                                       <span class="n">from_time</span><span class="o">=</span><span class="n">restore_from_time</span><span class="p">,</span>
                                                       <span class="n">to_time</span><span class="o">=</span><span class="n">restore_to_time</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">validate</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_job</span>

            <span class="c1"># Validation for restored content</span>
            <span class="n">compare_source</span> <span class="o">=</span> <span class="n">data_path</span>
            <span class="n">compare_destination</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">os_sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">dest_path</span><span class="p">,</span> <span class="n">data_path_leaf</span><span class="p">])</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Executing backed up content validation:</span>
<span class="s2">                        Source: [</span><span class="si">{0}</span><span class="s2">], and</span>
<span class="s2">                        Destination [</span><span class="si">{1}</span><span class="s2">]&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compare_source</span><span class="p">,</span> <span class="n">compare_destination</span><span class="p">))</span>

            <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">compare_meta_data</span><span class="p">(</span>
                <span class="n">compare_source</span><span class="p">,</span> <span class="n">compare_destination</span><span class="p">,</span> <span class="n">dirtime</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dirtime&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing meta data comparison on source and destination&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Meta data comparison failed&quot;</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff_output</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Meta data comparison failed&quot;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Meta data comparison successful&quot;</span><span class="p">)</span>

            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing checksum comparison on source and destination&quot;</span><span class="p">)</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">compare_checksum</span><span class="p">(</span><span class="n">compare_source</span><span class="p">,</span> <span class="n">compare_destination</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Checksum comparison failed&quot;</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff_output</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Checksum comparison failed&quot;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checksum comparison successful&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;applicable_os&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;UNIX&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;acls&#39;</span><span class="p">):</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing ACL comparison on source and destination&quot;</span><span class="p">)</span>
                    <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">compare_acl</span><span class="p">(</span>
                        <span class="n">compare_source</span><span class="p">,</span> <span class="n">compare_destination</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ACL comparison failed&quot;</span><span class="p">)</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff_output</span><span class="p">))</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ACL comparison failed&quot;</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ACL comparison successful&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xattr&#39;</span><span class="p">):</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing XATTR comparison on source and destination&quot;</span><span class="p">)</span>
                    <span class="n">result</span><span class="p">,</span> <span class="n">diff_output</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">compare_xattr</span><span class="p">(</span>
                        <span class="n">compare_source</span><span class="p">,</span> <span class="n">compare_destination</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;XATTR comparison failed&quot;</span><span class="p">)</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Diff output: </span><span class="se">\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff_output</span><span class="p">))</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;XATTR comparison failed&quot;</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;XATTR comparison successful&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">_job</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cleanup</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">machine_obj</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommonUtils.backupset_restore_in_place"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.backupset_restore_in_place">[docs]</a>    <span class="k">def</span> <span class="nf">backupset_restore_in_place</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">backupset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Restores the files/folders specified in the input paths list to the input client,</span>
<span class="sd">            to the same location.</span>

<span class="sd">            Args:</span>
<span class="sd">                paths                 (list)       --  list of full paths of files/folders to restore</span>

<span class="sd">                backupset             (obj)        --  backupset object of relevant SDK subclient class.</span>

<span class="sd">                wait                  (bool)       -- If True, will wait for backup job to complete.</span>
<span class="sd">                                                      If False, will return job object for the backup job without</span>
<span class="sd">                                                          waiting for job to finish.</span>

<span class="sd">                **kwargs              (dict)       -- Key value pair for the various backupset type</span>
<span class="sd">                                                        inputs for underlying restore_out_of_place module</span>
<span class="sd">            Returns:</span>
<span class="sd">                object - instance of the Job class for this restore job Schedule Object will be returned to perform</span>
<span class="sd">                            tasks on created Schedule</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while running restore or restore didn&#39;t</span>
<span class="sd">                                complete successfully.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># Use the current test case client as default</span>
            <span class="k">if</span> <span class="n">backupset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">backupset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">backupset</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">backupset</span><span class="p">,</span> <span class="n">Backupset</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Backupset object expected as argument&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;schedule_pattern&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executing out of place restore for backupset [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backupset</span><span class="o">.</span><span class="n">backupset_name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Creating Restore In Place Schedule for subclient &#39;</span><span class="si">{0}</span><span class="s2">&#39; with paths </span><span class="si">{1}</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;using schedule pattern </span><span class="si">{2}</span><span class="s2">&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backupset</span><span class="o">.</span><span class="n">backupset_name</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;schedule_pattern&#39;</span><span class="p">]))</span>

            <span class="n">_obj</span> <span class="o">=</span> <span class="n">backupset</span><span class="o">.</span><span class="n">restore_in_place</span><span class="p">(</span><span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;schedule_pattern&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executed in place restore with job id [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)))</span>

                <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">_obj</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created In Place Restore Schedule with Id </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">schedule_id</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">_obj</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.backupset_restore_out_of_place"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.backupset_restore_out_of_place">[docs]</a>    <span class="k">def</span> <span class="nf">backupset_restore_out_of_place</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backupset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Restores the files/folders specified in the input paths list to the input client,</span>
<span class="sd">            at the specified destination location.</span>

<span class="sd">            Args:</span>
<span class="sd">                client                (str/object) --  either the name or the instance of Client</span>

<span class="sd">                destination_path      (str)        --  full path of the restore location on client</span>

<span class="sd">                paths                 (list)       --  list of full paths of files/folders</span>
<span class="sd">                                                        to restore</span>

<span class="sd">                backupset             (obj)        --  backupset object of relevant SDK subclient</span>
<span class="sd">                                                        class.</span>

<span class="sd">                wait                  (bool)       -- If True, will wait for backup job to</span>
<span class="sd">                                                        complete.</span>
<span class="sd">                                                      If False, will return job object for the</span>
<span class="sd">                                                        backup job without waiting for job to</span>
<span class="sd">                                                        finish.</span>

<span class="sd">                **kwargs           (dict)  -- Key value pair for the various backupset type</span>
<span class="sd">                                                inputs for underlying restore_out_of_place module</span>
<span class="sd">            Returns:</span>
<span class="sd">                object - instance of the Job class for this restore job</span>
<span class="sd">                         Schedule Object will be returned to perform</span>
<span class="sd">                                         tasks on created Schedule</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception - Any error occurred while running restore or restore didn&#39;t</span>
<span class="sd">                                complete successfully.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># Use the current test case client as default</span>
            <span class="k">if</span> <span class="n">backupset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">backupset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">backupset</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">backupset</span><span class="p">,</span> <span class="n">Backupset</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Backupset object expected as argument&quot;</span><span class="p">)</span>

            <span class="c1"># Use the current test case subclient as default</span>
            <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testcase</span><span class="o">.</span><span class="n">client</span>

            <span class="k">if</span> <span class="s1">&#39;schedule_pattern&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executing out of place restore for backupset [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backupset</span><span class="o">.</span><span class="n">backupset_name</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;Creating Restore Out of Place Schedule for subclient &#39;{0}&#39; with paths</span>
<span class="sd">                        {1} to client &#39;{2}&#39; using schedule pattern {3}&quot;&quot;&quot;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backupset</span><span class="o">.</span><span class="n">backupset_name</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;schedule_pattern&#39;</span><span class="p">]))</span>

            <span class="n">_obj</span> <span class="o">=</span> <span class="n">backupset</span><span class="o">.</span><span class="n">restore_out_of_place</span><span class="p">(</span>
                <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">destination_path</span><span class="o">=</span><span class="n">destination_path</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;schedule_pattern&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executed out of place restore with job id [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)))</span>

                <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">_obj</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created Out Of Place Restore Schedule with Id </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">schedule_id</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">_obj</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.osc_backup_and_restore"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.osc_backup_and_restore">[docs]</a>    <span class="k">def</span> <span class="nf">osc_backup_and_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">postbackup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skip_osc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validates backup works fine from osc schedule for incremental backup for devices</span>

<span class="sd">            Args:</span>
<span class="sd">                client        (str)/(Machine object)  -- Client name or Machine object</span>

<span class="sd">                postbackup    (bool)                  -- If true:</span>
<span class="sd">                                                            Execute post backup and restore on the subclient by</span>
<span class="sd">                                                            modifying the subclient content.</span>

<span class="sd">                skip_osc      (bool)                  -- If true:</span>
<span class="sd">                                                            Will not wait for the filtered automatic jobs to trigger</span>
<span class="sd">                                                            Reinstall cases for laptop, where the owner does not change</span>

<span class="sd">                validate      (bool)                  -- Validate cksum/metadata for the restored subclient content.</span>

<span class="sd">                kwargs (dict)                    -- dictionary of optional arguments</span>

<span class="sd">                    Available kwargs Options:</span>

<span class="sd">                        options             (str)   --  to specify any other additional parameters</span>
<span class="sd">                            default: &quot;&quot;</span>

<span class="sd">                        client_name         (str)   --  Client name</span>
<span class="sd">                                                        e.g For user centric case the client name would be pseudo</span>
<span class="sd">                                                                client.</span>

<span class="sd">                        current_state      (str/list)</span>
<span class="sd">                                                    --  Expected job state. Could be a list or string from following</span>
<span class="sd">                                                        job state options</span>
<span class="sd">                                                        &#39;completed&#39;</span>
<span class="sd">                                                        &#39;failed&#39;</span>
<span class="sd">                                                        &#39;suspended&#39;</span>
<span class="sd">                                                        &#39;waiting&#39;</span>
<span class="sd">                                                        &#39;pending&#39;</span>

<span class="sd">                                                        This is originally added to handle the jobs for pseudo clients</span>
<span class="sd">                                                        which are executed in parellel when User centric client is</span>
<span class="sd">                                                        activated.</span>

<span class="sd">                        incr_current_state (str/list)</span>
<span class="sd">                                                    --  Expected job state for incremental job.</span>
<span class="sd">                                                        Could be a list or string from following job state options</span>
<span class="sd">                                                        &#39;completed&#39;</span>
<span class="sd">                                                        &#39;failed&#39;</span>
<span class="sd">                                                        &#39;suspended&#39;</span>
<span class="sd">                                                        &#39;waiting&#39;</span>
<span class="sd">                                                        &#39;pending&#39;</span>

<span class="sd">                                                        This is originally added to handle the jobs for pseudo clients</span>
<span class="sd">                                                        which are executed in parellel when User centric client is</span>
<span class="sd">                                                        activated.</span>

<span class="sd">                        backup_level        (str)    -- The level of backup.</span>
<span class="sd">                                                        Valid values are Full, Incremental, Differential, Synthetic Full</span>
<span class="sd">                                                        Default: Full</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception if:</span>
<span class="sd">                    - failed during execution of module</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">machine_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">client_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_name&#39;</span><span class="p">,</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">machine_name</span><span class="p">)</span>
            <span class="n">backup_level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;backup_level&#39;</span><span class="p">,</span> <span class="s1">&#39;Full&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;validate_user&#39;</span><span class="p">):</span>
                <span class="n">backup_level</span> <span class="o">=</span> <span class="s1">&#39;Incremental&#39;</span>
                <span class="n">job_state</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting&#39;</span><span class="p">,</span> <span class="s1">&#39;pending&#39;</span><span class="p">]</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">filtered_jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">get_filtered_jobs</span><span class="p">(</span><span class="n">client_name</span><span class="p">,</span> <span class="n">current_state</span><span class="o">=</span><span class="n">job_state</span><span class="p">)</span>
                <span class="n">filtered_jobs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">latest_job</span> <span class="o">=</span> <span class="n">filtered_jobs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;latest incremental job is </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latest_job</span><span class="p">))</span>
                <span class="n">latest_job</span> <span class="o">=</span> <span class="n">JobManager</span><span class="p">(</span><span class="n">latest_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="p">)</span><span class="o">.</span><span class="n">job</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">latest_job</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;registering_user&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span> <span class="p">(</span><span class="s2">&quot;Job not triggered with the activated username </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latest_job</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job triggered with activated username </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latest_job</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>

            <span class="c1"># Wait for auto triggered backups</span>
            <span class="n">job_state</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_state&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_osc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">get_filtered_jobs</span><span class="p">(</span>
                    <span class="n">client_name</span><span class="p">,</span>
                    <span class="n">time_limit</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                    <span class="n">retry_interval</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                    <span class="n">backup_level</span><span class="o">=</span><span class="n">backup_level</span><span class="p">,</span>
                    <span class="n">current_state</span><span class="o">=</span><span class="n">job_state</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">postbackup</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping post osc backup subclient modification.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="c1"># Add new content to default subclient of this client and check auto triggered</span>
            <span class="c1"># incremental backup</span>
            <span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subclient</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
            <span class="n">source_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">machine_obj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_directory_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;client&#39;</span><span class="p">:</span><span class="n">machine_obj</span><span class="p">,</span> <span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="n">source_dir</span><span class="p">})</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">subclient_content_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">create_test_data</span><span class="p">(</span><span class="n">machine_obj</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
            <span class="c1"># Let windows flush the directory and file changes, ELSE due to timing issues the metadata</span>
            <span class="c1"># may not match for the time stamp of folders,  after restoring the backed up content</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding directory [</span><span class="si">{0}</span><span class="s2">] to subclient content&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subclient_content_dir</span><span class="p">))</span>
            <span class="n">subclient</span><span class="o">.</span><span class="n">content</span> <span class="o">+=</span> <span class="p">[</span><span class="n">subclient_content_dir</span><span class="p">]</span>
            <span class="n">job_state</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;incr_current_state&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">job_state</span><span class="p">:</span>
                <span class="n">job_state</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_state&#39;</span><span class="p">)</span>
            <span class="n">jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">get_filtered_jobs</span><span class="p">(</span>
                <span class="n">client_name</span><span class="p">,</span>
                <span class="n">time_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">retry_interval</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">backup_level</span><span class="o">=</span><span class="s1">&#39;Incremental&#39;</span><span class="p">,</span>
                <span class="n">current_state</span><span class="o">=</span><span class="n">job_state</span>
            <span class="p">)</span>

            <span class="c1"># Execute out of place restore and validate data post restore.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subclient_restore_from_job</span><span class="p">(</span>
                <span class="n">source_dir</span><span class="p">,</span>
                <span class="n">job</span><span class="o">=</span><span class="n">jobs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">subclient</span><span class="o">=</span><span class="n">subclient</span><span class="p">,</span>
                <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
                <span class="n">validate</span><span class="o">=</span><span class="n">validate</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully executed auto backup jobs and validated &quot;</span>
                          <span class="s2">&quot;out of place restore on client [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.aux_copy"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.aux_copy">[docs]</a>    <span class="k">def</span> <span class="nf">aux_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_policy</span><span class="p">,</span> <span class="n">sp_copy</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executes aux copy on a specific storage policy copy and waits for job completion.</span>

<span class="sd">            Args:</span>
<span class="sd">                storage_policy    (obj/str)   -- storage policy name OR corresponding storage</span>
<span class="sd">                                                    policy SDK instance of class StoragePolicy</span>

<span class="sd">                sp_copy           (str)       -- name of the storage policy copy</span>

<span class="sd">                media_agent       (str)       -- name of the media agent</span>

<span class="sd">                wait              (bool)      -- If True, will wait for backup job to complete.</span>

<span class="sd">                                                  If False, will return job object for the job</span>
<span class="sd">                                                      without waiting for job to finish.</span>

<span class="sd">            Returns:</span>
<span class="sd">                job object        (object)    -- Job class instance for the aux copy job</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception if :</span>

<span class="sd">                    - storage_policy is neither the policy name nor SDK object</span>

<span class="sd">                    - failed during execution of module</span>

<span class="sd">            Example:</span>
<span class="sd">                - Executes aux copy for the storage policy sp01 and copy sp01_copy on media agent</span>
<span class="sd">                    ma01 and waits for job completion.</span>

<span class="sd">                job = aux_copy(&#39;sp01&#39;, &#39;sp01_copy&#39;, &#39;ma01&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># If storage policy name is passed as argument get it&#39;s object</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storage_policy</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">storage_policies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">storage_policies</span>
                <span class="n">storage_policy</span> <span class="o">=</span> <span class="n">storage_policies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">storage_policy</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storage_policy</span><span class="p">,</span> <span class="n">StoragePolicy</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;storage_policy should either be policy name or SDK object&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting aux copy for storage policy [</span><span class="si">{0}</span><span class="s2">] copy [</span><span class="si">{1}</span><span class="s2">]&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">,</span> <span class="n">sp_copy</span><span class="p">))</span>

            <span class="n">_job</span> <span class="o">=</span> <span class="n">storage_policy</span><span class="o">.</span><span class="n">run_aux_copy</span><span class="p">(</span><span class="n">sp_copy</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">)</span>
            <span class="n">_jobid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_jobid</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executed [</span><span class="si">{0}</span><span class="s2">] aux copy job id [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_job</span><span class="o">.</span><span class="n">job_type</span><span class="p">,</span> <span class="n">_jobid</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">_job</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">_jobid</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">_job</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.data_aging"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.data_aging">[docs]</a>    <span class="k">def</span> <span class="nf">data_aging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_policy</span><span class="p">,</span> <span class="n">sp_copy</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executes data aging for a specific storage policy copy and waits for job completion.</span>

<span class="sd">            Args:</span>
<span class="sd">                storage_policy    (obj/str)   -- storage policy name OR corresponding storage</span>
<span class="sd">                                                    policy SDK instance of class StoragePolicy</span>

<span class="sd">                sp_copy           (str)       -- name of the storage policy copy</span>

<span class="sd">                wait              (bool)      -- If True, will wait for backup job to complete.</span>

<span class="sd">                                                  If False, will return job object for the job</span>
<span class="sd">                                                      without waiting for job to finish.</span>

<span class="sd">            Returns:</span>
<span class="sd">                job object        (object)    -- Job class instance for the data aging job.</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception if :</span>

<span class="sd">                    - failed during execution of module</span>

<span class="sd">            Example:</span>
<span class="sd">                - Executes data aging for the storage policy sp01 and copy sp01_copy and waits</span>
<span class="sd">                    for job completion</span>

<span class="sd">                job = aux_copy(&#39;sp01&#39;, &#39;sp01_copy&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># If storage policy object is passed as argument get policy name from object</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storage_policy</span><span class="p">,</span> <span class="n">StoragePolicy</span><span class="p">):</span>
                <span class="n">storage_policy</span> <span class="o">=</span> <span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting data aging job on commcell.&quot;</span><span class="p">)</span>

            <span class="n">_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">(</span><span class="n">sp_copy</span><span class="p">,</span> <span class="n">storage_policy</span><span class="p">)</span>
            <span class="n">_jobid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_jobid</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executed [</span><span class="si">{0}</span><span class="s2">] data aging job id [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_job</span><span class="o">.</span><span class="n">job_type</span><span class="p">,</span> <span class="n">_jobid</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">_job</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">wait_for_state</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">_jobid</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">_job</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.compare_file_metadata"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.compare_file_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">compare_file_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">,</span> <span class="n">dirtime</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compares the meta data of source path with destination path and checks if they are same</span>

<span class="sd">             Args:</span>

<span class="sd">                client              (str)/(Machine object)</span>
<span class="sd">                                            -- Client name on which source and destination paths</span>
<span class="sd">                                                exist. Or corresponding machine object for client.</span>

<span class="sd">                source_path         (str)   --  source path of the folder to compare</span>

<span class="sd">                destination_path    (str)   --  destination path of the folder to compare</span>

<span class="sd">                dirtime             (bool)  --  whether to get time stamp of all directories</span>
<span class="sd">                    default: False</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool   -   Returns True if lists are same or returns False</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while comparing the source and destination paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">machine_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">machine_name</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client: [</span><span class="si">{0}</span><span class="s2">], Source path [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">source_path</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client: [</span><span class="si">{0}</span><span class="s2">], Destination path [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Comparing meta data for source and destination paths&quot;</span><span class="p">)</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">machine_obj</span><span class="o">.</span><span class="n">compare_meta_data</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">,</span> <span class="n">dirtime</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Differences found between source and destination&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Diff list: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Metadata comparison failed&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.cleanup_jobs"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.cleanup_jobs">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Kills all the jobs in the job list self.job_list, if the jobs are not completed</span>
<span class="sd">                already.</span>

<span class="sd">            self.job_list is populated with every call to the function in this module which</span>
<span class="sd">                executes a job.</span>

<span class="sd">                For example : aux_copy, data_aging, subclient_backup</span>

<span class="sd">            This module can be called as part of the testcase cleanup code in case the testcase</span>
<span class="sd">            ends abruptly in between leaving behind these running jobs which might interfere with</span>
<span class="sd">            other test cases execution.</span>

<span class="sd">            Args:</span>
<span class="sd">                None:</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception if :</span>

<span class="sd">                    - failed during execution of module</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_job</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">job_controller</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_job</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job [</span><span class="si">{0}</span><span class="s2">] status = [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span> <span class="n">_job</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">_job</span><span class="o">.</span><span class="n">is_finished</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">_job</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">modify_job</span><span class="p">(</span><span class="s1">&#39;kill&#39;</span><span class="p">)</span>

                <span class="k">del</span> <span class="n">_job</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.cleanup_dir"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.cleanup_dir">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes directories in the temp directories list &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dir_map</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_directory_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">dir_map</span><span class="p">[</span><span class="s1">&#39;client&#39;</span><span class="p">],</span> <span class="n">dir_map</span><span class="p">[</span><span class="s1">&#39;directory&#39;</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.cleanup"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generic cleanup for jobs/directories etc .&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;***Cleaning up ida specific environmental changes***&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_jobs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_dir</span><span class="p">()</span></div>

<div class="viewcode-block" id="CommonUtils.modify_additional_settings"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.modify_additional_settings">[docs]</a>    <span class="k">def</span> <span class="nf">modify_additional_settings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">key_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;CommServDB.GxGlobalParam&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;STRING&quot;</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Updates additional settings for a client based on name and value, for a specific category and data type</span>

<span class="sd">            Args:</span>
<span class="sd">                key_name  (str)   --  Name to update</span>
<span class="sd">                                        Ex:&quot;JobsCompleteIfActivityDisabled&quot;,</span>
<span class="sd">                                            &quot;isMSPCommcell&quot;</span>

<span class="sd">                value (str/int)  --   Value to update</span>
<span class="sd">                                        Ex: &quot;0 or 1&quot;,</span>
<span class="sd">                                            &quot;500&quot;</span>

<span class="sd">                category (str)   --  Key category</span>
<span class="sd">                                        Default : CommServDB.GxGlobalParam</span>

<span class="sd">                data_type (str)  --  Key data type</span>
<span class="sd">                                        Default : STRING</span>

<span class="sd">                client   (str/clientobj)</span>
<span class="sd">                                 --  Client name OR client object for which to delete the key.</span>
<span class="sd">                                        Default: Commserver</span>
<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Exception:</span>
<span class="sd">                failed to update parameters</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Setting </span><span class="si">%(key_name)s</span><span class="s2"> to </span><span class="si">%(value)s</span><span class="s2"> for category=</span><span class="si">%(category)s</span><span class="s2">, data_type=</span><span class="si">%(data_type)s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s1">&#39;key_name&#39;</span><span class="p">:</span> <span class="n">key_name</span><span class="p">,</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                    <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
                    <span class="s1">&#39;data_type&#39;</span><span class="p">:</span> <span class="n">data_type</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="n">clientobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">commserv_client</span> <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">clientobj</span><span class="o">.</span><span class="n">add_additional_setting</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">key_name</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CommonUtils.delete_additional_settings"><a class="viewcode-back" href="../../source/AutomationUtils.html#AutomationUtils.idautils.CommonUtils.delete_additional_settings">[docs]</a>    <span class="k">def</span> <span class="nf">delete_additional_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_name</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;CommServDB.GxGlobalParam&#39;</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Updates additional settings on commserve client based on name and value,</span>
<span class="sd">                for a specific category and data type</span>

<span class="sd">            Args:</span>
<span class="sd">                key_name  (str)   --  Name to delete</span>
<span class="sd">                                        Ex:&quot;JobsCompleteIfActivityDisabled&quot;,</span>
<span class="sd">                                            &quot;isMSPCommcell&quot;</span>

<span class="sd">                category (str)   --  Key category</span>
<span class="sd">                                        Default : CommServDB.GxGlobalParam</span>

<span class="sd">                client   (str/clientobj)</span>
<span class="sd">                                 --  Client name OR client object for which to delete the key.</span>
<span class="sd">                                        Default: Commserver</span>
<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Exception:</span>
<span class="sd">                failed to delete key</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Deleting additional settings: category=</span><span class="si">%(category)s</span><span class="s2">, </span><span class="si">%(key_name)s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
                    <span class="s1">&#39;key_name&#39;</span><span class="p">:</span> <span class="n">key_name</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="n">clientobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commcell</span><span class="o">.</span><span class="n">commserv_client</span> <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility</span><span class="o">.</span><span class="n">get_machine_object</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">clientobj</span><span class="o">.</span><span class="n">delete_additional_setting</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">key_name</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">] [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)))</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>