

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell &mdash; Commvault Automation 11.23 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;Commcell Helper</span>

<span class="sd">classes defined:</span>
<span class="sd">    AutoVSACommcell   - wrapper for commcell operations</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">cvpysdk.job</span> <span class="kn">import</span> <span class="n">Job</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">logger</span>


<div class="viewcode-block" id="AutoVSACommcell"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell">[docs]</a><span class="k">class</span> <span class="nc">AutoVSACommcell</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    class that act as wrapper for SDK and Testcase</span>

<span class="sd">    Methods:</span>
<span class="sd">            get_client_id()             - gets the client ID of given client name</span>

<span class="sd">            get_hostname_for_client()   - get the Host name for the given client</span>

<span class="sd">            get_base_dir()              - get the base directory of client given</span>
<span class="sd">                                        (default: Commserv client)</span>

<span class="sd">            get_client_os_type()           - get the os info of the client</span>

<span class="sd">            check_backup_job_type_expected()   - check the passed job id type and</span>
<span class="sd">                                                    passed job type is expeted</span>

<span class="sd">            _client_exist_in_cs()       - check if the client exist in CS</span>

<span class="sd">            get_job_duration()          - get the job duration of the job passed</span>

<span class="sd">            get_job_results_dir()                   - get the job results directory of the client</span>
<span class="sd">                                        (default: commserv client)</span>
<span class="sd">            get_snap_mount_status()     -   Returns the status of snap mount</span>

<span class="sd">            get_synth_backup_job_v2()   -   Returns the Synthful Job ID for v2 client</span>

<span class="sd">            get_snap_job_child)         -   Returns  the snap backup job id for the child for v2 clients</span>

<span class="sd">            dev_test_lab  - fetches the value for virtual lab from CS DB</span>

<span class="sd">            dev_test_virtual_lab_job - Performs Virtual Lab restore from Dev_Test_Group at Commcell level</span>

<span class="sd">            validate_lab_creation - check if lab exists in CS DB</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">csdb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the  SDK objects</span>

<span class="sd">        Args:</span>
<span class="sd">            commcell    (obj)   - Commcell object of SDK Commcell class</span>

<span class="sd">            csdb        (obj)   - CS Database object from testcase</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log_dir</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span> <span class="o">=</span> <span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span> <span class="o">=</span> <span class="n">csdb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commserv_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">commserv_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_base_dir</span><span class="p">()</span>

<div class="viewcode-block" id="AutoVSACommcell.get_client_id"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_client_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_client_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the client ID for the given client</span>

<span class="sd">        Args:</span>
<span class="sd">                client_name     (str)   - Client name for whihc client Id</span>
<span class="sd">                                                                                need to be fetched</span>

<span class="sd">        Return:</span>
<span class="sd">                client_id   (int)       - Id of the client name given</span>

<span class="sd">        Exception:</span>
<span class="sd">                if client does not exists in CS</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting the client ID for </span><span class="si">{0}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
            <span class="n">_client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_client_obj</span><span class="o">.</span><span class="n">client_id</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An exception occured in getting the client ID </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.run_backup_copy"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.run_backup_copy">[docs]</a>    <span class="k">def</span> <span class="nf">run_backup_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_policy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Run backup copy job for given storage policy</span>
<span class="sd">        </span>

<span class="sd">        Args:</span>
<span class="sd">            storage_policy   (str)   -- Name of the storage policy</span>

<span class="sd">        Returns:</span>
<span class="sd">            JobID   Backup copy job ID</span>

<span class="sd">            Raise Exception::</span>
<span class="sd">                    if backup copy Job fails to run</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;starting backup copy job&quot;</span><span class="p">)</span>
            <span class="n">storage_policy_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_policies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">storage_policy</span><span class="p">)</span>
            <span class="n">backupcopyjob</span> <span class="o">=</span> <span class="n">storage_policy_object</span><span class="o">.</span><span class="n">run_backup_copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;backup copy job triggered successfully&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">backupcopyjob</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;--Failed to run backupcopy job--&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span></div>

<div class="viewcode-block" id="AutoVSACommcell.run_aux_copy"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.run_aux_copy">[docs]</a>    <span class="k">def</span> <span class="nf">run_aux_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_policy</span><span class="p">,</span><span class="n">storage_policy_copy_name</span><span class="p">,</span> <span class="n">media_agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Run aux copy job for given storage policy</span>
<span class="sd">        </span>

<span class="sd">        Args:</span>
<span class="sd">            storage_policy   (str)   -- Name of the storage policy</span>
<span class="sd">            </span>
<span class="sd">            storage_policy_copy_name (str)      -- storage policy copy name</span>
<span class="sd">            </span>
<span class="sd">            media_agent    (str)                 --Media agent on which Aux copy job to run</span>
<span class="sd">        Returns:</span>
<span class="sd">            JobID   Backup copy job ID</span>

<span class="sd">            Raise Exception::</span>
<span class="sd">                    if aux copy Job fails to run</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;starting Aux copy job&quot;</span><span class="p">)</span>
            <span class="n">storage_policy_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_policies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">storage_policy</span><span class="p">)</span>
            <span class="n">auxcopyjob</span> <span class="o">=</span> <span class="n">storage_policy_object</span><span class="o">.</span><span class="n">run_aux_copy</span><span class="p">(</span><span class="n">media_agent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;auxcopy job triggered successfully&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">auxcopyjob</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;--Failed to run auxcopy job--&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span></div>

<div class="viewcode-block" id="AutoVSACommcell.dev_test_lab"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.dev_test_lab">[docs]</a>    <span class="k">def</span> <span class="nf">dev_test_lab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_name</span><span class="p">,</span> <span class="n">isolated_network</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches the value of vappName and vAppID from CS DB.</span>
<span class="sd">        Also validate if the Isolated network is configured in the Lab</span>

<span class="sd">        Args:</span>

<span class="sd">            lab_name (str) - Virtual App name which is configured under Dev-Test-Group</span>

<span class="sd">            isolated_network (bool) - if True then it will check the gateway template for Virtual Lab</span>

<span class="sd">            **kwargs : Arbitrary keyword arguments.</span>

<span class="sd">        Returns :</span>
<span class="sd">            dict with vAppName and vAppID</span>

<span class="sd">        Raises :</span>
<span class="sd">            Exception if Isolated_Network is to true but template is missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;(select * from App_VirtualApp where name =&#39;</span><span class="si">{0}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lab_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="kn">import</span> <span class="nn">xmltodict</span>
        <span class="kn">import</span> <span class="nn">json</span>
        <span class="n">xmldict</span> <span class="o">=</span> <span class="n">xmltodict</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">_results</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;snap&quot;</span><span class="p">):</span>
            <span class="n">copy</span> <span class="o">=</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;Api_VirtualAppReq&#39;</span><span class="p">][</span><span class="s1">&#39;vApp&#39;</span><span class="p">][</span><span class="s1">&#39;config&#39;</span><span class="p">][</span><span class="s1">&#39;vmGroups&#39;</span><span class="p">][</span><span class="s1">&#39;vmSequence&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">copy</span><span class="p">[</span><span class="s1">&#39;@copyPrecedence&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;incorrect copy precedence is set at Lab policy&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">vmName</span> <span class="ow">in</span> <span class="n">copy</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">vmName</span><span class="p">[</span><span class="s1">&#39;@copyPrecedence&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;incorrect copy precedence is set at Lab policy&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isolated_network</span><span class="p">:</span>
            <span class="n">isolated_Network</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;vmName&#39;</span><span class="p">:</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;Api_VirtualAppReq&#39;</span><span class="p">][</span><span class="s1">&#39;vApp&#39;</span><span class="p">][</span><span class="s1">&#39;policy&#39;</span><span class="p">]</span>
            <span class="p">[</span><span class="s1">&#39;gatewayTemplate&#39;</span><span class="p">][</span><span class="s1">&#39;@vmName&#39;</span><span class="p">]})</span>
            <span class="k">if</span> <span class="s1">&#39;vmName&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">isolated_Network</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Gateway Template not defined&quot;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">ast</span>
        <span class="n">vapp_prop</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;vAppId&#39;</span><span class="p">:</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;Api_VirtualAppReq&#39;</span><span class="p">][</span><span class="s1">&#39;vApp&#39;</span><span class="p">][</span><span class="s1">&#39;vAppEntity&#39;</span><span class="p">][</span><span class="s1">&#39;@vAppId&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;vAppName&#39;</span><span class="p">:</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;Api_VirtualAppReq&#39;</span><span class="p">][</span><span class="s1">&#39;vApp&#39;</span><span class="p">][</span><span class="s1">&#39;vAppEntity&#39;</span><span class="p">][</span><span class="s1">&#39;@vAppName&#39;</span><span class="p">]}))</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">vapp_prop</span><span class="p">:</span>
            <span class="n">vapp_prop</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vapp_prop</span><span class="p">[</span><span class="n">keys</span><span class="p">])</span>
            <span class="k">break</span>
        <span class="k">return</span> <span class="n">vapp_prop</span></div>

<div class="viewcode-block" id="AutoVSACommcell.dev_test_virtual_lab_job"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.dev_test_virtual_lab_job">[docs]</a>    <span class="k">def</span> <span class="nf">dev_test_virtual_lab_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_name</span><span class="p">,</span> <span class="n">isolated_network</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs Virtual Lab restore from Dev_Test_Group at Commcell level</span>

<span class="sd">        Args :</span>

<span class="sd">            lab_name (str) : lab_name from which Virtual lab job will start</span>

<span class="sd">            isolated_network (bool): If true then Lab will be created in Isolated network</span>

<span class="sd">            kwargs: Arbitrary keyword arguments</span>

<span class="sd">            Returns:</span>
<span class="sd">                 Virtual Lab job Id</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;snap&quot;</span><span class="p">):</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dev_test_lab</span><span class="p">(</span><span class="n">lab_name</span><span class="p">,</span> <span class="n">snap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">isolated_network</span><span class="o">=</span><span class="n">isolated_network</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dev_test_lab</span><span class="p">(</span><span class="n">lab_name</span><span class="p">,</span> <span class="n">isolated_network</span><span class="o">=</span><span class="n">isolated_network</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">cvpysdk.dev_test_group</span> <span class="kn">import</span> <span class="n">Dev_Test_Group</span>
        <span class="n">lab_request</span> <span class="o">=</span> <span class="n">Dev_Test_Group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>

        <span class="n">virtual_lab_job</span> <span class="o">=</span> <span class="n">lab_request</span><span class="o">.</span><span class="n">dev_test_lab_json</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">virtual_lab_job</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Virtual Management job is : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">virtual_lab_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">virtual_lab_job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to run Virtual Management job </span><span class="si">{0}</span><span class="s2"> with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">virtual_lab_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">virtual_lab_job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job Status : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">virtual_lab_job</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;one or more error&#39;</span> <span class="ow">in</span> <span class="n">virtual_lab_job</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Virtual Management Job Completed with one or more errors&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validate Lab creation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_lab_creation</span><span class="p">(</span><span class="n">lab_name</span><span class="p">,</span> <span class="n">virtual_lab_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">virtual_lab_job</span><span class="o">.</span><span class="n">job_id</span></div>

<div class="viewcode-block" id="AutoVSACommcell.validate_lab_creation"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.validate_lab_creation">[docs]</a>    <span class="k">def</span> <span class="nf">validate_lab_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_name</span><span class="p">,</span> <span class="n">virtual_lab_job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the Virtual Lab creation in CS DB</span>
<span class="sd">        Args :</span>
<span class="sd">            lab_name (str) : Lab policy under Dev-Test-Group</span>

<span class="sd">            virtual_lab_job (str) : Virtual Management job ID</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception if the CS DB entry is null</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">lab_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">virtual_lab_job</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;(select * from App_VirtualLab where name =&#39;</span><span class="si">{0}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Virtual Lab created successfully&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Virtual Lab Didn&#39;t get created&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_control_host_id"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_control_host_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_control_host_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subclient_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Control Host ID of configured array for the given subclient</span>

<span class="sd">        Args:</span>
<span class="sd">                subclient_name     (str)   - subclient name for which control host Id</span>
<span class="sd">                                             of the configured storage array need to be fetched</span>

<span class="sd">        Return:</span>
<span class="sd">                control host id   (int)    - id of configured storage array for the given subclient</span>

<span class="sd">        Exception:</span>
<span class="sd">                if sub client does not exists in CS or no storage array is configured for the subclient</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select id from APP_Application where subclientName = &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span> \
                <span class="nb">format</span><span class="p">(</span><span class="n">subclient_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">AppId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select SMSnapId from SMVolume v,SMVolSnapMap vsm where v.AppId=&#39;</span><span class="si">{0}</span><span class="s2">&#39; and  v.SMVolumeId = vsm.SMVolumeId&quot;</span><span class="o">.</span> \
                <span class="nb">format</span><span class="p">(</span><span class="n">AppId</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">SMSnapId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select ControlHostId from SMSnap  where  SMSnapId=&#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SMSnapId</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">ControlHostId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ControlHostId</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An exception occured in getting the control host  ID </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_backup_pending_jobs_to_replicate"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_backup_pending_jobs_to_replicate">[docs]</a>    <span class="k">def</span> <span class="nf">get_backup_pending_jobs_to_replicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the backup pending job to replicate for the given client</span>

<span class="sd">        Args:</span>
<span class="sd">                vm_name     (str)   - vm name for which backup jobs yet to replicate need to be fetched</span>

<span class="sd">        Return:</span>
<span class="sd">                pending_backup_jobids   (list)       - list of backup job Id&#39;s yet to replicate for the vm name given</span>

<span class="sd">        Exception:</span>
<span class="sd">                if vm name does not exists in CS</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select BkpJobsToSync from APP_VSAReplication where sourceName = &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span> \
                <span class="nb">format</span><span class="p">(</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">pending_backup_jobids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
            <span class="n">pending_backup_jobids</span> <span class="o">=</span> <span class="n">pending_backup_jobids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pending_backup_jobids</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An exception occured in getting the backup pending jobs to replicate </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.formulate_solr_query"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.formulate_solr_query">[docs]</a>    <span class="k">def</span> <span class="nf">formulate_solr_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subclient_name</span><span class="p">,</span> <span class="n">browse_ma</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formulate SOLR URL using the VM Datasource value retrieved from cvvscatalog log</span>
<span class="sd">        Args:</span>
<span class="sd">                subclient_name  (str)   -  subclient name for which  datsourceId</span>
<span class="sd">                                             of the configured SOLR need to be fetched.</span>

<span class="sd">                browse_ma      (str)   -  MA name where SOLR server is configured.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if there&#39;s any exception while formulating the URL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;(select bsp.attrVal from (select bsn.id from APP_BackupSetName bsn inner join APP_Application &quot;</span> \
                     <span class="s2">&quot;a on bsn.id = a.backupSet where a.subclientName = &#39;</span><span class="si">{0}</span><span class="s2">&#39;) as B inner join &quot;</span> \
                     <span class="s2">&quot;APP_BackupSetProp bsp on B.id = bsp.componentNameId and bsp.attrName = &#39;Indexing datasource id&#39;)&quot;</span> \
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subclient_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">data_source_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;(SELECT CI.ActualCoreName    FROM SEDataSource DS INNER JOIN SECollectionInfo CI ON DS.CoreId &quot;</span> \
                     <span class="s2">&quot;= CI.CoreId AND DS.DatasourceId = </span><span class="si">{0}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_source_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">data_source_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
            <span class="n">solr_url</span> <span class="o">=</span> <span class="s2">&quot;http://&quot;</span> <span class="o">+</span> <span class="n">browse_ma</span> <span class="o">+</span> <span class="s2">&quot;:20000/solr/&quot;</span> <span class="o">+</span> <span class="n">data_source_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> \
                       <span class="s2">&quot;/select?q=AchiveFileId:&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Formulated SOLR URL: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">solr_url</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">solr_url</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception when formulating SOLR URL. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_child_jobs"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_child_jobs">[docs]</a>    <span class="k">def</span> <span class="nf">get_child_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Fetch all child job ids given parent job id</span>

<span class="sd">        Args:</span>
<span class="sd">            job_id          (str)   --  Parent Job ID</span>

<span class="sd">        Returns:</span>
<span class="sd">            child_job_ids   (list)  --  List containing child job IDs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;select childJobId from jmjobdatalink where parentJobId=</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="n">child_job_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">child_job_ids</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_hostname_for_client"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_hostname_for_client">[docs]</a>    <span class="k">def</span> <span class="nf">get_hostname_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Host name for the given HostName</span>

<span class="sd">        Args:</span>
<span class="sd">                client_name     (str)   - Client name for which client Id</span>
<span class="sd">                                                                                need to be fetched</span>
<span class="sd">                                             default value is  commsev_name</span>

<span class="sd">        Return:</span>
<span class="sd">                host_name   (int)       - Hostname of the client name given</span>

<span class="sd">        Exception:</span>
<span class="sd">                if client does not exists in CS</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">client_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commserv_name</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting HostName for Client for </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">client_name</span><span class="p">)</span>
            <span class="n">_client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Successfully got </span><span class="si">{0}</span><span class="s2"> client object&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">_client_obj</span><span class="o">.</span><span class="n">client_hostname</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An exception occured in getting the client ID </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_instanceno_for_client"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_instanceno_for_client">[docs]</a>    <span class="k">def</span> <span class="nf">get_instanceno_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the instance number for the given HostName</span>

<span class="sd">        Args:</span>
<span class="sd">                client_name     (str)   - Client name for which client Id</span>
<span class="sd">                                                                                need to be fetched</span>
<span class="sd">                                             default value is  commsev_name</span>

<span class="sd">        Return:</span>
<span class="sd">                instance  (str)       - Instance number of the client name given</span>

<span class="sd">        Exception:</span>
<span class="sd">                if client does not exists in CS</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">client_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commserv_name</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting HostName for Client for </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">client_name</span><span class="p">)</span>
            <span class="n">_client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Successfully got </span><span class="si">{0}</span><span class="s2"> client object&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">_client_obj</span><span class="o">.</span><span class="n">instance</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An exception occured in getting the instance number </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_client_name_from_hostname"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_client_name_from_hostname">[docs]</a>    <span class="k">def</span> <span class="nf">get_client_name_from_hostname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Host name for the given HostName</span>

<span class="sd">        Args:</span>
<span class="sd">                host_name     (str)   - host name  for which client name</span>
<span class="sd">                                                                                need to be fetched</span>

<span class="sd">        Return:</span>
<span class="sd">                client_name   (int)       -client name of the client from the given hostname</span>

<span class="sd">        Exception:</span>
<span class="sd">                if client does not exists in CS</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting client name for Client for </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">host_name</span><span class="p">)</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select name from APP_Client where net_hostname = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">host_name</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An exception occured in getting the client ID </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_base_dir"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_base_dir">[docs]</a>    <span class="k">def</span> <span class="nf">get_base_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the base directory for the commvault installation</span>

<span class="sd">        Args:</span>
<span class="sd">                client_name     (str)   - Client name for which client Id</span>
<span class="sd">                                                                        need to be fetched</span>
<span class="sd">                                            default value is    (str)   commsev_name</span>

<span class="sd">        Return:</span>
<span class="sd">                base_dir    (int)       - installtion base dir of simpana in that client</span>

<span class="sd">        Exception:</span>
<span class="sd">                if client does not exists in CS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">client_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commserv_name</span>

            <span class="n">_client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Successfully got </span><span class="si">{0}</span><span class="s2"> client object&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
            <span class="n">_base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_client_obj</span><span class="o">.</span><span class="n">install_directory</span><span class="p">,</span> <span class="s2">&quot;Base&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_base_dir</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error in getting the base directory </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_client_os_type"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_client_os_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_client_os_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the OS type [Windows / Unix] of the client</span>

<span class="sd">        Args:</span>
<span class="sd">                client_name     (str)   - Client name for which os info</span>
<span class="sd">                                                                        need to be fetched</span>
<span class="sd">                                            default value is    commsev_name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">client_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commserv_name</span>

            <span class="n">_client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Successfully got </span><span class="si">{0}</span><span class="s2"> client object&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">_client_obj</span><span class="o">.</span><span class="n">os_info</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An error occured in getting the OS version of the client&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.check_backup_job_type_expected"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.check_backup_job_type_expected">[docs]</a>    <span class="k">def</span> <span class="nf">check_backup_job_type_expected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">job_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if the Job Type is expected</span>

<span class="sd">        Args:</span>
<span class="sd">                job_id      (int)   - job id which needs to be checked</span>

<span class="sd">                job_type    (str)   - the job type which the job id provided</span>
<span class="sd">                                        to be verified with</span>

<span class="sd">        Exception:</span>
<span class="sd">                if the job type is not expected</span>

<span class="sd">                if the job does not exist</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_job_info</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
            <span class="n">_job_type_from_cs</span> <span class="o">=</span> <span class="n">_job_info</span><span class="o">.</span><span class="n">backup_level</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_job_type_from_cs</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">==</span> <span class="p">(</span><span class="n">job_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Ok.The job was </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">job_type</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Job type was for the job id </span><span class="si">{0}</span><span class="s2"> is </span><span class="si">{1}</span><span class="s2"> which is not expected&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">job_id</span><span class="p">,</span> <span class="n">job_type</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">errrr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An exception occurred in CheckJobTypeIsExpected&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">errrr</span></div>

    <span class="k">def</span> <span class="nf">_client_exist_in_cs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check particular client exist in CS</span>

<span class="sd">        Args:</span>
<span class="sd">                client_name (str)   - client which has to be chacked that it exist in CS</span>

<span class="sd">        Return:</span>
<span class="sd">                True - If exists</span>

<span class="sd">                False- if does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">has_client</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="AutoVSACommcell.get_job_duration"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_job_duration">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the Duration of the particular Job</span>

<span class="sd">        Args:</span>
<span class="sd">                job_id (int)   -- job id for which duratiuon has to be fetched</span>

<span class="sd">        Exception:</span>
<span class="sd">                if job does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_job_info</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
            <span class="n">_job_duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">_job_info</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">_job_info</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_job_duration</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">errrr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;An exception occurred in GetJobDuration&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">errrr</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_job_results_dir"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_job_results_dir">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_results_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Job Results Directory</span>

<span class="sd">        Args:</span>
<span class="sd">                client_name (str)   -- client name for which simapana isntalled</span>
<span class="sd">                                            Job results directory has to be fetched</span>
<span class="sd">                                default value is     - commserv_name</span>

<span class="sd">        Exception:</span>
<span class="sd">                if client does not exist in cs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">client_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">client_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commserv_name</span>

            <span class="n">_client_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Successfully got </span><span class="si">{0}</span><span class="s2"> client object&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">_client_obj</span><span class="o">.</span><span class="n">job_results_directory</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed to compute Job results Directory&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.find_primary_copy_id"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.find_primary_copy_id">[docs]</a>    <span class="k">def</span> <span class="nf">find_primary_copy_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        find the primary copy id of the specified storage policy</span>

<span class="sd">        Args:</span>
<span class="sd">                sp_id   (int)   : storage policy id</span>

<span class="sd">        Return:</span>
<span class="sd">                primary copy id of that storage policy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select copy from archgroup AG,archGroupCopy AGC where AGC.type = 1 and </span><span class="se">\</span>
<span class="s2">            AGC.isSnapCopy = 0 and  ag.id = AGC.archGroupId and AGC.archGroupId = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">sp_id</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_results</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;An exception occurred getting Sp details details&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;An Aerror occurred in find_primary_copy_id &quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_snapshot_metadata_forjob"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_snapshot_metadata_forjob">[docs]</a>    <span class="k">def</span> <span class="nf">get_snapshot_metadata_forjob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the snapshot Metadata entry in db for job</span>
<span class="sd">            args:</span>
<span class="sd">                job_id (str): job_id for which query has to be performed</span>
<span class="sd">            return:  (list) : list of all Metadata entry  for JOb</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;select  e.SourceGUID,d.MetaData  from SMMetaData d,&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;(select s.SMSnapId,a.SourceGUID from SMVolSnapMap s,SMVolume a&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot; where s.SMVolumeId = a.SMVolumeId and a.jobID = </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">) e&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot; where e.SMSnapId = d.RefId &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;An exception </span><span class="si">{0}</span><span class="s2"> occurred in executing the query </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">query</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="AutoVSACommcell.execute"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the query passed and return the first row of value</span>
<span class="sd">        :param query: Query to be executed against CSDB</span>
<span class="sd">        :return:</span>
<span class="sd">            value : first row of query executed</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_results</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;An exception </span><span class="si">{0}</span><span class="s2"> occurred in executing the query </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_results</span><span class="p">,</span> <span class="n">query</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;An Aerror occurred in executing the db statements &quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.find_snap_copy_id"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.find_snap_copy_id">[docs]</a>    <span class="k">def</span> <span class="nf">find_snap_copy_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp_id</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        find the snap copy id of the specified storage policy</span>

<span class="sd">        Args:</span>
<span class="sd">                sp_id   (int)   : storage policy id</span>

<span class="sd">        Return:</span>
<span class="sd">                snap copy id of that storage policy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select copy from archgroup AG,archGroupCopy AGC where AGC.isSnapCopy = 1 and </span><span class="se">\</span>
<span class="s2">                                    ag.id = AGC.archGroupId and AGC.archGroupId = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">sp_id</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span></div>

<div class="viewcode-block" id="AutoVSACommcell.find_aux_copy_id"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.find_aux_copy_id">[docs]</a>    <span class="k">def</span> <span class="nf">find_aux_copy_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp_id</span><span class="p">,</span> <span class="n">copy_name</span><span class="o">=</span><span class="s2">&quot;Aux&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        find the aux copy id of the specified storage policy</span>

<span class="sd">        Args:</span>
<span class="sd">                sp_id   (int)   : storage policy id</span>

<span class="sd">        Return:</span>
<span class="sd">                aux copy id of that storage policy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select copy from archgroup AG,archGroupCopy AGC where </span><span class="se">\</span>
<span class="s2">                            ag.id = AGC.archGroupId and AGC.archGroupId = </span><span class="si">{0}</span><span class="s2"> and AGC.name = &#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">sp_id</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span></div>

<div class="viewcode-block" id="AutoVSACommcell.find_app_aware_jobs"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.find_app_aware_jobs">[docs]</a>    <span class="k">def</span> <span class="nf">find_app_aware_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vsa_backup_job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the workflow Job and IDA backup job id provided the VSA backup job</span>
<span class="sd">        :param vsa_backup_job:  VSA Backup Job ID</span>
<span class="sd">        :return:</span>
<span class="sd">            workflow_job : Work flow job ID for the VSA backup Job</span>
<span class="sd">            IDA_job      : IDA Job id for VSA backup job</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select childjobId  from jmVSAAppJobLink </span><span class="se">\</span>
<span class="s2">                            where Parentjobid = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">vsa_backup_job</span>
            <span class="n">ida_job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>

            <span class="n">_query1</span> <span class="o">=</span> <span class="s2">&quot;select workFlowjobId  from jmVSAAppJobLink</span><span class="se">\</span>
<span class="s2">                            where Parentjobid = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">vsa_backup_job</span>
            <span class="n">workflow_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query1</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ida_job_id</span><span class="p">,</span> <span class="n">workflow_job</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;An Error </span><span class="si">{0}</span><span class="s2"> occurred in find_aux_copy_id &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.check_cbt_status"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.check_cbt_status">[docs]</a>    <span class="k">def</span> <span class="nf">check_cbt_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_type</span><span class="p">,</span> <span class="n">subclient_obj</span><span class="p">,</span> <span class="n">job_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check CBT status for the backed up VMs according to backup type</span>

<span class="sd">        Args:</span>
<span class="sd">                backup_type    (string) - FULL/INCR/DIFF/SYNTH_FULL</span>
<span class="sd">                subclient_obj   (obj) - Subclient sdk object</span>
<span class="sd">                job_id         (int) - Job ID for which CBT status is needed</span>
<span class="sd">                                         else last jobID is used</span>
<span class="sd">        Raise Exception:</span>
<span class="sd">                If CBT status for given VM for given backup type is unexpected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">job_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">job_id</span> <span class="o">=</span> <span class="n">subclient_obj</span><span class="o">.</span><span class="n">find_latest_job</span><span class="p">(</span><span class="n">include_active</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">backup_type</span> <span class="o">==</span> <span class="s2">&quot;FULL&quot;</span><span class="p">:</span>
                <span class="n">cbt_status</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Enabled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cbt_status</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Used&#39;</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT attrVal from APP_VMProp where attrName = &#39;vmCBTStatus&#39; &quot;</span> \
                     <span class="s2">&quot; and jobId =</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="o">.</span><span class="n">_job_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>

            <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">_results</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cbt_status</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;cbt_status for the VM is not </span><span class="si">{0}</span><span class="s2">, it is </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbt_status</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The CBT status for all the VMs is </span><span class="si">{0}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cbt_status</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception while checking the CBT status on the recent backuped VMs:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.backup_time_check"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.backup_time_check">[docs]</a>    <span class="k">def</span> <span class="nf">backup_time_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subclient</span><span class="p">,</span> <span class="n">full_bkp_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Comapre and verify if time taken by incremental job is not more</span>
<span class="sd">            than 60% of as taken by FUll backup job</span>
<span class="sd">            Args:</span>
<span class="sd">                subclient          (obj):  Corresspoding subclient object</span>
<span class="sd">                full_bkp_time      (str):  Time taken by FUll  job</span>

<span class="sd">            Returns:</span>
<span class="sd">                True            (boolean): if verficiation check succeeds</span>
<span class="sd">                False           (boolean): if check fails</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to perform verificaton check</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">incr_job_id</span> <span class="o">=</span> <span class="n">subclient</span><span class="o">.</span><span class="n">find_latest_job</span><span class="p">(</span><span class="n">include_active</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">_job_info</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">incr_job_id</span><span class="o">.</span><span class="n">_job_id</span><span class="p">)</span>
            <span class="n">total_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_job_info</span><span class="o">.</span><span class="n">_summary</span><span class="p">[</span><span class="s1">&#39;jobEndTime&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span>
                <span class="n">_job_info</span><span class="o">.</span><span class="n">_summary</span><span class="p">[</span><span class="s1">&#39;jobStartTime&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">total_time</span> <span class="o">&gt;</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">full_bkp_time</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Time taken verification for incremental backup failed&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Time taken verification for incremental backup succeedded&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception while backup time check&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.find_job_transport_mode"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.find_job_transport_mode">[docs]</a>    <span class="k">def</span> <span class="nf">find_job_transport_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vsa_backup_job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find and return the Transport mode for the job</span>
<span class="sd">        Args:</span>
<span class="sd">            vsa_backup_job          (str):  Job id</span>

<span class="sd">        Returns:</span>
<span class="sd">            transport_mode          (str):  Transport mode of the job</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if failed to get the transport mode for the backup job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot; select attrVal from APP_VMProp where attrName like &#39;vmTransportMode&#39; and &quot;</span> \
                     <span class="s2">&quot;jobid = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">vsa_backup_job</span>
            <span class="n">transport_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">transport_mode</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception while getting transport mode for the job &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.live_browse_get_ds_info"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.live_browse_get_ds_info">[docs]</a>    <span class="k">def</span> <span class="nf">live_browse_get_ds_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vsa_backup_job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To get the list of DS currently mounted</span>

<span class="sd">        Args:</span>
<span class="sd">            vsa_backup_job          (str):  Job id</span>

<span class="sd">        Returns:</span>
<span class="sd">            ds_list                 (list): List of DS currently mounted</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if failed to get the browse ds information</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select MountDevice from SMVolume where SMVolumeId in &quot;</span> \
                     <span class="s2">&quot;(select SMVolumeId from SMSnapResource) and JobId=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">vsa_backup_job</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">ds_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ds_list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;An exception occurred getting server details&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ds_list</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception while getting transport mode for the job &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_snap_mount_status"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_snap_mount_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_snap_mount_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap_backup_job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns the status of snap mount</span>

<span class="sd">            Args:</span>
<span class="sd">                snap_backup_job             (str): Snap Backup Job ID</span>

<span class="sd">            Returns:</span>
<span class="sd">                The Snap mount status</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;select MountStatus from SMVolume WHERE JOBID =&#39;</span><span class="si">{</span><span class="n">snap_backup_job</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>
        <span class="n">mount_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mount_status</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_synth_backup_job_v2"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_synth_backup_job_v2">[docs]</a>    <span class="k">def</span> <span class="nf">get_synth_backup_job_v2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eachvm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Synthful Job ID for v2 client</span>

<span class="sd">        Args:</span>
<span class="sd">            eachvm              (str)   : The vm for the which Synthful Job is is to be fetched</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Synthful Job ID for v2 client</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;select jobId from JMBkpJobInfo where bkpLevel = 64 and applicationId in (</span>
<span class="s2">        select id from app_application where backupset in (select ChildBackupSetId from app_vmbackupset </span>
<span class="s2">        where vmclientid in (select id from app_client where name = &#39;</span><span class="si">{</span><span class="n">eachvm</span><span class="si">}</span><span class="s2">&#39;))) order by jobId desc&quot;&quot;&quot;</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;select TOP 1 jobId from JMBkpStats where bkpLevel = 64 and appId in (</span>
<span class="s2">                                select id from app_application where backupset in (</span>
<span class="s2">                                select ChildBackupSetId from app_vmbackupset where vmclientid in (</span>
<span class="s2">                                select id from app_client where name = &#39;</span><span class="si">{</span><span class="n">eachvm</span><span class="si">}</span><span class="s2">&#39;))) order by jobId desc&quot;&quot;&quot;</span>
            <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Couldnt fetch v2 Synthfull backup id&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">job_id</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_snap_job_child"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_snap_job_child">[docs]</a>    <span class="k">def</span> <span class="nf">get_snap_job_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm</span><span class="p">,</span> <span class="n">snap_backup_job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns  the snap backup job id for the child for v2 clients</span>
<span class="sd">        Args:</span>
<span class="sd">            vm          (str) : the vm name for which the backup job is run</span>

<span class="sd">        Returns:</span>
<span class="sd">            The snap backup job for the child</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;select childJobId from JMJobDataLink where childAppid in (select id from </span>
<span class="s2">                           APP_Application where clientId in (select id from App_client where name =&#39;</span><span class="si">{</span><span class="n">vm</span><span class="si">}</span><span class="s2">&#39;)) and </span>
<span class="s2">                           parentJobId = &#39;</span><span class="si">{</span><span class="n">snap_backup_job</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>

        <span class="n">snap_backup_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">snap_backup_job</span></div>

<div class="viewcode-block" id="AutoVSACommcell.check_if_discovered_client"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.check_if_discovered_client">[docs]</a>    <span class="k">def</span> <span class="nf">check_if_discovered_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns if the client is a discovered client or not</span>

<span class="sd">        Args:</span>
<span class="sd">            client      (str): Client to be checked</span>

<span class="sd">        Returns:</span>
<span class="sd">            True or False {Client is discovered or not}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;select specialClientFlags from APP_Client where name = &#39;</span><span class="si">{</span><span class="n">client</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>

        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;11&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="AutoVSACommcell.check_v2_indexing"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.check_v2_indexing">[docs]</a>    <span class="k">def</span> <span class="nf">check_v2_indexing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether the client is v1 or v2</span>

<span class="sd">        Args:</span>
<span class="sd">            client      (str) : Client to be checked</span>

<span class="sd">        Retuns:</span>
<span class="sd">           True or False {Client is v2 or not}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;select attrVal from App_ClientProp where componentNameID = </span>
<span class="s2">        (select id from APP_Client where name = &#39;</span><span class="si">{</span><span class="n">client</span><span class="si">}</span><span class="s2">&#39; and attrName = &#39;IndexingV2_VSA&#39;)&quot;&quot;&quot;</span>
        <span class="n">attr_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr_val</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_live_mount_share_name"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_live_mount_share_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_live_mount_share_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">live_mount_job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns  the snap backup job id for the child for v2 clients</span>
<span class="sd">        Args:</span>
<span class="sd">            live_mount_job          (str) : the job id for which the share name to get</span>

<span class="sd">        Returns:</span>
<span class="sd">            The share name for the job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Select shareName from APP_3DFSVSAExportProps where jobId = &#39;</span><span class="si">{</span><span class="n">live_mount_job</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>

        <span class="n">share_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">share_name</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_IndexCache_location"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_IndexCache_location">[docs]</a>    <span class="k">def</span> <span class="nf">get_IndexCache_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indexserverid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the index cache location for the Given Index Server</span>

<span class="sd">        Args:</span>
<span class="sd">            indexserverid     (str)    --  Index Server ID</span>

<span class="sd">        Returns:</span>
<span class="sd">            (str)                    --    The Index Cache path of the Index Server</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception if failed to get Index Cache location</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select attrVal from app_clientprop where attrName = &#39;Idx: cache path&#39; and componentNameId=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">indexserverid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unable to get IndexCache directory for the Index Server </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">indexserverid</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception while getting IndexCache directory &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_rfc_archfile_count"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_rfc_archfile_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_rfc_archfile_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the RFC Archive File count</span>

<span class="sd">        Args:</span>
<span class="sd">            jobid        (str)    --     Job ID</span>

<span class="sd">        Returns:</span>
<span class="sd">            (str)    -- count of RFC Arch Files</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception if failed to get Arch files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select count(*) from archfile where name =&#39;RFC_AFILE&#39; and jobId=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">jobid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;RFC Arch file failed to  create with backup</span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception while getting RFC Arch files for the job &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_Child_subclient_GUID_list"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_Child_subclient_GUID_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_Child_subclient_GUID_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of Child SubClient GUID, Child JobID, Child VM GUID</span>

<span class="sd">        Args:</span>
<span class="sd">            jobid    (str) -- Parent Job ID</span>

<span class="sd">        Returns:</span>
<span class="sd">            (list)    -- list of Child SubClient GUID, Child JobID, Child VM GUID</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception if failed to get the list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;Select a.GUID, b.childJobId, c.GUID from APP_Application a </span><span class="se">\</span>
<span class="s2">                            INNER JOIN JMJobDataLink b </span><span class="se">\</span>
<span class="s2">                            ON a.id = b.childAppid </span><span class="se">\</span>
<span class="s2">                            INNER JOIN App_Client c </span><span class="se">\</span>
<span class="s2">                            ON a.clientId = c.id </span><span class="se">\</span>
<span class="s2">                            where parentJobId = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">jobid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>

            <span class="n">child_guid_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">child_guid_list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to get Child SubClient GUID - ChildJobID list for Parent Job </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">child_guid_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception while getting Child SubClient GUID - ChildJobID list for Parent Job &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_backup_phase_status"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_backup_phase_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_backup_phase_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backup_job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get status of each phase of a Backup</span>

<span class="sd">        Args:</span>
<span class="sd">            backup_job_id    (string):     backup job ID</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if there&#39;s any exception while getting phase status</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting phases for Backup Job </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">backup_job_id</span><span class="p">)</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select Status from JMBkpAtmptStats where jobID = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">backup_job_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">_results</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">each_phase_status</span> <span class="ow">in</span> <span class="n">_results</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">each_phase_status</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">each_phase_status</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Backup job did not complete successfully. One of the phases failed.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception when getting Backup Job details: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="AutoVSACommcell.create_pesudo_client"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.create_pesudo_client">[docs]</a>    <span class="k">def</span> <span class="nf">create_pesudo_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">,</span><span class="n">client_name</span><span class="p">,</span> <span class="n">vcenter_hostname</span><span class="p">,</span> <span class="n">vcenter_username</span><span class="p">,</span> <span class="n">vcenter_password</span><span class="p">,</span> <span class="n">proxies</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        check if client exists and if exits delete the client before creating new VMware client</span>
<span class="sd">        </span>

<span class="sd">        Args:</span>
<span class="sd">            name   (list)   -- Name of the client to delete</span>
<span class="sd">            client_name (str) -- Name pesudo client</span>
<span class="sd">            vcenter_hostname (str) -- Vcenter hostname</span>
<span class="sd">            vcenter_hostname (str) -- Vcenter username</span>
<span class="sd">            vcenter_password (str) -- Vcenter password</span>
<span class="sd">            Proxies (list) -- Proxies clients</span>

<span class="sd">        Returns:</span>
<span class="sd">            new client object</span>

<span class="sd">            Raise Exception::</span>
<span class="sd">                    if failed to create pesudo client</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;-checking if client exist and delete if exist-&#39;</span><span class="p">)</span>
            <span class="n">clients</span> <span class="o">=</span> <span class="n">Clients</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">eachitem</span> <span class="ow">in</span> <span class="n">name</span> <span class="p">:</span>
                <span class="n">cliententry</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">has_client</span><span class="p">(</span><span class="n">eachitem</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cliententry</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">clients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">eachitem</span><span class="p">)</span>
                    <span class="n">clients</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-Client deleted successfully-&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-creating new VMware Hypervisor -&#39;</span><span class="p">)</span>
            <span class="n">newclient</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">add_vmware_client</span><span class="p">(</span><span class="n">client_name</span><span class="p">,</span> <span class="n">vcenter_hostname</span> <span class="p">,</span> <span class="n">vcenter_username</span> <span class="p">,</span> <span class="n">vcenter_password</span><span class="p">,</span> <span class="n">proxies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-New Hypervisor created successfully -&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">newclient</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;--Vmware Hypervisor creation failed--&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span></div>

<div class="viewcode-block" id="AutoVSACommcell.run_data_aging"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.run_data_aging">[docs]</a>    <span class="k">def</span> <span class="nf">run_data_aging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        runs data aging job.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            JobID   data aging job ID</span>

<span class="sd">            Raise Exception::</span>
<span class="sd">                    if data aging Job fails to run</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">agingjob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">(</span><span class="n">copy_name</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                                  <span class="n">storage_policy_name</span><span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">agingjob</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to run data aging with error: </span><span class="si">{0}</span><span class="s2">&quot;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">agingjob</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;backup copy job triggered successfully&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">agingjob</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;--Failed to run data aging job--&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span></div>

<div class="viewcode-block" id="AutoVSACommcell.client_status"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.client_status">[docs]</a>    <span class="k">def</span> <span class="nf">client_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clientname</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">        checks for client status whether deconfigured or configured from DB</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            clientname (list)  - client name to check  status</span>
<span class="sd">        Raise:</span>
<span class="sd">              Exception:</span>
<span class="sd">                If fail to get status</span>
<span class="sd">        Returns: </span>
<span class="sd">              client name and staus (dict)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-checking VM status on DB-&#39;</span><span class="p">)</span>
            <span class="n">statusdic</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">eachname</span> <span class="ow">in</span> <span class="n">clientname</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT status from APP_CLIENT where Name = &#39;&quot;</span><span class="o">+</span><span class="n">eachname</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
                <span class="n">statusdic</span><span class="p">[</span><span class="n">eachname</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
            <span class="k">return</span> <span class="n">statusdic</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;---Client is not in deconfigure state ---&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span></div>

    

<div class="viewcode-block" id="AutoVSACommcell.Validate_job_entry"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.Validate_job_entry">[docs]</a>    <span class="k">def</span> <span class="nf">Validate_job_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">        Validate job entries on DB</span>
<span class="sd">        Args</span>
<span class="sd">            job (str)  - jobid</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Job entries (dict)</span>
<span class="sd">        </span>
<span class="sd">        Raise:</span>
<span class="sd">              Exception:</span>
<span class="sd">                If fail to validate job entry</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Validate job entries on DB&#39;</span><span class="p">)</span>
            <span class="n">jobsdict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">eachjob</span> <span class="ow">in</span> <span class="n">jobid</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT distinct jmbkpstats.jobid FROM jmbkpstats INNER JOIN JMJobDataLink ON jmbkpstats.jobId = JMJobDataLink.parentjobid INNER JOIN APP_VMProp on jmbkpstats.jobId = APP_VMProp.jobId where jmbkpstats.jobid = &#39;&quot;</span><span class="o">+</span><span class="n">eachjob</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
                <span class="n">jobsdict</span><span class="p">[</span><span class="n">eachjob</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">jobsdict</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception getting job entries from DB&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_backup_job_archive_files"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_backup_job_archive_files">[docs]</a>    <span class="k">def</span> <span class="nf">get_backup_job_archive_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_backup_job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a child backup job, get the associated archive file IDs that have flags 64 or 65600</span>

<span class="sd">        Args:</span>
<span class="sd">            child_backup_job_id    (string):     child backup job ID</span>

<span class="sd">        Returns:</span>
<span class="sd">            a list of Archive File IDs that have flags 64 or 65600</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if there&#39;s any exception while retrieving the archive file IDs from the CS DB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Querying CS DB to get archive file IDs that are marked 64&quot;</span><span class="p">)</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select id from archFile where jobid = </span><span class="si">%s</span><span class="s2"> and (flags&amp;64) = 64&quot;</span> <span class="o">%</span> <span class="n">child_backup_job_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="n">archive_file_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">archive_file</span> <span class="ow">in</span> <span class="n">_results</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Archive File with either 64 or 65600 Flag: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">archive_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">archive_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">archive_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">archive_file_list</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception when querying the CS DB to retrieve Archive File IDs for Backup Job </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">child_backup_job_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_nfs_server_cache"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_nfs_server_cache">[docs]</a>    <span class="k">def</span> <span class="nf">get_nfs_server_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ma_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            ma_name                         (String):   name of the media agent</span>

<span class="sd">        Returns:</span>
<span class="sd">            path of the nfs server cache</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if it fails to do get nfs server cache</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;select IdxAccessPath.path from IdxAccessPath</span>
<span class="s1">            inner join IdxCache</span>
<span class="s1">            on IdxCache.IdxCacheId = IdxAccessPath.IdxCacheId</span>
<span class="s1">            where IdxCache.IdxCacheType = 3 and IdxAccessPath.ClientId in </span>
<span class="s1">            (select id from APP_Client where name like &#39;</span><span class="si">{}</span><span class="s1">&#39;)&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ma_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception when querying the CS DB to get nfs server cache </span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span>
                               <span class="nb">format</span><span class="p">(</span><span class="n">ma_name</span><span class="p">,</span> <span class="n">exp</span><span class="p">))</span></div>

<div class="viewcode-block" id="AutoVSACommcell.get_job_start_end_time"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_job_start_end_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_start_end_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the start and end time of the job</span>

<span class="sd">        Args:</span>
<span class="sd">        job_id  (string) : Job id for which details are to be fetched</span>

<span class="sd">        Returns:</span>
<span class="sd">            time for the job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Select servStartDate, servEndDate from JMBkpStats where jobId = </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="n">job_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job_info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;An exception occurred while getting job information&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job_info</span></div>
    

<div class="viewcode-block" id="AutoVSACommcell.get_job_backup_size"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_job_backup_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_backup_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the backup size</span>

<span class="sd">        Args:</span>
<span class="sd">        job_id (string) : Job Id for whoch backup size has to be fetched</span>

<span class="sd">        Returns:</span>
<span class="sd">            size of the jobs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Select totalBackupSize from JMBkpStats where jobId = </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="n">job_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_one_row</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job_info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;An exception occurred while getting job information&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job_info</span></div>

<div class="viewcode-block" id="AutoVSACommcell.add_filter"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.add_filter">[docs]</a>    <span class="k">def</span> <span class="nf">add_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backupsetobj</span><span class="p">,</span> <span class="n">subclientname</span><span class="p">,</span> <span class="n">subclientid</span><span class="p">,</span> <span class="n">vmname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">        This is used to add the a VM to  filters on the subclient.</span>
<span class="sd">         </span>
<span class="sd">        Args:</span>
<span class="sd">            backupsetobj - backupset object </span>
<span class="sd">            subclientname (str) - name of the subclient to which content to be added</span>
<span class="sd">            subclientid  (int) - Id of the subclient to which content to be added</span>
<span class="sd">            vname (str) - Vm name to add to subclient filter</span>
<span class="sd">        Raise:</span>
<span class="sd">              Exception:</span>
<span class="sd">                If unable to add VM to filter</span>
<span class="sd"> </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">contentobj</span> <span class="o">=</span> <span class="n">VirtualServerSubclient</span><span class="p">(</span><span class="n">backupsetobj</span><span class="p">,</span> <span class="n">subclientname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">vm_filter</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select GUID, displayName  from app_client where name = &#39;&quot;</span><span class="o">+</span><span class="n">vmname</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">virtual_server_dict</span> <span class="o">=</span> <span class="p">{</span>
               <span class="s1">&#39;allOrAnyChildren&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;equalsOrNotEquals&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s1">&#39;displayName&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="mi">9</span>
            <span class="p">}</span>

            <span class="n">vm_filter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">virtual_server_dict</span><span class="p">)</span>
            <span class="n">vs_filter_content</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;children&quot;</span><span class="p">:</span> <span class="n">vm_filter</span>
            <span class="p">}</span>
            <span class="n">contentobj</span><span class="o">.</span><span class="n">_set_subclient_properties</span><span class="p">(</span><span class="s2">&quot;_vmFilter&quot;</span><span class="p">,</span> <span class="n">vs_filter_content</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;VM added to subclient filter successfully&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception while adding filters to subclient&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>


<div class="viewcode-block" id="AutoVSACommcell.get_copy_retention"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VirtualServerHelper.html#VirtualServer.VSAUtils.VirtualServerHelper.AutoVsaCommcell.AutoVSACommcell.get_copy_retention">[docs]</a>    <span class="k">def</span> <span class="nf">get_copy_retention</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find copy retention setting from the snap job ID and return the value</span>

<span class="sd">        Raise Exception:</span>
<span class="sd">                If unable to find snap job or run DB query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JOB ID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="p">))</span>
            <span class="n">_query1</span> <span class="o">=</span> <span class="s2">&quot;select CopyId from SMVolume where JobId= &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">job_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query1</span><span class="p">)</span>
            <span class="n">_results1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;COPY ID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_results1</span><span class="p">))</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot;select retentionJobs from archAgingRule where copyId= &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">_results1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csdb</span><span class="o">.</span><span class="n">fetch_all_rows</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;RETENTION: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_results</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Exception while validating snaps: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>