

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>VirtualServer.VSAUtils.OpenStackWrapper &mdash; Commvault Automation 11.24 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>VirtualServer.VSAUtils.OpenStackWrapper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for VirtualServer.VSAUtils.OpenStackWrapper</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Wrapper methods for OpenStack</span>

<span class="sd">Endpoints:  All required OpenStack endpoints.</span>



<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">logger</span><span class="p">,</span> <span class="n">machine</span>



<div class="viewcode-block" id="OpenStackSDKWrapper"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackSDKWrapper">[docs]</a><span class="k">class</span> <span class="nc">OpenStackSDKWrapper</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Initialization of OpenStackSDKWrapper</span>

<span class="sd">            get_openstack_connection()  - Creates open stack connection</span>

<span class="sd">            get_cinder_connection()     -Creates cinder connection</span>

<span class="sd">            close_openstack_connection()- closes open stack connection</span>

<span class="sd">            get_session()               - get the openstack session</span>

<span class="sd">            get_creds()                 - gets openstack credentials in json format.</span>

<span class="sd">            login()                     - Performs openstack server login</span>

<span class="sd">            get_ostack_tokens()         - This mehtod gets the openstack token</span>

<span class="sd">            process_post_request()      - Processes the post request</span>

<span class="sd">            process_post_request()      - Process the get request</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">servername</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        servername              (str) -- OpenstackServer Name</span>
<span class="sd">        username                (str) -- OpenStack server user name</span>
<span class="sd">        password                  (str) -- OpenStack sever user password</span>
<span class="sd">        projectname             (str) -- Openstack project name</span>
<span class="sd">        port                    (str) -- OpenStack keystone port to connect</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">servername</span> <span class="o">=</span> <span class="n">servername</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projectName</span> <span class="o">=</span> <span class="n">project_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">servername</span><span class="si">}</span><span class="s2">:5000/v3&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username_domain_id</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_domain_id</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_openstack_conn</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="k">if</span> <span class="n">port</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KEYSTONE_DEFAULT_PORT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="c1">##Required OpenStack endpoints</span>
    <span class="n">KEYSTONE_ENDPOINT_NAME</span> <span class="o">=</span> <span class="s2">&quot;keystone&quot;</span>
    <span class="n">NOVA_ENDPOINT_NAME</span> <span class="o">=</span> <span class="s2">&quot;nova&quot;</span>
    <span class="n">GLANCE_ENDPOINT_NAME</span> <span class="o">=</span> <span class="s2">&quot;glance&quot;</span>
    <span class="n">CINDER_ENDPOINT_NAME</span> <span class="o">=</span> <span class="s2">&quot;cinder&quot;</span>
    <span class="n">NEUTRON_ENDPOINT_NAME</span> <span class="o">=</span> <span class="s2">&quot;neutron&quot;</span>

    <span class="c1">#Project</span>
    <span class="n">DEFAULT_PROJECT</span> <span class="o">=</span> <span class="s2">&quot;admin&quot;</span>
    <span class="c1">#URL</span>
    <span class="n">AUTH_URL_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;http://&quot;</span>
    <span class="n">AUTH_URL_PREFIX_SECURE</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span>
    <span class="n">AUTH_URL_SUFFIX_V2</span> <span class="o">=</span> <span class="s2">&quot;/v2&quot;</span>
    <span class="n">AUTH_URL_SUFFIX_V20</span> <span class="o">=</span> <span class="s2">&quot;/v2.0&quot;</span>
    <span class="n">AUTH_URL_SUFFIX_V21</span> <span class="o">=</span> <span class="s2">&quot;/v2.1&quot;</span>
    <span class="n">AUTH_URL_SUFFIX_V3</span> <span class="o">=</span> <span class="s2">&quot;/v3&quot;</span>

    <span class="c1">#KEYSTONE APIs</span>
    <span class="n">KEYSTONE_DEFAULT_PORT</span> <span class="o">=</span> <span class="mi">5000</span>
    <span class="n">API_KEYSTONE_TENANTS</span> <span class="o">=</span> <span class="s2">&quot;/tenants&quot;</span>
    <span class="n">API_KEYSTONE_PROJECTS_V3</span> <span class="o">=</span> <span class="s2">&quot;/projects&quot;</span>
    <span class="c1">## POST APIs</span>
    <span class="n">API_KEYSTONE_TOKENS</span> <span class="o">=</span> <span class="s2">&quot;/tokens&quot;</span>
    <span class="n">API_KEYSTONE_TOKENS_V3</span> <span class="o">=</span> <span class="s2">&quot;/auth/tokens&quot;</span>

    <span class="c1">#NOVA APIs</span>
    <span class="n">NOVA_DEFAULT_PORT</span> <span class="o">=</span> <span class="mi">8774</span>
    <span class="n">API_NOVA_SERVER_LIST</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">{tenantid}</span><span class="s2">/servers&quot;</span>  <span class="c1"># /{tenant_id}/servers</span>
    <span class="n">API_NOVA_SERVER_DETAIL_LIST</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">{tenantid}</span><span class="s2">/servers/detail&quot;</span>  <span class="c1"># /{tenant_id}/servers/detail</span>
    <span class="n">API_NOVA_SERVER_ACTION</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">{tenantid}</span><span class="s2">/servers/</span><span class="si">{serverid}</span><span class="s2">/action&quot;</span>  <span class="c1">#</span>

    <span class="n">API_NOVA_AVAILABILITY_ZONE</span> <span class="o">=</span> <span class="s2">&quot;/os-availability-zone&quot;</span>  <span class="c1"># /{tenant_id}/os-availability-zone</span>

    <span class="n">API_NOVA_ATTACHED_VOLUME_DETAIL</span> <span class="o">=</span> <span class="s2">&quot;/servers/</span><span class="si">%s</span><span class="s2">/os-volume_attachments/</span><span class="si">%s</span><span class="s2">&quot;</span>  <span class="c1"># /{tenant_id}/</span>
    <span class="c1"># servers/{server_id}/os-volume_attachments/{attachment_id} */</span>

    <span class="n">API_NOVA_ATTACHED_VOLUME_LIST</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">{tenantid}</span><span class="s2">/servers/</span><span class="si">{serverid}</span><span class="s2">/os-volume_attachments&quot;</span>
    <span class="c1"># /{tenant_id}/servers/{server_id}/os-volume_attachments */</span>

    <span class="c1">#CINDER APIs</span>
    <span class="n">CINDER_DEFAULT_PORT</span> <span class="o">=</span> <span class="mi">8776</span>
    <span class="n">API_CINDER_VOLUME_LIST</span> <span class="o">=</span> <span class="s2">&quot;/volumes/detail&quot;</span>  <span class="c1"># /{tenant_id}/volumes/details</span>
    <span class="n">API_CINDER_VOLUMETYPE</span> <span class="o">=</span> <span class="s2">&quot;/types&quot;</span>  <span class="c1"># /{tenant_id}/types</span>
    <span class="n">API_CINDER_SNAPSHOT_LIST</span> <span class="o">=</span> <span class="s2">&quot;/snapshots&quot;</span>  <span class="c1"># /{tenant_id}/snapshots</span>
    <span class="n">API_CINDER_SNAPSHOT_DETAIL_LIST</span> <span class="o">=</span> <span class="s2">&quot;/snapshots/detail&quot;</span>  <span class="c1"># /{tenant_id}/snapshots/details</span>
    <span class="c1"># /v3/{project_id}/types</span>

    <span class="c1">#Region API</span>
    <span class="n">API_REGION_LIST</span> <span class="o">=</span> <span class="s2">&quot;/regions&quot;</span>  <span class="c1">#http://172.24.20.228:5000/v3/regions</span>

    <span class="c1">#NEUTRON APIS</span>
    <span class="n">API_DEFAULT_NETWORK_PORT</span> <span class="o">=</span> <span class="mi">9696</span>
    <span class="n">API_NEUTRON_LIST_IPS</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">{tenantid}</span><span class="s2">/servers/</span><span class="si">{serverid}</span><span class="s2">/ips&quot;</span>
    <span class="n">API_LIST_FLOATING_IPS</span> <span class="o">=</span> <span class="s2">&quot;/floatingips&quot;</span>

    <span class="n">HTTP_STATUS_CODES</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">208</span><span class="p">]</span>

    <span class="c1">#For now we only support windows platform, as Openstack doesnt have a way to query OS type.</span>
    <span class="n">GUEST_OS</span> <span class="o">=</span> <span class="s2">&quot;Windows&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tokenObject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get token Object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenObj</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">openstack_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get openstack connection object</span>
<span class="sd">        Arg:None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">openstack</span> <span class="kn">import</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_openstack_conn</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">auth_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_url</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projectName</span><span class="p">,</span>
                                            <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                                            <span class="n">user_domain_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username_domain_id</span><span class="p">,</span>
                                            <span class="n">project_domain_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_domain_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_openstack_conn</span>


<div class="viewcode-block" id="OpenStackSDKWrapper.get_cinder_connection"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackSDKWrapper.get_cinder_connection">[docs]</a>    <span class="k">def</span> <span class="nf">get_cinder_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates cinder connection</span>
<span class="sd">        Args:None</span>
<span class="sd">        return:returns cinder connection object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">cinderclient</span> <span class="kn">import</span> <span class="n">client</span> <span class="k">as</span> <span class="n">cinderclient</span>
        <span class="n">cinder</span> <span class="o">=</span> <span class="n">cinderclient</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cinder</span></div>

    <span class="nd">@tokenObject</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tokenObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the token object which we get as response from login</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenObj</span> <span class="o">=</span> <span class="n">obj</span>

<div class="viewcode-block" id="OpenStackSDKWrapper.prepare_url"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackSDKWrapper.prepare_url">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">server</span><span class="p">,</span><span class="n">endpoint</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepares URL with required prefix and keystone version</span>

<span class="sd">            Args:</span>
<span class="sd">                server   --  OpenStack server name</span>

<span class="sd">                endpoint --  Endpoint to execute</span>

<span class="sd">                version  --  OpenStack server version</span>

<span class="sd">                port     --  Keystone server port if non default port configured</span>

<span class="sd">                prefix   --  prefix (default http).</span>

<span class="sd">            Returns:</span>
<span class="sd">                str    -   returns fully formes url</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_PREFIX</span>
            <span class="k">if</span> <span class="n">port</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KEYSTONE_DEFAULT_PORT</span>
            <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_SUFFIX_V2</span>

            <span class="n">url</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">server</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="n">endpoint</span>
            <span class="c1">#self.log(&quot;successfully computed and sending formatted URL {0}&quot;.format(url))</span>
            <span class="k">return</span> <span class="n">url</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An Exception Occurred in preparing URL&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="OpenStackSDKWrapper.get_session"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackSDKWrapper.get_session">[docs]</a>    <span class="k">def</span> <span class="nf">get_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get session object with args passed in.</span>

<span class="sd">            Args:</span>
<span class="sd">                kwargs (example)   --  #dHeaders = {&quot;Authtoken&quot;:&quot;token&quot;,&quot;contentType&quot;:&quot;application/json&quot;}</span>

<span class="sd">            return:</span>
<span class="sd">                obj    -   returns Session object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">kwargs</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span><span class="p">})</span>
            <span class="n">s</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Header content </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">headers</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">s</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_creds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get openstack property</span>

<span class="sd">            Args:</span>
<span class="sd">                None</span>

<span class="sd">            return:</span>
<span class="sd">                returns the openstack credential in json format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectName</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>  <span class="p">{</span><span class="s2">&quot;auth&quot;</span><span class="p">:{</span><span class="s2">&quot;tenantName&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">projectName</span><span class="p">,</span>
                            <span class="s2">&quot;passwordCredentials&quot;</span><span class="p">:{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">userName</span><span class="p">,</span><span class="s2">&quot;password&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">passwd</span><span class="p">}}}</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;auth&quot;</span><span class="p">:</span> <span class="p">{</span>
                             <span class="s2">&quot;passwordCredentials&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">userName</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">passwd</span><span class="p">}}}</span>



<div class="viewcode-block" id="OpenStackSDKWrapper.login"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackSDKWrapper.login">[docs]</a>    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;perform openstack login</span>

<span class="sd">            Args:</span>
<span class="sd">                None</span>

<span class="sd">            return:</span>
<span class="sd">                returns the GET response of ostack login end point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_dcreds</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_creds</span><span class="p">)</span>
            <span class="n">_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serverName</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">API_KEYSTONE_TOKENS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_SUFFIX_V20</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_PREFIX</span><span class="p">)</span>

            <span class="n">_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span>
            <span class="n">_response</span> <span class="o">=</span> <span class="n">_session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">_url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_dcreds</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">_response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span><span class="n">_response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in openstack server login method &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>

<div class="viewcode-block" id="OpenStackSDKWrapper.get_ostack_tokens"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackSDKWrapper.get_ostack_tokens">[docs]</a>    <span class="k">def</span> <span class="nf">get_ostack_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get openstack token</span>

<span class="sd">            Args:</span>
<span class="sd">                None</span>
<span class="sd">                None</span>

<span class="sd">            return:</span>
<span class="sd">                returns the tokens from openstack server login request</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">(</span><span class="n">status</span><span class="p">,</span><span class="n">data</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_STATUS_CODES</span><span class="p">:</span>
                <span class="n">_parsed_response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tokenObj</span>    <span class="o">=</span> <span class="n">_parsed_response</span><span class="p">[</span><span class="s2">&quot;access&quot;</span><span class="p">][</span><span class="s2">&quot;token&quot;</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">_parsed_response</span><span class="p">[</span><span class="s2">&quot;access&quot;</span><span class="p">][</span><span class="s2">&quot;token&quot;</span><span class="p">]</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Login failure..&quot;</span><span class="p">)</span>
                <span class="c1">#self.log(&quot;Login request did not succeed got the status code {0}&quot;.format(status))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in get_openstack_tokens method &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>


    
<div class="viewcode-block" id="OpenStackSDKWrapper.process_post_request"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackSDKWrapper.process_post_request">[docs]</a>    <span class="k">def</span> <span class="nf">process_post_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">endpoint</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get process post request</span>

<span class="sd">            Args:</span>
<span class="sd">                endpoint    --  Endpoint to be used</span>
<span class="sd">                version     --  keystone server version</span>
<span class="sd">                port        --  If non default port being used to access openstack server</span>
<span class="sd">                headers     --  request headers</span>
<span class="sd">                data        --  request payload in json</span>

<span class="sd">            return:</span>
<span class="sd">                returns the post request response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serverName</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_PREFIX</span><span class="p">)</span>
            <span class="n">_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="o">**</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_response</span> <span class="o">=</span> <span class="n">_session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_response</span> <span class="o">=</span> <span class="n">_session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">_url</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">_response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">_response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in the process_post_request method &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>


<div class="viewcode-block" id="OpenStackSDKWrapper.process_get_request"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackSDKWrapper.process_get_request">[docs]</a>    <span class="k">def</span> <span class="nf">process_get_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">endpoint</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get process get request</span>

<span class="sd">            Args:</span>
<span class="sd">                endpoint    --  Endpoint to be used</span>
<span class="sd">                version     --  keystone server version</span>
<span class="sd">                port        --  If non default port being used to access openstack server</span>
<span class="sd">                headers     --  request headers</span>
<span class="sd">                data        --  request payload in json</span>

<span class="sd">            return:</span>
<span class="sd">                returns the get request response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serverName</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_PREFIX</span><span class="p">)</span>
            <span class="n">_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="o">**</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_response</span> <span class="o">=</span> <span class="n">_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_response</span> <span class="o">=</span> <span class="n">_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_url</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">_response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">_response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in process get request method&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div></div>



<div class="viewcode-block" id="OpenStackVMops"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops">[docs]</a><span class="k">class</span> <span class="nc">OpenStackVMops</span><span class="p">(</span><span class="n">OpenStackSDKWrapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Initialization of OpenStackVMops</span>

<span class="sd">prepare_url()            - prepares the url with port and appropariate prefix</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        servername              (str) -- OpenstackServer Name</span>
<span class="sd">        username                (str) -- OpenStack server user name</span>
<span class="sd">        password                  (str) -- OpenStack sever user password</span>
<span class="sd">        projectname             (str) -- Openstack project name</span>
<span class="sd">        port                    (str) -- OpenStack keystone port to connect</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OpenStackVMops</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">server</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">project_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PROJECT</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KEYSTONE_DEFAULT_PORT</span><span class="p">)</span>

<div class="viewcode-block" id="OpenStackVMops.get_instance_list"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_instance_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_instance_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets all instances in OpenStack server</span>
<span class="sd">        Args: None</span>
<span class="sd">        return: returns instance as dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
            <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span>
                <span class="nb">dict</span><span class="p">[</span><span class="n">server</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">id</span>
            <span class="k">return</span> <span class="nb">dict</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getInstance method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.delete_vm"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.delete_vm">[docs]</a>    <span class="k">def</span> <span class="nf">delete_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vmname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        delete instances in OpenStack server</span>
<span class="sd">        Args: instancename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">delete_server</span><span class="p">(</span><span class="n">vmname</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getInstance method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
            
<div class="viewcode-block" id="OpenStackVMops.set_quota_volume_diff"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.set_quota_volume_diff">[docs]</a>    <span class="k">def</span> <span class="nf">set_quota_volume_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets set instance quota limits for a project if different than current project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: set instance quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;volumes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;snapshots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in setvolumequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.delete_volume"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.delete_volume">[docs]</a>    <span class="k">def</span> <span class="nf">delete_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">volumename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        delete volume for a server</span>
<span class="sd">        Args: volumename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">delete_volume</span><span class="p">(</span><span class="n">volumename</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in deleteserver method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.get_quota_limits"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_quota_limits">[docs]</a>    <span class="k">def</span> <span class="nf">get_quota_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets compute quota limits for a project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: returns quota limits for a project as dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
            <span class="n">quota</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_compute_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">quota</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in getcomputequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.get_volume_limits"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_volume_limits">[docs]</a>    <span class="k">def</span> <span class="nf">get_volume_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets volume quota limits for a project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: returns volume limits for a project as dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">quotalimits</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_volume_limits</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">quotalimits</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in getvolumequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.set_quota_instance"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.set_quota_instance">[docs]</a>    <span class="k">def</span> <span class="nf">set_quota_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">,</span><span class="n">vm_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets set instance quota limits for a project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: set instance quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_quota_limits</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">_listof_instances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instance_list</span><span class="p">()</span>
            <span class="n">vmcount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_listof_instances</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;instances&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vmcount</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> 
            
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_compute_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span> <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in setcomputequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.set_quota_volume_snapshot"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.set_quota_volume_snapshot">[docs]</a>    <span class="k">def</span> <span class="nf">set_quota_volume_snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sets volume snapshot quota limits for a project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: set volume snapshot quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">totvolused</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_volume_limits</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">volsnap</span> <span class="o">=</span> <span class="n">totvolused</span><span class="p">[</span><span class="s1">&#39;absolute&#39;</span><span class="p">][</span><span class="s1">&#39;totalSnapshotsUsed&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;snapshots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">volsnap</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in setvolumesnapquota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.set_quota_volumesnapshot_size"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.set_quota_volumesnapshot_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_quota_volumesnapshot_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sets volumesnapshot size quota limits for a project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: set volume snapshot size quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">totvolused</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_volume_limits</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">volsnapsize</span> <span class="o">=</span> <span class="n">totvolused</span><span class="p">[</span><span class="s1">&#39;absolute&#39;</span><span class="p">][</span><span class="s1">&#39;totalGigabytesUsed&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;gigabytes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">volsnapsize</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in setvolumesnapsizequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
            
<div class="viewcode-block" id="OpenStackVMops.set_quota_volume"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.set_quota_volume">[docs]</a>    <span class="k">def</span> <span class="nf">set_quota_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets set instance quota limits for a project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: set instance quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">totvolused</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_volume_limits</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="n">totvolused</span><span class="p">[</span><span class="s1">&#39;absolute&#39;</span><span class="p">][</span><span class="s1">&#39;totalVolumesUsed&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;volumes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">vol</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in setvolumequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span> </div>
                  
<div class="viewcode-block" id="OpenStackVMops.set_boundary_quota_compute"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.set_boundary_quota_compute">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_quota_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">,</span><span class="n">vm_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets set compute boundary quota limits for a project</span>
<span class="sd">        Args: Project name, instance name</span>
<span class="sd">        return: set compute quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_quota_limits</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">flavorid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instace_flavor_id</span><span class="p">(</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="c1">#get compute usage of the project</span>
            <span class="n">computeusage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_compute_usage</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">cores</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_flavor_by_id</span><span class="p">(</span><span class="n">flavorid</span><span class="p">)</span>
            <span class="n">vcpus</span> <span class="o">=</span> <span class="n">cores</span><span class="o">.</span><span class="n">vcpus</span>
            <span class="n">ramused</span> <span class="o">=</span> <span class="n">computeusage</span> <span class="p">[</span><span class="s1">&#39;total_memory_mb_usage&#39;</span><span class="p">]</span>
            <span class="n">ramsize</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_flavor_by_id</span><span class="p">(</span><span class="n">flavorid</span><span class="p">)</span>
            <span class="n">ram</span> <span class="o">=</span> <span class="n">ramsize</span><span class="o">.</span><span class="n">ram</span>
            <span class="n">ram</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ram</span><span class="p">)</span>
            <span class="n">_listof_instances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instance_list</span><span class="p">()</span>
            <span class="n">vmcount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_listof_instances</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;ram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">ramused</span> <span class="o">+</span><span class="n">ram</span><span class="p">))</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vcpus</span><span class="o">+</span><span class="mi">200</span><span class="p">)</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;instances&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vmcount</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_compute_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span> <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in setcomputequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.set_boundary_quota_volume"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.set_boundary_quota_volume">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_quota_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets set compute boundary volume limits for a project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: set compute volume limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">totvolused</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_volume_limits</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">volused</span> <span class="o">=</span> <span class="n">totvolused</span><span class="p">[</span><span class="s1">&#39;absolute&#39;</span><span class="p">][</span><span class="s1">&#39;totalVolumesUsed&#39;</span><span class="p">]</span>
            <span class="n">volsnap</span> <span class="o">=</span> <span class="n">totvolused</span><span class="p">[</span><span class="s1">&#39;absolute&#39;</span><span class="p">][</span><span class="s1">&#39;totalSnapshotsUsed&#39;</span><span class="p">]</span>
            <span class="n">volsnapsize</span> <span class="o">=</span> <span class="n">totvolused</span><span class="p">[</span><span class="s1">&#39;absolute&#39;</span><span class="p">][</span><span class="s1">&#39;totalGigabytesUsed&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;volumes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">volused</span> <span class="o">+</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;snapshots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">volsnap</span><span class="o">+</span><span class="mi">10</span><span class="p">))</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;gigabytes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">volsnapsize</span><span class="o">+</span><span class="mi">5000</span><span class="p">))</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in setcomputequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.set_quota_ram"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.set_quota_ram">[docs]</a>    <span class="k">def</span> <span class="nf">set_quota_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">,</span><span class="n">vm_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets set ram quota limits for a project</span>
<span class="sd">        Args: Project name ,instance name</span>
<span class="sd">        return: set ram quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_quota_limits</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">flavorid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instace_flavor_id</span><span class="p">(</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="n">ramsize</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_flavor_by_id</span><span class="p">(</span><span class="n">flavorid</span><span class="p">)</span>
            <span class="n">ram</span> <span class="o">=</span> <span class="n">ramsize</span><span class="o">.</span><span class="n">ram</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;ram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ram</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> 
            
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_compute_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span> <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in setcomputequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
            
<div class="viewcode-block" id="OpenStackVMops.set_quota_vcpus"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.set_quota_vcpus">[docs]</a>    <span class="k">def</span> <span class="nf">set_quota_vcpus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">,</span><span class="n">vm_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets set ram quota limits for a project</span>
<span class="sd">        Args: Project name ,instance name</span>
<span class="sd">        return: set ram quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_quota_limits</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="n">flavorid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instace_flavor_id</span><span class="p">(</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="n">cores</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_flavor_by_id</span><span class="p">(</span><span class="n">flavorid</span><span class="p">)</span>
            <span class="n">vcpus</span> <span class="o">=</span> <span class="n">cores</span><span class="o">.</span><span class="n">vcpus</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vcpus</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> 
            
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_compute_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span> <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in setcomputequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
    
    
<div class="viewcode-block" id="OpenStackVMops.reset_quota_limits"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.reset_quota_limits">[docs]</a>    <span class="k">def</span> <span class="nf">reset_quota_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete quota limits for a project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: delete quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">delete_compute_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>   
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in deletecomputequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.reset_volume_limits"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.reset_volume_limits">[docs]</a>    <span class="k">def</span> <span class="nf">reset_volume_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete quota limits for a project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: delete quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;volumes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span><span class="p">)</span>   
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in resetvolumequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.reset_volumesnapshot_limits"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.reset_volumesnapshot_limits">[docs]</a>    <span class="k">def</span> <span class="nf">reset_volumesnapshot_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete quota limits for a project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: delete quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;snapshots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span><span class="p">)</span>   
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in resetvolumesnapquota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.reset_volumesnapsize_limits"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.reset_volumesnapsize_limits">[docs]</a>    <span class="k">def</span> <span class="nf">reset_volumesnapsize_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete quota limits for a project</span>
<span class="sd">        Args: Project name</span>
<span class="sd">        return: delete quota limits for a project </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">quota</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;gigabytes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">del</span> <span class="n">quota</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">set_volume_quotas</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="o">**</span><span class="n">quota</span><span class="p">)</span>   
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception occured in resetvolumesnapsizequota method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.get_zones"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_zones">[docs]</a>    <span class="k">def</span> <span class="nf">get_zones</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets all the VMs in the corresponding zones</span>
<span class="sd">        Args:None</span>
<span class="sd">        return: returns list of VMs in the corresponding zone</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
            <span class="n">dict2</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span>
                <span class="n">dict2</span><span class="p">[</span><span class="n">server</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">availability_zone</span>
            <span class="k">return</span> <span class="n">dict2</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occurred in get_zones method: &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>

<div class="viewcode-block" id="OpenStackVMops.get_uuid"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_uuid">[docs]</a>    <span class="k">def</span> <span class="nf">get_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets UUID of an instance in OpenStack server</span>
<span class="sd">        Args: InstanceName</span>
<span class="sd">        return:UUID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_listof_instances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instance_list</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">_listof_instances</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">instance_id</span> <span class="o">=</span> <span class="n">_listof_instances</span><span class="p">[</span><span class="n">instanceName</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">instance_id</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getUUID method&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>

<div class="viewcode-block" id="OpenStackVMops.get_instance_details"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_instance_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_instance_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_uuid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets instance details in OpenStack server</span>
<span class="sd">        Args : UUID of the instance</span>
<span class="sd">        return:instance details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
            <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_uuid</span> <span class="o">==</span> <span class="n">server</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                    <span class="n">output</span><span class="p">[</span><span class="s2">&quot;servers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">servers</span>
                    <span class="k">return</span> <span class="n">output</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getUUID method:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
            
<div class="viewcode-block" id="OpenStackVMops.get_listsnapshot"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_listsnapshot">[docs]</a>    <span class="k">def</span> <span class="nf">get_listsnapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">search_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the list of snapshots</span>
<span class="sd">        Args: None</span>
<span class="sd">        return:Snapshots</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">snap_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">list_volume_snapshots</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">snap_list</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in setting list of snapshots&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>

    <span class="c1">###Gets the drivelist</span>
<div class="viewcode-block" id="OpenStackVMops.get_drive_details"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_drive_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_drive_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vmObj</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">vmObj</span><span class="o">.</span><span class="n">GuestOS</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="n">machine_name</span><span class="o">=</span><span class="n">vmObj</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span><span class="n">username</span><span class="o">=</span><span class="n">vmObj</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="n">vmObj</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s1">&#39;Get-PSDrive -PSProvider FileSystem | ?{$_.Used}&#39;</span><span class="p">)</span>
                <span class="n">_drivelist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">_item</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">_drivelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_item</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">_drivelist</span>



        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in get_driver_details() </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">_drivelist</span></div>
   
    
   
<div class="viewcode-block" id="OpenStackVMops.poweron_instance"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.poweron_instance">[docs]</a>    <span class="k">def</span> <span class="nf">poweron_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_uuid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PowerOn the instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">dHeaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X-Auth-Token&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">_uuid</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_endpoint</span>   <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">API_NOVA_SERVER_ACTION</span>
                <span class="n">_endpoint</span>   <span class="o">=</span>   <span class="n">_endpoint</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{tenantid}</span><span class="s2">&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenObj</span><span class="p">[</span><span class="s2">&quot;tenant&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">])</span> <span class="c1">#update tenantId to url</span>
                <span class="n">_endpoint</span>   <span class="o">=</span>   <span class="n">_endpoint</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{serverid}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">_uuid</span><span class="p">)</span> <span class="c1">#updating instance uuid to the url</span>
                <span class="n">_endpoint</span>   <span class="o">=</span> <span class="n">_endpoint</span> <span class="o">+</span> <span class="s1">&#39;?uuid=&#39;</span> <span class="o">+</span> <span class="n">_uuid</span> <span class="c1">#append instance UUID to the url</span>
                <span class="n">_body</span>       <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;os-start&quot;</span><span class="p">:</span><span class="s2">&quot;null&quot;</span><span class="p">}</span>
                <span class="p">(</span><span class="n">_status</span><span class="p">,</span><span class="n">_data</span><span class="p">)</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_post_request</span><span class="p">(</span><span class="n">_endpoint</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_SUFFIX_V2</span><span class="p">,</span>
                                                          <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NOVA_DEFAULT_PORT</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">dHeaders</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">_body</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">_status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_STATUS_CODES</span><span class="p">:</span>
                    <span class="c1">#self.log.info(&quot;Started the instance {0} successfully&quot;.format(_uuid))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started&quot;</span><span class="p">)</span>
                    <span class="n">flag</span> <span class="o">=</span>  <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#self.log(&quot;ERROR: Failed to start the instance &quot;.format(_status))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed with error </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_status</span><span class="p">))</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#self.log(&quot;ERROR: Couldn&#39;t find the server\instance &quot;,_uuid)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Server not found&quot;</span><span class="p">)</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">flag</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in powerOninstance method&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpenStackVMops.poweroff_instance"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.poweroff_instance">[docs]</a>    <span class="k">def</span> <span class="nf">poweroff_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_uuid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Poweroff the instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">dHeaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X-Auth-Token&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">_uuid</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_endpoint</span>   <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">API_NOVA_SERVER_ACTION</span>
                <span class="n">_endpoint</span>   <span class="o">=</span>   <span class="n">_endpoint</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{tenantid}</span><span class="s2">&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenObj</span><span class="p">[</span><span class="s2">&quot;tenant&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">])</span> <span class="c1">#update tenantId to url</span>
                <span class="n">_endpoint</span>   <span class="o">=</span>   <span class="n">_endpoint</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{serverid}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">_uuid</span><span class="p">)</span> <span class="c1">#updating instance uuid to the url</span>
                <span class="n">_endpoint</span>   <span class="o">=</span> <span class="n">_endpoint</span> <span class="o">+</span> <span class="s1">&#39;?uuid=&#39;</span> <span class="o">+</span> <span class="n">_uuid</span> <span class="c1">#append instance UUID to the url</span>
                <span class="n">_body</span>       <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;os-start&quot;</span><span class="p">:</span><span class="s2">&quot;null&quot;</span><span class="p">}</span>
                <span class="p">(</span><span class="n">_status</span><span class="p">,</span><span class="n">_data</span><span class="p">)</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_post_request</span><span class="p">(</span><span class="n">_endpoint</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_SUFFIX_V2</span><span class="p">,</span>
                                                          <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NOVA_DEFAULT_PORT</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">dHeaders</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">_body</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_STATUS_CODES</span><span class="p">:</span>
                    <span class="c1">#self.log(&quot;Started the instance {0} successfully&quot;.format(_uuid))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopped&quot;</span><span class="p">)</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#self.log(&quot;ERROR: Failed to stop the instance &quot;, _status)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#self.log(&quot;ERROR: Couldn&#39;t find the server\instance &quot;, _uuid)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No Server&quot;</span><span class="p">)</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">flag</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in poweroffInstance &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">flag</span></div>

    
<div class="viewcode-block" id="OpenStackVMops.get_volume_attachments"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_volume_attachments">[docs]</a>    <span class="k">def</span> <span class="nf">get_volume_attachments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_uuid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the list of volumes attached to the server or instance</span>
<span class="sd">        param _uuid: uuid of the openstack instance</span>
<span class="sd">        return: list of dictionary of volume attachments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cinder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cinder_connection</span><span class="p">()</span>
            <span class="n">volumelist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cinder</span><span class="o">.</span><span class="n">volumes</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">attachments</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">attachments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;server_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">_uuid</span><span class="p">:</span>
                    <span class="n">volumelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>                  
            <span class="k">return</span> <span class="n">volumelist</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getVolumeattachments() &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.get_instace_flavor_id"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_instace_flavor_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_instace_flavor_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vm_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the flavor id of the instance</span>

<span class="sd">        param : name of the instance.</span>
<span class="sd">        return: flavor id of vm</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">vm_name</span> <span class="o">==</span> <span class="n">server</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="o">.</span><span class="n">flavor</span><span class="p">:</span>
                        <span class="n">vmflavorid</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">flavor</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                        <span class="k">return</span> <span class="n">vmflavorid</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in vmflavorid() &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
            
<div class="viewcode-block" id="OpenStackVMops.get_vmflavor"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_vmflavor">[docs]</a>    <span class="k">def</span> <span class="nf">get_vmflavor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vm_name</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the flavor  of the instance</span>

<span class="sd">        param : name of the instance.</span>
<span class="sd">        return: flavor of vm</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">flavorid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instace_flavor_id</span><span class="p">(</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flavorid</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">flavorid</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">vmflavorname</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_flavor_by_id</span><span class="p">(</span><span class="n">flavorid</span><span class="p">)</span>
                <span class="n">vmflavor</span> <span class="o">=</span> <span class="n">vmflavorname</span><span class="o">.</span><span class="n">name</span>
                <span class="k">return</span> <span class="n">vmflavor</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">server</span><span class="o">.</span><span class="n">metadata</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="n">vmflavor</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">flavor</span><span class="p">[</span><span class="s1">&#39;original_name&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">vm_name</span> <span class="o">==</span> <span class="n">server</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">vmflavor</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getvmflavor() &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>





<div class="viewcode-block" id="OpenStackVMops.deleteInstance"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.deleteInstance">[docs]</a>    <span class="k">def</span> <span class="nf">deleteInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="OpenStackVMops.get_volume_types"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_volume_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_volume_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the list of all volume types in openstack server</span>

<span class="sd">        param None:</span>
<span class="sd">        return: list of dicitonary of volume types</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dHeaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X-Auth-Token&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">}</span>

            <span class="n">_endpoint</span>   <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">API_CINDER_VOLUMETYPE</span>
            <span class="n">_endpoint</span>   <span class="o">=</span>   <span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenObj</span><span class="p">[</span><span class="s2">&quot;tenant&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">+</span> <span class="n">_endpoint</span> <span class="c1">#Format {tenantId}/Types</span>

            <span class="p">(</span><span class="n">_status</span><span class="p">,</span><span class="n">_data</span><span class="p">)</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_get_request</span><span class="p">(</span><span class="n">_endpoint</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_SUFFIX_V2</span><span class="p">,</span>
                                                             <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CINDER_DEFAULT_PORT</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">dHeaders</span><span class="p">)</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_STATUS_CODES</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_data</span><span class="p">[</span><span class="s2">&quot;volume_types&quot;</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ERROR: Failed to get the volume types &quot;</span><span class="p">,</span> <span class="n">_status</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getVolumeTypes() &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>


<div class="viewcode-block" id="OpenStackVMops.get_volume_detail"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_volume_detail">[docs]</a>    <span class="k">def</span> <span class="nf">get_volume_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the list of all volume types in openstack server</span>

<span class="sd">        param None:</span>
<span class="sd">        return: list of dicitonary of volume types</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cinder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cinder_connection</span><span class="p">()</span>
            <span class="n">volumelist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cinder</span><span class="o">.</span><span class="n">volumes</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
                <span class="n">volumelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>              

            <span class="k">return</span> <span class="n">volumelist</span>
            <span class="n">dHeaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X-Auth-Token&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">}</span>

            <span class="n">_endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">API_CINDER_VOLUME_LIST</span>
            <span class="n">_endpoint</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenObj</span><span class="p">[</span><span class="s2">&quot;tenant&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">+</span> <span class="n">_endpoint</span> <span class="c1">#Format {tenantId}/Types</span>

            <span class="p">(</span><span class="n">_status</span><span class="p">,</span><span class="n">_data</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_get_request</span><span class="p">(</span><span class="n">_endpoint</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_SUFFIX_V2</span><span class="p">,</span>
                                                             <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CINDER_DEFAULT_PORT</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">dHeaders</span><span class="p">)</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_STATUS_CODES</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_data</span><span class="p">[</span><span class="s2">&quot;volumes&quot;</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: Failed to get the getVolumedetail &quot;</span><span class="p">,</span> <span class="n">_status</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getVolumedetail() &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>


<div class="viewcode-block" id="OpenStackVMops.get_volume_typefromAZ"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_volume_typefromAZ">[docs]</a>    <span class="k">def</span> <span class="nf">get_volume_typefromAZ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">AZ</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the volume from Availabilityzone</span>

<span class="sd">        param None: AZ (availablity zone instring)</span>
<span class="sd">        return: list of volumeTypes matching AZ</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_vollist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_volume_detail</span><span class="p">()</span>
            <span class="n">_volType</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_vollist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_vol</span> <span class="ow">in</span> <span class="n">_vollist</span><span class="p">:</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">_vol</span><span class="p">[</span><span class="s2">&quot;availability_zone&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">AZ</span><span class="p">):</span>
                        <span class="n">_volType</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">_vol</span><span class="p">[</span><span class="s2">&quot;volume_type&quot;</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;ERROR: Failed to get the volume type &quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">_volType</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getVolumeTypefromAZ() &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.get_ram"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_ram">[docs]</a>    <span class="k">def</span> <span class="nf">get_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vm_name</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the Ram size of the instance</span>

<span class="sd">        param : name of the instance.</span>
<span class="sd">        return: ram size</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">flavorid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instace_flavor_id</span><span class="p">(</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flavorid</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">flavorid</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">ramsize</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_flavor_by_id</span><span class="p">(</span><span class="n">flavorid</span><span class="p">)</span>
                <span class="n">ram</span> <span class="o">=</span> <span class="n">ramsize</span><span class="o">.</span><span class="n">ram</span>
                <span class="k">return</span> <span class="n">ram</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">server</span><span class="o">.</span><span class="n">metadata</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="n">ram</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">flavor</span><span class="p">[</span><span class="s1">&#39;ram&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">vm_name</span> <span class="o">==</span> <span class="n">server</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">ram</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getram() &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>


<div class="viewcode-block" id="OpenStackVMops.get_volume_typefrom_volid"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_volume_typefrom_volid">[docs]</a>    <span class="k">def</span> <span class="nf">get_volume_typefrom_volid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">VolId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the volume type info from volume ID(GUID)</span>

<span class="sd">        param : Volume ID of each attached volume to openstack instance(server).</span>
<span class="sd">        return: volType in str format</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_vollist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_volume_detail</span><span class="p">()</span>
            <span class="n">_volType</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_vollist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_vol</span> <span class="ow">in</span> <span class="n">_vollist</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">_vol_attachment_detail</span> <span class="ow">in</span> <span class="n">_vol</span><span class="p">[</span><span class="s2">&quot;attachments&quot;</span><span class="p">]:</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">_vol_attachment_detail</span><span class="p">[</span><span class="s2">&quot;volume_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">VolId</span><span class="p">):</span>
                            <span class="n">_volType</span> <span class="o">=</span>  <span class="n">_vol</span><span class="p">[</span><span class="s2">&quot;volume_type&quot;</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;ERROR: Failed to get the volume type &quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">_volType</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in get_volume_typefrom_volid() &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>


<div class="viewcode-block" id="OpenStackVMops.get_os_type"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_os_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_os_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vm_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the OS type of the instance</span>

<span class="sd">        param : name of the instance.</span>
<span class="sd">        return: string OS type</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            
            <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">server</span><span class="o">.</span><span class="n">metadata</span> <span class="o">!=</span> <span class="p">{}:</span>
                    <span class="k">if</span> <span class="n">vm_name</span> <span class="o">==</span> <span class="n">server</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                        <span class="n">osType</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;os_type&#39;</span><span class="p">]</span>
                        <span class="k">return</span> <span class="n">osType</span>
                
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getOSType() &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="OpenStackVMops.get_vcpus"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_vcpus">[docs]</a>    <span class="k">def</span> <span class="nf">get_vcpus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vm_name</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the vcpus type of the instance</span>

<span class="sd">        param : name of the instance.</span>
<span class="sd">        return: string no of vcpus</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">flavorid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instace_flavor_id</span><span class="p">(</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flavorid</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">flavorid</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">getvcpus</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">get_flavor_by_id</span><span class="p">(</span><span class="n">flavorid</span><span class="p">)</span>
                <span class="n">vcpus</span> <span class="o">=</span> <span class="n">getvcpus</span><span class="o">.</span><span class="n">vcpus</span>
                <span class="k">return</span> <span class="n">vcpus</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">server</span><span class="o">.</span><span class="n">metadata</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="n">vcpus</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">flavor</span><span class="p">[</span><span class="s1">&#39;vcpus&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">vm_name</span> <span class="o">==</span> <span class="n">server</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">vcpus</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occured in getvcpus() &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>


<div class="viewcode-block" id="OpenStackVMops.get_region"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_region">[docs]</a>    <span class="k">def</span> <span class="nf">get_region</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the OS type of the instance</span>

<span class="sd">        param : get region</span>
<span class="sd">        return: region_id</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">endpoints</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">identity</span><span class="o">.</span><span class="n">endpoints</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">endpoints</span><span class="p">[</span><span class="s1">&#39;region_id&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;unable to retrive region id () &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span></div>

<div class="viewcode-block" id="OpenStackVMops.get_cpu"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_cpu">[docs]</a>    <span class="k">def</span> <span class="nf">get_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_uuid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param _uuid: UUID of the instance</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dHeaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X-Auth-Token&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">_uuid</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                 <span class="c1">#Prepare URL</span>
                <span class="n">_endpoint</span>       <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">API_NOVA_SERVER_LIST</span>
                <span class="n">_endpoint</span>       <span class="o">=</span> <span class="n">_endpoint</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{tenantid}</span><span class="s2">&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenObj</span><span class="p">[</span><span class="s2">&quot;tenant&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
                <span class="n">_endpoint</span>       <span class="o">=</span>   <span class="n">_endpoint</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">_uuid</span> <span class="c1">#append instance UUID to the url</span>
                <span class="p">(</span><span class="n">_status</span><span class="p">,</span><span class="n">_data</span><span class="p">)</span> <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">process_get_request</span><span class="p">(</span><span class="n">_endpoint</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_SUFFIX_V2</span><span class="p">,</span>
                                                             <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NOVA_DEFAULT_PORT</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">dHeaders</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">_status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_STATUS_CODES</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Details of the get cpu </span><span class="si">{0}</span><span class="s2"> fetched successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_uuid</span><span class="p">))</span>
                    <span class="n">parsed_response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">parsed_response</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ERROR: Failed to list floating ips &quot;</span><span class="p">,</span> <span class="n">_status</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception occcured in floating_ips() </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>
    
    
    
<div class="viewcode-block" id="OpenStackVMops.add_floating_ip"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.add_floating_ip">[docs]</a>    <span class="k">def</span> <span class="nf">add_floating_ip</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">server_name</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assigns floating IP for Instance</span>
<span class="sd">            Args: Server_name</span>
<span class="sd">            Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
        <span class="n">server_details</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">server</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">server_name</span><span class="p">:</span>
                <span class="n">server_details</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">name</span>
                <span class="n">server_details</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">id</span>
                <span class="n">server_details</span><span class="p">[</span><span class="s1">&#39;addresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">addresses</span>
                <span class="n">server_details</span><span class="p">[</span><span class="s1">&#39;interface_ip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">add_auto_ip</span><span class="p">(</span><span class="n">server_details</span><span class="p">,</span><span class="n">wait</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">reuse</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenStackVMops.detach_and_delete_volume"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.detach_and_delete_volume">[docs]</a>    <span class="k">def</span> <span class="nf">detach_and_delete_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">destvm_guid</span><span class="p">,</span> <span class="n">server_details</span><span class="p">,</span> <span class="n">volume_details</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Detaches the attached volume to existing Instance</span>
<span class="sd">                    Args: Volume details</span>
<span class="sd">                    Returns: None</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
        <span class="n">server_details</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">destvm_guid</span>
        <span class="k">for</span> <span class="n">eachvol</span> <span class="ow">in</span> <span class="n">volume_details</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">detach_volume</span><span class="p">(</span><span class="n">server_details</span><span class="p">,</span> <span class="n">eachvol</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">delete_volume</span><span class="p">(</span><span class="n">eachvol</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span></div>
        
<span class="c1">#         for server in servers:</span>
<span class="c1">#             server_details[&#39;id&#39;] = server.id</span>
<span class="c1">#         self.openstack_conn.detach_volume(server_details, volume_details[0])</span>
<span class="c1">#         self.openstack_conn.delete_volume(volume_details[0][&#39;id&#39;])</span>
<div class="viewcode-block" id="OpenStackVMops.get_all_ips"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_all_ips">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_ips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_id</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="n">servers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openstack_conn</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">servers</span><span class="p">()</span>
        <span class="n">all_ips</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">server</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">server_id</span><span class="p">:</span>
                <span class="n">all_ips</span><span class="p">[</span><span class="s1">&#39;addresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">addresses</span>
                <span class="n">all_ips</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">id</span>
                <span class="n">all_ips</span><span class="p">[</span><span class="s1">&#39;private_network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;private_network&#39;</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">all_ips</span><span class="p">[</span><span class="s1">&#39;addresses&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="OpenStackVMops.get_floating_ips"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_floating_ips">[docs]</a>    <span class="k">def</span> <span class="nf">get_floating_ips</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
             <span class="c1">#Prepare URL</span>
            <span class="n">dHeaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X-Auth-Token&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">}</span>
            <span class="n">_endpoint</span>       <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">API_LIST_FLOATING_IPS</span>
            <span class="p">(</span><span class="n">_status</span><span class="p">,</span><span class="n">_data</span><span class="p">)</span> <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">process_get_request</span><span class="p">(</span><span class="n">_endpoint</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_SUFFIX_V20</span><span class="p">,</span>
                                                             <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">API_DEFAULT_NETWORK_PORT</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">dHeaders</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_STATUS_CODES</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Details of the floaingips&quot;</span><span class="p">)</span>
                <span class="n">parsed_response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">parsed_response</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ERROR: Failed to floatin ips list &quot;</span><span class="p">,</span> <span class="n">_status</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in get_float_ips() </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="OpenStackVMops.associate_floating_ips"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.associate_floating_ips">[docs]</a>    <span class="k">def</span> <span class="nf">associate_floating_ips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">floating_ip</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_ip</span> <span class="o">=</span> <span class="n">floating_ip</span><span class="p">[</span><span class="s2">&quot;floating_ip_address&quot;</span><span class="p">]</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;addFloatingIp&quot;</span> <span class="p">:</span> <span class="p">{</span>
                             <span class="s2">&quot;address&quot;</span><span class="p">:</span><span class="n">_ip</span>
                            <span class="p">}</span>
            <span class="p">}</span>
             <span class="c1"># API_NOVA_SERVER_ACTION  = &quot;/{tenantid}/servers/{serverid}/action&quot;</span>
            <span class="n">dHeaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X-Auth-Token&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">}</span>
            <span class="n">_endpoint</span>       <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">API_NOVA_SERVER_ACTION</span>
            <span class="n">_endpoint</span>       <span class="o">=</span> <span class="n">_endpoint</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{tenantid}</span><span class="s2">&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenObj</span><span class="p">[</span><span class="s2">&quot;tenant&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
            <span class="n">_endpoint</span>       <span class="o">=</span>   <span class="n">_endpoint</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{serverid}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">uuid</span><span class="p">)</span>
            <span class="p">(</span><span class="n">_status</span><span class="p">,</span><span class="n">_data</span><span class="p">)</span> <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">process_post_request</span><span class="p">(</span><span class="n">_endpoint</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AUTH_URL_SUFFIX_V21</span><span class="p">,</span>
                                                             <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NOVA_DEFAULT_PORT</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">dHeaders</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span> <span class="n">body</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_STATUS_CODES</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Details of the floaingips&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">_ip</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ERROR: Failed to floatin ips list &quot;</span><span class="p">,</span> <span class="n">_status</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in associate_floating_ips() </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">None</span></div>
    
    
<div class="viewcode-block" id="OpenStackVMops.get_tenant"><a class="viewcode-back" href="../../../source/VirtualServer.VSAUtils.html#VirtualServer.VSAUtils.OpenStackWrapper.OpenStackVMops.get_tenant">[docs]</a>    <span class="k">def</span> <span class="nf">get_tenant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenObj</span><span class="p">[</span><span class="s2">&quot;tenant&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in get_tenant </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>