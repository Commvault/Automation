

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>VirtualServer.VSAUtils.VMHelpers.OpenStackVM &mdash; Commvault Automation 11.23 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>VirtualServer.VSAUtils.VMHelpers.OpenStackVM</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for VirtualServer.VSAUtils.VMHelpers.OpenStackVM</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;Does all the Operation for Openstack vm&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.pyping</span> <span class="kn">import</span> <span class="n">ping</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">machine</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">VirtualServer.VSAUtils</span> <span class="kn">import</span> <span class="n">OpenStackWrapper</span>
<span class="kn">from</span> <span class="nn">VirtualServer.VSAUtils.VMHelper</span> <span class="kn">import</span> <span class="n">HypervisorVM</span>


<div class="viewcode-block" id="OpenStackVM"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM">[docs]</a><span class="k">class</span> <span class="nc">OpenStackVM</span><span class="p">(</span><span class="n">HypervisorVM</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class will have all OpenStack VM operations methods</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hvobj</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization of openstack vm properties</span>

<span class="sd">        Args:</span>
<span class="sd">            hvobj               (obj):  Hypervisor Object</span>

<span class="sd">            vm_name             (str):  Name of the VM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OpenStackVM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">hvobj</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_name</span> <span class="o">=</span> <span class="n">hvobj</span><span class="o">.</span><span class="n">server_host_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prop_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;server_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_name</span><span class="p">,</span>
            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_user_name</span><span class="p">,</span>
            <span class="s2">&quot;pwd&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_password</span><span class="p">,</span>
            <span class="s2">&quot;vm_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">,</span>
            <span class="s2">&quot;extra_args&quot;</span><span class="p">:</span> <span class="s2">&quot;$null&quot;</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">operation_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;server_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_name</span><span class="p">,</span>
            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_user_name</span><span class="p">,</span>
            <span class="s2">&quot;pwd&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_password</span><span class="p">,</span>
            <span class="s2">&quot;vm_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">,</span>
            <span class="s2">&quot;vm_user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span>
            <span class="s2">&quot;vm_pass&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
            <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;$null&quot;</span><span class="p">,</span>
            <span class="s2">&quot;extra_args&quot;</span><span class="p">:</span> <span class="s2">&quot;$null&quot;</span>
        <span class="p">}</span>
        <span class="c1"># self.OpenStackHandler = OpenStackWrapper.OpenStackVMops(self.server_name,self.host_user_name,</span>
        <span class="c1"># self.host_password)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GUID</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GuestOS</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HostName</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disk_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DiskPath</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># self.Memory = None</span>
        <span class="c1"># self.VMSpace = None</span>
        <span class="c1"># self.machine    = machine.Machine(vm_name,username=self.user_name,password=self.password)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host_machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">host_machine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vm_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># self.AZ         = None</span>

    <span class="c1"># @property</span>
    <span class="c1"># def getAvailabilityZone(self):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This method gets teh AZ for the instance in openstack</span>
    <span class="c1">#     :return: AZ in string</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     try:</span>
    <span class="c1">#         return self.AZ</span>
    <span class="c1">#</span>
    <span class="c1">#     except Exception as err:</span>
    <span class="c1">#         self.log.exception(&quot;Exception occured in getAvailbilityZone() &quot;.format(str(err)))</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># @getAvailabilityZone.setter</span>
    <span class="c1"># def getAvailabilityZone(self, az):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Sets AZ for the instance</span>
    <span class="c1">#     :param az: Availbility zone for the instance in string</span>
    <span class="c1">#     :return: None or exception</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     try:</span>
    <span class="c1">#         self.AZ = az</span>
    <span class="c1">#     except Exception as err:</span>
    <span class="c1">#         self.log.exception(&quot;Exception occured in setter getAvailabilityZone() &quot;.format(str(err)))</span>
<div class="viewcode-block" id="OpenStackVM.VmValidation"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.VmValidation">[docs]</a>    <span class="k">class</span> <span class="nc">VmValidation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vmobj</span><span class="p">,</span> <span class="n">vm_restore_options</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vm</span> <span class="o">=</span> <span class="n">vmobj</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_options</span> <span class="o">=</span> <span class="n">vm_restore_options</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_restore_options</span><span class="o">.</span><span class="n">restore_job</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>

        <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;compares the source vm and restored vm&quot;&quot;&quot;</span>
            <span class="n">config_val</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">_disk_list</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">_disk_list</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">disk_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">disk_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">volumelist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;volume_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">volumelist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;volume_type&#39;</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">volumelist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">volumelist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">volumelist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">volumelist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">_drives</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">_drives</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">disk_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">disk_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vcpus</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vcpus</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vmflavor</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vmflavor</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">ram</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">ram</span>

            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">verify_if_volumes_attached</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">verify_if_snap_attached</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">config_val</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="OpenStackVM.verify_if_volumes_attached"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.verify_if_volumes_attached">[docs]</a>    <span class="k">def</span> <span class="nf">verify_if_volumes_attached</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restore_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates if volumes are detached after backup</span>
<span class="sd">        Args:Jobidlist and instanceName</span>
<span class="sd">        return: VolumeList</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">projectName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">DEFAULT_PROJECT</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">restore_obj</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">host_machine</span><span class="p">)</span>
            <span class="n">volumeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_volume_attachments</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
            <span class="c1"># clean up validation</span>
            <span class="k">if</span> <span class="n">volumeList</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="k">for</span> <span class="n">volume_details</span> <span class="ow">in</span> <span class="n">volumeList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_job</span><span class="o">.</span><span class="n">job_id</span> <span class="ow">in</span> <span class="n">volume_details</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;Exception in detaching volume attachment to proxy after backup&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">volumeList</span><span class="p">))</span>
                        <span class="k">raise</span> <span class="ne">Exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Volumes detacahed for proxy validation is  successful&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in detaching volume attachment to proxy after backup&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">volumeList</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span></div>

<div class="viewcode-block" id="OpenStackVM.verify_if_snapshots_and_volume_attached"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.verify_if_snapshots_and_volume_attached">[docs]</a>    <span class="k">def</span> <span class="nf">verify_if_snapshots_and_volume_attached</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates if volumes and snapshots are detached after backup in proxy</span>
<span class="sd">        return: VolumeList</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">projectName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">DEFAULT_PROJECT</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">host_machine</span><span class="p">)</span>
            <span class="n">volumeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_volume_attachments</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
            <span class="c1"># clean up validation for volume list</span>
            <span class="k">if</span> <span class="n">volumeList</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="k">for</span> <span class="n">volume_details</span> <span class="ow">in</span> <span class="n">volumeList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_job</span><span class="o">.</span><span class="n">job_id</span> <span class="ow">in</span> <span class="n">volume_details</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;Exception in detaching volume attachment to proxy after backup&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">volumeList</span><span class="p">))</span>
                        <span class="k">raise</span> <span class="ne">Exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Volumes detached for proxy validation is successful&quot;</span><span class="p">)</span>
            <span class="c1"># clean up validation for snapshots</span>
            <span class="n">snap_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_listsnapshot</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">snap_list</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="k">for</span> <span class="n">snap_details</span> <span class="ow">in</span> <span class="n">snap_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_job</span><span class="o">.</span><span class="n">job_id</span> <span class="ow">in</span> <span class="n">snap_details</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception in detaching snap to proxy after backup&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">snap_list</span><span class="p">))</span>
                        <span class="k">raise</span> <span class="ne">Exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snaps deleted for proxy validation is  successful&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in detaching volume attachments and snapshots to proxy after backup/restore&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span></div>

<div class="viewcode-block" id="OpenStackVM.verify_if_snap_attached"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.verify_if_snap_attached">[docs]</a>    <span class="k">def</span> <span class="nf">verify_if_snap_attached</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates if snaps are detached after backup</span>
<span class="sd">        return: Snaplist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">snap_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_listsnapshot</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">snap_list</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="k">for</span> <span class="n">snap_details</span> <span class="ow">in</span> <span class="n">snap_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_job</span><span class="o">.</span><span class="n">job_id</span> <span class="ow">in</span> <span class="n">snap_details</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception in detaching snap to proxy after backup&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">snap_list</span><span class="p">))</span>
                        <span class="k">raise</span> <span class="ne">Exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;snaps deleted for proxy validation is  successful&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in detaching snaps attachment to proxy after backup&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">snap_list</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span></div>

<div class="viewcode-block" id="OpenStackVM.attach_volume_validation"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.attach_volume_validation">[docs]</a>    <span class="k">def</span> <span class="nf">attach_volume_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attach_volume_restore_options</span><span class="p">,</span> <span class="n">source_volume_details</span><span class="p">,</span>
                                 <span class="n">destination_volume_details</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                perform Attach Volume to existing instance restore validation for specific Openstack subclient</span>

<span class="sd">                Args:</span>
<span class="sd">                        attach_volume_restore_options    (object):   represent options that are currently set</span>
<span class="sd">                                                            when performing the attach volume restore</span>

<span class="sd">                        msg                     (string):  Log line to be printed</span>

<span class="sd">                Exception:</span>
<span class="sd">                                if job fails</span>
<span class="sd">                                if validation fails</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">project_name_restore</span> <span class="o">=</span> <span class="n">attach_volume_restore_options</span><span class="o">.</span><span class="n">datacenter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Project name is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">project_name_restore</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">each_vol_source</span> <span class="ow">in</span> <span class="n">source_volume_details</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">each_vol_destination</span> <span class="ow">in</span> <span class="n">destination_volume_details</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">each_vol_source</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">each_vol_destination</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The name of the volume in the destination is : </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">each_vol_destination</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                        <span class="n">indexValue</span> <span class="o">=</span> <span class="n">destination_volume_details</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">each_vol_destination</span><span class="p">)</span>

                <span class="n">destination_vol_status</span> <span class="o">=</span> <span class="n">destination_volume_details</span><span class="p">[</span><span class="n">indexValue</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The status of the attached volume is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">destination_vol_status</span><span class="p">)</span>
                <span class="n">destination_vol_size</span> <span class="o">=</span> <span class="n">destination_volume_details</span><span class="p">[</span><span class="n">indexValue</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The size of the attached volume in destination VM is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">destination_vol_size</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">each_vol_source</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">destination_vol_size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Source volume size matches destination volume size&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: Source volume size mismatch with destination volume size&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking volume details and accessibility to the VM where volume is restored...&quot;</span><span class="p">)</span>
                <span class="n">ips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_all_ips</span><span class="p">(</span><span class="n">attach_volume_restore_options</span><span class="o">.</span><span class="n">dest_vm_guid</span><span class="p">)</span>
                <span class="n">ip</span> <span class="o">=</span> <span class="n">ips</span><span class="p">[</span><span class="s1">&#39;private_network&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;addr&#39;</span><span class="p">]</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;ping </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">each_vol_source</span><span class="p">[</span><span class="s1">&#39;volume_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">destination_volume_details</span><span class="p">[</span><span class="n">indexValue</span><span class="p">][</span><span class="s1">&#39;volume_type&#39;</span><span class="p">]</span> <span class="ow">and</span>
                        <span class="n">response</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data Integrity on the restored volume and accessibility to the&quot;</span>
                                  <span class="s2">&quot; instance its been attached is a SUCCESS &quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: Data Integrity on the restored volume and accessibility to the&quot;</span>
                                   <span class="s2">&quot; instance its been attached is a FAILURE &quot;</span><span class="p">)</span>
                <span class="n">destination_vol_boot</span> <span class="o">=</span> <span class="n">destination_volume_details</span><span class="p">[</span><span class="n">indexValue</span><span class="p">][</span><span class="s1">&#39;bootable&#39;</span><span class="p">]</span>
                <span class="n">destination_vol_load</span> <span class="o">=</span> <span class="n">destination_volume_details</span><span class="p">[</span><span class="n">indexValue</span><span class="p">][</span><span class="s1">&#39;_loaded&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">destination_vol_boot</span><span class="p">)</span> <span class="ow">and</span> <span class="n">destination_vol_load</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The source volume attached is intact after restore&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: The source volume is not intact after restore&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Attach Volume to existing instance Restore Validation failed. please check logs&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Attach Volume to existing instance Restore Validation failed, please check agent logs </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>

<div class="viewcode-block" id="OpenStackVM.update_vm_info"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.update_vm_info">[docs]</a>    <span class="k">def</span> <span class="nf">update_vm_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="s1">&#39;Basic&#39;</span><span class="p">,</span> <span class="n">os_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches all the properties of the VM</span>

<span class="sd">        Args:</span>
<span class="sd">            prop                (str):  Basic - Basic properties of VM like HostName,</span>
<span class="sd">                                                especially the properties with which</span>
<span class="sd">                                                VM can be added as dynamic content</span>

<span class="sd">                                        All   - All the possible properties of the VM</span>

<span class="sd">            os_info             (bool): To fetch os info or not</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if failed to update all the properties of the VM</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Fetch basic props of the instance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_vm_info</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os_info</span> <span class="ow">or</span> <span class="n">prop</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
                <span class="c1"># Update attached volumes list to the instance</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_volume_list</span><span class="p">()</span>
                <span class="c1"># update IP address</span>
                <span class="k">if</span> <span class="n">force_update</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_pingableIP</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_pingableIP</span><span class="p">()</span>
                <span class="c1"># Update machine object</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">):</span>  <span class="c1"># Before calling machine, make sure instance has atleast one external ip</span>
                    <span class="c1"># for communication</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_pingableIP</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">machine</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="n">machine_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> \
                                                       <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">machine</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Machine</span><span class="p">(</span><span class="n">machine_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="n">commcell_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> \
                                                   <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
                <span class="c1"># update vCPUs and diskcount</span>
                <span class="c1"># setattr(self,&quot;NoofCPU&quot;,0)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_advprops</span><span class="p">()</span>
                <span class="c1"># Get drive list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_drive_list</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Failed to Get  the VM Properties of the VM&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_vm_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">extra_args</span><span class="o">=</span><span class="s2">&quot;$null&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the basic or all or specific properties of VM</span>

<span class="sd">        Args:</span>
<span class="sd">                prop                (str):  basic, All or specific property like Memory</span>

<span class="sd">                extra_args          (str):  Extra arguments needed for property listed by &quot;,&quot;</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                if failed to get all the properties of the VM</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Collecting all the VM properties for VM </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">prop_dict</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop_dict</span><span class="p">[</span><span class="s2">&quot;extra_args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extra_args</span>
            <span class="c1"># Get UUID for the VM</span>
            <span class="n">_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="n">_uuid</span>

            <span class="c1"># Update the vCPUS</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">):</span>  <span class="c1"># Before calling machine, make sure instance has atleast one external ip</span>
                <span class="c1"># for communication</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_pingableIP</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Get the OStype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GuestOS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_os_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="c1"># update the OS, currently hardcoded until we find out solution to find VM OS type</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;vm_guest_os&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GuestOS</span><span class="p">)</span>

            <span class="c1"># Update the disk list</span>
            <span class="n">vollist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_volume_attachments</span><span class="p">(</span><span class="n">_uuid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_disk_info</span><span class="p">(</span><span class="n">vollist</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DiskList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disk_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiskList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disk_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">disk</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disks</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disk_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disk_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disks_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disks</span><span class="p">)</span>

            <span class="c1"># Update all the properties of the VM</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_uuid</span><span class="p">):</span>
                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_instance_details</span><span class="p">(</span><span class="n">_uuid</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_server</span> <span class="ow">in</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;servers&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">_key</span> <span class="ow">in</span> <span class="n">_server</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_key</span><span class="p">,</span> <span class="n">_server</span><span class="p">[</span><span class="n">_key</span><span class="p">])</span>
                        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;OS-EXT-AZ&#39;</span> <span class="ow">in</span> <span class="n">_key</span><span class="p">):</span>
                            <span class="c1"># self.getAvailabilityZone = _listofInstances[0][_key]</span>
                            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;AZ&quot;</span><span class="p">,</span> <span class="n">_server</span><span class="p">[</span><span class="n">_key</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Failed to Get all the VM Properties of the VM&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

<div class="viewcode-block" id="OpenStackVM.get_ipaddress"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.get_ipaddress">[docs]</a>    <span class="k">def</span> <span class="nf">get_ipaddress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get_ipaddress() return the ip address from address::privatenetwor::ipaddress</span>

<span class="sd">        :return: ip address in str format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collecting IP address from networkdetails for the server </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">))</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;addresses&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_all_ips</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">guid</span><span class="p">)[</span><span class="s2">&quot;private_network&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception: exception occured in get_ipaddress() &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OpenStackVM.get_advprops"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.get_advprops">[docs]</a>    <span class="k">def</span> <span class="nf">get_advprops</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get_advprops() return the vCPU, RAM detail etc</span>

<span class="sd">        return: dictionary of vCPU, RAM, attached volumes etc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collecting advanced props for the server </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">))</span>
            <span class="c1"># Update the vCPUS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vcpus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_vcpus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="c1"># Update Ram</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_ram</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="c1"># Update the flavor of VM</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmflavor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_vmflavor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vm_name</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;no_of_cpu&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;disk_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception: exception occured in get_ipaddress() &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OpenStackVM.get_pingableIP"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.get_pingableIP">[docs]</a>    <span class="k">def</span> <span class="nf">get_pingableIP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get_pingableIP() will ping each IP address and gets the IP which is pingable</span>
<span class="sd">        force = True will associate available floatinip when instance fond to have valid ip</span>
<span class="sd">        return: return the IPaddress (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting all IP addresses avalaible for the instance&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_ipaddress</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">_addr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">addresses</span><span class="p">:</span>
                    <span class="n">pingObj</span> <span class="o">=</span> <span class="n">ping</span><span class="p">(</span><span class="n">_addr</span><span class="p">[</span><span class="s2">&quot;addr&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">pingObj</span><span class="o">.</span><span class="n">packet_lost</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">_addr</span><span class="p">[</span><span class="s2">&quot;addr&quot;</span><span class="p">]</span>
                        <span class="c1"># self.IP = _addr[&quot;addr&quot;]</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">force</span><span class="p">):</span>
                    <span class="n">_newip</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">tenant_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_tenant</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tenant_id</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error tenant id can&#39;t be empty&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Assinging new external ip address&quot;</span><span class="p">)</span>
                    <span class="n">_list_of_ips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_floating_ips</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">_float_ip</span> <span class="ow">in</span> <span class="n">_list_of_ips</span><span class="p">[</span><span class="s2">&quot;floatingips&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">_float_ip</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DOWN&quot;</span> <span class="ow">and</span> <span class="n">_float_ip</span><span class="p">[</span><span class="s2">&quot;port_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">_float_ip</span><span class="p">[</span>
                            <span class="s2">&quot;tenant_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tenant_id</span><span class="p">:</span>
                            <span class="n">_newip</span> <span class="o">=</span> <span class="n">_float_ip</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">_newip</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">assigned_floating_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">associate_floating_ips</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GUID</span><span class="p">,</span> <span class="n">_newip</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">assigned_floating_ip</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">assigned_floating_ip</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;New IP found and assigned </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_newip</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No valid floating ip found, validation may fail&quot;</span><span class="p">)</span>
            <span class="c1"># else:</span>
            <span class="c1">#     self.log.error(&quot;Error: No vaild  ip found for the server {0}, validation may be skipped&quot;.format(self.GUID))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception: exception occured in get_pingableIP() &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OpenStackVM.get_volume_list"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.get_volume_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_volume_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getvolumelist() gets the all attached volumes details to the server</span>
<span class="sd">        return: returns the list of dictionary of volume details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting all attached volumes for the instance&quot;</span><span class="p">)</span>
            <span class="n">_vollist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_volume_attachments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">guid</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_vollist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">volumelist</span> <span class="o">=</span> <span class="n">_vollist</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error: No vaild  attached volumes found for the server </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GUID</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception: exception occured in get_volume_list() &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OpenStackVM.power_on"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.power_on">[docs]</a>    <span class="k">def</span> <span class="nf">power_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Power on the VM.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                When power on failed</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">_powerstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">poweron_instance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GUID</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_powerstate</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;The error occurred &quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception in PowerOn&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in PowerOn&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception in PowerOn:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span></div>

<div class="viewcode-block" id="OpenStackVM.power_off"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.power_off">[docs]</a>    <span class="k">def</span> <span class="nf">power_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Power off the VM.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                When power off failed</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">_powerstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">poweroff_instance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GUID</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_powerstate</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;The error occurred &quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception in PowerOff&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in PowerOff&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception in PowerOff:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span></div>

<div class="viewcode-block" id="OpenStackVM.delete_vm"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.delete_vm">[docs]</a>    <span class="k">def</span> <span class="nf">delete_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the VM.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                When deleting of the vm failed</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">_ps_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utils_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_operation_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operation_dict</span><span class="p">[</span><span class="s2">&quot;operation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Delete&quot;</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_machine</span><span class="o">.</span><span class="n">_execute_script</span><span class="p">(</span><span class="n">_ps_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_dict</span><span class="p">)</span>

            <span class="n">_stdout</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span>
            <span class="k">if</span> <span class="s2">&quot;Success&quot;</span> <span class="ow">in</span> <span class="n">_stdout</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;The error occurred </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_stdout</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception in deleting the vm&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in DeleteVM </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpenStackVM.get_disk_in_controller"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.get_disk_in_controller">[docs]</a>    <span class="k">def</span> <span class="nf">get_disk_in_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_type</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the disk associated with controller</span>

<span class="sd">        Args:</span>
<span class="sd">                controller_type         (str):  IDE/SCSI</span>

<span class="sd">                number                  (int):  IDE(1:0) 1 is the disk number</span>

<span class="sd">                location                (int):  IDE(1:0) 0 is the location in disk number 1</span>

<span class="sd">        Returns:</span>
<span class="sd">                DiskType                (str):  disks in location of args(eg: disk in IDE(1:0))</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                When there is an error in getting disks in the controller</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_extr_args</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">controller_type</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_vm_info</span><span class="p">(</span><span class="s2">&quot;DiskType&quot;</span><span class="p">,</span> <span class="n">_extr_args</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiskType</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in get_disk_in_controller&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="OpenStackVM.get_disk_path_from_pattern"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.get_disk_path_from_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">get_disk_path_from_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disk_pattern</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the disk that matches the disk pattern form disk list</span>

<span class="sd">        Args:</span>
<span class="sd">                disk_pattern            (str):  pattern which needs to be matched</span>

<span class="sd">        Returns:</span>
<span class="sd">                each_disk               (str):  the disk that matches the pattern</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                When issues while getting disk path from the pattern passed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_disk_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">disk_pattern</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">each_disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiskList</span><span class="p">:</span>
                <span class="n">_vm_disk_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">each_disk</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_vm_disk_name</span> <span class="o">==</span> <span class="n">_disk_name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found the Disk to be filtered in the VM&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">each_disk</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Exception in get_disk_path_from_pattern&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">exp</span></div>

<div class="viewcode-block" id="OpenStackVM.live_browse_vm_exists"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.live_browse_vm_exists">[docs]</a>    <span class="k">def</span> <span class="nf">live_browse_vm_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_vm</span><span class="p">,</span> <span class="n">vsa_restore_job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the VM mounted during live browse is present or not</span>

<span class="sd">        Args:</span>
<span class="sd">            _vm                 (str):  Name of the vm which is mounted</span>

<span class="sd">            vsa_backup_job      (int):  File level restore job</span>

<span class="sd">        Returns:</span>
<span class="sd">            True    :       If the VM exists</span>

<span class="sd">            False   :       If the VM doesn&#39;t exists</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                issues when not able to check if the live vm exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vmname</span> <span class="o">=</span> <span class="n">_vm</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vsa_restore_job</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_GX_BACKUP&quot;</span>
            <span class="n">_ps_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utils_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_operation_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operation_dict</span><span class="p">[</span><span class="s2">&quot;vm_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vmname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operation_dict</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VMExists&quot;</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_machine</span><span class="o">.</span><span class="n">_execute_script</span><span class="p">(</span><span class="n">_ps_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_dict</span><span class="p">)</span>
            <span class="n">_stdout</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span>
            <span class="k">if</span> <span class="s2">&quot;True&quot;</span> <span class="ow">in</span> <span class="n">_stdout</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception while vm existence check &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

<div class="viewcode-block" id="OpenStackVM.live_browse_ds_exists"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.live_browse_ds_exists">[docs]</a>    <span class="k">def</span> <span class="nf">live_browse_ds_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_dslist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the DS mounted during live browse is present or not</span>

<span class="sd">        Args:</span>
<span class="sd">            _dslist             (list):  List of DS which is mounted</span>

<span class="sd">        Returns:</span>
<span class="sd">            True    :       If the DS exists</span>

<span class="sd">            False   :       If the DS doesn&#39;t exists</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                issues when not able to check if the live browse ds exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_ps_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utils_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vm_operation_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operation_dict</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DSExists&quot;</span>
            <span class="n">_failures</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">_ds</span> <span class="ow">in</span> <span class="n">_dslist</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_dict</span><span class="p">[</span><span class="s2">&quot;vm_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ds</span>
                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_machine</span><span class="o">.</span><span class="n">_execute_script</span><span class="p">(</span><span class="n">_ps_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_dict</span><span class="p">)</span>
                <span class="n">_stdout</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span>
                <span class="k">if</span> <span class="n">_stdout</span> <span class="o">!=</span> <span class="s2">&quot;False&quot;</span><span class="p">:</span>
                    <span class="n">_failures</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">_failures</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Exception while DS existence check &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">err</span></div>

    <span class="k">def</span> <span class="nf">_get_disk_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name, path and size of the disks available</span>
<span class="sd">        Args:</span>
<span class="sd">            volume_list:  response of the volume_attachments()</span>

<span class="sd">        Returns: (list)     List of the disk with Name, Path and Size</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_disks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">voldetails</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_volume_detail</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">volume_list</span><span class="p">:</span>
                <span class="n">_vm_disk</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="n">voldetails</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">disk</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">vol</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]):</span>
                        <span class="n">_vm_disk</span><span class="p">[</span><span class="s2">&quot;volumeId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                        <span class="n">_vm_disk</span><span class="p">[</span><span class="s2">&quot;attachments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span><span class="p">[</span><span class="s2">&quot;attachments&quot;</span><span class="p">]</span>
                        <span class="n">_vm_disk</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                        <span class="n">_vm_disk</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>
                        <span class="n">_vm_disk</span><span class="p">[</span><span class="s2">&quot;volume_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span><span class="p">[</span><span class="s2">&quot;volume_type&quot;</span><span class="p">]</span>
                        <span class="n">_vm_disk</span><span class="p">[</span><span class="s2">&quot;availability_zone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span><span class="p">[</span><span class="s2">&quot;availability_zone&quot;</span><span class="p">]</span>

                <span class="n">_disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_vm_disk</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_disks</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;An exception occurred in _get_disk_info&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

<div class="viewcode-block" id="OpenStackVM.get_drive_list"><a class="viewcode-back" href="../../../../source/VirtualServer.VSAUtils.VMHelpers.html#VirtualServer.VSAUtils.VMHelpers.OpenStackVM.OpenStackVM.get_drive_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_drive_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drives</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the drive list for the VM</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GuestOS</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
                <span class="c1"># get the list</span>
                <span class="n">storage_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hvobj</span><span class="o">.</span><span class="n">OpenStackHandler</span><span class="o">.</span><span class="n">get_drive_details</span><span class="p">(</span><span class="n">vmObj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">_temp_drive_letter</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">_drive_regex</span> <span class="o">=</span> <span class="s2">&quot;^[a-zA-Z]$&quot;</span>
                <span class="k">for</span> <span class="n">_drive</span> <span class="ow">in</span> <span class="n">storage_details</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_drive_regex</span><span class="p">,</span> <span class="n">_drive</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">_driveletter</span> <span class="o">=</span> <span class="n">_drive</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
                        <span class="n">_temp_drive_letter</span><span class="p">[</span><span class="n">_drive</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">_driveletter</span>
                    <span class="c1"># del _temp_drive_letter[&#39;D&#39;]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">_temp_drive_letter</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">storage_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">get_storage_details</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">_drive</span><span class="p">,</span> <span class="n">_volume</span> <span class="ow">in</span> <span class="n">storage_details</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="s2">&quot;/dev/vd&quot;</span> <span class="ow">in</span> <span class="n">_drive</span><span class="p">:</span>
                        <span class="n">_temp_drive_letter</span><span class="p">[</span><span class="s2">&quot;MountDir-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">_volume</span><span class="p">[</span><span class="s2">&quot;mountpoint&quot;</span><span class="p">]</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="s2">&quot;dev/mapper&quot;</span> <span class="ow">in</span> <span class="n">_drive</span><span class="p">:</span>
                        <span class="n">_volume_name</span> <span class="o">=</span> <span class="n">_drive</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">_temp_drive_letter</span><span class="p">[</span><span class="n">_volume_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_volume</span><span class="p">[</span><span class="s2">&quot;mountpoint&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_drive_list</span> <span class="o">=</span> <span class="n">_temp_drive_letter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_drives</span> <span class="o">=</span> <span class="n">_temp_drive_letter</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drive_list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to Get Volume Details for the VM&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;An Exception Occurred in Getting the Volume Info for the VM </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_drive_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>