
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Application.NotesDatabase.lndbhelper &#8212; Commvault Automation 11.13 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for Application.NotesDatabase.lndbhelper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="c1"># FIXME: https://engweb.commvault.com/engtools/defect/215314</span>

<span class="sd">&quot;&quot;&quot;&quot;Helper for Notes Database automation operations</span>

<span class="sd">    LNDBHelper:</span>
<span class="sd">        backup_template_and_encrypted_db()  --  Verifies data protection for template and encrypted databases</span>

<span class="sd">        deleted_subclient()                 --  Verifies data protection for a deleted subclient</span>

<span class="sd">        mark_job_bad()                      --  Verifies restore from a backup job that has been marked as bad</span>

<span class="sd">        unconditional_overwrite()           --  Verifies that restore option &#39;Unconditional Overwrite&#39; works as expected</span>

<span class="sd">        database_replica_id()               --  Verifies that restore option &#39;Change Replica ID&#39; works as expected</span>

<span class="sd">        database_instance_id()              --  Verifies that restore option &#39;Change Database Instance ID&#39; works as expected</span>

<span class="sd">        do_not_replay_transact_logs()       --  Verifies that restore option &#39;Do Not Replay Transactional Logs&#39; works as expected</span>

<span class="sd">        disable_replication()               --  Verifies that restore option &#39;Disable Replication&#39; works as expected</span>

<span class="sd">        full_data_protection()              --  Verifies full backup for a subclient.</span>

<span class="sd">        inc_data_protection()               --  Verifies incremental backups for a subclient</span>

<span class="sd">        restores()                          --  Verifies in-place and put-place restores for a subclient</span>

<span class="sd">        defsubclient_autodiscovery()        --  Verifies auto-discovery feature of the default subclient</span>

<span class="sd">        disaster_recovery()                 --  Verifies disaster recovery scenario</span>

<span class="sd">        tr_log_backup_with_indexing()       --  Verifies tr log backup job with indexing</span>

<span class="sd">        backup_many_tr_logs()               --  Verifies data protection with a large number of tr logs</span>

<span class="sd">        backup_many_databases()             --  Verifies data protection with a large number of databases</span>

<span class="sd">        osc_schedule_backup()               --  Verifies osc scheduler triggered backups</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">.cvrest_helper</span> <span class="k">import</span> <span class="n">CVRestHelper</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">constant</span>

<div class="viewcode-block" id="TimeoutException"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.TimeoutException">[docs]</a><span class="k">class</span> <span class="nc">TimeoutException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="LNDBHelper"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper">[docs]</a><span class="k">class</span> <span class="nc">LNDBHelper</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;&quot;Contains helper functions for LN Agent related automation tasks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span> <span class="o">=</span> <span class="n">CVRestHelper</span><span class="p">()</span>

<div class="viewcode-block" id="LNDBHelper.backup_template_and_encrypted_db"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.backup_template_and_encrypted_db">[docs]</a>    <span class="k">def</span> <span class="nf">backup_template_and_encrypted_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies data protection for template and encrypted databases.</span>
<span class="sd">        Requires a subclient to be created beforehand with the appropriate dbs</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;ntf&#39;</span> <span class="ow">in</span> <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;relativePath&#39;</span><span class="p">]:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is a template.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;relativePath&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s1">&#39;windows&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">os_info</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                                               <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;relativePath&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nsf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                                               <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;relativePath&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nsf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Database: &#39;</span> <span class="o">+</span> <span class="n">database</span><span class="p">)</span>
        <span class="n">test_steps</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IN PLACE RESTORE&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;OUT PLACE RESTORE&#39;</span><span class="p">}</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">test_steps</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**************************************************************&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**************************************************************&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;************************COLLECT*DOC*PROPERTIES*************************&#39;</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">)</span>
            <span class="n">doc_properties_beforebackup</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">remove_restored_dbs</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">type_of_restore</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;****************COLLECT*DOC*PROPERTIES********************&#39;</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span>
                <span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span>
                <span class="n">dbs_in_subclient</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">,</span>
                <span class="n">type_of_restore_performed</span><span class="o">=</span><span class="n">step</span>
            <span class="p">)</span>
            <span class="n">doc_properties_afterrestore</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">]</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*****************COMPARE*DOC*PROPERTIES*******************&#39;</span><span class="p">)</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">doc_properties_beforebackup</span> <span class="o">!=</span> <span class="n">doc_properties_afterrestore</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Document properties do not match&#39;</span><span class="p">)</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> has failed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Document properties do not match&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Document properties match&#39;</span><span class="p">)</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> has passed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only </span><span class="si">{}</span><span class="s2"> test scenario(s) passed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="LNDBHelper.deleted_subclient"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.deleted_subclient">[docs]</a>    <span class="k">def</span> <span class="nf">deleted_subclient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies data protection for a deleted subclient.</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_def_subclient</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">has_subclient</span><span class="p">(</span><span class="s1">&#39;new_sub_50995&#39;</span><span class="p">):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;new_sub_50995&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">newsubclient</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;new_sub_50995&#39;</span><span class="p">,</span> <span class="s1">&#39;SP1&#39;</span><span class="p">)</span>
        <span class="n">dbname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">add_database_to_subclient</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">newsubclient</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">dbname</span><span class="p">)</span>
        <span class="n">doc_count_1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">newsubclient</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">remove_restored_dbs</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">dbname</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">newsubclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;****************COLLECT*DOC*PROPERTIES********************&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">dbname</span><span class="p">)</span>
        <span class="n">doc_count_3</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">doc_count_1</span> <span class="o">==</span> <span class="n">doc_count_3</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Able to restore user defined subclient version&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unable to restore user defined subclient version&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;doc_count_1 </span><span class="si">{}</span><span class="s1"> doc_count_3 </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc_count_1</span><span class="p">,</span> <span class="n">doc_count_3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbname</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;add documents&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">])</span>
            <span class="n">db_name</span> <span class="o">=</span> <span class="n">database</span>
            <span class="n">doc_count_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">]]</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Total docs for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">doc_count_2</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">newsubclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_def_subclient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;databaseTitle&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">db_name</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_def_subclient</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;****************COLLECT*DOC*PROPERTIES********************&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">dbname</span><span class="p">)</span>
        <span class="n">doc_count_4</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">doc_count_2</span> <span class="o">==</span> <span class="n">doc_count_4</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Able to restore default subclient version&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unable to restore default subclient version&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;doc_count_2 </span><span class="si">{}</span><span class="s1"> doc_count_4 </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc_count_2</span><span class="p">,</span> <span class="n">doc_count_4</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">remove_restored_dbs</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">dbname</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LNDBHelper.mark_job_bad"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.mark_job_bad">[docs]</a>    <span class="k">def</span> <span class="nf">mark_job_bad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies restore from a backup job that has been marked as bad.</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">has_subclient</span><span class="p">(</span><span class="s1">&#39;new_sub_50995&#39;</span><span class="p">):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;new_sub_50995&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">newsubclient</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;new_sub_50995&#39;</span><span class="p">,</span> <span class="s1">&#39;SP1&#39;</span><span class="p">)</span>
        <span class="n">dbname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">add_database_to_subclient</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">newsubclient</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">newsubclient</span><span class="p">)</span>
        <span class="n">qscript</span> <span class="o">=</span> <span class="s2">&quot;-sn &#39;</span><span class="si">{}</span><span class="s2">&#39; -si &#39;</span><span class="si">{}</span><span class="s2">&#39; -si &#39;</span><span class="si">{}</span><span class="s2">&#39; -si &#39;</span><span class="si">{}</span><span class="s2">&#39; -si &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;MarkJobsOnCopy&#39;</span><span class="p">,</span> <span class="s1">&#39;SP1&#39;</span><span class="p">,</span> <span class="s1">&#39;Primary&#39;</span><span class="p">,</span> <span class="s1">&#39;markJobsBad&#39;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">_qoperation_execscript</span><span class="p">(</span><span class="n">qscript</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Response:&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">browse_paths_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">recursive_browse</span><span class="p">(</span><span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">newsubclient</span><span class="p">,</span>
                                                               <span class="n">log</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                                                               <span class="n">machine</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">machine</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;dbs_in_subclient:&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">([</span><span class="n">dbname</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;browse paths:&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">browse_paths_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">browse_paths_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="n">dbname</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Browse failed&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Browse works as expected&#39;</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">newsubclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Restore Job Status: &#39;</span> <span class="o">+</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test case PASSED&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">remove_restored_dbs</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="p">[</span><span class="n">dbname</span><span class="p">],</span> <span class="s1">&#39;in&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LNDBHelper.unconditional_overwrite"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.unconditional_overwrite">[docs]</a>    <span class="k">def</span> <span class="nf">unconditional_overwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies that restore option &#39;Unconditional Overwrite&#39; works as expected.</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**************************RESTORE*OPTION*1**********************************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*****************UNCONDITIONAL*OVERWRITE************************************&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">has_subclient</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">,</span> <span class="s1">&#39;SP1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">add_database_to_subclient</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="n">num_db</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">num_doc</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">db_name</span> <span class="o">=</span> <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;databaseTitle&#39;</span><span class="p">]</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="p">[</span><span class="n">db_name</span><span class="p">])</span>
        <span class="n">creation_initial</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;documents&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Original creation date is </span><span class="si">{}</span><span class="s1"> for database </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">creation_initial</span><span class="p">,</span>
            <span class="n">db_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;FULL&#39;</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;delete database&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">db_name</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">common_options_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;unconditionalOverwrite&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="p">[</span><span class="n">db_name</span><span class="p">])</span>
        <span class="n">creation_final</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;documents&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Restored creation date is </span><span class="si">{}</span><span class="s1"> for database </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">creation_final</span><span class="p">,</span> <span class="n">db_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">creation_final</span> <span class="o">==</span> <span class="n">creation_initial</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creation date is the same. Test scenario PASSED&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Doc count before: </span><span class="si">{}</span><span class="s1"> and doc count after : </span><span class="si">{}</span><span class="s1"> are not same.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">creation_initial</span><span class="p">,</span>
                <span class="n">creation_final</span>
            <span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test sceanrio FAILED&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">remove_restored_dbs</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="p">[</span><span class="n">db_name</span><span class="p">],</span> <span class="s1">&#39;in&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LNDBHelper.database_replica_id"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.database_replica_id">[docs]</a>    <span class="k">def</span> <span class="nf">database_replica_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies that restore option &#39;Change Replica ID&#39; works as expected.</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**************************RESTORE*OPTION*2********************************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*****************CHANGE*REPLICA*ID***************************************&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">has_subclient</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">,</span> <span class="s1">&#39;SP1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">add_database_to_subclient</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="n">num_db</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">num_doc</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">)</span>
        <span class="n">replication_info_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;databaseTitle&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Database: &#39;</span> <span class="o">+</span> <span class="n">database</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;****************************GET*REPLICATION*INFO********************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;replication info&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Replica ID for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;replicaID&#39;</span><span class="p">]))</span>
            <span class="n">replication_info_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;replicaID&#39;</span><span class="p">])</span>
        <span class="n">test_steps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SAME REPLICA ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CHANGE REPLICA ID&#39;</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">test_steps</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;****************************************************************************&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="n">replication_info_after</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="n">test_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">common_options_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;recoverZapReplica&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*****************************BACKUP*******************************&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">delete_db_and_validate</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span>
                                               <span class="n">dbsinsubclient</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;**************************GET*REPLICATION*INFO******************************&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span>
                                                          <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;replication info&#39;</span><span class="p">,</span>
                                                          <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Replica ID for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;replicaID&#39;</span><span class="p">]))</span>
                <span class="n">replication_info_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;replicaID&#39;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;************************COMPARE*REPLICATION*INFO****************************&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">replication_info_before</span> <span class="o">==</span> <span class="n">replication_info_after</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;For databases, the replica ID is the same&#39;</span><span class="p">)</span>
                <span class="n">match</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;For databases, the replication info is not the same&#39;</span><span class="p">)</span>
                <span class="n">match</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">match</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">==</span> <span class="n">test_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> \
                    <span class="p">(</span><span class="ow">not</span> <span class="n">match</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">==</span> <span class="n">test_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> passed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> failed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only </span><span class="si">{}</span><span class="s2"> test scenario(s) passed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">remove_restored_dbs</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LNDBHelper.database_instance_id"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.database_instance_id">[docs]</a>    <span class="k">def</span> <span class="nf">database_instance_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="c1">##Under development##</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies that restore option &#39;Change Database Instance ID&#39; works as expected.</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**************************RESTORE*OPTION*3**********************************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*****************CHANGE*DATABASE*INSTANCE*ID******************************&#39;</span><span class="p">)</span>
        <span class="n">dbiid_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">has_subclient</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">,</span> <span class="s1">&#39;SP1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">add_database_to_subclient</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="n">num_db</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">num_doc</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;databaseTitle&#39;</span><span class="p">])</span>
            <span class="n">dbiid_before</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;dbiid1&#39;</span><span class="p">],</span>
                                 <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;dbiid2&#39;</span><span class="p">],</span>
                                 <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;dbiid3&#39;</span><span class="p">],</span>
                                 <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;dbiid4&#39;</span><span class="p">]])</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Database: &#39;</span> <span class="o">+</span> <span class="n">database</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;DBIID before:&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">dbiid_before</span><span class="p">)</span>
        <span class="n">test_steps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SAME INSTANCE ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CHANGE INSTANCE ID&#39;</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">test_steps</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;****************************************************************************&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="n">test_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">common_options_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;recoverZap&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*****************************BACKUP*******************************&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">delete_db_and_validate</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span>
                                               <span class="n">dbsinsubclient</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="n">dbiid_after</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                <span class="n">dbiid_after</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;dbiid1&#39;</span><span class="p">],</span>
                                    <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;dbiid2&#39;</span><span class="p">],</span>
                                    <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;dbiid3&#39;</span><span class="p">],</span>
                                    <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;dbiid4&#39;</span><span class="p">]])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;DBIID after:&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">dbiid_after</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;************************COMPARE*INSTANCE*ID*INFO****************************&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dbiid_before</span> <span class="o">==</span> <span class="n">dbiid_after</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;For databases, the instance ID is the same&#39;</span><span class="p">)</span>
                <span class="n">match</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;For databases, the instance ID is not the same&#39;</span><span class="p">)</span>
                <span class="n">match</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">match</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">==</span> <span class="n">test_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> \
                    <span class="p">(</span><span class="ow">not</span> <span class="n">match</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">==</span> <span class="n">test_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> passed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> failed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test scenario FAILED&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="LNDBHelper.do_not_replay_transact_logs"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.do_not_replay_transact_logs">[docs]</a>    <span class="k">def</span> <span class="nf">do_not_replay_transact_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies that restore option &#39;Do Not Replay Transactional Logs&#39; works as expected.</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**************************RESTORE*OPTION*4**********************************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*****************DO*NOT*REPLAY*TRANSACTIONAL*LOGS***************************&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">has_subclient</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">,</span> <span class="s1">&#39;SP1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">add_database_to_subclient</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">db_name</span> <span class="o">=</span> <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;databaseTitle&#39;</span><span class="p">]</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="p">[</span><span class="n">db_name</span><span class="p">])</span>
        <span class="n">doc_prop_before</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;documents&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Original doc count is </span><span class="si">{}</span><span class="s1"> for database </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc_prop_before</span><span class="p">,</span> <span class="n">db_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**************************ADDING*NEW*DOCUMENTS******************************&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
            <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;add documents&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">db_name</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;New doc count is </span><span class="si">{}</span><span class="s1"> for database </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">],</span> <span class="n">db_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;incremental&#39;</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;delete database&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">db_name</span><span class="p">])</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
            <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;console commands&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;restart server&#39;</span><span class="p">])</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">check_if_domino_up</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">common_options_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;doNotReplayTransactLogs&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="p">[</span><span class="n">db_name</span><span class="p">])</span>
        <span class="n">doc_prop_after</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;documents&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Restored doc count is </span><span class="si">{}</span><span class="s1"> for database </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc_prop_after</span><span class="p">,</span> <span class="n">db_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">doc_prop_before</span> <span class="o">==</span> <span class="n">doc_prop_after</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario PASSED&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Doc count before: </span><span class="si">{}</span><span class="s1"> and doc count after : </span><span class="si">{}</span><span class="s1"> are not same.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">doc_prop_before</span><span class="p">,</span>
                <span class="n">doc_prop_after</span>
            <span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test sceanrio FAILED&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LNDBHelper.disable_replication"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.disable_replication">[docs]</a>    <span class="k">def</span> <span class="nf">disable_replication</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies that restore option &#39;Disable Replication&#39; works as expected.</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**************************RESTORE*OPTION*5**********************************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***********************DISABLE*REPLICATION**********************************&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">has_subclient</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;auto_50993&#39;</span><span class="p">,</span> <span class="s1">&#39;SP1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">add_database_to_subclient</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="n">num_db</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">num_doc</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">dbs_in_subclient</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">dbs_in_subclient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;databaseTitle&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Database: &#39;</span> <span class="o">+</span> <span class="n">database</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#####</span>
        <span class="c1"># Step 1</span>
        <span class="c1">#####</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*****************************REGULAR*SETUP****************************&#39;</span><span class="p">)</span>
        <span class="n">test_steps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;IN PLACE RESTORE&#39;</span><span class="p">,</span> <span class="s1">&#39;OUT PLACE RESTORE&#39;</span><span class="p">]</span>
        <span class="n">replication_info_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;********************ENABLE*REPLICATION********************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;set replication info&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Replication status for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;ReplicationInfo&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;console commands&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dbcache flush&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**********************GET*REPLICATION*INFO****************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;replication info&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Replication status for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]))</span>
            <span class="n">replication_info_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*****************************BACKUP*******************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">lndb_restore_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;disableReplication&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">test_steps</span><span class="p">:</span>
            <span class="n">replication_info_after</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">common_options_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;unconditionalOverwrite&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;********************GET*REPLICATION*INFO**************************&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;IN&#39;</span> <span class="ow">in</span> <span class="n">step</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                        <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;replication info&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out_path_database</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">constant</span><span class="o">.</span><span class="n">OUT_PLACE_FOLDER_PATH</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">database</span><span class="p">))</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                        <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;replication info&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">out_path_database</span><span class="p">])</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Replication status for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]))</span>
                <span class="n">replication_info_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*******************COMPARE*REPLICATION*INFO***********************&#39;</span><span class="p">)</span>
            <span class="n">chk</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">replication_info_after</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;disabled&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">chk</span> <span class="o">=</span> <span class="n">chk</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">chk</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbs_in_subclient</span><span class="p">):</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test scenario </span><span class="si">{}</span><span class="s2"> failed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test scenario </span><span class="si">{}</span><span class="s2"> passed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1">#####</span>
        <span class="c1"># Step 2</span>
        <span class="c1">#####</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*******************LOGS*GETTING*REPLAYED***************************&#39;</span><span class="p">)</span>
        <span class="n">replication_info_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">replication_info_after</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">doc_count_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">doc_count_after</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;****************************ENABLE*TR*LOGGING***********************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;change transactional logging&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;console commands&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dbcache flush&#39;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Transactional Logging for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;TRLogInfo&#39;</span><span class="p">]))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;************************ENABLE*REPLICATION**************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;set replication info&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;console commands&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dbcache flush&#39;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Replication status for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;ReplicationInfo&#39;</span><span class="p">]))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;********************GET*REPLICATION*INFO**************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;replication info&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Replication status for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]))</span>
            <span class="n">replication_info_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**********************CREATE*DOCUMENTS*******************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;add documents&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Total docs for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">]))</span>
            <span class="n">doc_count_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*******************BACKUP*TR*LOG*SUBCLIENT***************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INCREMENTAL&#39;</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***************************DELETE************************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;delete database&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;removed&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">):</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> removal successful&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> removal unsuccessful&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">lndb_restore_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;disableReplication&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">common_options_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">type_of_restore</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;********************GET*REPLICATION*INFO**************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;replication info&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Replication status for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]))</span>
            <span class="n">replication_info_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;************************COLLECT*DOC*PROPERTIES************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;get document properties&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">doc_count_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">]))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***************************COMPARE************************************&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">doc_count_before</span> <span class="o">==</span> <span class="n">doc_count_after</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Number of documents is the same. </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc_count_before</span><span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario PASSED&#39;</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Number of documents is not right. &#39;</span>
                         <span class="s1">&#39;DocCount before backup: </span><span class="si">{}</span><span class="s1"> DocCount after restore: </span><span class="si">{}</span><span class="s1">&#39;</span>
                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc_count_before</span><span class="p">,</span> <span class="n">doc_count_after</span><span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario FAILED&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;************************TR*LOGS*NOT*REPLAYED*************************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">common_options_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;doNotReplayTransactLogs&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">doc_count_after</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***************************DELETE************************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;delete database&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;removed&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">):</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> removal successful&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> removal unsuccessful&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">lndb_restore_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;disableReplication&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">common_options_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;doNotReplayTransactLogs&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">type_of_restore</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;********************GET*REPLICATION*INFO**************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;replication info&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Replication status for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]))</span>
            <span class="n">replication_info_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;************************COLLECT*DOC*PROPERTIES************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="s1">&#39;OOPRestore_auto-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;get document properties&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">temp</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">doc_count_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">]))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***************************COMPARE************************************&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">doc_count_before</span> <span class="o">!=</span> <span class="n">doc_count_after</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Number of documents is not same. </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">doc_count_before</span><span class="p">,</span> <span class="n">doc_count_after</span><span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario PASSED&#39;</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Number of documents is not right. &#39;</span>
                         <span class="s1">&#39;DocCount before backup: </span><span class="si">{}</span><span class="s1"> DocCount after restore: </span><span class="si">{}</span><span class="s1">&#39;</span>
                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc_count_before</span><span class="p">,</span> <span class="n">doc_count_after</span><span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario FAILED&#39;</span><span class="p">)</span>
        <span class="c1">#####</span>
        <span class="c1"># Step 3</span>
        <span class="c1">#####</span>
        <span class="n">replica_dbs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">doc_count_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">doc_count_after</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">common_options_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;****************************ENABLE*TR*LOGGING*************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;change transactional logging&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;console commands&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dbcache flush&#39;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Transactional Logging for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;TRLogInfo&#39;</span><span class="p">]))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;****************ENABLE*REPLICATION************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;set replication info&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;console commands&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dbcache flush&#39;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Replication status for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;ReplicationInfo&#39;</span><span class="p">]))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**********************CREATE*REPLICA*********************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                    <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;create replica&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Replication status for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]))</span>
                <span class="n">replica_dbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;replica name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Replication is disabled for this database&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*****************************BACKUP*******************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;FULL&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**********************CREATE*DOCUMENTS*********************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;add documents&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Total docs for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">]))</span>
            <span class="n">doc_count_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**********************BACKUP*TR*LOG*SUBCLIENT**********************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INCREMENTAL&#39;</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***************************DELETE************************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;delete database&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;removed&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">):</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> removal successful&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> removal unsuccessful&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">lndb_restore_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;disableReplication&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">type_of_restore</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**********************CREATE*DOCUMENTS*IN*REPLICTED*DB****************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">replica_dbs</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;add documents&#39;</span><span class="p">,</span>
                                                      <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nsf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                                                             <span class="s2">&quot;10&quot;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Total docs for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">]))</span>
            <span class="n">doc_count_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*********************COLLECT*DOC*PROPERTIES*********************&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">dbs_in_subclient</span><span class="p">)</span>
        <span class="n">doc_properties_before</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*********************RUN*REPLICATION******************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;replicate&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*******************COLLECT*REPLICA*PROPERTIES*****************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">database</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">replica_dbs</span><span class="p">):</span>
            <span class="n">replica_dbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nsf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">replica_dbs</span><span class="p">)</span>
        <span class="n">doc_properties_after</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;********************COMPARE*DOC*PROPERTIES********************&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">doc_properties_before</span> <span class="o">!=</span> <span class="n">doc_properties_after</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Document properties do not match. Hence no replication has occured&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> has passed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Replication Across Servers&#39;</span><span class="p">))</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Document properties match. Replication occured&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario has failed&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only </span><span class="si">{}</span><span class="s2"> out of 5 test scenario(s) passed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="LNDBHelper.full_data_protection"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.full_data_protection">[docs]</a>    <span class="k">def</span> <span class="nf">full_data_protection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies full backup for a subclient.</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">has_subclient</span><span class="p">(</span><span class="s1">&#39;new_sub_50994&#39;</span><span class="p">):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;new_sub_50994&#39;</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;new_sub_50994&#39;</span><span class="p">,</span> <span class="s1">&#39;SP1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">add_database_to_subclient</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;databaseTitle&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;FULL&#39;</span><span class="p">)</span>

        <span class="n">browse_paths_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">recursive_browse</span><span class="p">(</span><span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span>
                                                               <span class="n">log</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                                                               <span class="n">machine</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">machine</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;dbs_in_subclient:&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;browse paths:&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">browse_paths_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">browse_paths_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Browse failed&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="LNDBHelper.inc_data_protection"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.inc_data_protection">[docs]</a>    <span class="k">def</span> <span class="nf">inc_data_protection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies incremental backups for a subclient</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;***********DELETING*PREVIOUS*SUBCLIENT*AND*CREATING*A*NEW*ONE************&quot;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;new_sub_50994&#39;</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">backupset</span><span class="o">.</span><span class="n">subclients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;new_sub_50994&#39;</span><span class="p">,</span> <span class="s1">&#39;SP1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">add_database_to_subclient</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="n">num_db</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">num_doc</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;1st Incremental&#39;</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INCREMENTAL&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span> <span class="o">==</span> <span class="s1">&#39;Full&#39;</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job Not Converted to FULL. Failed&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job converted to FULL as expected&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;2nd Incremental&#39;</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INCREMENTAL&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;sizeOfApplication&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Inc backup without changing content should not back up anything. Failed.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span> <span class="o">==</span> <span class="s1">&#39;Full&#39;</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;2nd Incremental Job converted to FULL. Failed&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Application size is 0 as expected&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job not converted to FULL as expected&#39;</span><span class="p">)</span>

        <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;databaseTitle&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">delete_indexcache</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">browse_paths_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">recursive_browse</span><span class="p">(</span><span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span>
                                                                   <span class="n">log</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                                                                   <span class="n">machine</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">machine</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;dbs_in_subclient:&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;browse paths:&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">browse_paths_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">browse_paths_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">):</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Browse failed&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Browse works after IndexCache is deleted as expected&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;add documents&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Total docs for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">]))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;3rd Incremental&#39;</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INCREMENTAL&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span> <span class="o">==</span> <span class="s1">&#39;Full&#39;</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;3rd Incremental Job converted to FULL. Failed&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job not converted to FULL after Indexcache deletion as expected&#39;</span><span class="p">)</span>

        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;4th Incremental&#39;</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INCREMENTAL&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;sizeOfApplication&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Inc backup without changing content should not back up anything. Failed.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span> <span class="o">==</span> <span class="s1">&#39;Full&#39;</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;4th Incremental Job converted to FULL. Failed&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Application size is 0 as expected&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job not converted to FULL as expected&#39;</span><span class="p">)</span>

        <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="LNDBHelper.restores"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.restores">[docs]</a>    <span class="k">def</span> <span class="nf">restores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies in-place and put-place restores for a subclient.</span>
<span class="sd">        Requires a subclient to be created beforehand with the appropriate dbs</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;databaseTitle&#39;</span><span class="p">])</span>
        <span class="n">test_steps</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IN PLACE RESTORE&#39;</span><span class="p">,</span> <span class="s1">&#39;OUT PLACE RESTORE&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">test_steps</span><span class="p">:</span>
            <span class="n">doc_properties_beforebackup</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;******************************************************************&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*********************COLLECT*DOC*PROPERTIES***********************&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                    <span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;get document properties&#39;</span><span class="p">,</span>
                    <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                <span class="n">doc_properties_beforebackup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***************************BACKUP*******************************&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">backup</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;IN&#39;</span> <span class="ow">in</span> <span class="n">step</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">delete_db_and_validate</span><span class="p">(</span>
                    <span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span>
                    <span class="n">dbsinsubclient</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">remove_restored_dbs</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*******************COLLECT*DOC*PROPERTIES*********************&#39;</span><span class="p">)</span>
            <span class="n">browse_paths_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">recursive_browse</span><span class="p">(</span><span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="p">,</span>
                                                                   <span class="n">log</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                                                                   <span class="n">machine</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">machine</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">browse_path</span> <span class="ow">in</span> <span class="n">browse_paths_dictionary</span><span class="p">[</span><span class="n">database</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s1">&#39;windows&#39;</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">os_info</span><span class="p">:</span>
                        <span class="n">browse_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">browse_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_subclient</span><span class="p">,</span>
                <span class="n">step</span><span class="p">,</span>
                <span class="n">browse_paths_dictionary</span><span class="p">)</span>
            <span class="n">doc_properties_afterrestore</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">]</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*******************COMPARE*DOC*PROPERTIES*********************&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">doc_properties_beforebackup</span> <span class="o">!=</span> <span class="n">doc_properties_afterrestore</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Document properties do not match&#39;</span><span class="p">)</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> has failed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
                <span class="k">return</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Document properties match&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> has passed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="LNDBHelper.defsubclient_autodiscovery"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.defsubclient_autodiscovery">[docs]</a>    <span class="k">def</span> <span class="nf">defsubclient_autodiscovery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies auto-discovery feature of the default subclient.</span>
<span class="sd">        Requires the subclient to be initialized beforehand</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;***********************RUN*BACKUP*DEFAULT*SUBCLIENT*****************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;FULL&#39;</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;*******************************DATABASES*DEFAULT*SUBCLIENT**********************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">database</span> <span class="o">=</span> <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;relativePath&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;windows&#39;</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">os_info</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nsf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nsf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;TOTAL DATABASES IN DEFAULT SUBCLIENT: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_before</span><span class="p">)))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;***********************************CREATE*NEW*DATABASES*************************&#39;</span><span class="p">)</span>
        <span class="n">jstring</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span>
                <span class="p">[{</span>
                    <span class="s2">&quot;template&quot;</span><span class="p">:</span> <span class="s2">&quot;notebook9.ntf&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;numdb&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;numdocs&quot;</span><span class="p">:</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;numlogs&quot;</span><span class="p">:</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;dbname&quot;</span><span class="p">:</span> <span class="s2">&quot;36903&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;trlog&quot;</span><span class="p">:</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;del&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span>
                <span class="p">}]</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
            <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;data populator&#39;</span><span class="p">,</span> <span class="n">jstring</span><span class="o">=</span><span class="n">jstring</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">new_dbs_added</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nsf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;FULL&#39;</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;*******************************DATABASES*DEFAULT*SUBCLIENT**********************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">database</span> <span class="o">=</span> <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;relativePath&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;windows&#39;</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">os_info</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nsf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nsf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;TOTAL DATABASES IN DEFAULT SUBCLIENT: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_before</span><span class="p">):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;dbs_before: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_before</span><span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;dbs_after: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;new_dbs_added: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">new_dbs_added</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_before</span><span class="p">))</span> \
                    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">new_dbs_added</span><span class="p">):</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;New databases found by default subclient&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;New databases not found by default subclient&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Number of databases in default subclient after are not more than before&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INCREMENTAL&quot;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;*************************************CREATE*DOCUMENTS***************************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">new_dbs_added</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">new_dbs_added</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;add documents&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Total docs for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">]))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;***************************BACKUP*TR*LOG*SUBCLIENT******************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INCREMENTAL&#39;</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="p">)</span>
        <span class="n">test_steps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;IN PLACE RESTORE&#39;</span><span class="p">,</span> <span class="s1">&#39;OUT PLACE RESTORE&#39;</span><span class="p">]</span>
        <span class="n">doc_properties_beforebackup</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">doc_name_beforebackup</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">database</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="p">):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*********************COLLECT*DOC*PROPERTIES***********************&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">_</span><span class="p">:</span>
                <span class="n">doc_properties_beforebackup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">))</span>
                <span class="n">doc_name_beforebackup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">test_steps</span><span class="p">:</span>
            <span class="n">doc_properties_afterrestore</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">doc_name_afterrestore</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;******************************************************************&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;OUT&#39;</span> <span class="ow">in</span> <span class="n">step</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">remove_restored_dbs</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="n">type_of_restore</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*********************COLLECT*DOC*PROPERTIES***********************&#39;</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">_</span><span class="p">:</span>
                    <span class="n">doc_properties_afterrestore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">))</span>
                    <span class="n">doc_name_afterrestore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*****************COMPARE*DOC*PROPERTIES*******************&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">doc_properties_beforebackup</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;before backup: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc_name_beforebackup</span><span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">doc_properties_afterrestore</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;after restore:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc_name_afterrestore</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">doc_properties_beforebackup</span> <span class="o">==</span> <span class="n">doc_properties_afterrestore</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Document properties do not match&#39;</span><span class="p">)</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> has failed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Document properties match&#39;</span><span class="p">)</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> has passed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;count:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;count:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>

        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;count:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="LNDBHelper.disaster_recovery"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.disaster_recovery">[docs]</a>    <span class="k">def</span> <span class="nf">disaster_recovery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies disaster recovery scenario</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">doc_properties_beforebackup</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">doc_name_beforebackup</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">doc_properties_afterrestore</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">doc_name_afterrestore</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;**************************DISASTER*RECOVERY*SCENARIO****************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;FULL&#39;</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;*******************************CREATE*DOCUMENTS*********************************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">new_dbs_added</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">new_dbs_added</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;add documents&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Total docs for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">]))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;****************************BACKUP*TR*LOG*SUBCLIENT*****************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;incremental&#39;</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***********************COLLECT*DOC*PROPERTIES*************************&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">_</span><span class="p">:</span>
                <span class="n">doc_properties_beforebackup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">))</span>
                <span class="n">doc_name_beforebackup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;************************************DELETE**************************************&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">new_dbs_added</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;delete database&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;removed&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">):</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> removal successful&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> removal unsuccessful&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;***************************SHUT*DOWN*DOMINO*SERVER******************************&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
            <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;console commands&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;exit&#39;</span><span class="p">])</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;********************************CHANGE*NOTES.INI*******************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">edit_notes_ini</span><span class="p">(</span>
            <span class="n">tc</span><span class="p">,</span>
            <span class="s1">&#39;TRANSLOG_RECREATE_LOGCTRL=0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;TRANSLOG_RECREATE_LOGCTRL=1&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;**************************************RENAME*LOGDIR*****************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">rename_logdir</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;*************************************DR*RESTORE*********************************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">common_options_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;disasterRecovery&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;unconditionalOverwrite&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;**********************************BRINGING*UP*DOMINO****************************&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">start_domino</span><span class="p">(</span><span class="n">tc</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Error in Domino recovery. Unable to bring up server.&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wait for 2 mins before further processing&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***********************COLLECT*DOC*PROPERTIES*************************&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">dbs_in_default_after</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">_</span><span class="p">:</span>
                <span class="n">doc_properties_afterrestore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">))</span>
                <span class="n">doc_name_afterrestore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***********************COMPARE*DOC*PROPERTIES*************************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">doc_properties_beforebackup</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;before backup: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc_name_beforebackup</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">doc_properties_afterrestore</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;after restore:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc_name_afterrestore</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">doc_properties_beforebackup</span> <span class="o">!=</span> <span class="n">doc_properties_afterrestore</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Document properties do not match&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> has failed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;DISASTER RECOVERY&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Document properties match&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario </span><span class="si">{}</span><span class="s1"> has passed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;DISASTER RECOVERY&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="LNDBHelper.tr_log_backup_with_indexing"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.tr_log_backup_with_indexing">[docs]</a>    <span class="k">def</span> <span class="nf">tr_log_backup_with_indexing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies tr log backup job with indexing</span>
<span class="sd">        Requires the subclient to be initialized beforehand</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***********************BACKUP*TR*LOG*SUBCLIENT************************&#39;</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="s1">&#39;FULL&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***************SUSPEND*TR*LOG*BACKUP*JOB******************************&#39;</span><span class="p">)</span>
        <span class="n">job</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Will pause job for 30 secs&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;************RESUME*TR*LOG*BACKUP*JOB**********************************&#39;</span><span class="p">)</span>
        <span class="n">job</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***************SUSPEND*TR*LOG*BACKUP*JOB******************************&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">backup</span><span class="p">()</span>
        <span class="n">job</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Will pause job for 30 secs&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***********************RESET*SERVICES*ON*CLIENT***********************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">restart_services</span><span class="p">()</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Services restarted successfully&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;************RESUME*TR*LOG*BACKUP*JOB**********************************&#39;</span><span class="p">)</span>
        <span class="n">job</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">wait_for_job_to_complete</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">dictionary</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;WINDOWS&#39;</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">os_info</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">restore_in_place</span><span class="p">(</span>
                <span class="n">paths</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
                <span class="n">lndb_restore_options</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">lndb_restore_options</span><span class="p">,</span>
                <span class="n">common_options_dict</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">common_options_dict</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TR log jobs cannot be restored independently&quot;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test scenario PASSED&quot;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tried to restore TR logs individually. Test scenario FAILED&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Tried to restore TR logs individually.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LNDBHelper.backup_many_tr_logs"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.backup_many_tr_logs">[docs]</a>    <span class="k">def</span> <span class="nf">backup_many_tr_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies data protection with a large number of tr logs.</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**********************FILL*100*TR*LOG*EXTENTS*************************&#39;</span><span class="p">)</span>
        <span class="n">jstring</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span>
                <span class="p">[{</span>
                    <span class="s2">&quot;template&quot;</span><span class="p">:</span> <span class="s2">&quot;notebook9.ntf&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;numdb&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;numdocs&quot;</span><span class="p">:</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;numlogs&quot;</span><span class="p">:</span> <span class="s2">&quot;100&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;dbname&quot;</span><span class="p">:</span> <span class="s2">&quot;50919&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;trlog&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;del&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
                <span class="p">}]</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;data populator&#39;</span><span class="p">,</span> <span class="n">jstring</span><span class="o">=</span><span class="n">jstring</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
        <span class="n">db_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;New database added: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db_name</span><span class="p">))</span>
        <span class="n">subclient_content</span> <span class="o">=</span> <span class="p">[{</span>
            <span class="s1">&#39;dbiid1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;dbiid2&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;dbiid3&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;dbiid4&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;relativePath&#39;</span><span class="p">:</span> <span class="n">db_name</span><span class="p">,</span>
            <span class="s1">&#39;databaseTitle&#39;</span><span class="p">:</span> <span class="n">db_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nsf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="p">}]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span> <span class="o">+=</span> <span class="n">subclient_content</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
            <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;get document properties&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;50919_1&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Total docs for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;50919_1&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">))))</span>
        <span class="n">doc_count_before</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">))</span>

        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**********************BACKUP*TR*LOG*SUBCLIENT*************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;************************CLEAN*UP*TR*LOG*FOLDER************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span>
                                       <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;console commands&#39;</span><span class="p">,</span>
                                       <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;restart server&#39;</span><span class="p">])</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">check_if_domino_up</span><span class="p">(</span><span class="n">tc</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Failed to turn on Domino Server.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">delete_db_and_validate</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">dbsinsubclient</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;50919_1&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
            <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;get document properties&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;50919_1&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Total docs for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;50919_1&#39;</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">))))</span>
        <span class="n">doc_count_after</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">doc_count_before</span> <span class="o">==</span> <span class="n">doc_count_after</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario PASSED&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario FAILED&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Number of documents before: </span><span class="si">{}</span><span class="s1"> and &#39;</span>
                        <span class="s1">&#39;number of documents after : </span><span class="si">{}</span><span class="s1">. NOT SAME&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">doc_count_before</span><span class="p">,</span>
                <span class="n">doc_count_after</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Number of documents before: </span><span class="si">{}</span><span class="s1"> and &#39;</span>
                            <span class="s1">&#39;number of documents after : </span><span class="si">{}</span><span class="s1">. NOT SAME&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">doc_count_before</span><span class="p">,</span>
                <span class="n">doc_count_after</span><span class="p">))</span></div>

<div class="viewcode-block" id="LNDBHelper.backup_many_databases"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.backup_many_databases">[docs]</a>    <span class="k">def</span> <span class="nf">backup_many_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies data protection with a large number of databases.</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;FULL&#39;</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">new_dbs_added</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dbs_in_default_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">doc_count_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;********************CREATE*1000*DATABASES*****************************&#39;</span><span class="p">)</span>
        <span class="n">jstring</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span>
                <span class="p">[{</span>
                    <span class="s2">&quot;template&quot;</span><span class="p">:</span> <span class="s2">&quot;notebook9.ntf&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;numdb&quot;</span><span class="p">:</span> <span class="s2">&quot;1000&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;numdocs&quot;</span><span class="p">:</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;numlogs&quot;</span><span class="p">:</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;dbname&quot;</span><span class="p">:</span> <span class="s2">&quot;50919&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;trlog&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;del&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span>
                <span class="p">}]</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;data populator&#39;</span><span class="p">,</span> <span class="n">jstring</span><span class="o">=</span><span class="n">jstring</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">new_dbs_added</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nsf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;TOTAL DATABASES IN DEFAULT SUBCLIENT BEFORE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">dbs_in_default_before</span><span class="p">)))</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*******************RUN*BACKUP*DEFAULT*SUBCLIENT***********************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;********************DATABASES*DEFAULT*SUBCLIENT***********************&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lndbcontent</span> <span class="ow">in</span> <span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">database</span> <span class="o">=</span> <span class="n">lndbcontent</span><span class="p">[</span><span class="s1">&#39;lotusNotesDBContent&#39;</span><span class="p">][</span><span class="s1">&#39;databaseTitle&#39;</span><span class="p">]</span>
            <span class="n">dbs_in_default_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;TOTAL DATABASES IN DEFAULT SUBCLIENT AFTER: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">dbs_in_default_before</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_dbs_added</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dbs_in_default_before</span><span class="p">)):</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;New databases found by the default subclient&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;New databases not found by the default subclient&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;New databases not found by the default subclient&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">new_dbs_added</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span>
                <span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;add documents&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">database</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">])</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Total docs for </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">]))</span>
            <span class="n">doc_count_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;docCount&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*******************BACKUP*TR*LOG*SUBCLIENT****************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="s1">&#39;INCREMENTAL&#39;</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*********************CLEAN*UP*TR*LOG*FOLDER***************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">return_result_json</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;console commands&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;restart server&#39;</span><span class="p">])</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">check_if_domino_up</span><span class="p">(</span><span class="n">tc</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Failed to turn on Domino Server.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">delete_db_and_validate</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">dbsinsubclient</span><span class="o">=</span><span class="n">new_dbs_added</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_restore</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">default_subclient</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;*********************COLLECT*DOC*PROPERTIES***************************&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">collect_doc_properties</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">new_dbs_added</span><span class="p">)</span>
        <span class="n">doc_count_after</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">doc_count_before</span> <span class="o">==</span> <span class="n">doc_count_after</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test scenario PASSED&#39;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Document count for the new databases does not match&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;****************CLEAN*UP*EXTRA*DATABASES*CREATED**********************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">delete_db_and_validate</span><span class="p">(</span><span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span> <span class="n">dbsinsubclient</span><span class="o">=</span><span class="n">new_dbs_added</span><span class="p">)</span></div>

<div class="viewcode-block" id="LNDBHelper.osc_schedule_backup"><a class="viewcode-back" href="../../../Application.NotesDatabase.html#Application.NotesDatabase.lndbhelper.LNDBHelper.osc_schedule_backup">[docs]</a>    <span class="k">def</span> <span class="nf">osc_schedule_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Verifies osc scheduler triggered backups.</span>

<span class="sd">            Args:</span>
<span class="sd">                tc  (object)  --  instance of the testcase in operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schedule_pattern</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;schedule_name&quot;</span><span class="p">:</span> <span class="s2">&quot;osc_test_automation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;freq_type&quot;</span><span class="p">:</span> <span class="s2">&quot;automatic&quot;</span><span class="p">,</span>
            <span class="s2">&quot;min_interval_hours&quot;</span><span class="p">:</span> <span class="n">constant</span><span class="o">.</span><span class="n">OSC_MIN_HOURS</span><span class="p">,</span>
            <span class="s2">&quot;min_interval_minutes&quot;</span><span class="p">:</span> <span class="n">constant</span><span class="o">.</span><span class="n">OSC_MIN_MINS</span><span class="p">,</span>
            <span class="s2">&quot;max_interval_hours&quot;</span><span class="p">:</span> <span class="n">constant</span><span class="o">.</span><span class="n">OSC_MAX_HOURS</span><span class="p">,</span>
            <span class="s2">&quot;max_interval_minutes&quot;</span><span class="p">:</span> <span class="n">constant</span><span class="o">.</span><span class="n">OSC_MAX_MINS</span>
        <span class="p">}</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;***********************BACKUP*TR*LOG*SUBCLIENT************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvhelp</span><span class="o">.</span><span class="n">run_backup</span><span class="p">(</span>
            <span class="n">testcase</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INCREMENTAL&#39;</span><span class="p">,</span>
            <span class="n">sc</span><span class="o">=</span><span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="p">,</span>
            <span class="n">schedule_pattern</span><span class="o">=</span><span class="n">schedule_pattern</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">schedules</span><span class="o">.</span><span class="n">has_schedule</span><span class="p">(</span><span class="s2">&quot;osc_test_automation&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Schedule not set. Test scenario failed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Schedule creation successful&#39;</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">restart_services</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">constant</span><span class="o">.</span><span class="n">OSC_MAX_MINS</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">job_dict</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">job_controller</span><span class="o">.</span><span class="n">all_jobs</span><span class="p">(</span><span class="n">lookup_time</span><span class="o">=</span><span class="n">constant</span><span class="o">.</span><span class="n">OSC_MAX_MINS</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">job_dict</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">job_controller</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">job_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;jobDetail&#39;</span><span class="p">][</span><span class="s1">&#39;generalInfo&#39;</span><span class="p">][</span><span class="s1">&#39;jobStartedFrom&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Scheduled&#39;</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job ran successfully&#39;</span><span class="p">)</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Test Scenario PASSED&#39;</span><span class="p">)</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">pass_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">schedules</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;osc_test_automation&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;osc_test_automation&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Schedule has not triggered the job. Test scenario FAILED&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">trlogsubclient</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;osc_test_automation&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Schedule has not triggered the job. Test scenario FAILED&#39;</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Commvault Systems® Inc. All Rights Reserved.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>