

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>FileSystem.SNAPUtils.snaphelper &mdash; Commvault Automation 11.24 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Commvault Automation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Commvault Automation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>FileSystem.SNAPUtils.snaphelper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for FileSystem.SNAPUtils.snaphelper</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;Helper file for performing IntelliSnap operations</span>

<span class="sd">SNAPHelper is the only class defined in this file</span>

<span class="sd">SNAPHelper: Helper class to perform IntelliSnap operations</span>

<span class="sd">SNAPHelper:</span>
<span class="sd">    __init__()                   --  initializes Snap helper object</span>

<span class="sd">    setup()                      --  Setup function which calls create_locations() and</span>
<span class="sd">                                     create_snap_environment()</span>

<span class="sd">    create_locations()           --  Create MountPath, Restore and DisKlibrary Locations</span>
<span class="sd">                                     if does not exists</span>

<span class="sd">    create_snap_copy()           --  wrapper for creating snap, snapvault, snapmirror, replica,</span>
<span class="sd">                                     and replica mirror copies</span>

<span class="sd">    create_secondary_snap_copy()       --  creates snapvault, snapmirror, replica,</span>
<span class="sd">                                     and replica mirror copies</span>

<span class="sd">    create_snap_environment()    --  includes Add Array, Enabling IntelliSnap at Subclient</span>
<span class="sd">                                     Create Library, Storage Policy, Snap Copy, Aux Copy, BackupSet</span>
<span class="sd">                                     Subclient, set content and Enable IntelliSnap on it,</span>
<span class="sd">                                     add test data folder to subclient content</span>

<span class="sd">    kill_job()                   --  Starts a SnapBackup job and kills it after Snap Phase</span>
<span class="sd">                                     completes and adds the job in to</span>
<span class="sd">                                     Job_Tracker to check while DA validation</span>

<span class="sd">    suspend_job()                --  Suspends a snap Backup/ backup copy/restore/ aux copy job</span>
<span class="sd">    resume_job()                 --  Resumes a suspended job</span>

<span class="sd">    delete_copy()                --  deletes storage policy copy</span>

<span class="sd">    snap_backup()                --  Runs SnapBackup based on the following inputs</span>
<span class="sd">                                     if only inlinebkpcpy is True, Runs Backup with Catalog and</span>
<span class="sd">                                     inline backup copy</span>
<span class="sd">                                     if only skipCatalog is True, Runs Backup with Skip Catalog</span>
<span class="sd">                                     if Both inlinebkpcpy, skipCatalog are True, Runs Backup with</span>
<span class="sd">                                     skip catalog and inline backup copy</span>
<span class="sd">                                     if Both inlinebkpcpy, skipCatalog are False, Runs Backup with</span>
<span class="sd">                                     Catalog, Also if inline is true, monitors backup copy job.</span>

<span class="sd">    snap_outplace()              --  OutPlace Restore from Snap copy</span>

<span class="sd">    snap_inplace()               --  Inplace Restore from Snap copy</span>

<span class="sd">    time_formattor()             --  Takes job times as input and Formats it for Browse</span>

<span class="sd">    snap_inplace_validation()    --  Validate inplace restored content from snap by</span>
<span class="sd">                                     mounting the snapshot</span>

<span class="sd">    snap_outplace_validation()   --  Validate outplace restored content from snap with</span>
<span class="sd">                                     subclient content</span>

<span class="sd">    compare()                    --  Compares two directories</span>

<span class="sd">    tape_outplace()              --  Outplace Restore from tape copy</span>

<span class="sd">    tape_inplace()               --  Inplace restore from tape copy</span>

<span class="sd">    tape_outplace_validation()   --  Validate outplace restored content with the subclient content</span>

<span class="sd">    tape_inplace_validation()    --  Validate inplace restored content</span>

<span class="sd">    mount_snap()                 --  Mounts Snap of the given job_id and Copy</span>

<span class="sd">    unmount_snap()               --  UnMounts Snap of the given job_id and Copy</span>

<span class="sd">    revert_snap()                --  Reverts Snap of the given job_id and Copy</span>

<span class="sd">    delete_snap()                --  Deletes Snap of the given job_id and Copy</span>

<span class="sd">    force_delete_snap()          --  Force Deletes Snap of the given job id and Copy</span>

<span class="sd">    mount_validation()           --  Validates mounted snap with subclient content</span>

<span class="sd">    unmount_validation()         --  Validates if snap is unmounted</span>

<span class="sd">    revert_validation()          --  Validates reverted snap by mounting the snap</span>

<span class="sd">    delete_validation()          --  Validates if the snap is deleted</span>

<span class="sd">    unmount_status()             --  checks if the snap is unmounted</span>

<span class="sd">    update_storage_policy()      --  Method for Updating Backup copy and Snapshot Catalog options</span>

<span class="sd">    backup_copy()                --  Runs Offline backup copy for the given storage policy</span>

<span class="sd">    snapshot_cataloging()        --  Runs Offline Snapshot Cataloging for the given storage policy</span>

<span class="sd">    aux_copy()                   --  Runs Aux copy for the given storage policy and copy</span>

<span class="sd">    data_aging()                 --  Runs Data aging for the given storage policy and copy</span>

<span class="sd">    get_volumeid_list()          --  Fetches jobid&#39;s for the snap copy</span>

<span class="sd">    data_aging_validation()      --  Validates Pruning of Snap jobs</span>

<span class="sd">    clean_snap_environment()     --  includes disable intellisnap at subclient, delete subclient,</span>
<span class="sd">                                     backupset, auxcopy, snapcopy, storage policy, library,</span>
<span class="sd">                                     disable intellisnap at client and delete array</span>

<span class="sd">    clear_locations()            --  Deletes MountPath, Restores and DiskLibrary locations</span>

<span class="sd">    cleanup()                    --  Calls clean_snap_environment() and clear_locations()</span>

<span class="sd">    add_array()                  --  To add array in the array management</span>

<span class="sd">    delete array()               --  To delete array entry from the array managament</span>

<span class="sd">    spcopy_obj()                 --  Creates storage policy Copy Object</span>

<span class="sd">    remove_subclient_content()   --  deletes data under subclient content</span>

<span class="sd">    vplex_snap_validation()      --  snap validation on VPLEX Metro cluster</span>

<span class="sd">    svm_association()            --  Add SVM association to Replica Copy for Netapp Open Replication</span>

<span class="sd">    update_mmconfig()            --  Updates MMConfig MM config &#39;MMCONFIG_ARCHGROUP_CLEANUP_INTERVAL_MINUTES&#39;</span>
<span class="sd">                                     with provided value</span>

<span class="sd">    run_pruning()                --  Runs data aging for the given storage policy and copy and</span>
<span class="sd">                                     waits for the snaps to prune</span>

<span class="sd">    edit_array()                 --  Method to Update Snap Configuration and array Controller for</span>
<span class="sd">                                     the given array</span>

<span class="sd">    update_test_data()           --  Method to edit and delete test data</span>

<span class="sd">    delete_bkpcpy_schedule()     --  delete backup copy schedule as it interferes with the</span>
<span class="sd">                                     test case flow</span>

<span class="sd">    disable_auxcpy_schedule()    --  disable Auxilliary copy schedule policy as it interferes</span>
<span class="sd">                                     with the test case flow</span>

<span class="sd">    snap_extent_template()       -- Template to run extent cases for intellisnap</span>

<span class="sd">    verify_extentbased_subclient()      -- Verify all the extents are backed up from source_list</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.machine</span> <span class="kn">import</span> <span class="n">Machine</span>
<span class="kn">from</span> <span class="nn">AutomationUtils</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="kn">import</span> <span class="n">OptionsSelector</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.options_selector</span> <span class="kn">import</span> <span class="n">CVEntities</span>
<span class="kn">from</span> <span class="nn">AutomationUtils.idautils</span> <span class="kn">import</span> <span class="n">CommonUtils</span>
<span class="kn">from</span> <span class="nn">cvpysdk.job</span> <span class="kn">import</span> <span class="n">Job</span>
<span class="kn">from</span> <span class="nn">cvpysdk.policies.storage_policies</span> <span class="kn">import</span> <span class="n">StoragePolicyCopy</span>
<span class="kn">from</span> <span class="nn">cvpysdk.exception</span> <span class="kn">import</span> <span class="n">SDKException</span>
<span class="kn">from</span> <span class="nn">cvpysdk.schedules</span> <span class="kn">import</span> <span class="n">Schedules</span>


<div class="viewcode-block" id="SNAPHelper"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper">[docs]</a><span class="k">class</span> <span class="nc">SNAPHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class to perform snap operations&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commcell</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">tcinputs</span><span class="p">,</span> <span class="n">snapconstants</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes Snaphelper object and gets the commserv database object if not specified</span>

<span class="sd">            Args:</span>
<span class="sd">                commcell        (object)    --  commcell object</span>

<span class="sd">                client          (object)    --  client object</span>

<span class="sd">                agent           (object)    --  agent object</span>

<span class="sd">                tcinputs        (dict)      --  Test case inputs dictionary</span>

<span class="sd">                snapconstants   (object)    --  snapconstants object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span> <span class="o">=</span> <span class="n">snapconstants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span> <span class="o">=</span> <span class="n">commcell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schedules</span> <span class="o">=</span> <span class="n">Schedules</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="n">agent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span> <span class="o">=</span> <span class="n">tcinputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span> <span class="o">=</span> <span class="n">OptionsSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span> <span class="o">=</span> <span class="n">CVEntities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commonutils</span> <span class="o">=</span> <span class="n">CommonUtils</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">commonutils</span><span class="o">.</span><span class="n">check_client_readiness</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ClientName&#39;</span><span class="p">]]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Check readiness for the Client and Media Agent successful&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SNAPHelper.pre_cleanup"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.pre_cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">pre_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pre cleanup to clean up the failed/stale entries of snapshots, Index server,  Backupset and Storage policies &quot;&quot;&quot;</span>
        <span class="c1"># Unmount the snaps which are in mounted status.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting pre cleanup of the entities like Stale snaps, SP, Backupset and libraries.&quot;</span><span class="p">)</span>
            <span class="n">sp_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">sp_name</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;59&#39;</span><span class="p">},</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_sp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Going to unmount the snaps if snaps are in mounted state. </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp_list</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sp_list</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unmount_snap</span><span class="p">(</span><span class="n">sp_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">sp_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;unmounted snapshots: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sp_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unmount of snaps failed with error&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

            <span class="c1"># Delete the snaps which are in failed to delete status</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Going to delete the snaps&quot;</span><span class="p">)</span>
            <span class="n">delete_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">sp_name</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">79</span><span class="p">},</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_sp</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">delete_status</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_snap</span><span class="p">(</span><span class="n">delete_status</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">delete_status</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleted snapshots: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sp_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deletion of snapshots failed with error&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

            <span class="c1"># Delete the Index server which exist due to previous failed test cases</span>
            <span class="n">indexserver_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_indexserver_list</span><span class="p">,</span>
                                                                <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">indexserver_name</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">indexserver_list</span> <span class="ow">in</span> <span class="p">[[[]],</span> <span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to delete any Indexserver, query returned none.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Going to delete the  Indexserver: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">indexserver_list</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Going to delete the  Indexserver&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">indexserver</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indexserver_list</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">indexserver_list</span><span class="p">[</span><span class="n">indexserver</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleted Indexserver: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">indexserver_list</span><span class="p">[</span><span class="n">indexserver</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Indexserver deletion failed with error </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">error</span><span class="p">,</span> <span class="n">indexserver</span><span class="p">)</span>

            <span class="c1"># Delete the backupsets which exist due to previous failed test cases</span>
            <span class="n">bkpset_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_bkpset_list</span><span class="p">,</span>
                                                           <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">bkpset_name</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">bkpset_list</span> <span class="ow">in</span> <span class="p">[[[]],</span> <span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to delete any backupset, query returned none.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Going to delete the  backupset: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bkpset_list</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Going to delete the  backupset&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bkpset_list</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">backupsets</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">bkpset_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleted bkpset: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">bkpset_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;backupset deletion failed with error&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># Delete the storage policies which exist due to previous failed test cases.</span>
            <span class="n">sp_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_sp_list</span><span class="p">,</span>
                                                       <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">sp_name</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">sp_list</span> <span class="ow">in</span> <span class="p">[[[]],</span> <span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to delete Storage policies, query returned none&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Going to delete Storage policies: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp_list</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sp_list</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">storage_policies</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">sp_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleted storage policy: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sp_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;storage policy deletion failed with error&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># Delete the libraries which exist due to previous failed test cases.</span>
            <span class="n">lib_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_lib_list</span><span class="p">,</span>
                                                        <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">lib_name</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;lib list: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lib_list</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">lib_list</span> <span class="ow">in</span> <span class="p">[[[]],</span> <span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to delete libraries, query returned none.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Going to delete libraries:</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lib_list</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lib_list</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">disk_libraries</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">lib_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleted libraries: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">lib_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;library deletion failed with error : </span><span class="si">{0}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pre cleanup task has finished&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.setup"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Setup function to create locations and snap entities &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_locations</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">sc_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attempt_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">attempt_count</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">:</span>
                <span class="n">attempt_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_environment</span><span class="p">()</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Creation of Snap Environment failed with error: </span><span class="si">{0}</span><span class="s2">, &quot;&quot;&quot;</span>
                                  <span class="sd">&quot;&quot;&quot;will retry after 90 seconds, Retry Count: {1}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">e</span><span class="p">,</span> <span class="n">attempt_count</span><span class="p">))</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">attempt_count</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Failed with error: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;***Not creating the snap entities as the test case is run on Existing</span><span class="se">\</span>
<span class="s2">                          subclient***&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.create_locations"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.create_locations">[docs]</a>    <span class="k">def</span> <span class="nf">create_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clean subclient content if exists and create new one</span>
<span class="sd">            Create restore location</span>
<span class="sd">            Create Mountpath</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_engine_at_array</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span>
                                                                                                                   <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_engine_at_subclient</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Create Restore Location</span>
        <span class="n">Restores</span> <span class="o">=</span> <span class="s2">&quot;Restores_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_location</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="se">\\</span><span class="si">{1}</span><span class="se">\\</span><span class="si">{2}</span><span class="se">\\</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_automation_output</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">Restores</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;snap restore location: </span><span class="si">{0}</span><span class="s2"> exists, cleaning it and creating new folder&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;snap restore location does not exists, creating one! &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Created restore location : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Create MountPath Location</span>
        <span class="n">mount_path</span> <span class="o">=</span> <span class="s2">&quot;MountPath_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="se">\\</span><span class="si">{1}</span><span class="se">\\</span><span class="si">{2}</span><span class="se">\\</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_automation_output</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">mount_path</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Mount path location: </span><span class="si">{0}</span><span class="s2"> exists, cleaning it and creating new folder&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_path</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mountpath location does not exists, creating one! &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Created Mount path location : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_path</span><span class="p">))</span>

        <span class="c1"># Create DiskLibrary Location</span>
        <span class="n">dsik_library</span> <span class="o">=</span> <span class="s2">&quot;DiskLibrary_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib_loc</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="se">\\</span><span class="si">{1}</span><span class="se">\\</span><span class="si">{2}</span><span class="se">\\</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_automation_output</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">dsik_library</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib_loc</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Disk library location: </span><span class="si">{0}</span><span class="s2"> exists, Not creating!!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib_loc</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disk library location does not exists, creating one! &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib_loc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Created Disk Library location : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib_loc</span><span class="p">)</span>
            <span class="p">)</span></div>

    <span class="c1"># Adding array management entry</span>
<div class="viewcode-block" id="SNAPHelper.add_array"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.add_array">[docs]</a>    <span class="k">def</span> <span class="nf">add_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to Add Hardware Array in to the Array Management</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding array management entry for : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">))</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">add_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_engine_at_array</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">controlhost</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">array_access_nodes_to_add</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">is_ocum</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully added the Array with ControlHost id: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error_message</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">SDKException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">exception_id</span> <span class="o">==</span> <span class="s1">&#39;101&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">exception_message</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.create_snap_copy"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.create_snap_copy">[docs]</a>    <span class="k">def</span> <span class="nf">create_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">copy_name</span><span class="p">,</span>
                         <span class="n">is_mirror_copy</span><span class="p">,</span>
                         <span class="n">is_snap_copy</span><span class="p">,</span>
                         <span class="n">library_name</span><span class="p">,</span>
                         <span class="n">media_agent_name</span><span class="p">,</span>
                         <span class="n">source_copy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">provisioning_policy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">resource_pool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">is_replica_copy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; includes adding Snap Copy, Snapvault Copy, SnapMirror Copy, Replica/Vault Copy,</span>
<span class="sd">            Replica Mirror Copy etc</span>
<span class="sd">            Args:</span>
<span class="sd">                copy_name           (str)       -- Copy Name to create</span>

<span class="sd">                is_mirror_copy      (bool)      -- Creates Mirror Copy if true</span>

<span class="sd">                is_snap_copy        (bool)      -- Creates Snap Copy if true</span>

<span class="sd">                library_name        (str)       -- library name for creating copy</span>

<span class="sd">                media_agent_name    (str)       -- Media Agent name for creating copy</span>

<span class="sd">                source_copy         (str)       -- Source Copy for the Copy</span>
<span class="sd">                default: None</span>

<span class="sd">                provisioning_policy (str)       -- Provisioning Policy Name for the Vault/Mirror</span>
<span class="sd">                                                   Copy</span>
<span class="sd">                default: None</span>

<span class="sd">                resource_pool       (str)       -- Resource Pool for the Vault/Mirror Copy</span>
<span class="sd">                default: None</span>

<span class="sd">                is_replica_copy     (bool)      -- Creates Replica Copy if true</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">has_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storage policy : </span><span class="si">{0}</span><span class="s2"> already has copy named : </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copy with name </span><span class="si">{0}</span><span class="s2"> does not exists, Creating one!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">copy_name</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span>
                                                               <span class="n">is_mirror_copy</span><span class="p">,</span>
                                                               <span class="n">is_snap_copy</span><span class="p">,</span>
                                                               <span class="n">library_name</span><span class="p">,</span>
                                                               <span class="n">media_agent_name</span><span class="p">,</span>
                                                               <span class="n">source_copy</span><span class="p">,</span>
                                                               <span class="n">provisioning_policy</span><span class="p">,</span>
                                                               <span class="n">resource_pool</span><span class="p">,</span>
                                                               <span class="n">is_replica_copy</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.create_secondary_snap_copy"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.create_secondary_snap_copy">[docs]</a>    <span class="k">def</span> <span class="nf">create_secondary_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">source_copy</span><span class="p">,</span>
                                   <span class="n">snapvault</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">snapmirror</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">replica_vault</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates Snapvault, Snapmirror, Replica Vault and Replica Mirror Copies</span>
<span class="sd">            Agrs:</span>
<span class="sd">                source_copy     (str)     -- Source copy for the copy</span>

<span class="sd">                snapvault       (bool)    -- creates snapvault copy if true</span>

<span class="sd">                snapmirror      (bool)    -- creates snapmirror copy if true</span>

<span class="sd">                replica_vault   (bool)    -- creates replica vault copy if true</span>

<span class="sd">                replica_mirror  (bool)    -- creates replica mirror copy if true</span>
<span class="sd">            Returns:</span>
<span class="sd">                copy name       (string)  -- Newly created Copy Name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_snap</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">snapmirror</span> <span class="ow">or</span> <span class="n">replica_mirror</span><span class="p">:</span>
            <span class="n">is_mirror</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_mirror</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">snapvault</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating SnapVault copy&quot;</span><span class="p">)</span>
            <span class="n">copy_name</span> <span class="o">=</span> <span class="s2">&quot;Vault&quot;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span> <span class="n">is_mirror</span><span class="p">,</span>
                                  <span class="n">is_snap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib</span><span class="o">.</span><span class="n">library_name</span><span class="p">,</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">]),</span> <span class="n">source_copy</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">prov_policy_vault</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">resource_pool_vault</span>
                                  <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created SnapVault Copy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">snapmirror</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating SnapMirror copy&quot;</span><span class="p">)</span>
            <span class="n">copy_name</span> <span class="o">=</span> <span class="s2">&quot;Mirror&quot;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span> <span class="n">is_mirror</span><span class="p">,</span> <span class="n">is_snap</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib</span><span class="o">.</span><span class="n">library_name</span><span class="p">,</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">]),</span> <span class="n">source_copy</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">prov_policy_mirror</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">resource_pool_mirror</span>
                                  <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created SnapMirror Copy : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pmm&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">resource_pool_pmm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">resource_pool_mirror</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">resource_pool_pmm</span>

        <span class="k">elif</span> <span class="n">replica_vault</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating Replica/vault copy&quot;</span><span class="p">)</span>
            <span class="n">copy_name</span> <span class="o">=</span> <span class="s2">&quot;Replica_Vault&quot;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span> <span class="n">is_mirror</span><span class="p">,</span> <span class="n">is_snap</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib</span><span class="o">.</span><span class="n">library_name</span><span class="p">,</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">]),</span> <span class="n">source_copy</span><span class="p">,</span>
                                  <span class="n">is_replica_copy</span><span class="o">=</span><span class="kc">True</span>
                                  <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created Replica/Vault Copy : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating Replica Mirror copy&quot;</span><span class="p">)</span>
            <span class="n">copy_name</span> <span class="o">=</span> <span class="s2">&quot;Replica_Mirror&quot;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span> <span class="n">is_mirror</span><span class="p">,</span> <span class="n">is_snap</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib</span><span class="o">.</span><span class="n">library_name</span><span class="p">,</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">]),</span> <span class="n">source_copy</span><span class="p">,</span>
                                  <span class="n">is_replica_copy</span><span class="o">=</span><span class="kc">True</span>
                                  <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created Replica/Mirror Copy : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">copy_name</span></div>

<div class="viewcode-block" id="SNAPHelper.create_snap_environment"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.create_snap_environment">[docs]</a>    <span class="k">def</span> <span class="nf">create_snap_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; includes Add Array, Enabling IntelliSnap at Client, Create Library, Storage Policy,</span>
<span class="sd">        Snap Copy, Aux Copy,BackupSet, Subclient and Enable IntelliSnap on it, Set Retention</span>
<span class="sd">        Snap Copy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Enable Intellisnap at client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enabling Intellisnap on client: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">enable_intelli_snap</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Enabled Intellisnap on client: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">entity_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;subclient&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;disklibrary&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>

        <span class="c1"># Create Snap Copy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;This is OCUM SP, Not creating Snap primary Copy&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span> <span class="o">=</span> <span class="s2">&quot;Primary&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Snap copy&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib</span><span class="o">.</span><span class="n">library_name</span><span class="p">,</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">])</span>
                                  <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully created Snap Copy &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_bkpcpy_schedule</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pv&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for PV Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">snapvault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pm&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for PM Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">snapmirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pvm&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for PVM Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">snapvault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="n">snapmirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pmv&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for PMV Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">snapmirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="n">snapvault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pmm&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for PMM Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">snapmirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="n">snapmirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pv_replica&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for PV_Replica Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">replica_vault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_engine_at_array</span> <span class="o">==</span> <span class="s2">&quot;NetApp&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Since Vendor is non-Netapp, Not Updating SVM association&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_auxcpy_schedule</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pm_replica&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for PM_Replica Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_auxcpy_schedule</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pvm_replica&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for PVM_Replica Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">replica_vault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName3&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_auxcpy_schedule</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pmv_replica&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for PMV_Replica Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="n">replica_vault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName3&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_auxcpy_schedule</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pmm_replica&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for PMM_Replica Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName3&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_auxcpy_schedule</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pvv_replica&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for PVV_Replica Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">replica_vault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">,</span> <span class="n">replica_vault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName3&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_auxcpy_schedule</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;fanout&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for OCUM FanOut Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for Open Replication FanOut Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_count_pv</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span><span class="p">:</span>
                    <span class="n">copy_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span>
                                                                <span class="n">snapvault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">copy_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">replica_vault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_vault</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Successfully created: </span><span class="si">{0}</span><span class="s2"> Vault copies for FANOUT config&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_count_pv</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_count_pm</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span><span class="p">:</span>
                    <span class="n">copy_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span>
                                                                <span class="n">snapmirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">copy_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="n">copy_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_mirror</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Successfully created: </span><span class="si">{0}</span><span class="s2"> Mirror copies for FANOUT config&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_count_pm</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_auxcpy_schedule</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for OCUM All copies Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
                <span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span>
                                                     <span class="n">snapvault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_vault</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>
                <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span>
                                                     <span class="n">snapmirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_mirror</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>
                <span class="n">pmv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="n">pm</span><span class="p">,</span> <span class="n">snapvault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_vault</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmv</span><span class="p">)</span>
                <span class="n">pvm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="n">pv</span><span class="p">,</span> <span class="n">snapmirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_mirror</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pvm</span><span class="p">)</span>
                <span class="n">pm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span> <span class="n">snapmirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_mirror</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pm1</span><span class="p">)</span>
                <span class="n">pmm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="n">pm1</span><span class="p">,</span> <span class="n">snapmirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_mirror</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Successfully Created Copies for OCUM All copies Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Creating Copies for Open Replication All copies Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
                <span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span>
                                                     <span class="n">replica_vault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="n">pv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_vault</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>
                <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span>
                                                     <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="n">pm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_mirror</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>
                <span class="n">pmv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="n">pm</span><span class="p">,</span> <span class="n">replica_vault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="n">pmv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName3&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_vault</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmv</span><span class="p">)</span>
                <span class="n">pvm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="n">pv</span><span class="p">,</span> <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="n">pvm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName3&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_mirror</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pvm</span><span class="p">)</span>
                <span class="n">pm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span>
                                                      <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="n">pm1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_mirror</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pm1</span><span class="p">)</span>
                <span class="n">pmm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="n">pm1</span><span class="p">,</span> <span class="n">replica_mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="n">pmm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName3&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_mirror</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmm</span><span class="p">)</span>
                <span class="n">pv1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span>
                                                      <span class="n">replica_vault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="n">pv1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_vault</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pv1</span><span class="p">)</span>
                <span class="n">pvv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_secondary_snap_copy</span><span class="p">(</span><span class="n">pv1</span><span class="p">,</span> <span class="n">replica_vault</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svm_association</span><span class="p">(</span><span class="n">pvv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName2&#39;</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;ArrayName3&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fanout_copies_vault</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pvv</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Successfully Created Copies for Open Replication All copies Configuration&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disable_auxcpy_schedule</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Not creating any replica copies&quot;</span><span class="p">)</span>

        <span class="c1"># Enabling Intellisnap on subclient and setting Snap engine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enabling Intellisnap on subclient: </span><span class="si">{0}</span><span class="s2"> and setting Snap engine: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_engine_at_subclient</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">proxy_options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;snap_proxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">],</span>
            <span class="s1">&#39;backupcopy_proxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">],</span>
            <span class="s1">&#39;use_source_if_proxy_unreachable&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">enable_intelli_snap</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_engine_at_subclient</span><span class="p">,</span> <span class="n">proxy_options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Enabled Intellisnap on subclient: </span><span class="si">{0}</span><span class="s2"> and set Snap engine: </span><span class="si">{1}</span><span class="se">\</span>
<span class="s2">                      &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_engine_at_subclient</span><span class="p">)</span>
                      <span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.delete_bkpcpy_schedule"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.delete_bkpcpy_schedule">[docs]</a>    <span class="k">def</span> <span class="nf">delete_bkpcpy_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;delete backup copy schedule as it interferes with the test case flow&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">schedules</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">schedule_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span> <span class="o">+</span> <span class="s1">&#39; snap copy&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedules</span><span class="o">.</span><span class="n">has_schedule</span><span class="p">(</span><span class="n">schedule_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting backup copy schedule :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schedule_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedules</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">schedule_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Deleted backup copy schedule :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schedule_name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Schedule with name: </span><span class="si">{0}</span><span class="s2"> does not exists&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schedule_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.disable_auxcpy_schedule"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.disable_auxcpy_schedule">[docs]</a>    <span class="k">def</span> <span class="nf">disable_auxcpy_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;disable Auxilliary copy schedule policy as it interferes with the test case flow&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">schedule_policies</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">schedule_policy_name</span> <span class="o">=</span> <span class="s1">&#39;System Created Autocopy schedule&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disabling Auxilliary copy schedule policy :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">schedule_policy_name</span><span class="p">))</span>
        <span class="n">schedule_policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">schedule_policies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schedule_policy_name</span><span class="p">)</span>
        <span class="n">schedule_policy</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;successfully disabled schedule policy :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schedule_policy_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.add_test_data_folder"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.add_test_data_folder">[docs]</a>    <span class="k">def</span> <span class="nf">add_test_data_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add Test data folder on the subclient content</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Read subclient content&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Subclient Content: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">drive</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">drive</span> <span class="o">+</span> <span class="s2">&quot;TestData&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">drive</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">TestData&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;test data folder  is  </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;TestData Folder already exists under </span><span class="si">{0}</span><span class="s2">, deleting it and creating&quot;</span>
                    <span class="s2">&quot; new one!!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;TestData Folder does not exists under </span><span class="si">{0}</span><span class="s2">, creating one!!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created TestData Folder under </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">drive</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">test_data_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.svm_association"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.svm_association">[docs]</a>    <span class="k">def</span> <span class="nf">svm_association</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">,</span> <span class="n">source_array</span><span class="p">,</span> <span class="n">target_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to Update SVM association for Netapp Open Replication</span>
<span class="sd">        Args:</span>
<span class="sd">            copy_name       (str)   --  Copy name for the update</span>

<span class="sd">            source_array    (str)   --  Source Array Name</span>

<span class="sd">            target_array    (str)   --  Target Array Name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding SVM association&quot;</span><span class="p">)</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="n">src_array_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_controlhost_id</span><span class="p">,</span>
                                                        <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">source_array</span><span class="p">},</span> <span class="n">fetch_rows</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">)</span>
        <span class="n">tgt_array_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_controlhost_id</span><span class="p">,</span>
                                                        <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">target_array</span><span class="p">},</span> <span class="n">fetch_rows</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">)</span>
        <span class="n">spcopy</span><span class="o">.</span><span class="n">add_svm_association</span><span class="p">(</span><span class="n">src_array_id</span><span class="p">,</span> <span class="n">source_array</span><span class="p">,</span> <span class="n">tgt_array_id</span><span class="p">,</span> <span class="n">target_array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully added SVM association to copy : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.delete_copy"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.delete_copy">[docs]</a>    <span class="k">def</span> <span class="nf">delete_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes Copy</span>
<span class="sd">            Args:</span>
<span class="sd">                string  : copy_name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleting  copy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">delete_secondary_copy</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully deleted  copy : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.suspend_job"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.suspend_job">[docs]</a>    <span class="k">def</span> <span class="nf">suspend_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Suspends SnapBackup/backup copy/ aux copy job</span>
<span class="sd">                Returns:</span>
<span class="sd">                        object : job Object</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;job is completed before suspending it&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Suspending job </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="n">job</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">wait_count</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">while</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;suspended&#39;</span> <span class="ow">and</span> <span class="n">wait_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">is_finished</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job is completed&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;will check the suspend status after 20 seconds&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">wait_count</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;suspended&#39;</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job status is </span><span class="si">{0}</span><span class="s2"> after suspending, we did not get the suspended job&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;completed&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job is completed while suspending, continuing..&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully suspended the job  :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.resume_job"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.resume_job">[docs]</a>    <span class="k">def</span> <span class="nf">resume_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Resumes a job</span>
<span class="sd">                Returns:</span>
<span class="sd">                        object : job Object</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;suspended&#39;</span><span class="p">,</span> <span class="s1">&#39;pending&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;job status </span><span class="si">{0}</span><span class="s2">, Can not resume it&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="n">job</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">wait_count</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">while</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting&#39;</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wait_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;pending&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job went to pending Post resume, resuming it again&quot;</span><span class="p">)</span>
                <span class="n">job</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;will check the resume status after 10 seconds&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">wait_count</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting&#39;</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job status: </span><span class="si">{0}</span><span class="s2"> after resuming, hence raising exception.&quot;</span>
                            <span class="s2">&quot; Reason: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully resumed the job:</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.run_suspend_resume"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.run_suspend_resume">[docs]</a>    <span class="k">def</span> <span class="nf">run_suspend_resume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">phases</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Suspends and resumes the job in each phase</span>
<span class="sd">        Args:</span>
<span class="sd">            job: obj: Job object</span>
<span class="sd">            phases: list: list of phases(in str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">phases</span><span class="p">:</span>
                <span class="n">attempt</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">skip_suspend</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">total_wait_attempts</span> <span class="o">=</span> <span class="mi">180</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">phase</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s1">&#39;Waiting for job [</span><span class="si">{0}</span><span class="s1">] to come to [</span><span class="si">{1}</span><span class="s1">] phase. Current phase [</span><span class="si">{2}</span><span class="s1">]. &#39;</span>
                        <span class="s1">&#39;Attempt [</span><span class="si">{3}</span><span class="s1">/</span><span class="si">{4}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span> <span class="n">attempt</span><span class="p">,</span> <span class="n">total_wait_attempts</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sleeping for 10 seconds&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">is_finished</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job already finished while waiting for phase&#39;</span><span class="p">)</span>
                        <span class="k">return</span>
                    <span class="k">if</span> <span class="n">phases</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">phases</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">phase</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Phase [</span><span class="si">{0}</span><span class="s1">] has already completed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phase</span><span class="p">))</span>
                        <span class="n">skip_suspend</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                    <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">total_wait_attempts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting&#39;</span><span class="p">]:</span>
                            <span class="n">total_wait_attempts</span> <span class="o">=</span> <span class="mi">270</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Attempts exhausted while waiting for the job to come to the&#39;</span>
                                            <span class="s1">&#39; required phase. Please check the Job details,&#39;</span>
                                            <span class="s1">&#39;reason :</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">pending_reason</span><span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_suspend</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Suspending in phase: </span><span class="si">{</span><span class="n">phase</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">suspend_job</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sleeping for 60 seconds before resuming job&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resume_job</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job has already completed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.kill_job"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.kill_job">[docs]</a>    <span class="k">def</span> <span class="nf">kill_job</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Kills SnapBackup job</span>
<span class="sd">            Returns:</span>
<span class="sd">                    object : job Object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">advanced_option</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;inline_bkp_cpy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">inline_bkp_cpy</span><span class="p">,</span>
            <span class="s1">&#39;skip_catalog&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">skip_catalog</span>
        <span class="p">}</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span>
                                                  <span class="n">advanced_options</span><span class="o">=</span><span class="n">advanced_option</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sleeping for 10 seconds for job to start&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;failed to start&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job is failed or failed to start, Please rerun the test case&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;successfully started </span><span class="si">{0}</span><span class="s2"> job :</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span>
                                                                 <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;killing the job </span><span class="si">{0}</span><span class="s2"> to verify snap cleanup&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">while</span> <span class="n">job</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">phase</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;will check the phase status after 10 seconds&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;pending&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;job is in pending state with reason </span><span class="si">{0}</span><span class="s2">, killing it and raising</span>
<span class="s2">                              the exception, please check the logs!&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">pending_reason</span><span class="p">))</span>
                <span class="n">job</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;job is in pending state with reason </span><span class="si">{0}</span><span class="s2">, killing it and raising</span><span class="se">\</span>
<span class="s2">                              the exception, please check the logs and rerun the test case!</span><span class="se">\</span>
<span class="s2">                              &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">pending_reason</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;completed&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;job is completed before killing it hence raising the exception,</span>
<span class="s2">                              please rerun the test case&quot;&quot;&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;job is completed before killing it hence raising the exception,</span>
<span class="s2">                              please rerun the test case&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snap phase completed, killing the job now&quot;</span><span class="p">)</span>
        <span class="n">job</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;killed&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;will check the killed status after 10 seconds&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;completed&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job status is failed or completed, we did not get the killed job&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully killed the job :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">job_tracker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job</span></div>

<div class="viewcode-block" id="SNAPHelper.update_test_data"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.update_test_data">[docs]</a>    <span class="k">def</span> <span class="nf">update_test_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to edit or delete the test data</span>
<span class="sd">        Args:</span>
<span class="sd">            mode      --  mode values can be &#39;add&#39;,&#39;edit&#39;,&#39;delete&#39; or &#39;copy&#39;</span>
<span class="sd">            path      --  directory location to perform add/update/delete test data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;edit&quot;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">test_data_folder</span>

        <span class="k">elif</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">test_data_path</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">backup_level</span> <span class="o">!=</span> <span class="s2">&quot;Synthetic_full&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">test_path</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">folder_name</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">backup_level</span><span class="p">)</span>
                    <span class="n">test_data_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating test data at: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_data_folder</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span><span class="n">test_data_folder</span><span class="p">,</span>
                                                           <span class="n">acls</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                           <span class="n">unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                           <span class="n">xattr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Generated data at: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_data_folder</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">test_data_folder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_data_folder</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;edit&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">test_path</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">modify_test_data</span><span class="p">(</span><span class="n">test_path</span><span class="p">,</span> <span class="n">modify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Modified data at: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">test_path</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleting the folder for delete data verification&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_path</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">test_path</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;copy&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">copy_content_location</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">test_path</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">copy_content_location</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">,</span>
                                                         <span class="s1">&#39;copied_data&#39;</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">folder_name</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">copy_content_location</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Location to move data before delete/restore: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">copy_content_location</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">copy_folder</span><span class="p">(</span><span class="n">test_path</span><span class="p">,</span> <span class="n">copy_content_location</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;folder move is done&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">copy_content_location</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy_content_location</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_backup"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_backup">[docs]</a>    <span class="k">def</span> <span class="nf">snap_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs Snap Backup from Commcell for the given subclient</span>
<span class="sd">        Returns:</span>
<span class="sd">                    object : job Object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">advanced_option</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;inline_bkp_cpy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">inline_bkp_cpy</span><span class="p">,</span>
            <span class="s1">&#39;skip_catalog&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">skip_catalog</span>
        <span class="p">}</span>

        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span>
                                                  <span class="n">advanced_options</span><span class="o">=</span><span class="n">advanced_option</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sleeping for 10 seconds for job to start&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started </span><span class="si">{0}</span><span class="s2"> Snap backup with Job ID: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;backup level :</span><span class="si">{0}</span><span class="s2">, job type </span><span class="si">{1}</span><span class="s2">, job status </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">job_type</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;failed to start&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job status is failed or failed to start&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">is_suspend_job</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">skip_catalog</span><span class="p">:</span>
                <span class="n">phases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;backup&quot;</span><span class="p">,</span> <span class="s2">&quot;archive index&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">phases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;backup&quot;</span><span class="p">,</span> <span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="s2">&quot;catalog&quot;</span><span class="p">,</span> <span class="s2">&quot;archive index&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">run_suspend_resume</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">phases</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run </span><span class="si">{0}</span><span class="s2"> backup job with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">backup_level</span> <span class="ow">or</span> <span class="n">job</span><span class="o">.</span><span class="n">backup_level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;SYNTHETIC FULL&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;backup level is same as we started&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;backup level is not same as we started&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished </span><span class="si">{0}</span><span class="s2"> Snap backup job&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">backup_level</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">inline_bkp_cpy</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">bkp_cpy_jid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_backup_copy_job</span><span class="p">,</span>
                                                           <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">},</span> <span class="n">fetch_rows</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;This is Inline backup job and Backup copy job id is: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">bkp_cpy_jid</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">bkp_cpy_jid</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;backup copy job for the snap job : </span><span class="si">{0}</span><span class="s2"> is not started&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bkp_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">bkp_cpy_jid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Monitoring backup copy job: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bkp_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">is_suspend_job</span><span class="p">:</span>
                <span class="n">phases</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span> <span class="s1">&#39;backup&#39;</span><span class="p">,</span> <span class="s1">&#39;archive index&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_suspend_resume</span><span class="p">(</span><span class="n">bkp_job</span><span class="p">,</span> <span class="n">phases</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">bkp_job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to run </span><span class="si">{0}</span><span class="s2"> backup job with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">bkp_job</span><span class="o">.</span><span class="n">backup_level</span><span class="p">,</span> <span class="n">bkp_job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;successfully completed backup copy job: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bkp_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">job_tracker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_restore"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_restore">[docs]</a>    <span class="k">def</span> <span class="nf">snap_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">copy_precedence</span><span class="p">,</span>
                     <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">fs_options</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">outplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method for Restore from Snap job</span>
<span class="sd">            Return :</span>
<span class="sd">                    Object : job object of restore job</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fs_options</span><span class="p">:</span>
            <span class="n">fs_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;no_image&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fs_options</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot; Running restore from Snap Backup &quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running outplace restore from snap using Copy Precedence:</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">copy_precedence</span><span class="p">))</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">restore_out_of_place</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_outplace_restore_location</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">source_path</span><span class="p">,</span>
                <span class="n">copy_precedence</span><span class="o">=</span><span class="n">copy_precedence</span><span class="p">,</span>
                <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">fs_options</span><span class="o">=</span><span class="n">fs_options</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running inplace restore from snap using Copy Precedence:</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">copy_precedence</span><span class="p">))</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">restore_in_place</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">source_path</span><span class="p">,</span>
                <span class="n">copy_precedence</span><span class="o">=</span><span class="n">copy_precedence</span><span class="p">,</span>
                <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">fs_options</span><span class="o">=</span><span class="n">fs_options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started Restore from Snap Backup with job id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run restore from Snap Backup: &quot;</span> <span class="o">+</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished restore from Snap Backup&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_outplace"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_outplace">[docs]</a>    <span class="k">def</span> <span class="nf">snap_outplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fs_options</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; OutPlace restore from snapbackup</span>

<span class="sd">            Args :</span>
<span class="sd">                copy_precedence : precedence of snap copy</span>

<span class="sd">                from_time       : from time for browse, default: None</span>

<span class="sd">                to_time         : to time for Browse,  default: None</span>

<span class="sd">                fs_options      : if true then &#39;no_image&#39;(show deleted items) option will be set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dir_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span><span class="o">.</span><span class="n">_get_restore_dir_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;dir name: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_outplace_restore_location</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_location</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">dir_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_outplace_restore_location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;restore location is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_outplace_restore_location</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">(</span>
            <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">fs_options</span><span class="o">=</span><span class="n">fs_options</span><span class="p">,</span>
            <span class="n">outplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_inplace"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_inplace">[docs]</a>    <span class="k">def</span> <span class="nf">snap_inplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fs_options</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; OutPlace restore from snapbackup</span>

<span class="sd">            Args :</span>
<span class="sd">                copy_precedence : precedence of snap copy</span>

<span class="sd">                from_time : from time for browse, default: None</span>

<span class="sd">                to_time : to time for Browse,  default: None</span>

<span class="sd">                fs_options : if true then &#39;no_image&#39;(show deleted items) option will be set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_restore</span><span class="p">(</span>
            <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">fs_options</span><span class="o">=</span><span class="n">fs_options</span><span class="p">,</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.inplace_validation"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.inplace_validation">[docs]</a>    <span class="k">def</span> <span class="nf">inplace_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">,</span> <span class="n">source_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validation for inplace restore operation</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : Job id used for the restore</span>

<span class="sd">                copy_name : copy name from which the restore is done</span>

<span class="sd">                source_path: Source directory Path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">source_path</span><span class="p">:</span>
                <span class="n">folder_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">get_folder_or_file_names</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">folder_list</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_list</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folder_list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span>
                                 <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">folder</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">copy_content_location</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span>
                                 <span class="s2">&quot;TestData&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">+</span> <span class="n">folder</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mount_snap</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">)</span>
            <span class="n">mount_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_mount_path</span><span class="p">,</span>
                                                          <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">jobid</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">}</span>
                                                          <span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">mount_path</span><span class="p">:</span>
                <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">mount_path</span><span class="p">:</span>
                <span class="n">folder_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">get_folder_or_file_names</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">folder_list</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_list</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folder_list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span>
                                 <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">folder</span><span class="p">,</span>
                                 <span class="n">source_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;TestData&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">folder</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unmount_snap</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unmount_validation</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.outplace_validation"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.outplace_validation">[docs]</a>    <span class="k">def</span> <span class="nf">outplace_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restore_location</span><span class="p">,</span> <span class="n">restore_client</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validation for outplace restore operation</span>
<span class="sd">            Args:</span>
<span class="sd">                restore_location    : Data restore path</span>

<span class="sd">                restore_client      : client where the data is restored</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outplace_restore_location</span> <span class="o">=</span> <span class="n">restore_location</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;TestData&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;restore location is: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outplace_restore_location</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">source_path</span><span class="p">:</span>
            <span class="n">folder_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">get_folder_or_file_names</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">folder_list</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_list</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folder_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="n">restore_client</span><span class="p">,</span>
                             <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">folder</span><span class="p">,</span>
                             <span class="n">outplace_restore_location</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">folder</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.compare"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.compare">[docs]</a>    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_obj</span><span class="p">,</span> <span class="n">destclient_obj</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Compare two directories</span>
<span class="sd">            Args:</span>
<span class="sd">                client_obj      : client Object of the Source machine</span>

<span class="sd">                destclient_obj  : client Object of the Destination machine</span>

<span class="sd">                source_dir      : Source directory Path</span>

<span class="sd">                dest_dir        : Destination directory Path</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;comparing content&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;source dir: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;dest dir : </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">)</span>

        <span class="n">difference</span> <span class="o">=</span> <span class="n">client_obj</span><span class="o">.</span><span class="n">compare_folders</span><span class="p">(</span>
            <span class="n">destclient_obj</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">,</span> <span class="n">dest_dir</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">difference</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Validation failed. List of different files </span><span class="se">\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;validation failed. Please check logs for more details.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Compare folder validation was successful&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.tape_restore"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.tape_restore">[docs]</a>    <span class="k">def</span> <span class="nf">tape_restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">copy_precedence</span><span class="p">,</span>
                     <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">fs_options</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">outplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Restore from Tape Copy</span>
<span class="sd">            Args:</span>
<span class="sd">                copy_precedence : precedence of snap copy</span>

<span class="sd">                from_time       : from time for browse, default: None</span>

<span class="sd">                to_time         : to time for Browse,  default: None</span>

<span class="sd">                fs_options      : if true then &#39;no_image&#39;(show deleted items) option will be set</span>

<span class="sd">                outplace        : set to True if outplace restore</span>

<span class="sd">                inplace         : set to True if inplace restore</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fs_options</span><span class="p">:</span>
            <span class="n">fs_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;no_image&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fs_options</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot; Running restore from tape copy &quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Running out of place restore from Tape using Copy Precedence: </span><span class="si">{0}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_precedence</span><span class="p">))</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">restore_out_of_place</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_client</span><span class="o">.</span><span class="n">machine_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">tape_outplace_restore_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">source_path</span><span class="p">,</span>
                <span class="n">copy_precedence</span><span class="o">=</span><span class="n">copy_precedence</span><span class="p">,</span>
                <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">fs_options</span><span class="o">=</span><span class="n">fs_options</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running in place restore from Tape using Copy Precedence: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">copy_precedence</span><span class="p">))</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">restore_in_place</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">source_path</span><span class="p">,</span>
                <span class="n">copy_precedence</span><span class="o">=</span><span class="n">copy_precedence</span><span class="p">,</span>
                <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">fs_options</span><span class="o">=</span><span class="n">fs_options</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started Restore from tape copy with job id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run restore from Tape copy: &quot;</span> <span class="o">+</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished restore from Tape copy&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.tape_outplace"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.tape_outplace">[docs]</a>    <span class="k">def</span> <span class="nf">tape_outplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">jobid</span><span class="p">,</span>
                      <span class="n">copy_precedence</span><span class="p">,</span>
                      <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">fs_options</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Outplace restore from tape copy</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid           : jobid to find total nackup size</span>

<span class="sd">                copy_precedence : precedence of snap copy</span>

<span class="sd">                from_time       : from time for browse, default: None</span>

<span class="sd">                to_time         : to time for Browse,  default: None</span>

<span class="sd">                fs_options      : if true then &#39;no_image&#39;(show deleted items) option will be set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">size</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_total_backup_size</span><span class="p">,</span>
                                                     <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">jobid</span><span class="p">},</span>
                                                     <span class="n">fetch_rows</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Total Backed up size: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="c1"># Find a client to restore the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">tape_outplace_restore_location</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">options_selector</span><span class="o">.</span><span class="n">get_windows_restore_client</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tape_restore</span><span class="p">(</span>
            <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">fs_options</span><span class="o">=</span><span class="n">fs_options</span><span class="p">,</span>
            <span class="n">outplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.tape_inplace"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.tape_inplace">[docs]</a>    <span class="k">def</span> <span class="nf">tape_inplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fs_options</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Inplace restore from tape copy</span>
<span class="sd">            Args:</span>
<span class="sd">                copy_precedence : precedence of snap copy</span>

<span class="sd">                from_time       : from time for browse, default: None</span>

<span class="sd">                to_time         : to time for Browse,  default: None</span>

<span class="sd">                fs_options      : if true then &#39;no_image&#39;(show deleted items) option will be set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tape_restore</span><span class="p">(</span>
            <span class="n">copy_precedence</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span> <span class="n">fs_options</span><span class="o">=</span><span class="n">fs_options</span><span class="p">,</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_operations"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_operations">[docs]</a>    <span class="k">def</span> <span class="nf">snap_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_id</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mountpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">do_vssprotection</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Common Method for Snap Operations</span>
<span class="sd">            Args :</span>
<span class="sd">                jobid             : jobid for the Snap operation</span>

<span class="sd">                copy_id           : copy id from which the snap operations needs to be done</span>

<span class="sd">                client_name       : name of the destination client, default: None</span>

<span class="sd">                MountPath         : MountPath for Snap operation, default: None</span>

<span class="sd">                do_vssprotection  : enable vss protection snap during mount</span>

<span class="sd">                mode              : mode can be mount,unmount,force_unmount,delete,force_delete,</span>
<span class="sd">                                    revert,reconcile</span>

<span class="sd">            Return :</span>
<span class="sd">                object : Job object of Snap Operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;reconcile&#39;</span><span class="p">:</span>
            <span class="n">control_hosts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_control_host</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">jobid</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ControlHost Id is : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">control_hosts</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">control_hosts</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[[]],</span> <span class="p">[]]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ControlHost Id is Empty, Cannot proceed with Reconcile operation&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">fail</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">repeats</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">runs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">control_hosts</span><span class="p">)</span>
                <span class="n">repeat</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">control_host</span> <span class="ow">in</span> <span class="n">control_hosts</span><span class="p">:</span>
                    <span class="n">runs</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">control_host</span> <span class="ow">in</span> <span class="n">repeat</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reconcile repeat skipped for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">control_host</span><span class="p">))</span>
                        <span class="n">repeats</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">runs</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">break</span>
                    <span class="n">repeat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">control_host</span><span class="p">)</span>
                    <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">reconcile</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">control_host</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started  job : </span><span class="si">{0}</span><span class="s2"> for Snap Operation&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="s2">&quot;Failed to run   job </span><span class="si">{0}</span><span class="s2"> for Snap operation with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">))</span>
                        <span class="n">fail</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">runs</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">break</span>

                    <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="s2">&quot;job: </span><span class="si">{0}</span><span class="s2"> for snap operation is completed with errors, Reason: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">))</span>
                        <span class="n">success</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">runs</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">break</span>
                    <span class="n">success</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;successfully completed Snap operation of jobid :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Snap Reconcile operation successful for </span><span class="si">{0}</span><span class="s2"> out of </span><span class="si">{1}</span><span class="s2"> arrays&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">success</span> <span class="o">+</span> <span class="n">fail</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">fail</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Reconcile operation failed for </span><span class="si">{0}</span><span class="s2"> out of </span><span class="si">{1}</span><span class="s2"> arrays. Check logs for more info.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fail</span><span class="p">,</span>
                                                                                                                 <span class="n">success</span> <span class="o">+</span> <span class="n">fail</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">job</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting SMVolumeId using JobId: </span><span class="si">{0}</span><span class="s2"> and Copy id: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_id</span><span class="p">))</span>
            <span class="n">volumeid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_volume_id</span><span class="p">,</span>
                                                        <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">jobid</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">copy_id</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;SMvolumeId is : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volumeid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;destination client name is :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;mountpath is </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mountpath</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">volumeid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mount&#39;</span><span class="p">,</span> <span class="s1">&#39;unmount&#39;</span><span class="p">,</span> <span class="s1">&#39;force_unmount&#39;</span><span class="p">,</span> <span class="s1">&#39;revert&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;VolumeID is Empty, Looks like it is deleted or never been</span><span class="se">\</span>
<span class="s2">                                    created, Cannot proceed with Snap operation&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="s1">&#39;force_delete&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;VolumeID is Empty, Looks like it is already deleted,</span><span class="se">\</span>
<span class="s2">                                  treating it as soft failure&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;mount&#39;</span><span class="p">:</span>
                    <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="n">volumeid</span><span class="p">,</span>
                                                               <span class="n">client_name</span><span class="p">,</span>
                                                               <span class="n">mountpath</span><span class="p">,</span>
                                                               <span class="n">do_vssprotection</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;unmount&#39;</span><span class="p">:</span>
                    <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">unmount</span><span class="p">(</span><span class="n">volumeid</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;force_unmount&#39;</span><span class="p">:</span>
                    <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">force_unmount</span><span class="p">(</span><span class="n">volumeid</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;revert&#39;</span><span class="p">:</span>
                    <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">revert</span><span class="p">(</span><span class="n">volumeid</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span><span class="p">:</span>
                    <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">volumeid</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;force_delete&#39;</span><span class="p">:</span>
                    <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">force_delete</span><span class="p">(</span><span class="n">volumeid</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get Snap Operation Type&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started  job: </span><span class="si">{0}</span><span class="s2"> for Snap Operation&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to run job: </span><span class="si">{0}</span><span class="s2"> for Snap operation with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;job: </span><span class="si">{0}</span><span class="s2"> for snap operation is completed with errors, Reason: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;successfully completed Snap operation of jobid :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">job</span></div>

<div class="viewcode-block" id="SNAPHelper.mount_snap"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.mount_snap">[docs]</a>    <span class="k">def</span> <span class="nf">mount_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">,</span> <span class="n">do_vssprotection</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Mounts Snap of the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid               : jobid for mount operation</span>

<span class="sd">                copy_name           : copy name from which the mount operations needs to be done</span>

<span class="sd">                do_vssprotection    : Performs VSS protected mount</span>

<span class="sd">            Return:</span>
<span class="sd">                object              : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mounting snapshot of jobid : </span><span class="si">{0}</span><span class="s2"> from Copy: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">))</span>
        <span class="n">mountpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_path</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span>
                                    <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;mount&#39;</span><span class="p">,</span>
                                    <span class="n">client_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span><span class="p">,</span> <span class="n">mountpath</span><span class="o">=</span><span class="n">mountpath</span><span class="p">,</span>
                                    <span class="n">do_vssprotection</span><span class="o">=</span><span class="n">do_vssprotection</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.unmount_snap"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.unmount_snap">[docs]</a>    <span class="k">def</span> <span class="nf">unmount_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; UnMounts Snap of the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid       : jobid for unmount operation</span>

<span class="sd">                copy_name   : copy name from which the unmount operations needs to be done</span>

<span class="sd">            Return:</span>
<span class="sd">                object      : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mountpath_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_mount_path</span><span class="p">,</span>
            <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">jobid</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;UnMounting snapshot of jobid : </span><span class="si">{0}</span><span class="s2"> from Copy: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;unmount&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.force_unmount_snap"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.force_unmount_snap">[docs]</a>    <span class="k">def</span> <span class="nf">force_unmount_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; UnMounts Snap of the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid       : jobid for unmount operation</span>

<span class="sd">                copy_name   : copy name from which the force unmount operations needs to be done</span>

<span class="sd">            Return:</span>
<span class="sd">                object      : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mountpath_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_mount_path</span><span class="p">,</span>
            <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">jobid</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;UnMounting snapshot of jobid : </span><span class="si">{0}</span><span class="s2"> from Copy: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;force_unmount&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.revert_snap"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.revert_snap">[docs]</a>    <span class="k">def</span> <span class="nf">revert_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reverts Snap of the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid       : jobid for revert operation</span>

<span class="sd">                copy_name   : copy name from which the revert operations needs to be done</span>

<span class="sd">            Return:</span>
<span class="sd">                object      : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reverting snapshot of jobid : </span><span class="si">{0}</span><span class="s2"> from Copy: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleting subclient content before revert operation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_subclient_content</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;revert&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.delete_snap"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.delete_snap">[docs]</a>    <span class="k">def</span> <span class="nf">delete_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">,</span> <span class="n">is_mirror</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">source_copy_for_mirror</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes Snap of the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid                   : jobid for delete operation</span>

<span class="sd">                copy_name               : copy name from which the delete operations needs to be</span>
<span class="sd">                                          done</span>

<span class="sd">                is_mirror               : if mirror snap needs to be deleted</span>

<span class="sd">                source_copy_for_mirror  : Source Copy Name of the Mirror</span>

<span class="sd">            Return:</span>
<span class="sd">                object : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_mirror</span><span class="p">:</span>
            <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">source_copy_for_mirror</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting snapshot of jobid : </span><span class="si">{0}</span><span class="s2"> from Copy: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">jobid</span><span class="p">,</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">_copy_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.force_delete_snap"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.force_delete_snap">[docs]</a>    <span class="k">def</span> <span class="nf">force_delete_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Force Deletes Snap of the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid       : jobid for delete operation</span>

<span class="sd">                copy_name   : copy name from which the delete operations needs to be done</span>

<span class="sd">            Return:</span>
<span class="sd">                object      : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Force Deleting snapshot of jobid : </span><span class="si">{0}</span><span class="s2"> from Copy: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">jobid</span><span class="p">,</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">_copy_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;force_delete&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.reconcile_snap"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.reconcile_snap">[docs]</a>    <span class="k">def</span> <span class="nf">reconcile_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs Reconcile Operation of the array for the given jobid</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid       : jobid for Reconcile operation</span>
<span class="sd">            Return:</span>
<span class="sd">                object      : job object of Snap operation job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running Reconcile Operation&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_operations</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">copy_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;reconcile&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snapop_validation"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.snapop_validation">[docs]</a>    <span class="k">def</span> <span class="nf">snapop_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">jobid</span><span class="p">,</span>
                          <span class="n">copy_id</span><span class="p">,</span>
                          <span class="n">mount</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">revert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unmount</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Common Method for Snap Operation Validations</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid       : snap backup jobid</span>

<span class="sd">                copy_id     : copy id from which the snap validation needs to be done</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;validating snap operation&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mount</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mountpath_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_mount_path</span><span class="p">,</span>
                <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">jobid</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">copy_id</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mountpath_val</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mountpath_val</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">:],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;comparing files/folders was successful&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">revert</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inplace_validation</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">delete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking if the snapshot of JobId: </span><span class="si">{0}</span><span class="s2"> exists in the DB&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
            <span class="n">volumeid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_volume_id</span><span class="p">,</span>
                                                        <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">jobid</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">copy_id</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;smvolumeid from DB is: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volumeid</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">volumeid</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">volumeid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snapshot is successfully deleted&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Snapshot of jobid: </span><span class="si">{0}</span><span class="s2"> is not deleted yet, please check the CVMA logs</span><span class="se">\</span>
<span class="s2">                        &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully verified Snapshot cleanup&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">unmount</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mountpath_val</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;MountPath folder still exists under </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MountPath folder path: </span><span class="si">{0}</span><span class="s2"> does not exists&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.mount_validation"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.mount_validation">[docs]</a>    <span class="k">def</span> <span class="nf">mount_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Mount Snap validation</span>
<span class="sd">            Args :</span>
<span class="sd">                jobid       : snap backup jobid</span>

<span class="sd">                copy_name   : copy name from which the mount validation needs to be done</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapop_validation</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">,</span> <span class="n">mount</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;mount validation was successful&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.revert_validation"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.revert_validation">[docs]</a>    <span class="k">def</span> <span class="nf">revert_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Revert Snap validation</span>
<span class="sd">            Args :</span>
<span class="sd">                jobid       : snap backup jobid</span>

<span class="sd">                copy_name   : copy name from which the revert validation needs to be done</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapop_validation</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">,</span> <span class="n">revert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;revert validation was successful&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.delete_validation"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.delete_validation">[docs]</a>    <span class="k">def</span> <span class="nf">delete_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Delete Snap validation</span>
<span class="sd">            Args :</span>
<span class="sd">                jobid       : snap backup jobid</span>

<span class="sd">                copy_name   : copy name from which the delete validation needs to be done</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapop_validation</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;delete validation was successful&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.unmount_validation"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.unmount_validation">[docs]</a>    <span class="k">def</span> <span class="nf">unmount_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; UnMount Snap validation</span>
<span class="sd">            Args :</span>
<span class="sd">                jobid       : snap backup jobid</span>

<span class="sd">                copy_name   : copy name from which the unmount validation needs to be done</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapop_validation</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">,</span> <span class="n">unmount</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;unmount validation was successful&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.check_mountstatus"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.check_mountstatus">[docs]</a>    <span class="k">def</span> <span class="nf">check_mountstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">unmount</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Common function to check mount status</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : snap backup jobid</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">unmount</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;79&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_mount_status</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">jobid</span><span class="p">},</span> <span class="n">fetch_rows</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;mount status of jobid :</span><span class="si">{0}</span><span class="s2"> is :</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">jobid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_status</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;snapshot is not unmounted yet, checking after 1min&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;snapshot of jobid </span><span class="si">{0}</span><span class="s2"> is unmounted successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_status</span></div>

<div class="viewcode-block" id="SNAPHelper.unmount_status"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.unmount_status">[docs]</a>    <span class="k">def</span> <span class="nf">unmount_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check Unmount status</span>
<span class="sd">            Args:</span>
<span class="sd">                jobid : snap backup jobid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_mountstatus</span><span class="p">(</span><span class="n">jobid</span><span class="p">,</span> <span class="n">unmount</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.update_storage_policy"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.update_storage_policy">[docs]</a>    <span class="k">def</span> <span class="nf">update_storage_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">enable_backup_copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">source_copy_for_snap_to_tape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">enable_snapshot_catalog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">source_copy_for_snapshot_catalog</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method for Updating Storage Policy Options like Backup Copy and Snapshot Catalog</span>
<span class="sd">            Args:</span>
<span class="sd">                enable_backup_copy               (bool) -- Enables backup copy if the value is True</span>

<span class="sd">                source_copy_for_snap_to_tape     (str)  -- Source Copy name for backup copy</span>

<span class="sd">                enable_snapshot_catalog          (bool) -- Enables Snapshot Catalog if value isTrue</span>

<span class="sd">                source_copy_for_snapshot_catalog (str)  -- Source Copy name for Snapshot Catalog</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;enable_backup_copy&#39;</span><span class="p">:</span> <span class="n">enable_backup_copy</span><span class="p">,</span>
            <span class="s1">&#39;source_copy_for_snap_to_tape&#39;</span><span class="p">:</span> <span class="n">source_copy_for_snap_to_tape</span><span class="p">,</span>
            <span class="s1">&#39;enable_snapshot_catalog&#39;</span><span class="p">:</span> <span class="n">enable_snapshot_catalog</span><span class="p">,</span>
            <span class="s1">&#39;source_copy_for_snapshot_catalog&#39;</span><span class="p">:</span> <span class="n">source_copy_for_snapshot_catalog</span><span class="p">,</span>
            <span class="s1">&#39;is_ocum&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">enable_backup_copy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enabling Backup Copy Option on Storage Policy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disabling Backup Copy Option on Storage Policy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">enable_snapshot_catalog</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enabling Snapshot Catalog Option on Storage Policy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disabling Snapshot Catalog Option on Storage Policy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">update_snapshot_options</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;successfully completed update operation on storage policy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">enable_backup_copy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_bkpcpy_schedule</span><span class="p">()</span></div>

<div class="viewcode-block" id="SNAPHelper.backup_copy"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.backup_copy">[docs]</a>    <span class="k">def</span> <span class="nf">backup_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs Offline backup copy for the given storage policy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">run_backup_copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backup copy workflow job id is : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">is_suspend_job</span><span class="p">:</span>
            <span class="n">suspend_completed_jobs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for 20 secs&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">backup_job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_backup_copy_jobid</span><span class="p">,</span>
                                                                 <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">})</span>
                <span class="n">new_job</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">backup_job_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;backup copy job id: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">suspend_completed_jobs</span> <span class="ow">and</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                        <span class="n">new_job</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">suspend_completed_jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for 1 minute&quot;</span><span class="p">)</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
                        <span class="n">backup_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">phases</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span> <span class="s1">&#39;backup&#39;</span><span class="p">,</span> <span class="s1">&#39;archive index&#39;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">run_suspend_resume</span><span class="p">(</span><span class="n">backup_job</span><span class="p">,</span> <span class="n">phases</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">backup_job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backup copy job </span><span class="si">{0}</span><span class="s2"> failed/killed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backup_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                            <span class="n">new_job</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">new_job</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run  Workflow job </span><span class="si">{0}</span><span class="s2"> for backup copy with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;job: </span><span class="si">{0}</span><span class="s2"> for Backup copy operation is completed with errors, Reason: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished backup copy workflow Job :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.snapshot_cataloging"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.snapshot_cataloging">[docs]</a>    <span class="k">def</span> <span class="nf">snapshot_cataloging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs Offline snapshot cataloging for the given storage policy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">run_snapshot_cataloging</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deferred Catalog workflow job id is : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">is_suspend_job</span><span class="p">:</span>
            <span class="n">suspend_completed_jobs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for 20 secs&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">catalog_job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_backup_copy_jobid</span><span class="p">,</span>
                                                                  <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">})</span>
                <span class="n">new_job</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">catalog_job_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;catalog copy job id: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">suspend_completed_jobs</span> <span class="ow">and</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                        <span class="n">new_job</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">suspend_completed_jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="n">catalog_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">phases</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span> <span class="s1">&#39;catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;archive index&#39;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">run_suspend_resume</span><span class="p">(</span><span class="n">catalog_job</span><span class="p">,</span> <span class="n">phases</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">catalog_job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backup copy job </span><span class="si">{0}</span><span class="s2"> failed/killed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">catalog_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                            <span class="n">new_job</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">new_job</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run  Workflow job </span><span class="si">{0}</span><span class="s2"> for Deferred Catalog with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;job: </span><span class="si">{0}</span><span class="s2"> for Snapshot catalog operation is completed with errors&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully completed deferred catalog job: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.aux_copy"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.aux_copy">[docs]</a>    <span class="k">def</span> <span class="nf">aux_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs Auxilliary copy for the given storage policy and copy</span>
<span class="sd">            Args:</span>
<span class="sd">                copy_name       (str)       -- Copy name for which aux copy needs to be run</span>
<span class="sd">                default: None</span>

<span class="sd">                use_scale       (bool)      -- Use scalable resource allocation</span>
<span class="sd">                default: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">copy_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">run_aux_copy</span><span class="p">(</span>
                <span class="n">copy_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">]),</span> <span class="n">use_scale</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">run_aux_copy</span><span class="p">(</span>
                <span class="n">media_agent</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;MediaAgent&#39;</span><span class="p">]),</span> <span class="n">use_scale</span><span class="o">=</span><span class="n">use_scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started Aux copy job with job id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">is_suspend_job</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">use_scale</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">is_finished</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job finished before suspending, continuing..&#39;</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">suspend_job</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sleeping for one minutes&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Resuming job :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">is_finished</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job finished before resuming, continuing..&#39;</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resume_job</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">is_finished</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job finished before suspending, continuing..&#39;</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">suspend_job</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sleeping for one minutes&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Resuming job :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">is_finished</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job finished before resuming, continuing..&#39;</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resume_job</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">is_kill_process</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Killing Aux copy Process to make aux opy failure&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">kill_process</span><span class="p">(</span><span class="s2">&quot;AuxCopy&quot;</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">is_process_running</span><span class="p">(</span><span class="s2">&quot;AuxCopy&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">flag</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Aux Copy Process did not get killed&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aux copy process is killed&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sleeping for 3 minutes&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Resuming job :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">is_finished</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Job finished before resuming, continuing..&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resume_job</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to run aux copy job with error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;job: </span><span class="si">{0}</span><span class="s2"> for snap operation is completed with errors, Reason: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished Aux copy job: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.run_data_aging"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.run_data_aging">[docs]</a>    <span class="k">def</span> <span class="nf">run_data_aging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs data aging for the given storage policy and copy</span>
<span class="sd">            Args:</span>
<span class="sd">                copy_name       (str)       -- Copy name for which Data Aging needs to be run</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">attempt_count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">attempt_count</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">(</span><span class="n">copy_name</span><span class="o">=</span><span class="n">copy_name</span><span class="p">,</span>
                                               <span class="n">storage_policy_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">,</span>
                                               <span class="n">is_granular</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                               <span class="n">include_all_clients</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                               <span class="n">select_copies</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                               <span class="n">prune_selected_copies</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;failed to start&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed to start the Data aging Job, will Retry after 60 seconds,</span><span class="se">\</span>
<span class="s2">                              Retry Attempt: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attempt_count</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully started data aging jobid: </span><span class="si">{0}</span><span class="s2">, job status: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
                <span class="k">break</span>
            <span class="n">attempt_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run data aging job </span><span class="si">{0}</span><span class="s2"> with error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Data Aging job: </span><span class="si">{0}</span><span class="s2"> did not completed Successfully, Job status: </span><span class="si">{1}</span><span class="s2">, Reason: </span><span class="si">{2}</span><span class="se">\</span>
<span class="s2">                &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">delay_reason</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully finished data aging Job :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.get_jobid_list"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.get_jobid_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_jobid_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Fetches job id list from the snap copy</span>
<span class="sd">            Args:</span>
<span class="sd">                copy_id         (int)   -- copy id to which snap list need be queried</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">snapbda</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">fetch_job_ids</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">copy_id</span><span class="p">})</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">snapbda</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unable to fetch the smvolumeID from DB&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">volume_id_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">snapbda</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">snapbda</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">volume_id_list</span><span class="p">:</span>
                    <span class="n">volume_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snapbda</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">volume_id_list</span></div>

<div class="viewcode-block" id="SNAPHelper.data_aging_validation"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.data_aging_validation">[docs]</a>    <span class="k">def</span> <span class="nf">data_aging_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">copy_name</span><span class="p">,</span>
                              <span class="n">source_copy_for_mirror</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vault</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mirror</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validates if the jobs are pruned after running the data aging</span>
<span class="sd">            Agrs:</span>
<span class="sd">                copy_name               (str) -- copy name for which data aging validation needs</span>
<span class="sd">                                                 to be done</span>

<span class="sd">                source_copy_for_mirror  (str) -- if Copy type is mirror then source copy name needs</span>
<span class="sd">                                                 to be provided</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>
        <span class="n">job_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jobid_list</span><span class="p">(</span><span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job IDs before running data aging </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">job_id_list</span><span class="p">))</span>
        <span class="n">jobtracker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">job_tracker</span>

        <span class="k">if</span> <span class="n">vault</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;setting retention to 0 day 1 cycle on vault copy : </span><span class="si">{0}</span><span class="s2"> to verify aging</span>
<span class="s2">                          &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>
            <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_retention</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">(</span><span class="n">copy_name</span><span class="o">=</span><span class="n">copy_name</span><span class="p">)</span>
            <span class="n">number_of_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobtracker</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>

        <span class="k">elif</span> <span class="n">mirror</span><span class="p">:</span>
            <span class="n">sourcecopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">source_copy_for_mirror</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;pvm&quot;</span><span class="p">,</span> <span class="s2">&quot;pvm_replica&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">}:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;setting retention to 0 day 1 cycle on source copy **</span><span class="si">{0}</span><span class="s2">** of</span>
<span class="s2">                mirror to verify aging&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_copy_for_mirror</span><span class="p">))</span>
                <span class="n">sourcecopy</span><span class="o">.</span><span class="n">copy_retention</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">number_of_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobtracker</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sourcecopy</span><span class="o">.</span><span class="n">copy_retention</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">number_of_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobtracker</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">(</span><span class="n">copy_name</span><span class="o">=</span><span class="n">source_copy_for_mirror</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;setting retention to spool on snap copy : </span><span class="si">{0}</span><span class="s2"> to verify aging&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">copy_name</span><span class="p">))</span>
            <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_retention</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">(</span><span class="n">copy_name</span><span class="o">=</span><span class="n">copy_name</span><span class="p">)</span>
            <span class="n">number_of_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobtracker</span><span class="p">)</span>

        <span class="n">job_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jobid_list</span><span class="p">(</span><span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job IDs after running data aging </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">job_id_list</span><span class="p">))</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">wait_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobtracker</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">number_of_jobs</span><span class="p">:</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">volumeid_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_volumeid_da</span><span class="p">,</span>
                                                                    <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">job</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">})</span>
                    <span class="k">if</span> <span class="n">volumeid_val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for 2 minutes&quot;</span><span class="p">)</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
                        <span class="n">wait_time</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="k">if</span> <span class="n">wait_time</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="s2">&quot;Snapshot of jobid: </span><span class="si">{0}</span><span class="s2"> is not yet deleted,&quot;</span>
                            <span class="s2">&quot;please check the CVMA logs&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
                        <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snapshot for job </span><span class="si">{0}</span><span class="s2"> deleted successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job</span><span class="p">))</span>

            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully completed Aging verification on copy :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">copy_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">mirror</span><span class="p">:</span>
            <span class="n">sourcecopy</span><span class="o">.</span><span class="n">copy_retention</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_retention</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.update_mmconfig"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.update_mmconfig">[docs]</a>    <span class="k">def</span> <span class="nf">update_mmconfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to Update MM config MMCONFIG_ARCHGROUP_CLEANUP_INTERVAL_MINUTES</span>
<span class="sd">        Args:</span>
<span class="sd">            value       (int)       --  Config Value to Update</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">qscript</span> <span class="o">=</span> <span class="s2">&quot;-sn setConfigParam -si MMCONFIG_ARCHGROUP_CLEANUP_INTERVAL_MINUTES -si </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">_qoperation_execscript</span><span class="p">(</span><span class="n">qscript</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;qscript response: [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Successfully Updated MMConfig &#39;MMCONFIG_ARCHGROUP_CLEANUP_INTERVAL_MINUTES&#39;</span>
<span class="s2">                      to :</span><span class="si">{0}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.clean_snap_environment"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.clean_snap_environment">[docs]</a>    <span class="k">def</span> <span class="nf">clean_snap_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; includes disable Intellisnap at subclient, delete subclient, delete backupset,</span>
<span class="sd">            delete aux and snap copy, delete storage policy, delete library,</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Disable Intellisnap on Subclient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disabling Intellisnap on subclient: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">disable_intelli_snap</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Disabled Intellisnap on subclient: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_name</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">delete</span><span class="p">({</span><span class="s1">&#39;subclient&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;subclient&#39;</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">delete</span><span class="p">({</span><span class="s1">&#39;backupset&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;backupset&#39;</span><span class="p">]})</span>

        <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">current_mmconfig</span><span class="p">,</span>
                                                         <span class="n">fetch_rows</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Current value of MM Config &#39;MMCONFIG_ARCHGROUP_CLEANUP_INTERVAL_MINUTES&#39;</span>
<span class="s2">                      is : </span><span class="si">{0}</span><span class="s2"> minutes&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating it to 1 Minutes to Prune SP and copies&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_mmconfig</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;pv&quot;</span><span class="p">,</span> <span class="s2">&quot;pm&quot;</span><span class="p">,</span> <span class="s2">&quot;pv_replica&quot;</span><span class="p">,</span> <span class="s2">&quot;pm_replica&quot;</span><span class="p">}:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;pv&quot;</span><span class="p">,</span> <span class="s2">&quot;pv_replica&quot;</span><span class="p">}:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting First Node Copy </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sucessfully delete First Node Copy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for 8 mins&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">480</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storage Policy is created with OCUM, Not deleting</span><span class="se">\</span>
<span class="s2">                                  Primary Snap Copy&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleting Primary Snap Copy&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">delete</span><span class="p">({</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">]})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sucessfully deleted Storage Policy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for 8 mins&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">480</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;pvm&quot;</span><span class="p">,</span> <span class="s2">&quot;pvm_replica&quot;</span><span class="p">,</span> <span class="s2">&quot;pmm&quot;</span><span class="p">,</span> <span class="s2">&quot;pmm_replica&quot;</span><span class="p">,</span> <span class="s2">&quot;pmv&quot;</span><span class="p">,</span> <span class="s2">&quot;pmv_replica&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;pvv_replica&quot;</span><span class="p">}:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;pvm&quot;</span><span class="p">,</span> <span class="s2">&quot;pmv_replica&quot;</span><span class="p">,</span> <span class="s2">&quot;pmm_replica&quot;</span><span class="p">,</span> <span class="s2">&quot;pvv_replica&quot;</span><span class="p">}:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting Second Node Copy </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sucessfully deleted Second Node Copy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">second_node_copy</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for 8 mins&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">480</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting First Node Copy </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sucessfully delete First Node Copy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">first_node_copy</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for 8 mins&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">480</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storage Policy is created with OCUM, Not deleting Primary Snap Copy&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleting Primary Snap Copy&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                    <span class="p">{</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">]})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sucessfully deleted Storage Policy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for 5 mins&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;fanout&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">entity_properties</span><span class="p">[</span><span class="s1">&#39;storagepolicy&#39;</span><span class="p">]})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sucessfully deleted Storage Policy: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">storage_policy_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_data_aging</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sleeping for 5 mins&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">ocum_server</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storage Policy is created with OCUM, Not deleting Primary Snap Copy&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_copy_name</span><span class="p">)</span>

        <span class="c1"># Cleanup Entities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Updating back to original value : </span><span class="si">{0}</span><span class="s2"> of config</span>
<span class="s2">                      &#39;MMCONFIG_ARCHGROUP_CLEANUP_INTERVAL_MINUTES&#39;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_mmconfig</span><span class="p">(</span><span class="n">current_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.clear_locations"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.clear_locations">[docs]</a>    <span class="k">def</span> <span class="nf">clear_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Remove Subclient content</span>
<span class="sd">            Remove Restore location</span>
<span class="sd">            Remove Mountpath</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_subclient_content</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully removed Subclient Content&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_location</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully removed Restore Location&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">mount_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully removed MountPath&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">disk_lib_loc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully removed disk library location&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_client</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">tape_outplace_restore_location</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully removed Tape restore location&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Removing location failed with err: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.remove_subclient_content"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.remove_subclient_content">[docs]</a>    <span class="k">def</span> <span class="nf">remove_subclient_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Delete data under subclient content</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleting the content from </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.cleanup"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Cleanup function to clear locations and snap entities &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">sc_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_snap_environment</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;***Not cleaning up the snap entities as the test case is run on</span><span class="se">\</span>
<span class="s2">                          Existing subclient***&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_locations</span><span class="p">()</span></div>

<div class="viewcode-block" id="SNAPHelper.delete_array"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.delete_array">[docs]</a>    <span class="k">def</span> <span class="nf">delete_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to Delete the array management entry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting the array management entry : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">))</span>
            <span class="n">control_host_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_controlhost_id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">arrayname</span><span class="p">},</span>
                <span class="n">fetch_rows</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">control_host_array</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Array Management entry Not found in the database, &quot;&quot;&quot;</span>
                              <span class="sd">&quot;&quot;&quot;Treating this as Soft Failure&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">delete_array</span><span class="p">(</span><span class="n">control_host_array</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error_message</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">SDKException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">exception_id</span> <span class="o">==</span> <span class="s1">&#39;103&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">exception_message</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Treating this as Soft failure&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.spcopy_obj"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.spcopy_obj">[docs]</a>    <span class="k">def</span> <span class="nf">spcopy_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create storage Policy Copy object</span>
<span class="sd">        Arg:</span>
<span class="sd">            copy_name        (str)         -- Copy name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="n">StoragePolicyCopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">storage_policy</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">spcopy</span></div>

<div class="viewcode-block" id="SNAPHelper.vplex_snap_validation"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.vplex_snap_validation">[docs]</a>    <span class="k">def</span> <span class="nf">vplex_snap_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">copy_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validate snap created on both the nodes of Vplex Array</span>
<span class="sd">        Args:</span>
<span class="sd">            jobid       (int)       -- Vplex Snapbackup job id</span>

<span class="sd">            copy_name   (str)       -- Copy name from where the job belongs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spcopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spcopy_obj</span><span class="p">(</span><span class="n">copy_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting SMVolumeId using JobId: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
        <span class="n">volumeid</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_volume_id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">jobid</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">spcopy</span><span class="o">.</span><span class="n">copy_id</span><span class="p">},</span> <span class="n">fetch_rows</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">volid</span> <span class="ow">in</span> <span class="n">volumeid</span><span class="p">:</span>
            <span class="n">cntrl_host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">vplex_control_host</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">volid</span><span class="p">})</span>
            <span class="n">frontend_control_host</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cntrl_host</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">Backend1_control_host</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cntrl_host</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Backend2_control_host</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cntrl_host</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">snap_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_snap_count</span><span class="p">,</span>
                                                          <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">frontend_control_host</span><span class="p">,</span>
                                                           <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">jobid</span><span class="p">,</span>
                                                           <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">Backend1_control_host</span><span class="p">,</span>
                                                           <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="n">Backend2_control_host</span><span class="p">}</span>
                                                          <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">snap_count</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Metrocluster Test succeed: Created snap on both Backend arrays&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Metrocluster Test failed: Snap not present on both backend arrays&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.edit_array"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.edit_array">[docs]</a>    <span class="k">def</span> <span class="nf">edit_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">array_name</span><span class="p">,</span>
                   <span class="n">snap_configs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">config_update_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">level_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">array_access_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to Update Snap Configurations and array access nodes for the given array</span>
<span class="sd">        Args:</span>
<span class="sd">            array_name              (str)     -- Name of the Array</span>

<span class="sd">            snap_configs            (dict)     -- Snap Configs in Dict format</span>
<span class="sd">            Ex: {&quot;Mount Retry Interval (in seconds)&quot; : &quot;600&quot;, &quot;Array Host Aliases&quot; : {&quot;msconfig1&quot; : &quot;add&quot;, &quot;msconfig2&quot; : &quot;delete&quot;, &quot;New alias Name&quot; : &quot;Old alias name&quot;}}</span>

<span class="sd">            config_update_level     (int)     -- update level for the Snap config</span>
<span class="sd">            default: &quot;array&quot;</span>
<span class="sd">            other values: &quot;subclient&quot;, &quot;copy&quot;, &quot;client&quot;</span>

<span class="sd">            level_id                (int)     -- level Id where the config needs to be</span>
<span class="sd">                                                 added/updated, ex: Subclient, client, copy id&#39;s</span>
<span class="sd">            default: None</span>

<span class="sd">            array_access_node       (dict)    -- Array Access Node MA&#39;s in dict format with mode</span>
<span class="sd">            default: None</span>
<span class="sd">            Ex: {&quot;snapautotest3&quot; : &quot;add&quot;, &quot;linuxautomation1&quot; : &quot;add&quot;, &quot;snapautofc1&quot; : &quot;delete&quot;}</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">control_host_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_controlhost_id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">array_name</span><span class="p">},</span> <span class="n">fetch_rows</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">snap_configs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">config</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">snap_configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">master_config_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_master_config_id</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">snap_engine_at_array</span><span class="p">},</span>
                    <span class="n">fetch_rows</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">)</span>
                <span class="n">config_data</span><span class="p">[</span><span class="n">master_config_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating the Snap Config: &#39;</span><span class="si">{0}</span><span class="s2">&#39; on Array: &#39;</span><span class="si">{1}</span><span class="s2">&#39; at : *</span><span class="si">{2}</span><span class="s2">* level&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">snap_configs</span><span class="p">,</span> <span class="n">array_name</span><span class="p">,</span> <span class="n">config_update_level</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">config_data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">array_access_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating Array Access Nodes :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">array_access_node</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="o">.</span><span class="n">array_management</span><span class="o">.</span><span class="n">edit_array</span><span class="p">(</span><span class="n">control_host_id</span><span class="p">,</span>
                                                  <span class="n">config_data</span><span class="p">,</span>
                                                  <span class="n">config_update_level</span><span class="p">,</span>
                                                  <span class="n">level_id</span><span class="o">=</span><span class="n">level_id</span><span class="p">,</span>
                                                  <span class="n">array_access_node</span><span class="o">=</span><span class="n">array_access_node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">snap_configs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Updated Snap Configs: &#39;</span><span class="si">{0}</span><span class="s2">&#39; on Array: &#39;</span><span class="si">{1}</span><span class="s2">&#39;at : *</span><span class="si">{2}</span><span class="s2">* level&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">snap_configs</span><span class="p">,</span> <span class="n">array_name</span><span class="p">,</span> <span class="n">config_update_level</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">array_access_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Updated Array Access Nodes :</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">array_access_node</span><span class="p">))</span></div>

<div class="viewcode-block" id="SNAPHelper.verify_extentbased_subclient"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.verify_extentbased_subclient">[docs]</a>    <span class="k">def</span> <span class="nf">verify_extentbased_subclient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Template to run extent level validation after snap backup</span>

<span class="sd">            Args:</span>
<span class="sd">                job     (object) --- job of the snap backup</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">job</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting RemoteFileCache for SubclientPropertiesFile location from MediaAgent&quot;</span><span class="p">)</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">subclient_guid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The subclient GUID obtained is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">get_indexcache_location</span><span class="p">,</span>
                                                  <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">client_name</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The query output is : </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The actualy ouput derived from the above query is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">SPPath</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span>
                     <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">RemoteFileCache</span><span class="se">\\</span><span class="s1">2&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">properties</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">File System&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">SubClientProperties.cvf&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">SPPath</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">SPPath</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;fileAsExtentsBackupEnabled=</span><span class="se">\&quot;</span><span class="s2">1</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;File extent is enabled on the client&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snap backup validation passed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snap backup validation failed&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SNAPHelper.snap_extent_template"><a class="viewcode-back" href="../../../source/FileSystem.SNAPUtils.html#FileSystem.SNAPUtils.snaphelper.SNAPHelper.snap_extent_template">[docs]</a>    <span class="k">def</span> <span class="nf">snap_extent_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_proxy_options</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Template to run extent test case for intellisnap</span>

<span class="sd">            Args:</span>
<span class="sd">                set_proxy_options      (bool)   --    True, if the proxy needed otherwise False.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s2">&quot;Running with Catalog Phase&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_snap_environment</span><span class="p">()</span>
        <span class="n">proxy_options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;snap_proxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span>  <span class="c1"># assigning client name as proxy incase if set_proxy_options is false</span>
            <span class="s1">&#39;backupcopy_proxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="p">,</span>
            <span class="s1">&#39;use_source_if_proxy_unreachable&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">set_proxy_options</span><span class="p">:</span>
            <span class="n">proxy_options</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;snap_proxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Snap_Proxy&#39;</span><span class="p">],</span>
                <span class="s1">&#39;backupcopy_proxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;Backupcopy_Proxy&#39;</span><span class="p">],</span>
                <span class="s1">&#39;use_source_if_proxy_unreachable&#39;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">subclient</span><span class="o">.</span><span class="n">enable_intelli_snap</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s1">&#39;SnapEngine&#39;</span><span class="p">],</span> <span class="n">proxy_options</span><span class="p">)</span>
        <span class="n">fsa</span> <span class="o">=</span> <span class="s2">&quot;FileSystemAgent&quot;</span>
        <span class="n">enable</span> <span class="o">=</span> <span class="s2">&quot;bEnableFileExtentBackup&quot;</span>
        <span class="n">slab</span> <span class="o">=</span> <span class="s2">&quot;mszFileExtentSlabs&quot;</span>
        <span class="n">slab_val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Slab&quot;</span><span class="p">,</span> <span class="s2">&quot;10-1024=5&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;01 : Enable feature by setting </span><span class="si">{}</span><span class="s2"> under </span><span class="si">{}</span><span class="s2"> on client.&quot;</span>
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">enable</span><span class="p">,</span> <span class="n">fsa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_registry</span><span class="p">(</span><span class="n">fsa</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;02 : Lowering threshold by setting </span><span class="si">{}</span><span class="s2"> under </span><span class="si">{}</span><span class="s2"> on client.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">slab</span><span class="p">,</span> <span class="n">fsa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">create_registry</span><span class="p">(</span><span class="n">fsa</span><span class="p">,</span> <span class="n">slab</span><span class="p">,</span> <span class="n">slab_val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_test_data_folder</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">test_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">test_data_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">folder_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">backup_level</span><span class="p">)</span>
            <span class="n">test_data_folder</span> <span class="o">=</span> <span class="n">test_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating test data at: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_data_folder</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span><span class="n">test_data_folder</span><span class="p">,</span>
                                                   <span class="n">dirs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                   <span class="n">files</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                   <span class="n">file_size</span><span class="o">=</span><span class="mi">1097152</span>
                                                   <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully Generated data at: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_data_folder</span><span class="p">))</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_backup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Snap backup completed successfully&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validation for snap backup&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_extentbased_subclient</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running backupcopy job from storage policy&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backup copy job completed successfully&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_client</span> <span class="o">=</span> <span class="n">Machine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s2">&quot;RestoreClient&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">tape_outplace_restore_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s2">&quot;RestoreLocation&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">source_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcinputs</span><span class="p">[</span><span class="s2">&quot;SourcePath&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tape_outplace</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outplace_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">tape_outplace_restore_location</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">snapconstants</span><span class="o">.</span><span class="n">windows_restore_client</span><span class="p">)</span>
        <span class="n">remove_msg</span> <span class="o">=</span> <span class="s2">&quot;Removing registry entries </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2"> under </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">enable</span><span class="p">,</span> <span class="n">slab</span><span class="p">,</span> <span class="n">fsa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">remove_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_registry</span><span class="p">(</span><span class="n">fsa</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_machine</span><span class="o">.</span><span class="n">remove_registry</span><span class="p">(</span><span class="n">fsa</span><span class="p">,</span> <span class="n">slab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Snap Backup and restore with Extent Base Feature Test case completed Successfully&quot;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Commvault Systems Inc. All Rights Reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>