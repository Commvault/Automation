
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AutomationUtils.unix_machine &#8212; Commvault Automation 11.12 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for AutomationUtils.unix_machine</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># pylint: disable=W0703</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Copyright Commvault Systems, Inc.</span>
<span class="c1"># See LICENSE.txt in the project root for</span>
<span class="c1"># license information.</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;File for performing operations on a machine / computer with UNIX Operating System.</span>

<span class="sd">This file consists of a class named: Machine, which can connect to the remote machine,</span>
<span class="sd">using CVD, if it is a Commvault Client, or using UNIX Shell, otherwise.</span>

<span class="sd">The instance of this class can be used to perform various operations on a machine, like,</span>

<span class="sd">    #.  Check if a Directory Exists or not</span>
<span class="sd">    #.  Create a new Directory</span>
<span class="sd">    #.  Rename a File / Folder</span>
<span class="sd">    #.  Remove an existing Directory</span>
<span class="sd">    #.  Get the Size of a File / Folder</span>
<span class="sd">    #.  Check if a Registry exists or not</span>
<span class="sd">    #.  Add / Update a Registry Key / Value</span>
<span class="sd">    #.  Get the Value of a Registry Key</span>
<span class="sd">    #.  Delete a Registry Key / Value</span>
<span class="sd">    #.  Compare the contents of 2 Files / Folders</span>


<span class="sd">UnixMachine</span>
<span class="sd">===========</span>

<span class="sd">    __init__()                      --  initialize object of the class</span>

<span class="sd">    _login_with_credentials()       --  establishes an SSH session to the client using paramiko</span>

<span class="sd">    _execute_with_credential()      --  execute a script on a remote client using its credentials</span>

<span class="sd">    _execute_with_cvd()             --  execute a script on a remote client using the CVD service</span>

<span class="sd">    _get_file_hash()                --  returns the hash value of specified file</span>

<span class="sd">    _get_folder_hash()              --  returns the set of file paths and hash values</span>

<span class="sd">    _execute_script()               --  executes a UNIX Shell script on the remote machine</span>

<span class="sd">    _copy_file_from_local()         --  copy a file from the controller machine to the remote</span>
<span class="sd">    machine</span>

<span class="sd">    _get_files_or_folders_in_path() --  returns the list of files / folders present at the given</span>
<span class="sd">    path based on the operation type given</span>

<span class="sd">    reboot_client()                 --  Reboots the remote machine</span>

<span class="sd">    kill_process()                --  Kills a process in the remote machine</span>

<span class="sd">    execute_command()               --  executes a UNIX Shell / bash command on the remote machine</span>

<span class="sd">    check_directory_exists()        --  checks if a directory exists on a remote client or not</span>

<span class="sd">    check_file_exists()             --  checks if a file exists on a remote client or not</span>

<span class="sd">    create_directory()              --  creates a new directory on a remote client</span>

<span class="sd">    rename_file_or_folder()         --  renames a file / folder on a remote client</span>

<span class="sd">    remove_directory()              --  removes a directory on a remote client</span>

<span class="sd">    get_file_size()                 --  get the size of a file on a remote client</span>

<span class="sd">    get_folder_size()               --  get the size of a folder on a remote client</span>

<span class="sd">    get_storage_details()           --  gets the details of storage of the client</span>

<span class="sd">    check_registry_exists()         --  check if a registry exists on a remote client or not</span>

<span class="sd">    get_registry_value()            --  get the value of a registry key from a remote client</span>

<span class="sd">    create_registry()               --  create a registry key / value on a remote client</span>

<span class="sd">    update_registry()               --  update the data of a registry value on a remote client</span>

<span class="sd">    remove_registry()               --  remove a registry key / value from a remote client</span>

<span class="sd">    copy_from_local()               --  copy a file / folder from the controller machine</span>
<span class="sd">    to the remote machine</span>

<span class="sd">    copy_folder()                   --  copy a folder from one location to another on same</span>
<span class="sd">    local machine</span>

<span class="sd">    create_file()                   --  creates a file on the remote machine</span>

<span class="sd">    mount_network_path()            --  mounts the network shared path</span>

<span class="sd">    unmount_path()                  --  dis mounts the network path mounted at specified path</span>

<span class="sd">    copy_folder_to_network_share()  --  copies the source folder from controller to network path</span>

<span class="sd">    copy_folder_from_network_share() -- copies the folder from network path to the local</span>

<span class="sd">    generate_test_data()            --  generates and adds random testdata on the specified path</span>

<span class="sd">    modify_test_data()              --  Modifies the test data at the given path</span>

<span class="sd">    get_test_data_info()            --  Gets information about the items on the given path</span>

<span class="sd">    get_uname_output()              --  Gets the uname output from the machine</span>

<span class="sd">    get_registry_dict()             --  Gets dictionary of all the commvault registry</span>
<span class="sd">    keys and values</span>

<span class="sd">    get_items_list()                --  Gets the list of items at the given path</span>

<span class="sd">    get_meta_list()                 --  Gets the list of meta data of items</span>
<span class="sd">    from the machine on a give path</span>

<span class="sd">    compare_meta_data()             --  Compares the meta data of source path with destination path</span>
<span class="sd">    and checks if they are same.</span>

<span class="sd">    get_checksum_list()             --  Gets the list of checksum of items</span>
<span class="sd">    from the machine on a give path</span>

<span class="sd">    compare_checksum()              --  Compares the checksum of source path with destination path</span>
<span class="sd">    and checks if they are same</span>

<span class="sd">    get_acl_list()                  --  Gets the list of acl of items</span>
<span class="sd">    from the machine on a give path</span>

<span class="sd">    compare_acl()                   --  Compares the acl of source path with destination path</span>
<span class="sd">    and checks if they are same</span>

<span class="sd">    get_xattr_list()                --  Gets the list of xattr of items</span>
<span class="sd">    from the machine on a give path</span>

<span class="sd">    compare_xattr()                 --  Compares the xattr of source path with destination path</span>
<span class="sd">    and checks if they are same</span>

<span class="sd">    get_disk_count()                --  returns the number of disks on the machine</span>

<span class="sd">    change_folder_owner()           --  changes the owner of the given folder as the given user</span>

<span class="sd">    get_files_in_path()             --  returns the list of files present at the given path</span>

<span class="sd">    get_folders_in_path()           --  returns the list of folders present at the given path</span>

<span class="sd">    disconnect()                    --  disconnects the session with the machine</span>

<span class="sd">    add_firewall_machine_exclusion()--  Adds given machine to firewall exclusion list</span>

<span class="sd">    add_firewall_allow_port_rule()  --  Adds the inbound rule for the given port number</span>

<span class="sd">    start_firewall()                --  turn on firewall services on the current client machine</span>

<span class="sd">    remove_firewall_allow_port_rule()-- removes the inbound rule for the given port number</span>

<span class="sd">    stop_firewall()                  -- turn off firewall service on the current client machine</span>

<span class="sd">    remove_firewall_machine_exclusion()</span>
<span class="sd">                                     -- removes given machine from firewall exclusion list</span>

<span class="sd">    get_firewall_state()             -- get the state of firewall on current machine</span>

<span class="sd">Attributes</span>
<span class="sd">----------</span>

<span class="sd">    **is_connected**        --  returns boolean specifying whether connection is alive or not</span>

<span class="sd">    **key**                 --  returns the base path of the Registry Key of Commvault Instance</span>

<span class="sd">    **os_flavour**          --  returns the flavour of the UNIX distribution</span>

<span class="sd">    **instance**            --  returns the Commvault instance registry currently being interacted</span>
<span class="sd">    with</span>

<span class="sd">    **instance.setter**     --  set the value of the Commvault instance to interact with</span>

<span class="sd">    **tmp_dir**             --  returns the path of the **tmp** directory on the Machine where the</span>
<span class="sd">    temporary database files are stored</span>

<span class="sd">    **os_sep**              --  returns the path separator based on the OS of the Machine</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">posixpath</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">paramiko</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="kn">from</span> <span class="nn">.constants</span> <span class="k">import</span> <span class="n">UNIX_CREATE_REGISTRY</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="k">import</span> <span class="n">UNIX_MANAGE_DATA</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="k">import</span> <span class="n">UNIX_PROBLEM_DATA</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="k">import</span> <span class="n">UNIX_REGISTRY_EXISTS</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="k">import</span> <span class="n">UNIX_SET_REG_VALUE</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="k">import</span> <span class="n">UNIX_TMP_DIR</span>
<span class="kn">from</span> <span class="nn">.machine</span> <span class="k">import</span> <span class="n">Machine</span>
<span class="kn">from</span> <span class="nn">.output_formatter</span> <span class="k">import</span> <span class="n">UnixOutput</span>
<span class="kn">from</span> <span class="nn">.script_generator</span> <span class="k">import</span> <span class="n">ScriptGenerator</span>


<div class="viewcode-block" id="UnixMachine"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine">[docs]</a><span class="k">class</span> <span class="nc">UnixMachine</span><span class="p">(</span><span class="n">Machine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for performing operations on a UNIX OS remote client.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commcell_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes instance of the Machine class.</span>

<span class="sd">            Args:</span>
<span class="sd">                machine_name        (str)       --  name / ip address of the client to connect to</span>

<span class="sd">                    if machine name is not provided, then the Machine object for the local machine</span>
<span class="sd">                    will be created</span>

<span class="sd">                    default:    None</span>

<span class="sd">                commcell_object     (object)    --  instance of the Commcell class from CVPySDK</span>

<span class="sd">                    default:    None</span>

<span class="sd">                username            (str)       --  username for the client to connect to</span>

<span class="sd">                        Only Applicable if the client is not a Commvault Client</span>

<span class="sd">                    default:    None</span>

<span class="sd">                password            (str)       --  password for the above specified user</span>

<span class="sd">                    default:    None</span>

<span class="sd">            Also, initializes the Client object, if it is Commvault Client.</span>

<span class="sd">            Otherwise, it creates a paramiko SSH client object for the client.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UnixMachine</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">machine_name</span><span class="p">,</span> <span class="n">commcell_object</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_script_generator</span> <span class="o">=</span> <span class="n">ScriptGenerator</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="s1">&#39;Instance001&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;/etc/CommVaultRegistry/Galaxy/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">%s</span><span class="s1">/.properties&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_os_info</span> <span class="o">=</span> <span class="s2">&quot;UNIX&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_uname_output</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_login_with_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Establishes a SSH connection to the UNIX client.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">load_system_host_keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">machine_name</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">AuthenticationException</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Authentication Failed. Invalid credentials provided.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_with_credential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">script_arguments</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the script remotely on a client using the credentials provided,</span>
<span class="sd">            if the client is not a Commvault client.</span>

<span class="sd">            Args:</span>
<span class="sd">                script              (str)   --  path of the script file to execute on the</span>
<span class="sd">                remote client</span>

<span class="sd">                script_arguments    (str)   --  arguments to be passed to the script</span>

<span class="sd">                    default: None</span>

<span class="sd">            Returns:</span>
<span class="sd">                object  -   instance of UnixOutput class</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">script_arguments</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">script_arguments</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">script_arguments</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_local_machine</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>
                <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                    <span class="s1">&#39;sed -i &quot;s/</span><span class="se">\r</span><span class="s1">//&quot; </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script</span><span class="p">),</span>
                    <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
                <span class="p">)</span>

                <span class="n">script</span> <span class="o">=</span> <span class="s1">&#39;bash </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">script</span><span class="p">,</span> <span class="n">script_arguments</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">script</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">script_arguments</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">script</span><span class="p">,</span>
                <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">UnixOutput</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">remove_temp_file</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>
                <span class="n">script_base_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">script</span><span class="p">))</span>
                <span class="n">sftp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">open_sftp</span><span class="p">()</span>
                <span class="n">sftp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">script</span><span class="p">),</span>
                    <span class="s1">&#39;/tmp/</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_base_name</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">sftp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span>
                    <span class="s1">&#39;sed -i &quot;s/</span><span class="se">\r</span><span class="s1">//&quot; /tmp/</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_base_name</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
                <span class="n">script</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;bash /tmp/</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_base_name</span><span class="p">,</span>
                                               <span class="n">script_arguments</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">remove_temp_file</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">script</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">script_arguments</span><span class="p">)</span>

            <span class="n">__</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>

            <span class="n">output</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">stdout</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">recv_ready</span><span class="p">():</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

                <span class="k">while</span> <span class="n">stderr</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">recv_ready</span><span class="p">():</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">stderr</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

                <span class="k">if</span> <span class="n">stdout</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">exit_status_ready</span><span class="p">():</span>
                    <span class="k">break</span>

            <span class="n">exit_code</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">recv_exit_status</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">remove_temp_file</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span>
                    <span class="s1">&#39;rm -rf /tmp/</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_base_name</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">UnixOutput</span><span class="p">(</span><span class="n">exit_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="n">error</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_execute_with_cvd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">script_arguments</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the script remotely on a client using the CVD service running on the client.</span>
<span class="sd">            Only applicable if the client is a Commvault Client.</span>

<span class="sd">            Args:</span>
<span class="sd">                script  (str)   --  path of the script file to execute on the client remotely</span>

<span class="sd">                script_arguments (str)  --  arguments to the script</span>

<span class="sd">            Returns:</span>
<span class="sd">                object  -   instance of UnixOutput class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>
            <span class="n">exit_code</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">error_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_object</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span>
                <span class="s1">&#39;UnixShell&#39;</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">script_arguments</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exit_code</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">error_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_object</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span>
                <span class="n">script</span><span class="p">,</span> <span class="n">script_arguments</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">UnixOutput</span><span class="p">(</span><span class="n">exit_code</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_file_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns MD5 hash value of the specified file at the given file path.</span>

<span class="sd">            Args:</span>
<span class="sd">                file_path       (str)   --  path of the file to get the hash value of</span>

<span class="sd">            Returns:</span>
<span class="sd">                str     -   hash value of the given file</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if file path doesn&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_file_exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> file does not exist on </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_name</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;find </span><span class="si">{0}</span><span class="s1"> -type f -print0 | xargs -0 md5sum&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_folder_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns set of files and their MD5 hash values present on the input path.</span>

<span class="sd">            Args:</span>
<span class="sd">                directory_path      (str)   --  path of the directory to get hash values of</span>

<span class="sd">            Returns:</span>
<span class="sd">                set     -   set consisting of the file paths and their hash value as tuple</span>
<span class="sd">                    set(</span>
<span class="sd">                        (file_path1, hash1),</span>
<span class="sd">                        (file_path2, hash2)</span>
<span class="sd">                    )</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if specified directory path doesn&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> path does not exist on </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">directory_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_name</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;find </span><span class="si">{0}</span><span class="s1"> -type f -print0 | xargs -0 md5sum&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">format_output</span><span class="p">(</span><span class="n">output_list</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Parses the output list received from UnixOutput class object,</span>
<span class="sd">                and returns a set of paths, and their hash value</span>

<span class="sd">                Args:</span>
<span class="sd">                    output_list     (list)  --  list of the output to parse</span>

<span class="sd">                Returns:</span>
<span class="sd">                    set     -   set consisting of the file paths and their hash value as tuple</span>
<span class="sd">                        set(</span>
<span class="sd">                            (file_path1, hash1),</span>
<span class="sd">                            (file_path2, hash2)</span>
<span class="sd">                        )</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">hash_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">output_list</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">output</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="n">directory_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="n">hash_values</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">hash_values</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">format_output</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script_path</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executes a UNIX Shell script on the machine.</span>

<span class="sd">            Args:</span>
<span class="sd">                script_path     (str)   --  Shell script to be executed on the machine</span>
<span class="sd">                    script should be of same format as other UNIX Shell scripts present in</span>
<span class="sd">                        ..\\Scripts\\UNIX\\</span>

<span class="sd">                data            (dict)  --  dictionary consisting of the variables and its values,</span>
<span class="sd">                                                to be substituted in the script</span>

<span class="sd">            Returns:</span>
<span class="sd">                object  -   instance of UnixOutput class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_script_generator</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">script_path</span>
        <span class="n">execute_script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_script_generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">execute_script</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">execute_script</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">_copy_file_from_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="n">remote_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies the local file to the remote UNIX client.</span>

<span class="sd">            Args:</span>
<span class="sd">                local_path      (str)   --  path of the local file to copy</span>

<span class="sd">                remote_path     (str)   --  path on the client to copy the file at</span>
<span class="sd">                        copies the file to Desktop, if not provided</span>
<span class="sd">                    default: None</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if local_path is not a valid file</span>

<span class="sd">                    if failed to copy the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Input path is not a valid file&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">remote_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">remote_path</span> <span class="o">=</span> <span class="s1">&#39;/root/Desktop/&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_commvault_client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_object</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">remote_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">remote_path</span><span class="p">)</span>

            <span class="n">remote_path</span> <span class="o">=</span> <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">remote_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">sftp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">open_sftp</span><span class="p">()</span>
                <span class="n">sftp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">)</span>
                <span class="n">sftp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s1">&#39;Failed to copy the file. Please check the permissions&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_get_files_or_folders_in_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">operation_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of all the files / folders at the given folder path.</span>

<span class="sd">            Args:</span>
<span class="sd">                folder_path     (str)   --  full path of the folder to get the</span>
<span class="sd">                list of files / folders from</span>

<span class="sd">                operation_type  (str)   --  type of the operation, i.e., whether to get the files</span>
<span class="sd">                or the folders from the given folder path</span>

<span class="sd">                    Valid values are</span>

<span class="sd">                    -   FILE</span>

<span class="sd">                    -   FOLDER</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    -   list of the files / folders present at the given path</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if path is not valid</span>

<span class="sd">                    if failed to get the list of files / folders</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Please give a valid path&#39;</span><span class="p">)</span>

        <span class="n">operation_type</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span> <span class="k">if</span> <span class="n">operation_type</span> <span class="o">==</span> <span class="s1">&#39;FILE&#39;</span> <span class="k">else</span> <span class="s1">&#39;d&#39;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;find </span><span class="si">{folder_path}</span><span class="s1"> -type </span><span class="si">{operation_type}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns boolean specifying whether the connection to the machine is open or closed.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_object</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_object</span><span class="o">.</span><span class="n">is_ready</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># use the command `df` instead of `ls`, as it is not</span>
                    <span class="c1"># available on NAS filers</span>
                    <span class="n">__</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s1">&#39;df&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_local_machine</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the value of key attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">os_flavour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the value of key attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the value of instance attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span>

    <span class="nd">@instance</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the value of instance attribute.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;Instance&#39;</span> <span class="ow">in</span> <span class="n">instance</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="s1">&#39;Instance</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;/etc/CommVaultRegistry/Galaxy/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">%s</span><span class="s1">/.properties&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tmp_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the path of the **tmp** directory on the UNIX Machine, where temporary</span>
<span class="sd">            database files are stored.</span>

<span class="sd">            default value:  /tmp/</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create directory should always be called, to ensure that the directory exists,</span>
        <span class="c1"># and ADD it if it does not exists on the machine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">UNIX_TMP_DIR</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">UNIX_TMP_DIR</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">os_sep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the path separator based on the OS of the Machine.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;/&quot;</span>

<div class="viewcode-block" id="UnixMachine.reboot_client"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.reboot_client">[docs]</a>    <span class="k">def</span> <span class="nf">reboot_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reboots the machine.</span>

<span class="sd">            Please NOTE that the connectivity will go down in this scenario, and the Machine</span>
<span class="sd">            class may not be able to re-establish the connection to the Machine.</span>

<span class="sd">            In such cases, the user will have to initialize the Machine class instance again.</span>

<span class="sd">            Args:</span>
<span class="sd">                None</span>

<span class="sd">            Returns:</span>
<span class="sd">                object  -   instance of the UnixOutput class</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to reboot the client</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;reboot&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="UnixMachine.kill_process"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.kill_process">[docs]</a>    <span class="k">def</span> <span class="nf">kill_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">process_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Terminates a running process on the client machine with either the given</span>
<span class="sd">            process name or the process id.</span>

<span class="sd">            Args:</span>
<span class="sd">                process_name    (str)   --  name of the process to be terminate</span>

<span class="sd">                process_id      (str)   --  ID of the process ID to be terminated</span>

<span class="sd">            Returns:</span>
<span class="sd">                object  -   instance of the UnixOutput class</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if neither the process name nor the process id is given</span>

<span class="sd">                    if failed to kill the process</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">process_name</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;pkill -f </span><span class="si">{process_name}</span><span class="s1">&#39;</span>
        <span class="k">elif</span> <span class="n">process_id</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;kill -9 </span><span class="si">{process_id}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Please provide either the process Name or the process ID&#39;</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="UnixMachine.execute_command"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.execute_command">[docs]</a>    <span class="k">def</span> <span class="nf">execute_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executes a UNIX Shell command on the machine.</span>

<span class="sd">            An instance of the **UnixOutput** class is returned.</span>

<span class="sd">            Output / Exception messages received from command execution are</span>
<span class="sd">            available as the attributes of the class instance.</span>

<span class="sd">                output_instance.output              --  raw output returned from the command</span>

<span class="sd">                output_instance.formatted_output    --  o/p received after parsing the raw output</span>

<span class="sd">                output_instance.exception           --  raw exception message</span>

<span class="sd">                output_instance.exception_message   --  parsed exception message from the raw o/p</span>


<span class="sd">            Args:</span>
<span class="sd">                command     (str)   --  UNIX Shell command to be executed on the machine</span>

<span class="sd">            Returns:</span>
<span class="sd">                object  -   instance of UnixOutput class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span></div>

    <span class="c1"># OS related functions</span>
<div class="viewcode-block" id="UnixMachine.check_directory_exists"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.check_directory_exists">[docs]</a>    <span class="k">def</span> <span class="nf">check_directory_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if a directory exists on the client or not.</span>

<span class="sd">            Args:</span>
<span class="sd">                directory_path  (str)   --  path of the directory to check</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool    -   boolean value whether the directory exists or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;if test -d &quot;</span><span class="si">{0}</span><span class="s1">&quot;; then echo &quot;TRUE&quot;; fi&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory_path</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span></div>

<div class="viewcode-block" id="UnixMachine.check_file_exists"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.check_file_exists">[docs]</a>    <span class="k">def</span> <span class="nf">check_file_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if a file exists on the client or not.</span>

<span class="sd">            Args:</span>
<span class="sd">                file_path  (str)   --  name of the file to check</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool    -   boolean value whether the file exists or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;if test -f &quot;</span><span class="si">{0}</span><span class="s1">&quot;; then echo &quot;TRUE&quot;; fi&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span></div>

<div class="viewcode-block" id="UnixMachine.create_directory"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.create_directory">[docs]</a>    <span class="k">def</span> <span class="nf">create_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a directory on the client, if it does not exist.</span>

<span class="sd">            Args:</span>
<span class="sd">                directory_name  (str)   --  name / full path of the directory to create</span>

<span class="sd">            Returns:</span>
<span class="sd">                None    -   if directory creation was successful</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if directory already exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;mkdir -p </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="UnixMachine.rename_file_or_folder"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.rename_file_or_folder">[docs]</a>    <span class="k">def</span> <span class="nf">rename_file_or_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Renames a file or a folder on the client.</span>

<span class="sd">            Args:</span>
<span class="sd">                old_name    (str)   --  name / full path of the directory to rename</span>

<span class="sd">                new_name    (str)   --  new name / full path of the directory</span>

<span class="sd">            Returns:</span>
<span class="sd">                None    -   if the file or folder was renamed successfully</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to rename the file or folder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;mv </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="UnixMachine.remove_directory"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.remove_directory">[docs]</a>    <span class="k">def</span> <span class="nf">remove_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_name</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes a directory on the client.</span>
<span class="sd">            If days is specified then directories older than given days</span>
<span class="sd">            will be cleaned up</span>

<span class="sd">            Args:</span>
<span class="sd">                directory_name  (str)   --  name / full path of the directory to remove</span>

<span class="sd">                days            (int)   --  dirs older than the given days will be cleaned up</span>

<span class="sd">                    default: None</span>

<span class="sd">            Returns:</span>
<span class="sd">                None    -   if directory was removed successfully</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred during cleanup</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">days</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;rm -rf </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory_name</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">cleanup_cmd</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;find  &quot;&#39;</span> <span class="o">+</span> <span class="n">directory_name</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;/* -prune -type d -mtime +&#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>
                <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39; -exec rm -rf &quot;</span><span class="si">{}</span><span class="s1">&quot; \;&#39;</span>
            <span class="p">)</span>

            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cleanup_cmd</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Error occurred while cleaning up the test data &quot;</span>
                    <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span>
                    <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.get_file_size"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_file_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_file_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the size of a file on the client.</span>

<span class="sd">            Args:</span>
<span class="sd">                file_path   (str)   --  path of the file to get the size of</span>

<span class="sd">            Returns:</span>
<span class="sd">                float   -   size of the file on the client (in MB)</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to get the size of the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;du </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1024.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.get_folder_size"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_folder_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_folder_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the size of a folder on the client.</span>

<span class="sd">            Args:</span>
<span class="sd">                folder_path     (str)   --  path of the folder to get the size of</span>

<span class="sd">            Returns:</span>
<span class="sd">                float   -   size of the folder on the client (in MB)</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if failed to get the size of the folder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;du </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1024.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.get_storage_details"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_storage_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_storage_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the details of the Storage on the Client.</span>
<span class="sd">            Returns the details of all paths, if root is set to the default value False.</span>
<span class="sd">            If root is set to True, it returns the details of only `/`</span>

<span class="sd">            Args:</span>
<span class="sd">                root    (bool)  --  boolean flag to specify whether to return details of all paths,</span>
<span class="sd">                                        or the details of the path mounted on root(/)</span>

<span class="sd">            Returns:</span>
<span class="sd">                dict - dictionary consisting the details of the storage on the client (in MB)</span>

<span class="sd">                {</span>
<span class="sd">                    &#39;total&#39;: size_in_MB,</span>
<span class="sd">                    &#39;available&#39;: size_in_MB,</span>
<span class="sd">                    &#39;drive&#39;: {</span>
<span class="sd">                        &#39;total&#39;: size_in_MB,</span>
<span class="sd">                        &#39;available&#39;: size_in_MB,</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;df&#39;</span>

        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">+=</span> <span class="s1">&#39; /&#39;</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">storage_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;available&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;mountpoint&#39;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">drive_name</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">total_space</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1024.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">free_space</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1024.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">mount_point</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

                <span class="n">storage_dict</span><span class="p">[</span><span class="n">drive_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total_space</span><span class="p">,</span>
                    <span class="s1">&#39;available&#39;</span><span class="p">:</span> <span class="n">free_space</span><span class="p">,</span>
                    <span class="s1">&#39;mountpoint&#39;</span><span class="p">:</span> <span class="n">mount_point</span>
                <span class="p">}</span>

                <span class="n">storage_dict</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">total_space</span>
                <span class="n">storage_dict</span><span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">free_space</span>
                <span class="n">storage_dict</span><span class="p">[</span><span class="s1">&#39;mountpoint&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mount_point</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="n">storage_dict</span></div>

    <span class="c1"># Registry related operations</span>
<div class="viewcode-block" id="UnixMachine.check_registry_exists"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.check_registry_exists">[docs]</a>    <span class="k">def</span> <span class="nf">check_registry_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if a registry key / value exists on the client or not.</span>

<span class="sd">            Args:</span>
<span class="sd">                key     (str)   --  registry path of the key</span>

<span class="sd">                value   (str)   --  value of the registry key</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool    -   boolean value whether the registry key / value exists or not</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if the registry key does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_script_generator</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">UNIX_REGISTRY_EXISTS</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">%</span> <span class="n">key</span><span class="p">,</span>
            <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">value</span>
        <span class="p">}</span>
        <span class="n">registry_exists_script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_script_generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">registry_exists_script</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">registry_exists_script</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="UnixMachine.get_registry_value"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_registry_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_registry_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the data of a registry key and value on the client.</span>

<span class="sd">            Args:</span>
<span class="sd">                key     (str)       --  registry path of the key</span>

<span class="sd">                value   (str)       --  value of the registry key</span>

<span class="sd">            Returns:</span>
<span class="sd">                str     -   data of the value of the registry key</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_script_generator</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">UNIX_REGISTRY_EXISTS</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">%</span> <span class="n">key</span><span class="p">,</span>
            <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">value</span>
        <span class="p">}</span>

        <span class="n">get_reg_value_script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_script_generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">get_reg_value_script</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">get_reg_value_script</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span></div>

<div class="viewcode-block" id="UnixMachine.create_registry"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.create_registry">[docs]</a>    <span class="k">def</span> <span class="nf">create_registry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a registry key / value on the client, if it does not exist.</span>

<span class="sd">            Args:</span>
<span class="sd">                key     (str)       --  registry path of the key</span>

<span class="sd">                value   (str)       --  value of the registry key</span>

<span class="sd">                data    (str)       --  data for the registry value</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool    -   if registry key / value creation was successful</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception(Exception_Code, Exception_Message):</span>
<span class="sd">                    if failed to create the registry key</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_script_generator</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">UNIX_CREATE_REGISTRY</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">%</span> <span class="n">key</span><span class="p">,</span>
            <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">data</span>
        <span class="p">}</span>

        <span class="n">create_registry_script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_script_generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_registry_script</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">create_registry_script</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="UnixMachine.update_registry"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.update_registry">[docs]</a>    <span class="k">def</span> <span class="nf">update_registry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the value of a registry key / Adds the key (if it does not exist) on the client.</span>

<span class="sd">            Args:</span>
<span class="sd">                key     (str)       --  registry path of the key</span>

<span class="sd">                value   (str)       --  value of the registry key</span>

<span class="sd">                data    (str)       --  data for the registry value</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool    -   if registry value was updated successfully</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_script_generator</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">UNIX_SET_REG_VALUE</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">%</span> <span class="n">key</span><span class="p">,</span>
            <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">data</span>
        <span class="p">}</span>

        <span class="n">update_reg_value_script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_script_generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">update_reg_value_script</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">update_reg_value_script</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="UnixMachine.remove_registry"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.remove_registry">[docs]</a>    <span class="k">def</span> <span class="nf">remove_registry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes a registry key / value on the client.</span>

<span class="sd">            Args:</span>
<span class="sd">                key     (str)       --  registry path of the key</span>

<span class="sd">                value   (str)       --  value of the registry key</span>

<span class="sd">            Returns:</span>
<span class="sd">                None    -   if registry key / value removal was successful</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;sed -i &quot;/^</span><span class="si">{0}</span><span class="s1">/d&quot; </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;rm -f </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="UnixMachine.copy_from_local"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.copy_from_local">[docs]</a>    <span class="k">def</span> <span class="nf">copy_from_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies the file / folder present at the given path to the path specified on the</span>
<span class="sd">            remote machine.</span>

<span class="sd">            Args:</span>
<span class="sd">                local_path      (str)   --  path of the file / folder on the local machine</span>

<span class="sd">                remote_path     (str)   --  path of the directory to which the file / folder</span>
<span class="sd">                should be copied on the remote machine</span>

<span class="sd">            Returns:</span>
<span class="sd">                (bool, list)    -   tuple consisting of a</span>

<span class="sd">                **bool** output specifying whether the file / folder was copied successfully or not</span>

<span class="sd">                    True    -   all files / folders were copied successfully</span>

<span class="sd">                    False   -   failed to copy some files / folders</span>

<span class="sd">                **list** consisting of the items failed to be copied</span>

<span class="sd">                    list consisiting of items that were not copied</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception(Exception_Code, Exception_Message):</span>
<span class="sd">                    if failed to copy the file / folder</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Local Path specified does not exist&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_file_from_local</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">failed_items_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">remote_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">remote_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_commvault_client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_object</span><span class="o">.</span><span class="n">upload_folder</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
                <span class="n">local_item_path</span> <span class="o">=</span> <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                <span class="n">remote_item_path</span> <span class="o">=</span> <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">remote_path</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_item_path</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_file_from_local</span><span class="p">(</span>
                            <span class="n">local_item_path</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">failed_items_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_item_path</span><span class="p">)</span>
                        <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">sftp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">open_sftp</span><span class="p">()</span>
                        <span class="n">sftp</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">remote_item_path</span><span class="p">)</span>
                        <span class="n">sftp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_from_local</span><span class="p">(</span>
                        <span class="n">local_item_path</span><span class="p">,</span> <span class="n">remote_item_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">failed_items_list</span></div>

<div class="viewcode-block" id="UnixMachine.create_file"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.create_file">[docs]</a>    <span class="k">def</span> <span class="nf">create_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a file at specified path on this machine</span>

<span class="sd">            Args:</span>
<span class="sd">                file_path   (str)   --  path of file to be created</span>

<span class="sd">                content     (str)   --  content that is to be written to file</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool    -   file creation was successful or not</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception(Exception_Code, Exception_Message):</span>
<span class="sd">                    if failed to create file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;echo &quot;</span><span class="si">{1}</span><span class="s1">&quot; &gt; </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="UnixMachine.mount_network_path"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.mount_network_path">[docs]</a>    <span class="k">def</span> <span class="nf">mount_network_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network_path</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mounts the specified cifs share path on this machine</span>

<span class="sd">            Args:</span>
<span class="sd">                network_path    (str)   --  cifs share path that is to be mounted</span>

<span class="sd">                username        (str)   --  username to access network path</span>
<span class="sd">                    Ex: DOMAIN\\USERNAME</span>

<span class="sd">                password        (str)   --  password to access network path</span>

<span class="sd">            Returns:</span>
<span class="sd">                (str)   -   mounted drive name</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception(Exception_Code, Exception_Message):</span>
<span class="sd">                    if failed to mount network path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">random_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
        <span class="n">mount_path</span> <span class="o">=</span> <span class="s2">&quot;/Mount&quot;</span> <span class="o">+</span> <span class="n">random_string</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">mount_path</span><span class="p">)</span>

        <span class="n">network_path</span> <span class="o">=</span> <span class="n">network_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">username</span><span class="p">,</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">username</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">username</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">mount_command</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;mount -t cifs -o username=</span><span class="si">{0}</span><span class="s1">,password=</span><span class="si">{1}</span><span class="s1">,domain=</span><span class="si">{2}</span><span class="s1"> &quot;</span><span class="si">{3}</span><span class="s1">&quot; </span><span class="si">{4}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">network_path</span><span class="p">,</span> <span class="n">mount_path</span>
        <span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">mount_command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mount_path</span></div>

<div class="viewcode-block" id="UnixMachine.unmount_path"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.unmount_path">[docs]</a>    <span class="k">def</span> <span class="nf">unmount_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mount_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dis mounts the mounted path</span>

<span class="sd">            Args:</span>
<span class="sd">                mount_path  (str)   --  path which is mounted on this machine</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool    - dis mount network path operation status</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception(Exception_Code, Exception_Message):</span>
<span class="sd">                    if failed to mount network path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unmount_cmd</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;umount &#39;</span> <span class="o">+</span> <span class="n">mount_path</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">unmount_cmd</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="UnixMachine.copy_folder_to_network_share"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.copy_folder_to_network_share">[docs]</a>    <span class="k">def</span> <span class="nf">copy_folder_to_network_share</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">network_path</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies the source directory on controller machine to cifs share share path</span>

<span class="sd">            Args:</span>
<span class="sd">                source_path     (str)   --  source directory whose contents are to be copied</span>

<span class="sd">                network_path    (str)   --  cifs share path where the files are to be copied</span>

<span class="sd">                username        (str)   --  username to access network path</span>
<span class="sd">                    Ex: DOMAIN\\USERNAME</span>

<span class="sd">                password        (str)   --  password to access network path</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool    -   status of copy folder to network path</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception(Exception_Code, Exception_Message):</span>
<span class="sd">                    if failed to mount network path</span>


<span class="sd">                    if failed to copy files to mounted drive</span>

<span class="sd">                    if failed to un mount network drive</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Mount Network shared path on this machine</span>
        <span class="n">mount_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount_network_path</span><span class="p">(</span><span class="n">network_path</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

        <span class="n">copy_cmd</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;cp -R &quot;</span><span class="si">{0}</span><span class="s1">&quot; &quot;</span><span class="si">{1}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">mount_path</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">copy_cmd</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="c1"># Un mount network shared path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unmount_path</span><span class="p">(</span><span class="n">mount_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="UnixMachine.copy_folder"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.copy_folder">[docs]</a>    <span class="k">def</span> <span class="nf">copy_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies the directory specified at source path to the destination path.</span>

<span class="sd">            Args:</span>
<span class="sd">                source_path     (str)   --  source directory to be copied</span>

<span class="sd">                destination_path    (str)   --  destination path where the folder has to be copied</span>


<span class="sd">            Raises:</span>
<span class="sd">                Exception(Exception_Code, Exception_Message):</span>
<span class="sd">                    if failed to connect to the machine where the copy has to done locally</span>

<span class="sd">                    if failed to copy files from source to destination</span>

<span class="sd">                    if either of the source or destination path specifies is wrong</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copy_cmd</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;cp -R &quot;</span><span class="si">{0}</span><span class="s1">&quot; &quot;</span><span class="si">{1}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">copy_cmd</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.read_file"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.read_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the contents of the file present at the specified file path.</span>

<span class="sd">            Args:</span>
<span class="sd">                file_path   (str)   --  full path of the file to get the contents of</span>

<span class="sd">            Returns:</span>
<span class="sd">                str     -   string consisting of the file contents</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if no file exists at the given path</span>

<span class="sd">                    if failed to get the contents of the file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s1">&#39;cat </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span></div>

<div class="viewcode-block" id="UnixMachine.delete_file"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.delete_file">[docs]</a>    <span class="k">def</span> <span class="nf">delete_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes the file present at the specified file path.</span>

<span class="sd">            Args:</span>
<span class="sd">                file_path   (str)   --  full path of the file to be removed</span>

<span class="sd">            Returns:</span>
<span class="sd">                None    -   if the file was removed successfully</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if no file exists at the given path</span>

<span class="sd">                    if failed to remove the file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s1">&#39;rm -f </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">exception_code</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.generate_test_data"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.generate_test_data">[docs]</a>    <span class="k">def</span> <span class="nf">generate_test_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">file_path</span><span class="p">,</span>
            <span class="n">dirs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">files</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">file_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">levels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">hlinks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">slinks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">sparse_hole_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
            <span class="n">acls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">unicode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xattr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">long_path</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">long_level</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span>
            <span class="n">problematic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates and adds random test data</span>
<span class="sd">            at the given path with the specified options</span>

<span class="sd">            Args:</span>
<span class="sd">                file_path           (str)   --  directory path where</span>
<span class="sd">                                                the data will be generated.</span>

<span class="sd">                dirs                (int)   --  number of directories</span>
<span class="sd">                                                in each level</span>
<span class="sd">                    default: 3</span>

<span class="sd">                files               (int)   --  number of files</span>
<span class="sd">                                                in each directory</span>
<span class="sd">                    default: 5</span>

<span class="sd">                file_size           (int)   --  Size of the files in KB</span>
<span class="sd">                    default: 20</span>

<span class="sd">                levels              (int)   --  number of levels to be created</span>
<span class="sd">                    default: 1</span>

<span class="sd">                hlinks              (bool)  --  whether to create</span>
<span class="sd">                                                hardlink files</span>
<span class="sd">                    default: True</span>

<span class="sd">                slinks              (bool)  --  whether to create</span>
<span class="sd">                                                symbolic link files</span>
<span class="sd">                    default: True</span>

<span class="sd">                sparse              (bool)  --  whether to create sparse files</span>
<span class="sd">                    default: True</span>

<span class="sd">                sparse_hole_size    (int)   --  Size of the holes</span>
<span class="sd">                                                in sparse files in KB</span>
<span class="sd">                    default: 1024</span>

<span class="sd">                long_path           (bool)  --  whether to create long files</span>
<span class="sd">                    default: False</span>

<span class="sd">                long_level          (int)   --  length of the long path</span>
<span class="sd">                    default: 1500</span>

<span class="sd">                acls                (bool)  --  whether to create</span>
<span class="sd">                                                files with acls</span>
<span class="sd">                    default: False</span>

<span class="sd">                unicode             (bool)  --  whether to create</span>
<span class="sd">                                                unicode files</span>
<span class="sd">                    default: False</span>

<span class="sd">                problematic         (bool)  --  whether to create</span>
<span class="sd">                                                problematic data</span>
<span class="sd">                    default: False</span>

<span class="sd">                xattr               (bool)  --  whether to create files</span>
<span class="sd">                                                with xattr</span>
<span class="sd">                    default: False</span>

<span class="sd">                options             (str)   --  to specify any other</span>
<span class="sd">                                                additional parameters</span>
<span class="sd">                                                to the script.</span>
<span class="sd">                    default: &quot;&quot;</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool    -   boolean value True is returned</span>
<span class="sd">                            if no errors during data generation.</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while generating the test data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">script_arguments</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;-optype add -path </span><span class="se">\&quot;</span><span class="si">{0}</span><span class="se">\&quot;</span><span class="s2"> -dirs </span><span class="si">{1}</span><span class="s2"> -files </span><span class="si">{2}</span><span class="s2"> -sizeinkb </span><span class="si">{3}</span><span class="s2"> -levels </span><span class="si">{4}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">file_path</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">dirs</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">files</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">file_size</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">levels</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">hlinks</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -hlinks yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -hlinks no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">slinks</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -slinks yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -slinks no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sparse</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -sparse yes&quot;</span>
                                <span class="s2">&quot; -holesizeinkb </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">script_arguments</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">sparse_hole_size</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -sparse no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">long_path</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -long yes&quot;</span>
                                <span class="s2">&quot; -longlevel </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">script_arguments</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">long_level</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -long no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">acls</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -acls yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -acls no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xattr</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -xattr yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -xattr no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unicode</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -unicode yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -unicode no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="n">delete_tar</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">problematic</span><span class="p">:</span>
            <span class="n">tar_tmp_path</span> <span class="o">=</span> <span class="s2">&quot;/tmp/</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="n">tar_tmp_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_file_from_local</span><span class="p">(</span><span class="n">UNIX_PROBLEM_DATA</span><span class="p">,</span> <span class="n">tar_tmp_path</span><span class="p">)</span>
            <span class="n">custom_tar_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">/</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tar_tmp_path</span><span class="p">,</span>
                                               <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">UNIX_PROBLEM_DATA</span><span class="p">))</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -customtar </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">script_arguments</span><span class="p">,</span> <span class="n">custom_tar_path</span><span class="p">)</span>
            <span class="n">delete_tar</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">UNIX_MANAGE_DATA</span><span class="p">,</span> <span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">delete_tar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_directory</span><span class="p">(</span><span class="n">tar_tmp_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Error occurred while generating test data &quot;</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="UnixMachine.modify_test_data"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.modify_test_data">[docs]</a>    <span class="k">def</span> <span class="nf">modify_test_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">data_path</span><span class="p">,</span>
                         <span class="n">rename</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">modify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">acls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">xattr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">permissions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">slinks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">hlinks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">options</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Modifies the test data at the given path</span>
<span class="sd">            based on the specified options</span>

<span class="sd">            Args:</span>
<span class="sd">                data_path   (str)   --  directory path where</span>
<span class="sd">                                        dataset resides.</span>

<span class="sd">                rename              (bool)  --  whether to rename all files</span>
<span class="sd">                    default: False</span>

<span class="sd">                modify              (bool)  --  whether to modify</span>
<span class="sd">                                                data of all files</span>
<span class="sd">                    default: False</span>

<span class="sd">                hlinks              (bool)  --  whether to add hard link</span>
<span class="sd">                                                to all files</span>
<span class="sd">                    default: False</span>

<span class="sd">                permissions         (bool)  --  whether to change permission</span>
<span class="sd">                                                of all files</span>
<span class="sd">                    default: False</span>

<span class="sd">                slinks              (bool)  --  whether to add symbolic link</span>
<span class="sd">                                                to all files</span>
<span class="sd">                    default: False</span>

<span class="sd">                acls                (bool)  --  whether to change</span>
<span class="sd">                                                acls of all files</span>
<span class="sd">                    default: False</span>

<span class="sd">                xattr               (bool)  --  whether to change</span>
<span class="sd">                                                xattr of all files</span>
<span class="sd">                    default: False</span>

<span class="sd">                options             (str)   --  to specify any other</span>
<span class="sd">                                                additional parameters</span>
<span class="sd">                                                to the script.</span>
<span class="sd">                    default: &quot;&quot;</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool    -   boolean value True is returned</span>
<span class="sd">                            if no errors during data generation.</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while modifying the test data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;-optype change -path </span><span class="se">\&quot;</span><span class="si">{0}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rename</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -rename yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -rename no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">modify</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -modify yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -modify no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">permissions</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -permissions yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -permissions no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hlinks</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -hlinks yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -hlinks no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">slinks</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -slinks yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -slinks no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">acls</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -acls yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -acls no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xattr</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -xattr yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -xattr no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">UNIX_MANAGE_DATA</span><span class="p">,</span> <span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Error occurred while modifying test data &quot;</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="UnixMachine.get_test_data_info"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_test_data_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_test_data_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">data_path</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">meta</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">checksum</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">acls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">xattr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">dirtime</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">machinesort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">options</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets information about the items on the given path</span>
<span class="sd">            based on the given options</span>

<span class="sd">            Args:</span>
<span class="sd">                data_path             (str)   --  directory path from where</span>
<span class="sd">                                                  the data should be retrieved.</span>

<span class="sd">                name                  (bool)  --  whether to get</span>
<span class="sd">                                                  name of all the files</span>
<span class="sd">                    default: False</span>

<span class="sd">                meta                  (bool)  --  whether to get</span>
<span class="sd">                                                  meta data of all files</span>
<span class="sd">                    default: True</span>

<span class="sd">                checksum              (bool)  --  whether to get</span>
<span class="sd">                                                  OS checksum of all files</span>
<span class="sd">                    default: False</span>

<span class="sd">                machinesort           (bool)  --  whether to sort</span>
<span class="sd">                                                  the results on the machine</span>
<span class="sd">                    default: False</span>

<span class="sd">                acls                  (bool)  --  whether to get</span>
<span class="sd">                                                  acls of all files</span>
<span class="sd">                    default: False</span>

<span class="sd">                xattr                 (bool)  --  whether to get</span>
<span class="sd">                                                  xattr of all files</span>
<span class="sd">                    default: False</span>

<span class="sd">                dirtime               (bool)  --  whether to get</span>
<span class="sd">                                                  time stamp of all directories</span>
<span class="sd">                    default: False</span>

<span class="sd">                options               (str)   --  to specify any other</span>
<span class="sd">                                                  additional parameters</span>
<span class="sd">                                                  to the script.</span>
<span class="sd">                    default: &quot;&quot;</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    -   list of output lines while executing the script.</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while getting the data information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;-optype get -path </span><span class="se">\&quot;</span><span class="si">{0}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -name yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -name no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">meta</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -meta yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -meta no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">checksum</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -sum yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -sum no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">acls</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -acls yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -acls no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xattr</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -xattr yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -xattr no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dirtime</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -dirtime yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -dirtime no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">machinesort</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -sorted yes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> -sorted no&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">)</span>

        <span class="n">script_arguments</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_arguments</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">UNIX_MANAGE_DATA</span><span class="p">,</span> <span class="n">script_arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Error occurred while getting the data information &quot;</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span></div>

<div class="viewcode-block" id="UnixMachine.get_uname_output"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_uname_output">[docs]</a>    <span class="k">def</span> <span class="nf">get_uname_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="s2">&quot;-s&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the uname output from the machine</span>

<span class="sd">            Args:</span>
<span class="sd">                options     (str)   --  options to uname command</span>
<span class="sd">                    default: &quot;-s&quot;</span>
<span class="sd">            Returns:</span>
<span class="sd">                str    -   uname output</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while getting the uname output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">uname_cmd</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;uname  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">uname_cmd</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Error occurred while getting uname output. &quot;</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span></div>

<div class="viewcode-block" id="UnixMachine.get_registry_dict"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_registry_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_registry_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets dictionary of all the commvault registry keys and values</span>
<span class="sd">             from the machine</span>

<span class="sd">            Returns:</span>
<span class="sd">                dict    -   commvault registry keys and values</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while getting the registry keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reg_command</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;find /etc/CommVaultRegistry/Galaxy/&#39;</span>
                       <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">+</span> <span class="s1">&#39;/ -name .properties | xargs cat&#39;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">reg_command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Error occurred while getting all registry keys &quot;</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span>
            <span class="p">)</span>

        <span class="n">reg_list</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reg_list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No output returned for command :  &quot;</span> <span class="o">+</span> <span class="n">reg_command</span><span class="p">)</span>

        <span class="c1"># Convert the list output to dict of key value pairs.</span>
        <span class="n">reg_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">reg_list</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">item_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item_len</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">reg_dict</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">elif</span> <span class="n">item_len</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">reg_dict</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">reg_dict</span></div>

<div class="viewcode-block" id="UnixMachine.get_items_list"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_items_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_items_list</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data_path</span><span class="p">,</span>
            <span class="n">sorted_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">include_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the list of items at the given path.</span>

<span class="sd">            Args:</span>
<span class="sd">                data_path           (str)    --  directory path</span>
<span class="sd">                                                 to get the items list</span>

<span class="sd">                sorted              (bool)   --  to specify whether</span>
<span class="sd">                                                 the list should be sorted.</span>
<span class="sd">                    default: True</span>

<span class="sd">                include_parents     (bool)   --  to specify whether</span>
<span class="sd">                                                 parent paths should be include</span>
<span class="sd">                    default: False</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    -   list of the items</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while getting the items list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">find_cmd</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;find  &quot;</span><span class="si">{0}</span><span class="s1">&quot; &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">find_cmd</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Error occurred while getting items list from machine &quot;</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span>
                <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">exception</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_list</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">include_parents</span><span class="p">:</span>
                <span class="n">data_path</span> <span class="o">=</span> <span class="n">data_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;//&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="n">parent_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;/&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">itr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data_path</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)):</span>
                    <span class="n">parent_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_path</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">itr</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">output_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parent_list</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sorted_output</span><span class="p">:</span>
                <span class="n">output_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="c1"># remove empty items and return output list</span>
            <span class="k">while</span> <span class="s1">&#39;&#39;</span> <span class="ow">in</span> <span class="n">output_list</span><span class="p">:</span>
                <span class="n">output_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output_list</span></div>

<div class="viewcode-block" id="UnixMachine.get_meta_list"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_meta_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_meta_list</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data_path</span><span class="p">,</span>
            <span class="n">sorted_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dirtime</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the list of meta data of items from the machine on a give path</span>

<span class="sd">             Args:</span>
<span class="sd">                data_path     (str)   --  directory path</span>
<span class="sd">                                            to get meta data of the items list</span>

<span class="sd">                sorted_output (bool)  --  to specify whether</span>
<span class="sd">                                            the list should be sorted.</span>

<span class="sd">                dirtime       (bool)  --  whether to get</span>
<span class="sd">                                            time stamp of all directories</span>
<span class="sd">                    default: False</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    -   list of meta data of items from  the machine</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while getting the meta data of items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">meta_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_data_info</span><span class="p">(</span>
                <span class="n">data_path</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dirtime</span><span class="o">=</span><span class="n">dirtime</span><span class="p">)</span>
            <span class="n">meta_list</span> <span class="o">=</span> <span class="n">meta_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="s1">&#39;&#39;</span> <span class="ow">in</span> <span class="n">meta_list</span><span class="p">:</span>
                <span class="n">meta_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sorted_output</span><span class="p">:</span>
                <span class="n">meta_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">meta_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Error occurred while getting meta data from machine &#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.compare_meta_data"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.compare_meta_data">[docs]</a>    <span class="k">def</span> <span class="nf">compare_meta_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">,</span> <span class="n">dirtime</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compares the meta data of source path with destination path</span>
<span class="sd">            and checks if they are same.</span>

<span class="sd">             Args:</span>
<span class="sd">                source_path         (str)   -- source path to compare</span>

<span class="sd">                destination_path    (str)   -- destination path to compare</span>

<span class="sd">                dirtime             (bool)  --  whether to get</span>
<span class="sd">                                            time stamp of all directories</span>
<span class="sd">                    default: False</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool, str   -   Returns True</span>
<span class="sd">                                 if metadata of source and destination are same</span>
<span class="sd">                                diff output between source and destination</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred</span>
<span class="sd">                        while comparing the meta data of paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">source_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_meta_list</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">dirtime</span><span class="o">=</span><span class="n">dirtime</span><span class="p">)</span>
            <span class="n">destination_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_meta_list</span><span class="p">(</span>
                <span class="n">destination_path</span><span class="p">,</span> <span class="n">dirtime</span><span class="o">=</span><span class="n">dirtime</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare_lists</span><span class="p">(</span><span class="n">source_list</span><span class="p">,</span> <span class="n">destination_list</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Error occurred while comparing the metadata: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.get_checksum_list"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_checksum_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_checksum_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">sorted_output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the list of checksum of items from the machine on a give path</span>
<span class="sd">            this is Unix checksum , can&#39;t be used for md5sum comparision</span>

<span class="sd">             Args:</span>
<span class="sd">                data_path      (str)   --  directory path</span>
<span class="sd">                                            to get the checksum list</span>

<span class="sd">                sorted_output  (bool)  --  to specify whether</span>
<span class="sd">                                            the checksum list should be sorted.</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    -   list of checksum of items from  the machine</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while getting the checksum of items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">checksum_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_data_info</span><span class="p">(</span>
                <span class="n">data_path</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">checksum_list</span> <span class="o">=</span> <span class="n">checksum_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="s1">&#39;&#39;</span> <span class="ow">in</span> <span class="n">checksum_list</span><span class="p">:</span>
                <span class="n">checksum_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sorted_output</span><span class="p">:</span>
                <span class="n">checksum_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">checksum_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Error occurred while getting checksum list from machine &#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.compare_checksum"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.compare_checksum">[docs]</a>    <span class="k">def</span> <span class="nf">compare_checksum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compares the checksum of source path with destination path</span>
<span class="sd">            and checks if they are same. (This is Unix checksum)</span>

<span class="sd">             Args:</span>
<span class="sd">                source_path         (str) -- source path to compare</span>

<span class="sd">                destination_path    (str) -- destination path to compare</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool, str   -   Returns True</span>
<span class="sd">                                 if checksum of source and destination are same</span>
<span class="sd">                                diff output between source and destination</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred</span>
<span class="sd">                        while comparing the checksum of paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">source_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_checksum_list</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span>
            <span class="n">destination_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_checksum_list</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare_lists</span><span class="p">(</span><span class="n">source_list</span><span class="p">,</span> <span class="n">destination_list</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Error occurred while comparing the checksums: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.get_acl_list"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_acl_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_acl_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">sorted_output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the list of acl of items from the machine on a give path</span>

<span class="sd">             Args:</span>
<span class="sd">                data_path     (str)   -- directory path to get the acl list</span>

<span class="sd">                sorted_output (bool)  -- to specify whether</span>
<span class="sd">                                            the acl list should be sorted.</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    -   list of acl of items from  the machine</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while getting the acl of items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">acl_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_data_info</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">acls</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;linux&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">acl_list</span> <span class="o">=</span> <span class="n">acl_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;# file:&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;darwin&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">output_list</span> <span class="o">=</span> <span class="n">acl_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">acl_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">acl_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">current_key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">output_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">)):</span>
                        <span class="n">meta_data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>
                            <span class="n">current_key</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">current_key</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                        <span class="n">acl_dict</span><span class="p">[</span><span class="n">current_key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
                            <span class="p">(</span><span class="s2">&quot; 0&quot;</span><span class="p">,</span> <span class="s2">&quot; 1&quot;</span><span class="p">,</span> <span class="s2">&quot; 2&quot;</span><span class="p">,</span> <span class="s2">&quot; 3&quot;</span><span class="p">,</span> <span class="s2">&quot; 4&quot;</span><span class="p">,</span>
                             <span class="s2">&quot; 5&quot;</span><span class="p">,</span> <span class="s2">&quot; 6&quot;</span><span class="p">,</span> <span class="s2">&quot; 7&quot;</span><span class="p">,</span> <span class="s2">&quot; 8&quot;</span><span class="p">,</span> <span class="s2">&quot; 9&quot;</span><span class="p">)):</span>
                        <span class="n">acl_dict</span><span class="p">[</span><span class="n">current_key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">acl_dict</span><span class="p">[</span><span class="n">current_key</span><span class="p">],</span> <span class="n">item</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">acl_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">acl_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> ::: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acl_list</span> <span class="o">=</span> <span class="n">acl_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">while</span> <span class="s1">&#39;&#39;</span> <span class="ow">in</span> <span class="n">acl_list</span><span class="p">:</span>
                <span class="n">acl_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sorted_output</span><span class="p">:</span>
                <span class="n">acl_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">acl_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Error occurred while getting acl list from machine &#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.compare_acl"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.compare_acl">[docs]</a>    <span class="k">def</span> <span class="nf">compare_acl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compares the acl of source path with destination path</span>
<span class="sd">            and checks if they are same.</span>

<span class="sd">             Args:</span>
<span class="sd">                source_path         (str)  -- source path to compare</span>

<span class="sd">                destination_path    (str)  -- destination path to compare</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool, str   -   Returns True</span>
<span class="sd">                                 if acls of source and destination are same</span>
<span class="sd">                                diff output between source and destination</span>
<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while comparing the acl of paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">source_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acl_list</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span>
            <span class="n">destination_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acl_list</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare_lists</span><span class="p">(</span><span class="n">source_list</span><span class="p">,</span> <span class="n">destination_list</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Error occurred while comparing the acls: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.get_xattr_list"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_xattr_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_xattr_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">sorted_output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the list of xattr of items from the machine on a give path</span>

<span class="sd">             Args:</span>
<span class="sd">                data_path      (str)   --  directory path to get the xattr list</span>

<span class="sd">                sorted_output  (bool)  --  to specify whether</span>
<span class="sd">                                            the xattr list should be sorted.</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    -   list of xattr of items from  the machine</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while getting the xattr of items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xattr_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_data_info</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">xattr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;linux&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">xattr_list</span> <span class="o">=</span> <span class="n">xattr_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Attribute&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xattr_list</span> <span class="o">=</span> <span class="n">xattr_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">while</span> <span class="s1">&#39;&#39;</span> <span class="ow">in</span> <span class="n">xattr_list</span><span class="p">:</span>
                <span class="n">xattr_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sorted_output</span><span class="p">:</span>
                <span class="n">xattr_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">xattr_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Error occurred while getting xattr list from machine &#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.compare_xattr"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.compare_xattr">[docs]</a>    <span class="k">def</span> <span class="nf">compare_xattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compares the xattr of source path with destination path</span>
<span class="sd">            and checks if they are same.</span>

<span class="sd">             Args:</span>
<span class="sd">                source_path         (str)   -- source path to compare</span>

<span class="sd">                destination_path    (str)   -- destination path to compare</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool, str   -   Returns True</span>
<span class="sd">                                 if xattr of source and destination are same</span>
<span class="sd">                                diff output between source and destination</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if any error occurred while comparing the xattr of paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">source_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xattr_list</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span>
            <span class="n">destination_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xattr_list</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare_lists</span><span class="p">(</span><span class="n">source_list</span><span class="p">,</span> <span class="n">destination_list</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Error occurred while comparing the xattrs: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excp</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.get_disk_count"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_disk_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_disk_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the number of disk in the machine</span>

<span class="sd">        return:</span>
<span class="sd">            disk_count  (int)   - disk count of the machine</span>

<span class="sd">        Raises:</span>
<span class="sd">                Exception(Exception_Code, Exception_Message):</span>
<span class="sd">                    if failed to get the disk count for the machine</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s1">&#39;lsblk&#39;</span><span class="p">)</span>
        <span class="n">mount_paths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">mount_paths</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mount_paths</span><span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.change_folder_owner"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.change_folder_owner">[docs]</a>    <span class="k">def</span> <span class="nf">change_folder_owner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes the owner of the folder given as the value of directory_path.</span>

<span class="sd">            Args:</span>
<span class="sd">                username        (str)   --  name of user to give ownership</span>

<span class="sd">                directory_path  (str)   --  path of the directory to change ownership</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool    -   boolean value if ownership change was successful</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if specified folder doesn&#39;t exist</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_directory_exists</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> path does not exist on </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">directory_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_name</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;if chown </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">; then echo &quot;TRUE&quot;; fi&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">username</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">formatted_output</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span></div>

<div class="viewcode-block" id="UnixMachine.get_files_in_path"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_files_in_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_files_in_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of all the files at the given folder path.</span>

<span class="sd">            Args:</span>
<span class="sd">                folder_path     (str)   --  full path of the folder to get the list of files from</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    -   list of the files present at the given path</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if path is not valid</span>

<span class="sd">                    if failed to get the list of files</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_files_or_folders_in_path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s1">&#39;FILE&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.get_folders_in_path"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_folders_in_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_folders_in_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of all the folders at the given folder path.</span>

<span class="sd">            Args:</span>
<span class="sd">                folder_path     (str)   --  full path of the folder to get the list of folders from</span>

<span class="sd">            Returns:</span>
<span class="sd">                list    -   list of the folders present at the given path</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if path is not valid</span>

<span class="sd">                    if failed to get the list of folders</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_files_or_folders_in_path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s1">&#39;FOLDER&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="UnixMachine.disconnect"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disconnects the current session with the machine.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">UnixMachine</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span></div>

<div class="viewcode-block" id="UnixMachine.add_firewall_allow_port_rule"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.add_firewall_allow_port_rule">[docs]</a>    <span class="k">def</span> <span class="nf">add_firewall_allow_port_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tunnel_port</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds the inbound rule for the given port number</span>

<span class="sd">            Args:</span>
<span class="sd">                tunnel_port (int): port number to be added in the inbound rule</span>

<span class="sd">            Returns:</span>
<span class="sd">                None: if rule addition is successful</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if command to add the firewall rule fails</span>
<span class="sd">                    if current os flavor is not supported</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># firewall-offline-cmd is used instead of firewall-cmd to handle the errors</span>
        <span class="n">rule_cmd</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Linux&quot;</span><span class="p">:</span> <span class="s2">&quot;firewall-offline-cmd --direct --add-rule ipv4 filter &quot;</span>
                             <span class="s2">&quot;INPUT 0 -p tcp --dport </span><span class="si">{0}</span><span class="s2"> -j ACCEPT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span> <span class="s2">&quot;echo </span><span class="se">\&quot;</span><span class="s2">pass in proto tcp from any port </span><span class="si">{0}</span><span class="se">\&quot;</span><span class="s2"> | pfctl -f -&quot;</span>
                    <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rule_cmd</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;current OS flavor </span><span class="si">{0}</span><span class="s2"> is not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">))</span>

        <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span><span class="p">:</span>  <span class="c1"># for linux we need to stop firewall first</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_firewall_state</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_firewall</span><span class="p">()</span>

        <span class="c1"># define the command based on os flavor</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">rule_cmd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tunnel_port</span><span class="p">)</span>

        <span class="n">cmd_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="c1"># As the command status differs for OSX and Linux, we need to handle it separately</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;success&quot;</span> <span class="ow">in</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
                <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">exit_code</span><span class="p">:</span>
                <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;adding firewall rule command </span><span class="si">{0}</span><span class="s2"> failed with &quot;</span>
                            <span class="s2">&quot;error </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">output</span><span class="p">))</span></div>

<div class="viewcode-block" id="UnixMachine.start_firewall"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.start_firewall">[docs]</a>    <span class="k">def</span> <span class="nf">start_firewall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;start firewall services on the current client machine</span>

<span class="sd">            Returns:</span>
<span class="sd">                None: if firewall started successfully</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if command to start firewall service fails</span>
<span class="sd">                    if current os flavor is not supported</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">start_firewall_cmd</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Linux&quot;</span><span class="p">:</span> <span class="s2">&quot;systemctl enable firewalld&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/libexec/ApplicationFirewall/socketfilterfw &quot;</span>
                                         <span class="s2">&quot;--setglobalstate on&quot;</span>
                              <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">start_firewall_cmd</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;current OS flavor </span><span class="si">{0}</span><span class="s2"> is not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">))</span>

        <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># define the command based on the os flavor</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">start_firewall_cmd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">]</span>
        <span class="n">cmd_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="c1"># As the command status differs for OSX and Linux, we need to handle it separately</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">exit_code</span><span class="p">:</span>
                <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;enabled&quot;</span> <span class="ow">in</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
                <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;starting firewall service command </span><span class="si">{0}</span><span class="s2"> failed with &quot;</span>
                            <span class="s2">&quot;error </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">output</span><span class="p">))</span></div>

<div class="viewcode-block" id="UnixMachine.remove_firewall_allow_port_rule"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.remove_firewall_allow_port_rule">[docs]</a>    <span class="k">def</span> <span class="nf">remove_firewall_allow_port_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tunnel_port</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;removes the inbound rule for the given port number</span>

<span class="sd">            Args:</span>
<span class="sd">                tunnel_port (int): port number to be removed in the inbound rule</span>

<span class="sd">            Returns:</span>
<span class="sd">                None: if rule deletion is successful</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if command to delete the firewall rule fails</span>
<span class="sd">                    if current os flavor is not supported</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># firewall-offline-cmd is used instead of firewall-cmd to handle the errors</span>
        <span class="n">rule_cmd</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Linux&quot;</span><span class="p">:</span> <span class="s2">&quot;firewall-offline-cmd --direct --remove-rule ipv4 filter &quot;</span>
                             <span class="s2">&quot;INPUT 0 -p tcp --dport </span><span class="si">{0}</span><span class="s2"> -j ACCEPT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span> <span class="s2">&quot;pfctl -F rules&quot;</span> <span class="c1"># TODO: need to explore on -a &lt;anchors&gt; options to</span>
                                               <span class="c1"># clear a specific rule</span>
                    <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rule_cmd</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;current OS flavor </span><span class="si">{0}</span><span class="s2"> is not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">))</span>

        <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># define the command based on os flavor</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">rule_cmd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tunnel_port</span><span class="p">)</span>

        <span class="n">cmd_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="c1"># As the command status differs for OSX and Linux we need to handle it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span><span class="p">:</span>
            <span class="c1"># in case of exception this rule may not be added. Hence &quot;not in list&quot;</span>
            <span class="c1"># is handled here</span>
            <span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="s2">&quot;not in list&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">msgs</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">output</span><span class="p">]):</span>
                <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">exit_code</span><span class="p">:</span>
                <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;deleting firewall rule command </span><span class="si">{0}</span><span class="s2"> failed with &quot;</span>
                            <span class="s2">&quot;error </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">output</span><span class="p">))</span></div>

<div class="viewcode-block" id="UnixMachine.stop_firewall"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.stop_firewall">[docs]</a>    <span class="k">def</span> <span class="nf">stop_firewall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;turn off firewall service on the current client machine</span>

<span class="sd">            Returns:</span>
<span class="sd">                None: firewall is turned off successfully</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if command to turn off firewall fails</span>
<span class="sd">                    if current os flavor is not supported</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stop_firewall_cmd</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Linux&quot;</span><span class="p">:</span> <span class="s2">&quot;service firewalld stop&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/libexec/ApplicationFirewall/socketfilterfw &quot;</span>
                                       <span class="s2">&quot;--setglobalstate off&quot;</span>
                             <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_firewall_cmd</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;current OS flavor </span><span class="si">{0}</span><span class="s2"> is not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">))</span>

        <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># define the command based on os flavor</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">stop_firewall_cmd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">]</span>
        <span class="n">cmd_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="c1"># As the command status differs for OSX and Linux, we need to handle it separately</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">exit_code</span><span class="p">:</span>
                <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;disabled&quot;</span> <span class="ow">in</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
                <span class="n">cmd_success</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;turn off firewall command </span><span class="si">{0}</span><span class="s2"> failed with &quot;</span>
                            <span class="s2">&quot;error </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">output</span><span class="p">))</span></div>

<div class="viewcode-block" id="UnixMachine.add_firewall_machine_exclusion"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.add_firewall_machine_exclusion">[docs]</a>    <span class="k">def</span> <span class="nf">add_firewall_machine_exclusion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine_to_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds given machine to firewall exclusion list. If machine details is</span>
<span class="sd">           not passed, it considers current machine and adds it to exclusion list.</span>

<span class="sd">            Args:</span>
<span class="sd">                machine_to_exclude (str): hostname or IP address to be added to</span>
<span class="sd">                    firewall exclusion list</span>

<span class="sd">            Returns:</span>
<span class="sd">                None: if machine is successfully added to firewall exclusion list</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if command to add the firewall exclusion rule fails</span>
<span class="sd">                    if current os flavor is not supported</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">add_firewall_exclusion</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Linux&quot;</span><span class="p">:</span> <span class="s2">&quot;firewall-offline-cmd --direct --add-rule ipv4 filter &quot;</span>
                                           <span class="s2">&quot;INPUT 0 -s </span><span class="si">{0}</span><span class="s2"> -j ACCEPT&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span> <span class="s2">&quot;echo </span><span class="se">\&quot;</span><span class="s2">pass in from </span><span class="si">{0}</span><span class="s2"> to any</span><span class="se">\&quot;</span><span class="s2"> | pfctl -f -&quot;</span>
                                  <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">add_firewall_exclusion</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;current OS flavor </span><span class="si">{0}</span><span class="s2"> is not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">machine_to_exclude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">machine_to_exclude</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span><span class="p">:</span>  <span class="c1"># for linux we need to stop firewall first</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_firewall_state</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_firewall</span><span class="p">()</span>

        <span class="c1"># define the command based on os flavor</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">add_firewall_exclusion</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">machine_to_exclude</span><span class="p">)</span>

        <span class="n">cmd_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">exit_code</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;adding firewall exclusion rule command </span><span class="si">{0}</span><span class="s2"> failed &quot;</span>
                            <span class="s2">&quot;with error </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">output</span><span class="p">))</span></div>

<div class="viewcode-block" id="UnixMachine.remove_firewall_machine_exclusion"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.remove_firewall_machine_exclusion">[docs]</a>    <span class="k">def</span> <span class="nf">remove_firewall_machine_exclusion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">excluded_machine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;removes given machine from firewall exclusion list. If machine details is</span>
<span class="sd">           not passed, it considers current machine and removes it from exclusion list.</span>

<span class="sd">                excluded_machine (str): hostname or IP address to be removed from</span>
<span class="sd">                    firewall exclusion list</span>

<span class="sd">            Returns:</span>
<span class="sd">                None: if machine is successfully removed from firewall exclusion list</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>
<span class="sd">                    if command to delete from firewall exclusion rule fails</span>
<span class="sd">                    if current os flavor is not supported</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">excluded_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">excluded_machine</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>

        <span class="n">remove_firewall_exclusion</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Linux&quot;</span><span class="p">:</span> <span class="s2">&quot;firewall-offline-cmd --direct --remove-rule &quot;</span>
                                              <span class="s2">&quot;ipv4 filter INPUT 0 -s </span><span class="si">{0}</span><span class="s2"> -j ACCEPT&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span> <span class="s2">&quot;pfctl -F rules&quot;</span>
                                    <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_firewall_exclusion</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;current OS flavor </span><span class="si">{0}</span><span class="s2"> is not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">))</span>

        <span class="c1"># define the command based on os flavor</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">remove_firewall_exclusion</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">excluded_machine</span><span class="p">)</span>
        <span class="n">cmd_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">exit_code</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;removing firewall exclusion command </span><span class="si">{0}</span><span class="s2"> failed with &quot;</span>
                            <span class="s2">&quot;error </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">output</span><span class="p">))</span></div>

<div class="viewcode-block" id="UnixMachine.get_firewall_state"><a class="viewcode-back" href="../../AutomationUtils.html#AutomationUtils.unix_machine.UnixMachine.get_firewall_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_firewall_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get the current state of the firewall service on the current machine</span>

<span class="sd">            Returns:</span>
<span class="sd">                True (bool): if firewall service is running</span>

<span class="sd">				False (bool): if firewall service is not running</span>

<span class="sd">                bool    -   boolean value if ownership change was successful</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception:</span>

<span class="sd">                    if command to get the firewall state rule fails</span>
<span class="sd">                    if current os flavor is not supported</span>
<span class="sd">                    if specified folder doesn&#39;t exist</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">firewall_cmd</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Linux&quot;</span><span class="p">:</span> <span class="s2">&quot;firewall-cmd --state&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/libexec/ApplicationFirewall/socketfilterfw &quot;</span>
                                  <span class="s2">&quot;--getglobalstate&quot;</span>
                       <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">firewall_cmd</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;current OS flavor </span><span class="si">{0}</span><span class="s2"> is not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">))</span>

        <span class="n">firewall_state_string</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Linux&quot;</span><span class="p">:</span> <span class="s2">&quot;running&quot;</span><span class="p">,</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span> <span class="s2">&quot;is enabled&quot;</span><span class="p">}</span>
        <span class="n">firewall_status</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="n">firewall_cmd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">]</span>

        <span class="n">cmd_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">firewall_state_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_os_flavour</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cmd_output</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="n">firewall_status</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">firewall_status</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Commvault Systems Inc. All Rights Reserved.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>